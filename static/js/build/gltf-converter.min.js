this["gltf-converter"]=this["gltf-converter"]||{},function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=document.querySelector("#original-preview-canvas"),i=document.querySelector("#result-preview-canvas"),o=document.querySelector("#previews"),a=document.querySelector("#fullscreen-button"),s=document.querySelector("#messages"),u=document.querySelector("#errors"),l=document.querySelector("#errors-container"),c=document.querySelector("#warnings"),d=document.querySelector("#warnings-container"),h=document.querySelector("#logs"),f=document.querySelector("#logs-container"),p={input:document.querySelector("#file-upload-input"),button:document.querySelector("#file-upload-button"),form:document.querySelector("#file-upload-form")},m={original:{bar:document.querySelector("#original-loading-bar"),overlay:document.querySelector("#original-loading-overlay"),progress:document.querySelector("#original-progress")},result:{bar:document.querySelector("#result-loading-bar"),overlay:document.querySelector("#result-loading-overlay"),progress:document.querySelector("#result-progress")}},v={trs:document.querySelector("#option_trs"),onlyVisible:document.querySelector("#option_visible"),truncateDrawRange:document.querySelector("#option_drawrange"),binary:document.querySelector("#option_binary"),embedImages:document.querySelector("#option_embedImages"),animations:document.querySelector("#option_animations"),exportGLTF:document.querySelector("#export")},y=function(){function e(){t(this,e)}return n(e,null,[{key:"setInitialState",value:function(){v.exportGLTF.disabled=!0,m.original.overlay.classList.remove("hide"),m.result.overlay.classList.remove("hide"),m.original.bar.classList.add("hide"),m.original.progress.style.width=0,m.result.bar.classList.add("hide"),m.result.progress.style.width=0}},{key:"setOnLoadStartState",value:function(){v.exportGLTF.disabled=!0,m.result.overlay.classList.remove("hide"),m.original.bar.classList.remove("hide"),s.classList.add("hide"),l.classList.add("hide"),d.classList.add("hide"),f.classList.add("hide"),u.innerHTML="",c.innerHTML="",h.innerHTML=""}},{key:"setOnLoadEndState",value:function(){m.original.overlay.classList.add("hide")}}]),e}();y.originalCanvas=r,y.resultCanvas=i,y.fileUpload=p,y.loading=m,y.controls=v,y.previews=o,y.fullscreenButton=a,y.messages=s,y.errorsContainer=l,y.errors=u,y.warningsContainer=d,y.warnings=c,y.logsContainer=f,y.logs=h;var g=console.warn.bind(console);function b(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.slice(1,t.length),i=0;return"string"==typeof t[0]?t[0].replace(/%s/g,function(e,t){return r.slice(i,++i)}):t[0]}console.error=function(){var e=b.apply(void 0,arguments);if(e){y.messages.classList.remove("hide"),y.errorsContainer.classList.remove("hide");var t=document.createElement("p");t.innerHTML=e,y.errors.append(t),g.apply(void 0,arguments)}};var w=console.warn.bind(console);console.warn=function(){var e=b.apply(void 0,arguments);if(e){y.messages.classList.remove("hide"),y.warningsContainer.classList.remove("hide");var t=document.createElement("p");t.innerHTML=e,y.warnings.append(t),w.apply(void 0,arguments)}};var E=console.log.bind(console);console.log=function(){var e=b.apply(void 0,arguments);if(e&&("function"!=typeof e.indexOf||-1===e.indexOf("THREE.WebGLRenderer"))){y.messages.classList.remove("hide"),y.logsContainer.classList.remove("hide");var t=document.createElement("p");t.innerHTML=e,y.logs.append(t),E.apply(void 0,arguments)}};y.fullscreenButton.addEventListener("click",function(e){var t;e.preventDefault(),t=y.previews,document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},!1),function(e){if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],r=function(e){return e&&DataView.prototype.isPrototypeOf(e)},i=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};c.prototype.append=function(e,t){e=s(e),t=u(t);var n=this.map[e];this.map[e]=n?n+","+t:t},c.prototype.delete=function(e){delete this.map[s(e)]},c.prototype.get=function(e){return e=s(e),this.has(e)?this.map[e]:null},c.prototype.has=function(e){return this.map.hasOwnProperty(s(e))},c.prototype.set=function(e,t){this.map[s(e)]=u(t)},c.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},c.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),l(e)},c.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),l(e)},c.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),l(e)},t.iterable&&(c.prototype[Symbol.iterator]=c.prototype.entries);var o=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},m.call(v.prototype),m.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new c(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var a=[301,302,303,307,308];g.redirect=function(e,t){if(-1===a.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})},e.Headers=c,e.Request=v,e.Response=g,e.fetch=function(e,n){return new Promise(function(r,i){var o=new v(e,n),a=new XMLHttpRequest;a.onload=function(){var e,t,n={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new c,e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}}),t)};n.url="responseURL"in a?a.responseURL:n.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;r(new g(i,n))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.open(o.method,o.url,!0),"include"===o.credentials&&(a.withCredentials=!0),"responseType"in a&&t.blob&&(a.responseType="blob"),o.headers.forEach(function(e,t){a.setRequestHeader(t,e)}),a.send(void 0===o._bodyInit?null:o._bodyInit)})},e.fetch.polyfill=!0}function s(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function u(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function c(e){this.map={},e instanceof c?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function f(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function p(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&r(e))this._bodyArrayBuffer=p(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!i(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=p(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,n,r=d(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}function v(e,t){var n,r,i=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new c(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new c(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),o.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function y(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}}),t}function g(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new c(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:void 0);var L=new THREE.LoadingManager,T=0,x=null;L.onStart=function(){y.setOnLoadStartState(),x=setInterval(function(){(T+=5)>=100?clearInterval(x):y.loading.original.progress.style.width=T+"%"},100)},L.onLoad=function(){y.setOnLoadEndState(),clearInterval(x)},L.onProgress=function(){T>=100||(T+=1,y.loading.original.progress.style.width=T+"%")},L.onError=function(e){console.error(e)};var S=function(e,t){return function(n){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(i,o){!0===r?e.parse(n,"",i,o):e.load(n,i,t.onProgress,o)})}},R=null,A=null,P=null,B=null,F=null,k=null,O=null,j=null,C=null,H=null,_=new function e(){return t(this,e),{get objectLoader(){return null===R&&(R=S(new THREE.ObjectLoader(L),L)),R},get bufferGeometryLoader(){return null===A&&(A=S(new THREE.BufferGeometryLoader(L),L)),A},get jsonLoader(){return null===P&&(P=S(new THREE.JSONLoader(L),L)),P},get fbxLoader(){return null===B&&(B=S(new THREE.FBXLoader(L),L)),B},get gltfLoader(){return null===F&&(F=S(new THREE.GLTFLoader(L),L)),F},get legacyGltfLoader(){return null===k&&(k=S(new THREE.LegacyGLTFLoader(L),L)),k},get objLoader(){return null===H&&(H=new THREE.OBJLoader(L),(O=S(H,L)).setMaterials=function(e){H.setMaterials(e)}),O},get mtlLoader(){return null===j&&(j=S(new THREE.MTLLoader(L),L)),j},get colladaLoader(){return null===C&&(C=S(new THREE.ColladaLoader(L),L)),C}}},q=document.createElement("a");q.style.display="none",document.body.appendChild(q);var D=function(e,t){q.href=URL.createObjectURL(e),q.download=t||"data.json",q.click()},U=new(function(){function e(){t(this,e),this.loader=_.gltfLoader,this.exporter=new THREE.GLTFExporter,this.initExportButton(),this.initOptionListeners()}return n(e,[{key:"getOptions",value:function(){var e={trs:y.controls.trs.checked,onlyVisible:y.controls.onlyVisible.checked,truncateDrawRange:y.controls.truncateDrawRange.checked,binary:y.controls.binary.checked,embedImages:y.controls.embedImages.checked,animations:y.controls.animations.checked,forceIndices:!0,forcePowerOfTwoTextures:!0};return e.animations&&this.animations.length>0&&(e.animations=this.animations),e}},{key:"setInput",value:function(e,t,n){this.input=e,this.animations=t,this.name=n,this.parse()}},{key:"parse",value:function(){var e=this;this.exporter.parse(this.input,function(t){e.result=t,e.processResult(t)},this.getOptions())}},{key:"loadPreview",value:function(){oe.resultPreview.reset(),_.gltfLoader(this.output,!0).then(function(e){y.loading.result.overlay.classList.add("hide"),y.controls.exportGLTF.disabled=!1,e.scenes.length>1?e.scenes.forEach(function(t){e.animations&&(t.animations=e.animations),oe.resultPreview.addObjectToScene(t)}):e.scene&&(e.animations&&(e.scene.animations=e.animations),oe.resultPreview.addObjectToScene(e.scene))}).catch(function(e){console.log(e),y.loading.result.overlay.classList.remove("hide"),y.controls.exportGLTF.disabled=!0})}},{key:"processResult",value:function(){this.setOutput(),this.loadPreview()}},{key:"updateInfo",value:function(e){var t=y.controls.binary.checked?"GLB":"GLTF";y.controls.exportGLTF.value=e<1e6?"Export as "+t+" ("+Math.ceil(.001*e)+"kb)":"Export as "+t+" ("+(1e-6*e).toFixed(3)+"mb)"}},{key:"setOutput",value:function(){this.result instanceof ArrayBuffer?(this.output=this.result,this.updateInfo(this.result.byteLength)):(this.output=JSON.stringify(this.result,null,2),this.updateInfo(function(e){for(var t=e.length,n=e.length-1;n>=0;n--){var r=e.charCodeAt(n);r>127&&r<=2047?t++:r>2047&&r<=65535&&(t+=2),r>=56320&&r<=57343&&n--}return t}(this.output)))}},{key:"save",value:function(){var e,t,n,r;this.output instanceof ArrayBuffer?(n=this.result,r=this.name+".glb",D(new Blob([n],{type:"application/octet-stream"}),r)):(e=this.output,t=this.name+".gltf",D(new Blob([e],{type:"text/plain"}),t))}},{key:"initExportButton",value:function(){var e=this;y.controls.exportGLTF.addEventListener("click",function(t){t.preventDefault(),e.output&&e.save(e.output)})}},{key:"initOptionListeners",value:function(){var e=this,t=function(t){t.preventDefault(),void 0!==e.input&&e.parse()};y.controls.trs.addEventListener("change",t,!1),y.controls.onlyVisible.addEventListener("change",t,!1),y.controls.truncateDrawRange.addEventListener("change",t,!1),y.controls.binary.addEventListener("change",t,!1),y.controls.embedImages.addEventListener("change",t,!1),y.controls.animations.addEventListener("change",t,!1)}}]),e}()),M=new THREE.MeshBasicMaterial({wireframe:!0,color:0}),I=function(e,t){e.traverse(function(e){e.material&&Array.isArray(e.material)&&console.error("Multimaterials are currently not supported.")});var n=[];e.animations&&(n=e.animations),oe.originalPreview.addObjectToScene(e),oe.resultPreview.reset(),U.setInput(e,n,t)},G=function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"scene",i=arguments[2];return n.then(function(e){e.isGeometry||e.isBufferGeometry?I(new THREE.Mesh(e,M)):e.isObject3D?I(e,r):e.scenes&&e.scenes.length>1?e.scenes.forEach(function(t){e.animations&&(t.animations=e.animations),I(t,r)}):e.scene?(e.animations&&(e.scene.animations=e.animations),I(e.scene,r)):console.error("No scene found in file!")}).catch(function(n){e(n.message)&&-1!==n.message.indexOf("Use LegacyGLTFLoader instead")?t(_.legacyGltfLoader(i)):console.error(n)}),n};function z(e,t){if(!(e instanceof Blob))throw new TypeError("Must be a File or Blob");return new Promise(function(n,r){var i=new FileReader;i.onload=function(e){n(e.target.result)},i.onerror=function(t){r(new Error("Error reading"+e.name+": "+t.target.result))},i["readAs"+t](e)})}window.File&&window.FileReader&&window.FileList&&window.Blob||console.error("This loader requires the File API. Please upgrade your browser");var N=function(e){return new RegExp("(png|jpg|jpeg|gif|bmp|dds|tga|bin|vert|frag|txt|mtl)$").test(e)},W=function(e){return new RegExp("(json|js|fbx|gltf|glb|dae|obj)$").test(e)},V=[],J={},X=[],$=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];switch(r){case"fbx":L.onStart(),G(_.fbxLoader(t),n);break;case"gltf":case"glb":L.onStart(),G(_.gltfLoader(t),n,t);break;case"obj":L.onStart(),_.mtlLoader(J[i.name.replace(".obj",".mtl")]).then(function(e){return _.objLoader.setMaterials(e),G(_.objLoader(t),n)}).catch(function(e){return console.error(e)});break;case"dae":L.onStart(),G(_.colladaLoader(t),n);break;case"json":case"js":L.onStart(),function(e,t,n){var r=JSON.parse(e);if(r.metadata){var i="";r.metadata.type&&(i=r.metadata.type.toLowerCase()),z(n,"DataURL").then(function(e){G("buffergeometry"===i?_.bufferGeometryLoader(e):"object"===i?_.objectLoader(e):_.jsonLoader(e),t)}).catch(function(e){return console.error(e)})}else console.error("Error: Invalid JSON file.")}(t,n,i);break;default:console.error("Unsupported file type "+r+" - please load one of the supported model formats.")}};L.setURLModifier(function(e){if("."===e[e.length-3]||"."===e[e.length-4]){var t=e.split(".").pop().toLowerCase();N(t)&&(e=(e=(e=e.replace("data:application/","")).split("/"))[e.length-1])}return void 0===J[e]?e:J[e]});var Y=function(e){var t,n=e.name.split("/").pop().split(".")[0],r=e.name.split(".").pop().toLowerCase();if(N(t=r)||W(t))if("js"===r||"json"===r){var i=z(e,"Text").then(function(t){V.push([t,n,r,e])}).catch(function(e){return console.error(e)});X.push(i)}else{var o=z(e,"DataURL").then(function(t){W(r)?"obj"===r?V.push([t,n,r,e]):V.push([t,n,r]):N(r)&&(J[e.name]=t)}).catch(function(e){return console.error(e)});X.push(o)}},K=function(e){V=[],J={},X=[];for(var t=0;t<e.length;t++)Y(e[t]);Promise.all(X).then(function(){V.forEach(function(e){return $(e)})}).catch(function(e){return console.error(e)})},Q=y.fileUpload.form,Z=y.fileUpload.button;function ee(e){var t=void 0,n=void 0,r=void 0,i=void 0,o=this;void 0!==e?this.canvas=e:console.warn("Canvas is undefined! "),this.autoRender=!0,this.autoResize=!0,this.frameCount=0,this.delta=0,this.isPlaying=!1,this.isPaused=!1,this.time=new function(){var e=void 0,t=0,n=0;this.running=!1,this.paused=!1;var r=1,i=0,o=0;Object.defineProperties(this,{now:{get:function(){return(performance||Date).now()}},timeScale:{get:function(){return r},set:function(e){i=this.totalTime,o=this.now,r=e}},unscaledTotalTime:{get:function(){return this.running?this.now-n:0}},totalTime:{get:function(){var e=(this.now-o)*this.timeScale;return this.running?i+e:0}},unscaledDelta:{get:function(){var e=this.now-t;return t=this.now,e}},delta:{get:function(){return this.unscaledDelta*this.timeScale}}}),this.start=function(){if(this.paused){var r=this.now-e;n+=r,t+=r,o+=r}else this.running||(n=t=o=this.now,i=0);this.running=!0,this.paused=!1},this.stop=function(){n=0,i=0,this.running=!1},this.pause=function(){e=this.now,this.paused=!0}};var a=function(){r&&r.setSize(o.canvas.clientWidth,o.canvas.clientHeight,!0)},s=function(){n&&(n.aspect=o.canvas.clientWidth/o.canvas.clientHeight,n.updateProjectionMatrix())};this.onWindowResize=function(){};window.addEventListener("resize",function(){o.autoResize?n&&("PerspectiveCamera"===n.type?(s(),a(),o.onWindowResize()):console.warn("App: AutoResize only works with PerspectiveCamera")):o.onWindowResize()},!1),Object.defineProperties(this,{camera:{get:function(){return void 0===n&&(n=new THREE.PerspectiveCamera(50,this.canvas.clientWidth/this.canvas.clientHeight,.1,1e3)),n},set:function(e){n=e,s()}},scene:{get:function(){return void 0===t&&(t=new THREE.Scene),t},set:function(e){t=e}},renderer:{get:function(){return void 0===r&&((r=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0})).setPixelRatio(window.devicePixelRatio),r.setSize(this.canvas.clientWidth,this.canvas.clientHeight,!1)),r},set:function(e){r=e,a()}},averageFrameTime:{get:function(){return 0!==this.frameCount?this.time.unscaledTotalTime/this.frameCount:0}}}),this.play=function(){this.time.start(),this.isPlaying=!0,this.isPaused=!1,function e(){o.frameCount++,o.delta=o.time.delta,o.onUpdate(),o.controls&&o.controls.enableDamping&&o.controls.update(),o.autoRender&&o.renderer.render(o.scene,o.camera),i=requestAnimationFrame(function(){e()})}()},this.pause=function(){this.isPaused=!0,this.time.pause(),cancelAnimationFrame(i)},this.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.time.stop(),this.frameCount=0,cancelAnimationFrame(i)},this.onUpdate=function(){},this.initControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.canvas),this.controls.enableDamping=!0,this.controls.dampingFactor=.2},this.fitCameraToObject=function(e,t){t=t||1;var n=new THREE.Box3;n.setFromObject(e);var r=n.getCenter(),i=n.getSize(),o=Math.max(i.x,i.y,i.z),a=this.camera.fov*(Math.PI/180),s=Math.abs(o/4*Math.tan(2*a));s*=t;var u=-n.min.z+s,l=3*u;return this.camera.far=l,this.camera.near=l<1?.001:l<100?.01:l<500?.1:1,this.controls.target.copy(r),this.controls.maxDistance=2*u,this.camera.position.set(r.x,i.y,s),this.camera.updateProjectionMatrix(),this.controls.update(),this.controls.saveState(),n}}Z.addEventListener("click",function(e){e.preventDefault(),y.fileUpload.input.click()},!1),y.fileUpload.input.addEventListener("change",function(e){e.preventDefault();var t=e.target.files;K(t)},!1),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){return Q.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation()})}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){return document.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation()})}),["dragover","dragenter"].forEach(function(e){return Q.addEventListener(e,function(){Z.style.background="#B82601"})}),["dragend","dragleave","drop"].forEach(function(e){return Q.addEventListener(e,function(){Z.style.background="#062f4f"})}),y.fileUpload.form.addEventListener("drop",function(e){var t=e.dataTransfer.files;K(t)});var te=function(){function e(){t(this,e),this.isPaused=!1,this.pauseButtonActive=!1,this.clips=[],this.mixers=[],this.actions=[],this.animationNames=[]}return n(e,[{key:"reset",value:function(){this.clips=[],this.mixers=[],this.actions=[],this.animationNames=[],this.currentMixer=null,this.currentAction=null,this.isPaused=!1,this.pauseButtonActive=!1}},{key:"update",value:function(e){this.currentMixer&&this.currentAction&&!this.isPaused&&(this.currentMixer.update(e/1e3),this.setSliderValue(this.currentAction.time))}},{key:"initAnimation",value:function(e){var t=this;e.animations&&0!==e.animations.length&&(e.animations.forEach(function(n){if(n instanceof THREE.AnimationClip){var r=new THREE.AnimationMixer(e),i=r.clipAction(n);t.clips.push(n),t.mixers.push(r),t.actions.push(i),t.animationNames.push(n.name)}else console.warn("Some animations are not valid THREE.AnimationClips. Skipping these.")}),0!==this.animationNames.length&&this.selectCurrentAnimation(this.animationNames[0]))}},{key:"selectCurrentAnimation",value:function(e){var t=this.animationNames.indexOf(e);-1===t?console.warn("Animation "+e+" not found."):(this.currentAction&&this.currentAction.stop(),this.currentMixer=this.mixers[t],this.currentAction=this.actions[t],this.currentClip=this.clips[t],this.currentAction.play())}},{key:"setSliderValue",value:function(e){}},{key:"initPlayPauseControls",value:function(){var e=this;this.playPause=function(t){t.preventDefault(),e.togglePause()}}},{key:"togglePause",value:function(){this.isPaused?(this.pauseButtonActive=!1,this.play()):(this.pauseButtonActive=!0,this.pause())}},{key:"pause",value:function(){this.isPaused=!0}},{key:"play",value:function(){this.isPaused=!1}}]),e}(),ne=function(){function e(n){t(this,e),this.app=n,this.initMaterials(),this.initMesh(),this.initButton()}return n(e,[{key:"initMesh",value:function(){var e=new THREE.PlaneBufferGeometry(2,2,1),t=new THREE.Mesh(e,this.mat);this.app.camera.add(t)}},{key:"initMaterials",value:function(){var e=(new THREE.TextureLoader).load("/images/textures/noise-256.jpg");e.wrapS=e.wrapT=THREE.RepeatWrapping,this.colA=new THREE.Color(16777215),this.colB=new THREE.Color(2635844);var t={color1:{value:this.colA},color2:{value:this.colB},noiseTexture:{value:e},vignetteAmount:{value:0},mixAmount:{value:.08}};this.mat=new THREE.RawShaderMaterial({uniforms:t,depthFunc:THREE.NeverDepth,vertexShader:"#define GLSLIFY 1\nattribute vec3 position;\nvarying vec2 uv;\nvoid main() {\n\tgl_Position = vec4( vec3( position.x, position.y, 1.0 ), 1.0 );\n\tuv = vec2(position.x, position.y) * 0.5;\n}\n",fragmentShader:"precision mediump float;\n#define GLSLIFY 1\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float vignetteAmount;\nuniform float mixAmount;\nuniform vec2 smooth;\nuniform sampler2D noiseTexture;\nvarying vec2 uv;\nvoid main() {\n\tfloat dst = length( uv );\n\tvec3 color = mix( color1, color2, dst );\n  vec2 texSize = vec2( 0.25, 0.25 );\n  vec2 phase = fract(  uv / texSize );\n\tvec3 noise = mix( color, texture2D( noiseTexture, phase ).rgb, mixAmount );\n\tvec4 col = vec4( mix( noise, vec3( vignetteAmount ), dot( uv, uv ) ), 1.0 );\n\tgl_FragColor = col;\n}"})}},{key:"initButton",value:function(){var e=!0;e?(this.mat.uniforms.mixAmount.value=.08,this.mat.uniforms.vignetteAmount.value=0):(this.mat.uniforms.mixAmount.value=.8,this.mat.uniforms.vignetteAmount.value=-1.6),e=!e}}]),e}(),re=function(){function e(n){t(this,e),this.app=n,this.initLights(),this.initialStrength=1.2}return n(e,[{key:"initLights",value:function(){var e=new THREE.AmbientLight(16777215,.3);this.app.scene.add(e),this.light=new THREE.PointLight(16777215,this.initialStrength),this.app.camera.add(this.light),this.app.scene.add(this.app.camera)}}]),e}(),ie=function(){function e(n){t(this,e);var r=this;this.canvas=n,this.app=new ee(this.canvas),this.animationControls=new te,this.app.onUpdate=function(){r.animationControls.update(r.app.delta)},this.app.onWindowResize=function(){},this.loadedObjects=new THREE.Group,this.loadedMaterials=[],this.app.scene.add(this.loadedObjects),this.lighting=new re(this.app),this.background=new ne(this.app),this.app.initControls()}return n(e,[{key:"addObjectToScene",value:function(e){this.reset(),void 0!==e?(this.animationControls.initAnimation(e),this.loadedObjects.add(e),this.app.fitCameraToObject(this.loadedObjects,.9),this.app.play()):console.error("Oops! An unspecified error occurred :(")}},{key:"reset",value:function(){for(;this.loadedObjects.children.length>0;){var e=this.loadedObjects.children[0];this.loadedObjects.remove(e),e=null}this.loadedMaterials=[],this.animationControls.reset()}}]),e}();THREE.Cache.enabled=!0;var oe=new function e(n,r){t(this,e),this.originalPreview=new ie(n),this.resultPreview=new ie(r)}(y.originalCanvas,y.resultCanvas)}();