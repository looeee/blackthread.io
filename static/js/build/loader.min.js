!function(){"use strict";var e,i=(function(e){var t,i,o,r,a,s,l,u,c,d;(t={exports:{}}).exports=function(){var t=null,n=0,i=0;this.running=!1,this.paused=!1;var o=1,r=0,a=0;Object.defineProperties(this,{now:{get:function(){return(performance||Date).now()}},timeScale:{get:function(){return o},set:function(e){r=this.totalTime,a=this.now,o=e}},unscaledTotalTime:{get:function(){return this.running?this.now-i:0}},totalTime:{get:function(){var e=(this.now-a)*this.timeScale;return this.running?r+e:0}},unscaledDelta:{get:function(){var e=this.now-n;return n=this.now,e}},delta:{get:function(){return this.unscaledDelta*this.timeScale}}}),this.start=function(){if(this.paused){var e=this.now-t;i+=e,n+=e,a+=e}else this.running||(i=n=a=this.now,r=0);this.running=!0,this.paused=!1},this.stop=function(){r=i=0,this.running=!1},this.pause=function(){t=this.now,this.paused=!0}},i=t.exports,o=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),u=l=s=a=r=void 0,c=function(){s&&l&&s.setSize(l.clientWidth,l.clientHeight,!1)},d=function(){a&&l&&(a.aspect=l.clientWidth/l.clientHeight,a.updateProjectionMatrix())},e.exports=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),u=e,void 0!==t?l=t:console.warn("Canvas is undefined! "),this.canvas=l,this.autoRender=!0,this.autoResize=!0,this.time=new i,this.frameCount=0,this.delta=0,this.isPlaying=!1,this.isPaused=!1,this.onResizeFunctions=[],this.onUpdateFunctions=[],this.preRenderFunctions=[],this.initOnWindowResize()}return o(n,[{key:"add",value:function(){var e;(e=this.scene).add.apply(e,arguments)}},{key:"registerOnResizeFunction",value:function(e){this.onResizeFunctions.push(e)}},{key:"registerOnUpdateFunction",value:function(e){this.onUpdateFunctions.push(e)}},{key:"registerPreRenderFunction",value:function(e){this.preRenderFunctions.push(e)}},{key:"play",value:function(){var e=this;if(!this.isPlaying||this.isPaused){var t=this;this.render=function(){t.renderer.render(t.scene,t.camera)},this.update=function(){t.frameCount++,t.delta=t.time.delta,e.onUpdateFunctions.forEach(function(e){e()}),t.controls&&t.controls.enableDamping&&t.controls.update()},this.time.start(),this.isPlaying=!0,this.isPaused=!1,t.renderer.setAnimationLoop(function(){t.update(),e.preRenderFunctions.forEach(function(e){e()}),t.render()})}}},{key:"pause",value:function(){this.isPaused||(this.isPaused=!0,this.time.pause(),this.renderer.setAnimationLoop(null))}},{key:"stop",value:function(){this.isPlaying=!1,this.isPaused=!1,this.time.stop(),this.frameCount=0,this.renderer.setAnimationLoop(null)}},{key:"initControls",value:function(e,t){"function"==typeof THREE.OrbitControls?this.controls=new THREE.OrbitControls(this.camera,t||l):"function"==typeof e&&(this.controls=new e(this.camera,t||l))}},{key:"initOnWindowResize",value:function(){var e=this,t=this;window.addEventListener("resize",function(){t.autoResize?a&&("PerspectiveCamera"===a.type?(d(),c(),e.onResizeFunctions.forEach(function(e){e()})):console.warn("App: AutoResize only works with PerspectiveCamera")):t.onWindowResize()},!1)}},{key:"fitCameraToObject",value:function(e,t){t=t||1;var n=new u.Box3;n.setFromObject(e);var i=n.getCenter(new u.Vector3),o=n.getSize(new u.Vector3),r=Math.max(o.x,o.y,o.z),a=this.camera.fov*(Math.PI/180),s=Math.abs(r/4*Math.tan(2*a));s*=t;var l=-n.min.z+s,c=3*l;return this.camera.far=c,this.camera.near=c<1?.001:c<100?.01:c<500?.1:1,this.camera.position.set(i.x,o.y,s),this.camera.updateProjectionMatrix(),this.controls&&(this.controls.target.copy(i),this.controls.maxDistance=2*l,this.controls.update(),this.controls.saveState()),n}},{key:"averageFrameTime",get:function(){return 0!==this.frameCount?this.time.unscaledTotalTime/this.frameCount:0}},{key:"scene",get:function(){return void 0===r&&(r=new u.Scene),r},set:function(e){r=e}},{key:"camera",get:function(){return void 0===a&&(a=new u.PerspectiveCamera(35,l.clientWidth/l.clientHeight,.1,1e3)),a},set:function(e){a=e,d()}},{key:"renderer",get:function(){return void 0===s&&((s=new u.WebGLRenderer({powerPreference:"high-performance",alpha:!0,canvas:l,antialias:!0})).setPixelRatio(window.devicePixelRatio),s.setSize(l.clientWidth,l.clientHeight,!1)),s},set:function(e){s=e,c()}}]),n}()}(e={exports:{}},e.exports),e.exports),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}(),t=document.querySelector("#loader-canvas"),n=document.querySelector("#page-content-full-width"),a=document.querySelector("#reset"),s=document.querySelector("#export"),l=document.querySelector("#export-anims"),c=document.querySelector("#fullscreen-button"),u={bbDepth:document.querySelector("#bb-depth"),bbWidth:document.querySelector("#bb-width"),bbHeight:document.querySelector("#bb-height"),faces:document.querySelector("#faces"),vertices:document.querySelector("#vertices"),infoBox:document.querySelector("#model-info")},d={slider:document.querySelector("#animation-slider"),playButton:document.querySelector("#play-button"),pauseButton:document.querySelector("#pause-button"),playbackControl:document.querySelector("#playback-control"),clipsSelection:document.querySelector("#animation-clips"),controls:document.querySelector("#animation-controls")},h={input:document.querySelector("#file-upload-input"),button:document.querySelector("#file-upload-button"),form:document.querySelector("#file-upload-form")},p={unlitToggle:document.querySelector("#toggle-unlit"),slider:document.querySelector("#lighting-slider"),symbol:document.querySelector("#light-symbol")},f={bar:document.querySelector("#loading-bar"),overlay:document.querySelector("#loading-overlay"),progress:document.querySelector("#progress")},m={button:document.querySelector("#screenshot-button")},v={main:document.querySelector("#controls"),toggleGrid:document.querySelector("#toggle-grid"),toggleInfo:document.querySelector("#toggle-info"),toggleBackground:document.querySelector("#toggle-background"),toggleEnvironment:document.querySelector("#toggle-environment"),sliders:document.querySelectorAll("input[type=range]"),exampleDuck:document.querySelector("#example-duck"),exportGLTF:document.querySelector("#export-gltf")},g=function(){function e(){o(this,e)}return r(e,null,[{key:"setInitialState",value:function(){f.overlay.classList.remove("hide"),h.form.classList.remove("hide"),f.bar.classList.add("hide"),f.progress.style.width=0,d.controls.classList.add("hide"),d.playButton.classList.add("hide"),d.pauseButton.classList.remove("hide");var e=d.clipsSelection.children[0];d.clipsSelection.innerHTML="",d.clipsSelection.appendChild(e)}},{key:"setOnLoadStartState",value:function(){h.form.classList.add("hide"),f.bar.classList.remove("hide")}},{key:"setOnLoadEndState",value:function(){f.overlay.classList.add("hide")}}]),e}();g.canvas=t,g.container=n,g.reset=a,g.fullscreenButton=c,g.animation=d,g.fileUpload=h,g.lighting=p,g.loading=f,g.screenshot=m,g.controls=v,g.export=s,g.exportAnims=l,g.modelInfo=u;g.fullscreenButton.addEventListener("click",function(e){var t;e.preventDefault(),t=g.container,document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},!1);var y=document.createElement("a");y.style.display="none",document.body.appendChild(y);var E=function(e,t){var n,i;n=new Blob([e],{type:"text/plain"}),i=t,y.href=URL.createObjectURL(n),y.download=i||"data.json",y.click()},L=function(){function e(){o(this,e),this.isPaused=!1,this.pauseButtonActive=!1,this.clips=[],this.mixers=[],this.actions=[],this.animationNames=[],this.initExportAnims()}return r(e,[{key:"reset",value:function(){this.clips=[],this.mixers=[],this.actions=[],this.animationNames=[],this.currentMixer=null,this.currentAction=null,this.isPaused=!1,this.pauseButtonActive=!1,g.animation.playbackControl.removeEventListener("click",this.playPause,!1),g.animation.slider.removeEventListener("mousedown",this.sliderMouseDownEvent,!1),g.animation.slider.removeEventListener("input",this.sliderInputEvent,!1),g.animation.slider.removeEventListener("mouseup",this.sliderMouseupEvent,!1),g.animation.clipsSelection.removeEventListener("change",this.clipsChangeEvent,!1)}},{key:"update",value:function(e){this.currentMixer&&this.currentAction&&!this.isPaused&&(this.currentMixer.update(e/1e3),this.setSliderValue(this.currentAction.time))}},{key:"initAnimation",value:function(i){var o=this;i.animations&&0!==i.animations.length&&(i.animations.forEach(function(e){if(e instanceof THREE.AnimationClip){var t=new THREE.AnimationMixer(i),n=t.clipAction(e);o.clips.push(e),o.mixers.push(t),o.actions.push(n),o.animationNames.push(e.name),g.animation.clipsSelection.appendChild(new Option(e.name,e.name))}else console.warn("Some animations are not valid THREE.AnimationClips. Skipping these.")}),0!==this.animationNames.length&&(this.selectCurrentAnimation(this.animationNames[0]),g.animation.controls.classList.remove("hide"),this.initPlayPauseControls(),this.initSlider(),this.initSelectionMenu()))}},{key:"selectCurrentAnimation",value:function(e){var t=this.animationNames.indexOf(e);-1===t?console.warn("Animation "+e+" not found."):(this.currentAction&&this.currentAction.stop(),this.currentMixer=this.mixers[t],this.currentAction=this.actions[t],this.currentClip=this.clips[t],g.animation.slider.max=String(this.currentClip.duration),g.animation.slider.step=String(this.currentClip.duration/150),this.currentAction.play())}},{key:"setSliderValue",value:function(e){g.animation.slider.value=String(e)}},{key:"initPlayPauseControls",value:function(){var t=this;this.playPause=function(e){e.preventDefault(),t.togglePause()},g.animation.playbackControl.addEventListener("click",this.playPause,!1)}},{key:"togglePause",value:function(){this.isPaused?(this.pauseButtonActive=!1,this.play()):(this.pauseButtonActive=!0,this.pause())}},{key:"pause",value:function(){this.isPaused=!0,g.animation.playButton.classList.remove("hide"),g.animation.pauseButton.classList.add("hide")}},{key:"play",value:function(){this.isPaused=!1,g.animation.playButton.classList.add("hide"),g.animation.pauseButton.classList.remove("hide")}},{key:"initSlider",value:function(){var i=this;this.sliderMouseDownEvent=function(e){i.pauseButtonActive||i.pause()},g.animation.slider.addEventListener("mousedown",this.sliderMouseDownEvent,!1),this.sliderInputEvent=function(e){var t=i.currentMixer.time,n=g.animation.slider.value;i.currentMixer.update(n-t)},g.animation.slider.addEventListener("input",this.sliderInputEvent,!1),this.sliderMouseupEvent=function(e){i.pauseButtonActive||i.play()},g.animation.slider.addEventListener("mouseup",this.sliderMouseupEvent,!1)}},{key:"initSelectionMenu",value:function(){var t=this;g.animation.clipsSelection.selectedIndex=1,this.clipsChangeEvent=function(e){e.preventDefault(),"static"===e.target.value?t.currentAction.stop():t.selectCurrentAnimation(e.target.value)},g.animation.clipsSelection.addEventListener("change",this.clipsChangeEvent,!1)}},{key:"initExportAnims",value:function(){var i=this;g.exportAnims.addEventListener("click",function(e){var t,n;(e.preventDefault(),0!==i.clips.length)&&(t=i.currentClip,n=(n=JSON.stringify(THREE.AnimationClip.toJSON(t),null,"\t")).replace(/[^{]*/i,"").replace(/\]$/i,""),E(n,"BlackThreadDOTioAnimations.json"))},!1)}}]),e}(),b=function(){function t(e){o(this,t),this.app=e,this.initMaterials(),this.initMesh(),this.initButton(),this.lightControls()}return r(t,[{key:"initMesh",value:function(){var e=new THREE.PlaneBufferGeometry(2,2,1),t=new THREE.Mesh(e,this.mat);this.app.camera.add(t)}},{key:"initMaterials",value:function(){var e=(new THREE.TextureLoader).load("/images/textures/noise-256.jpg");e.wrapS=e.wrapT=THREE.RepeatWrapping,this.colA=new THREE.Color(16777215),this.colB=new THREE.Color(2635844);var t={color1:{value:this.colA},color2:{value:this.colB},noiseTexture:{value:e},vignetteAmount:{value:0},mixAmount:{value:.08}};this.mat=new THREE.RawShaderMaterial({uniforms:t,depthFunc:THREE.NeverDepth,vertexShader:"#define GLSLIFY 1\nattribute vec3 position;\nvarying vec2 uv;\nvoid main() {\n\tgl_Position = vec4( vec3( position.x, position.y, 1.0 ), 1.0 );\n\tuv = vec2(position.x, position.y) * 0.5;\n}\n",fragmentShader:"precision mediump float;\n#define GLSLIFY 1\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float vignetteAmount;\nuniform float mixAmount;\nuniform vec2 smooth;\nuniform sampler2D noiseTexture;\nvarying vec2 uv;\nvoid main() {\n\tfloat dst = length( uv );\n\tvec3 color = mix( color1, color2, dst );\n  vec2 texSize = vec2( 0.25, 0.25 );\n  vec2 phase = fract(  uv / texSize );\n\tvec3 noise = mix( color, texture2D( noiseTexture, phase ).rgb, mixAmount );\n\tvec4 col = vec4( mix( noise, vec3( vignetteAmount ), dot( uv, uv ) ), 1.0 );\n\tgl_FragColor = col;\n}"})}},{key:"initButton",value:function(){var t=this,n=!1;g.controls.toggleBackground.addEventListener("click",function(e){e.preventDefault(),n?(t.mat.uniforms.mixAmount.value=.08,t.mat.uniforms.vignetteAmount.value=0,t.lightControls()):(t.mat.uniforms.mixAmount.value=.8,t.mat.uniforms.vignetteAmount.value=-1.6,t.darkControls()),n=!n},!1)}},{key:"darkControls",value:function(){g.controls.main.classList.add("backgroundToggle");for(var e=0;e<g.controls.sliders.length;e++)g.controls.sliders[e].classList.remove("light-slider"),g.controls.sliders[e].classList.add("dark-slider")}},{key:"lightControls",value:function(){g.controls.main.classList.remove("backgroundToggle");for(var e=0;e<g.controls.sliders.length;e++)g.controls.sliders[e].classList.remove("dark-slider"),g.controls.sliders[e].classList.add("light-slider")}}]),t}(),w=function(){function t(e){o(this,t),this.materials=e,this.loadMaps(),this.initButton()}return r(t,[{key:"loadMaps",value:function(){this.maps=[];var e=(new THREE.TextureLoader).load("/images/textures/env_maps/test_env_map.jpg");e.mapping=THREE.EquirectangularReflectionMapping,e.magFilter=THREE.LinearFilter,e.minFilter=THREE.LinearMipMapLinearFilter,this.maps.push(e);var t="/images/textures/cube_maps/Bridge2/",n=[t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"],i=(new THREE.CubeTextureLoader).load(n);i.format=THREE.RGBFormat,i.mapping=THREE.CubeReflectionMapping,this.maps.push(i)}},{key:"initButton",value:function(){var n=this,i=0;g.controls.toggleEnvironment.addEventListener("click",function(e){e.preventDefault();var t=n.maps[i%n.maps.length];i++,n.materials.forEach(function(e){void 0!==e.reflectivity&&(e.reflectivity=.5),void 0!==e.envMapIntensity&&(e.envMapIntensity=.5),void 0!==e.envMap&&(e.envMap=t),e.needsUpdate=!0})})}},{key:"default",value:function(){var t=this;this.materials.forEach(function(e){void 0!==e.reflectivity&&(e.reflectivity=.25),void 0!==e.envMapIntensity&&(e.envMapIntensity=.25),void 0!==e.envMap&&(e.envMap=t.maps[0]),e.needsUpdate=!0})}}]),t}(),S=function(){function t(e){o(this,t),this.app=e,this.initLights(),this.initSlider(),this.initUnlitToggle(),this.initialStrength=1.2,this.reset()}return r(t,[{key:"initLights",value:function(){var e=new THREE.AmbientLight(16777215,.3);this.app.scene.add(e),this.light=new THREE.PointLight(16777215,this.initialStrength),this.app.camera.add(this.light),this.app.scene.add(this.app.camera)}},{key:"initSlider",value:function(){var t=this;g.lighting.slider.addEventListener("input",function(e){e.preventDefault(),t.light.intensity=g.lighting.slider.value},!1),g.lighting.symbol.addEventListener("click",function(e){e.preventDefault(),t.reset()},!1)}},{key:"initUnlitToggle",value:function(){var t=this;g.lighting.unlitToggle.addEventListener("click",function(e){e.preventDefault(),t.app.loadedObjects.traverse(function(e){e.isMesh&&function(e){if(e.material){var t=e.material;if(Array.isArray(t)){var n=[];t.forEach(function(e){n.push(new THREE.MeshBasicMaterial({alphaMap:e.alphaMap,color:e.color,map:e.map,morphTargets:e.morphTargets,reflectivity:e.reflectivity,skinning:e.skinning,specularMap:e.specularMap}))}),e.material=n}else e.material=new THREE.MeshBasicMaterial({alphaMap:t.alphaMap,color:t.color,map:t.map,morphTargets:t.morphTargets,reflectivity:t.reflectivity,skinning:t.skinning,specularMap:t.specularMap})}}(e)})},!1)}},{key:"reset",value:function(){this.light.intensity=this.initialStrength,g.lighting.slider.value=String(this.light.intensity)}}]),t}(),k=function(){function t(e){o(this,t),this.camera=e.camera,this.scene=e.scene,this.renderer=e.renderer,this.initButton()}return r(t,[{key:"initButton",value:function(){var t=this;g.screenshot.button.addEventListener("click",function(e){e.preventDefault(),t.takeScreenshot()},!1)}},{key:"takeScreenshot",value:function(){this.renderer.render(this.scene,this.camera,null,!1);var e='\n      <iframe\n        src="'+this.renderer.domElement.toDataURL("image/png")+'"\n        frameborder="0"\n        style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;"\n        allowfullscreen>\n      </iframe>',t=window.open();t.document.open(),t.document.write(e),t.document.close()}}]),t}(),T=function(){function t(e){o(this,t),this.app=e,this.size=0,this.gridHelper=new THREE.GridHelper,this.axesHelper=new THREE.AxesHelper,this.helpers=new THREE.Group,this.helpers.add(this.gridHelper,this.axesHelper),this.helpers.visible=!1,this.initButton()}return r(t,[{key:"setSize",value:function(){this.size=Math.floor(.5*this.app.camera.far),this.size%2!=0&&this.size++,this.updateGrid(),this.updateAxes()}},{key:"updateGrid",value:function(){var e=new THREE.GridHelper(this.size,10);this.helpers.remove(this.gridHelper),this.gridHelper=e,this.helpers.add(this.gridHelper)}},{key:"updateAxes",value:function(){var e=new THREE.AxesHelper(this.size/2);this.helpers.remove(this.axesHelper),this.axesHelper=e,this.helpers.add(this.axesHelper)}},{key:"initButton",value:function(){var t=this;g.controls.toggleGrid.addEventListener("click",function(e){e.preventDefault(),t.setSize(),t.helpers.visible=!t.helpers.visible})}}]),t}(),x=function(){function n(e,t){o(this,n),this.renderer=e.renderer,this.objects=t,this.modelInfo=this.boundingBox=new THREE.Box3,this.initButton()}return r(n,[{key:"update",value:function(){this.boundingBox.expandByObject(this.objects);var e=Math.abs(this.boundingBox.max.z-this.boundingBox.min.z),t=Math.abs(this.boundingBox.max.x-this.boundingBox.min.x),n=Math.abs(this.boundingBox.max.y-this.boundingBox.min.y);g.modelInfo.bbDepth.innerHTML=e.toPrecision(4),g.modelInfo.bbWidth.innerHTML=t.toPrecision(4),g.modelInfo.bbHeight.innerHTML=n.toPrecision(4),g.modelInfo.faces.innerHTML=this.renderer.info.render.faces,g.modelInfo.vertices.innerHTML=this.renderer.info.render.vertices}},{key:"initButton",value:function(){g.controls.toggleInfo.addEventListener("click",function(e){e.preventDefault(),g.modelInfo.infoBox.classList.toggle("hide")})}}]),n}(),R=new THREE.LoadingManager,H=0,M=null;function j(i,o){if(!(i instanceof Blob))throw new TypeError("Must be a File or Blob");return new Promise(function(t,n){var e=new FileReader;e.onload=function(e){t(e.target.result)},e.onerror=function(e){n(new Error("Error reading"+i.name+": "+e.target.result))},e["readAs"+o](i)})}R.onStart=function(){null===M&&(g.setOnLoadStartState(),M=setInterval(function(){100<=(H+=5)?clearInterval(M):g.loading.progress.style.width=H+"%"},100))},R.onLoad=function(){g.setOnLoadEndState(),clearInterval(M)},R.onProgress=function(){100<=H||(H+=1,g.loading.progress.style.width=H+"%")},R.onError=function(e){console.error(e)},THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var O=null,B=null,F=null,C=null,A=null,P=null,q=null,D=null,z=null,G=function(i){return function(n){return new Promise(function(e,t){i.load(n,e,R.onProgress,t)})}},I=new function e(){return o(this,e),{get objectLoader(){return null===O&&(O=G(new THREE.ObjectLoader(R))),O},get bufferGeometryLoader(){return null===B&&(B=G(new THREE.BufferGeometryLoader(R))),B},get jsonLoader(){return null===F&&(F=G(new THREE.JSONLoader(R))),F},get fbxLoader(){return null===C&&(C=G(new THREE.FBXLoader(R))),C},get gltfLoader(){return null===A&&(A=G(new THREE.GLTFLoader(R))),A},get objLoader(){return null===z&&(z=new THREE.OBJLoader(R),(P=G(z)).setMaterials=function(e){z.setMaterials(e)}),P},get mtlLoader(){return null===q&&(q=G(new THREE.MTLLoader(R))),q},get colladaLoader(){return null===D&&(D=G(new THREE.ColladaLoader(R))),D}}},U=new THREE.MeshBasicMaterial({wireframe:!0,color:0}),N=function(){function e(){o(this,e)}return r(e,null,[{key:"onJSONLoad",value:function(e,t){var n=this,i=JSON.parse(e);if(i.metadata&&i.metadata.type){var o=i.metadata.type.toLowerCase();j(t,"DataURL").then(function(e){"buffergeometry"===o?n.onJSONBufferGeometryLoad(e):"geometry"===o?n.onJSONGeometryLoad(e):"object"===o&&n.onJSONObjectLoad(e)}).catch(function(e){return console.error(e)})}else console.error("Error: Invalid JSON file.")}},{key:"onJSONBufferGeometryLoad",value:function(e){console.log("Using THREE.BufferGeometryLoader");var t=I.bufferGeometryLoader(e);return t.then(function(e){console.log(e);var t=new THREE.Mesh(e,U);te.addObjectToScene(t)}).catch(function(e){console.log(e)}),t}},{key:"onJSONGeometryLoad",value:function(e){console.log("Using THREE.JSONLoader");var t=I.jsonLoader(e);return t.then(function(e){console.log(e);var t=new THREE.Mesh(e,U);te.addObjectToScene(t)}).catch(function(e){console.log(e)}),t}},{key:"onJSONObjectLoad",value:function(e){console.log("Using THREE.ObjectLoader");var t=I.objectLoader(e);return t.then(function(e){console.log(e),te.addObjectToScene(e)}).catch(function(e){console.log(e)}),t}},{key:"onFBXLoad",value:function(e){console.log("Using THREE.FBXLoader");var t=I.fbxLoader(e);return t.then(function(e){console.log(e),te.addObjectToScene(e)}).catch(function(e){console.log(e)}),t}},{key:"onGLTFLoad",value:function(e){var t=new Promise(function(e,t){});return console.log("Using THREE.GLTFLoader"),(t=I.gltfLoader(e)).then(function(t){console.log(t),1<t.scenes.length?t.scenes.forEach(function(e){t.animations&&(e.animations=t.animations),te.addObjectToScene(e)}):t.scene?(t.animations&&(t.scene.animations=t.animations),te.addObjectToScene(t.scene)):console.error("No scene found in GLTF file.")}).catch(function(e){console.log(e)}),t}},{key:"onMTLLoad",value:function(e){new Promise(function(e,t){});return I.mtlLoader(e)}},{key:"onOBJLoad",value:function(e,t){var n=new Promise(function(e,t){});return I.objLoader.setMaterials(t),(n=I.objLoader(e)).then(function(e){console.log(e),te.addObjectToScene(e)}).catch(function(e){console.log(e)}),n}},{key:"onDAELoad",value:function(e){var t=new Promise(function(e){});return(t=I.colladaLoader(e)).then(function(e){console.log(e);var t=e.scene;e.animations&&0<e.animations.length&&(t.animations=e.animations),te.addObjectToScene(t)}).catch(function(e){console.log(e)}),t}}]),e}();window.File&&window.FileReader&&window.FileList&&window.Blob||console.error("This loader requires the File API. Please upgrade your browser");var J=function(e){return new RegExp("(png|jpg|jpeg|gif|bmp|dds|tga|bin|vert|frag|txt|mtl)$").test(e)},W=function(e){return new RegExp("(json|js|fbx|gltf|glb|dae|obj)$").test(e)},_=[],V={},X=[];R.setURLModifier(function(e){if("."===e[e.length-3]||"."===e[e.length-4]){var t=e.split(".").pop().toLowerCase();J(t)&&(e=(e=(e=e.replace("data:application/","")).split("/"))[e.length-1])}return void 0===V[e]?e:V[e]});var $=function(t){var e,n=t.name.split(".").pop().toLowerCase();if(J(e=n)||W(e))if("js"===n||"json"===n){var i=j(t,"Text").then(function(e){_.push([e,n,t])}).catch(function(e){return console.error(e)});X.push(i)}else{var o=j(t,"DataURL").then(function(e){W(n)?"obj"===n?_.push([e,n,t]):_.push([e,n]):J(n)&&(V[t.name]=e)}).catch(function(e){return console.error(e)});X.push(o)}},Y=function(e){_=[],V={},X=[];for(var t=0;t<e.length;t++)$(e[t]);Promise.all(X).then(function(){_.forEach(function(e){return function(e){var t=e[0],n=e[1],i=e[2];switch(n){case"fbx":R.onStart(),N.onFBXLoad(t);break;case"gltf":case"glb":R.onStart(),N.onGLTFLoad(t);break;case"obj":R.onStart(),N.onMTLLoad(V[i.name.replace(".obj",".mtl")]).then(function(e){N.onOBJLoad(t,e)}).catch(function(e){return console.error(e)});break;case"dae":R.onStart(),N.onDAELoad(t);break;case"json":case"js":R.onStart(),N.onJSONLoad(t,i);break;default:console.error("Unsupported file type "+n+" - please load one of the supported model formats.")}}(e)})}).catch(function(e){return console.error(e)})},K=g.fileUpload.form,Q=g.fileUpload.button;Q.addEventListener("click",function(e){e.preventDefault(),g.fileUpload.input.click()},!1),g.fileUpload.input.addEventListener("change",function(e){e.preventDefault();var t=e.target.files;Y(t)},!1),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){return K.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation()})}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){return document.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation()})}),["dragover","dragenter"].forEach(function(e){return K.addEventListener(e,function(){K.classList.add("border"),Q.classList.add("highlight")})}),["dragend","dragleave","drop"].forEach(function(e){return K.addEventListener(e,function(){K.classList.remove("border"),Q.classList.remove("highlight")})}),g.fileUpload.form.addEventListener("drop",function(e){var t=e.dataTransfer.files;Y(t)}),g.controls.exampleDuck.addEventListener("click",function(e){e.preventDefault(),R.onStart(),N.onGLTFLoad("/models/gltf/Duck.gltf")});var Z=document.createElement("a");Z.style.display="none",document.body.appendChild(Z);var ee=function(e,t){var n,i;n=new Blob([e],{type:"text/plain"}),i=t,Z.href=URL.createObjectURL(n),Z.download=i||"data.json",Z.click()};THREE.Cache.enabled=!0;var te=new(function(){function n(e){o(this,n);var t=this;this.canvas=e,this.app=new i(THREE,this.canvas),this.animationControls=new L,this.app.registerOnUpdateFunction(function(){t.animationControls.update(t.app.delta)}),this.app.loadedObjects=new THREE.Group,this.app.loadedMaterials=[],this.app.scene.add(this.app.loadedObjects),this.lighting=new S(this.app),this.grid=new T(this.app),this.background=new b(this.app),this.environment=new w(this.app.loadedMaterials),this.info=new x(this.app,this.app.loadedObjects),this.app.scene.add(this.grid.helpers),this.app.initControls(THREE.OrbitControls),this.screenshotHandler=new k(this.app),this.initReset(),this.initExport()}return r(n,[{key:"addObjectToScene",value:function(e){var t=this;void 0!==e?(this.animationControls.initAnimation(e),this.app.loadedObjects.add(e),this.app.fitCameraToObject(this.app.loadedObjects,3),this.app.play(),this.info.update(),this.app.loadedObjects.traverse(function(e){void 0!==e.material&&t.app.loadedMaterials.push(e.material)}),this.environment.default()):console.error("Oops! An unspecified error occurred :(")}},{key:"initExport",value:function(){var i=this;g.controls.exportGLTF.addEventListener("click",function(e){var t,n;e.preventDefault(),t=i.app.loadedObjects,n=new THREE.GLTFExporter,console.log(t),n.parse(t.children[0].children[0],function(e){var t=JSON.stringify(e,null,2);ee(t,"BlackThreadDOTioGLTF.gltf")},{trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!1,embedImages:!0})})}},{key:"initReset",value:function(){var t=this;g.reset.addEventListener("click",function(){for(;0<t.app.loadedObjects.children.length;){var e=t.app.loadedObjects.children[0];t.app.loadedObjects.remove(e),e=null}t.app.loadedMaterials=[],t.animationControls.reset(),t.lighting.reset(),g.setInitialState()})}}]),n}())(g.canvas)}();