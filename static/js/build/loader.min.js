this.loader=this.loader||{},function(){"use strict";var e=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},t=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();new(function(){function n(){e(this,n),this.masthead=document.querySelector(".masthead"),null!==this.masthead&&(this.visibleLinks=this.masthead.querySelector(".visible-links"),this.hiddenLinks=this.masthead.querySelector(".hidden-links"),this.toggleButton=this.masthead.querySelector(".toggle-links"),this.spacer=this.masthead.querySelector("#spacer"),this.setupResize(),this.setupButton(),this.decreaseSize(),this.decreaseSize(),this.initScroll())}return t(n,[{key:"initScroll",value:function(){var e=this;document.addEventListener("scroll",function(){window.scrollY>50?e.masthead.classList.add("shrink"):e.masthead.classList.remove("shrink")})}},{key:"visibleLinksWidth",value:function(){var e=0;for(var t in this.visibleLinks.children)Object.prototype.hasOwnProperty.call(this.visibleLinks.children,t)&&this.visibleLinks.children[t].id!==this.spacer&&(e+=this.visibleLinks.children[t].offsetWidth);return e}},{key:"increaseSize",value:function(){if(this.spacer.style.width=0,0===this.hiddenLinks.children.length)return this.hiddenLinks.classList.add("fold"),void this.setSpacerWidth();for(var e=this.visibleLinksWidth()+this.hiddenLinks.firstChild.offsetWidth;this.hiddenLinks.children.length>0&&e<this.masthead.clientWidth;)e+=this.hiddenLinks.firstChild.offsetWidth,this.visibleLinks.insertBefore(this.hiddenLinks.firstChild,this.visibleLinks.lastChild);this.showButton(),this.setSpacerWidth()}},{key:"decreaseSize",value:function(){for(this.spacer.style.width=0;this.masthead.clientWidth<this.visibleLinks.scrollWidth;){if(3===this.visibleLinks.children.length)return this.showButton(),void this.setSpacerWidth();var e=this.visibleLinks.children[this.visibleLinks.children.length-2];this.hiddenLinks.insertBefore(e,this.hiddenLinks.firstChild)}this.showButton(),this.setSpacerWidth()}},{key:"setSpacerWidth",value:function(){this.spacer.style.width=this.visibleLinks.offsetWidth-this.visibleLinksWidth()+"px"}},{key:"showButton",value:function(){0===this.hiddenLinks.children.length?this.toggleButton.classList.add("hide"):this.toggleButton.classList.remove("hide")}},{key:"setupResize",value:function(){var e=this,t=window.innerWidth;window.addEventListener("resize",function(){window.innerWidth>t?e.increaseSize():window.innerWidth<t&&e.decreaseSize(),t=window.innerWidth})}},{key:"setupButton",value:function(){var e=this,t=!0;this.toggleButton.addEventListener("click",function(){t?e.hiddenLinks.classList.remove("fold"):e.hiddenLinks.classList.add("fold"),t=!t})}}]),n}());!function(){var e=document.querySelector("#main"),t=document.querySelector("#toggle-nav"),n=document.querySelector("#vert-nav");if(null!==e&&null!==t&&null!==n){var i=1280;o(),t.addEventListener("click",function(e){e.preventDefault(),n.classList.toggle("fold")}),window.addEventListener("resize",o)}function o(){if(e.offsetWidth<i){if(!t.classList.contains("hide"))return;t.classList.remove("hide"),n.classList.add("fold")}else{if(t.classList.contains("hide"))return;t.classList.add("hide"),n.classList.remove("fold")}}}();var n=document.querySelector("#loader-canvas"),i=document.querySelector("#page-content-full-width"),o=document.querySelector("#reset"),r=document.querySelector("#export"),s=document.querySelector("#export-anims"),a=document.querySelector("#fullscreen-button"),l={bbDepth:document.querySelector("#bb-depth"),bbWidth:document.querySelector("#bb-width"),bbHeight:document.querySelector("#bb-height"),faces:document.querySelector("#faces"),vertices:document.querySelector("#vertices"),infoBox:document.querySelector("#model-info")},c={slider:document.querySelector("#animation-slider"),playButton:document.querySelector("#play-button"),pauseButton:document.querySelector("#pause-button"),playbackControl:document.querySelector("#playback-control"),clipsSelection:document.querySelector("#animation-clips"),controls:document.querySelector("#animation-controls")},u={input:document.querySelector("#file-upload-input"),button:document.querySelector("#file-upload-button"),form:document.querySelector("#file-upload-form")},d={slider:document.querySelector("#lighting-slider"),symbol:document.querySelector("#light-symbol")},h={bar:document.querySelector("#loading-bar"),overlay:document.querySelector("#loading-overlay"),progress:document.querySelector("#progress")},f={button:document.querySelector("#screenshot-button")},p={main:document.querySelector("#controls"),toggleGrid:document.querySelector("#toggle-grid"),toggleInfo:document.querySelector("#toggle-info"),toggleBackground:document.querySelector("#toggle-background"),toggleEnvironment:document.querySelector("#toggle-environment"),sliders:document.querySelectorAll("input[type=range]"),exampleDuck:document.querySelector("#example-duck"),exportGLTF:document.querySelector("#export-gltf")},m=function(){function n(){e(this,n)}return t(n,null,[{key:"setInitialState",value:function(){h.overlay.classList.remove("hide"),u.form.classList.remove("hide"),h.bar.classList.add("hide"),h.progress.style.width=0,c.controls.classList.add("hide"),c.playButton.classList.add("hide"),c.pauseButton.classList.remove("hide");var e=c.clipsSelection.children[0];c.clipsSelection.innerHTML="",c.clipsSelection.appendChild(e)}},{key:"setOnLoadStartState",value:function(){u.form.classList.add("hide"),h.bar.classList.remove("hide")}},{key:"setOnLoadEndState",value:function(){h.overlay.classList.add("hide")}}]),n}();m.canvas=n,m.container=i,m.reset=o,m.fullscreenButton=a,m.animation=c,m.fileUpload=u,m.lighting=d,m.loading=h,m.screenshot=f,m.controls=p,m.export=r,m.exportAnims=s,m.modelInfo=l;m.fullscreenButton.addEventListener("click",function(e){var t;e.preventDefault(),t=m.container,document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()},!1);var v=void 0,y=void 0,g=void 0,b=void 0,E=void 0;function L(e){var t=this;void 0!==e&&(v=e),this.autoRender=!0,this.autoResize=!0,this.frameCount=0,this.delta=0,this.isPlaying=!1,this.isPaused=!1,this.time=new function(){var e=void 0,t=0,n=0;this.running=!1,this.paused=!1;var i=1,o=0,r=0;Object.defineProperties(this,{now:{get:function(){return(performance||Date).now()}},timeScale:{get:function(){return i},set:function(e){o=this.totalTime,r=this.now,i=e}},unscaledTotalTime:{get:function(){return this.running?this.now-n:0}},totalTime:{get:function(){var e=(this.now-r)*this.timeScale;return this.running?o+e:0}},unscaledDelta:{get:function(){var e=this.now-t;return t=this.now,e}},delta:{get:function(){return this.unscaledDelta*this.timeScale}}}),this.start=function(){if(this.paused){var i=this.now-e;n+=i,t+=i,r+=i}else this.running||(n=t=r=this.now,o=0);this.running=!0,this.paused=!1},this.stop=function(){n=0,o=0,this.running=!1},this.pause=function(){e=this.now,this.paused=!0}};var n=function(){b&&b.setSize(t.canvas.clientWidth,t.canvas.clientHeight,!1)},i=function(){g&&(g.aspect=v.clientWidth/v.clientHeight,g.updateProjectionMatrix())};this.onWindowResize=function(){};window.addEventListener("resize",function(){t.autoResize?g&&("PerspectiveCamera"===g.type?(i(),n(),t.onWindowResize()):console.warn("App: AutoResize only works with PerspectiveCamera")):t.onWindowResize()},!1),Object.defineProperties(this,{canvas:{get:function(){return void 0===v&&((v=document.body.appendChild(document.createElement("canvas"))).style.position="absolute",v.style.width=v.style.height="100%"),v},set:function(e){v=e}},camera:{get:function(){return void 0===g&&(g=new THREE.PerspectiveCamera(50,this.canvas.clientWidth/this.canvas.clientHeight,.1,1e3)),g},set:function(e){g=e,i()}},scene:{get:function(){return void 0===y&&(y=new THREE.Scene),y},set:function(e){y=e}},renderer:{get:function(){return void 0===b&&((b=new THREE.WebGLRenderer({canvas:this.canvas,antialias:!0})).setPixelRatio(window.devicePixelRatio),b.setSize(this.canvas.clientWidth,this.canvas.clientHeight,!1)),b},set:function(e){b=e,n()}},averageFrameTime:{get:function(){return 0!==this.frameCount?this.time.unscaledTotalTime/this.frameCount:0}}}),this.play=function(){this.time.start(),this.isPlaying=!0,this.isPaused=!1,function e(){t.frameCount++,t.delta=t.time.delta,t.onUpdate(),t.controls&&t.controls.enableDamping&&t.controls.update(),t.autoRender&&t.renderer.render(t.scene,t.camera),E=requestAnimationFrame(function(){e()})}()},this.pause=function(){this.isPaused=!0,this.time.pause(),cancelAnimationFrame(E)},this.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.time.stop(),this.frameCount=0,cancelAnimationFrame(E)},this.onUpdate=function(){},this.initControls=function(){this.controls=new THREE.OrbitControls(this.camera,this.canvas),this.controls.enableDamping=!0,this.controls.dampingFactor=.2},this.fitCameraToObject=function(e,t){t=t||1;var n=new THREE.Box3;n.setFromObject(e);var i=n.getCenter(),o=n.getSize(),r=Math.max(o.x,o.y,o.z),s=this.camera.fov*(Math.PI/180),a=Math.abs(r/4*Math.tan(2*s));a*=t;var l=-n.min.z+a,c=3*l;return this.camera.far=c,this.camera.near=c<1?.001:c<100?.01:c<500?.1:1,this.controls.target.copy(i),this.controls.maxDistance=2*l,this.camera.position.set(i.x,o.y,a),this.camera.updateProjectionMatrix(),this.controls.update(),this.controls.saveState(),n}}var w=document.createElement("a");w.style.display="none",document.body.appendChild(w);var S=function(e,t){var n,i;n=new Blob([e],{type:"text/plain"}),i=t,w.href=URL.createObjectURL(n),w.download=i||"data.json",w.click()},k=function(){function n(){e(this,n),this.isPaused=!1,this.pauseButtonActive=!1,this.clips=[],this.mixers=[],this.actions=[],this.animationNames=[],this.initExportAnims()}return t(n,[{key:"reset",value:function(){this.clips=[],this.mixers=[],this.actions=[],this.animationNames=[],this.currentMixer=null,this.currentAction=null,this.isPaused=!1,this.pauseButtonActive=!1,m.animation.playbackControl.removeEventListener("click",this.playPause,!1),m.animation.slider.removeEventListener("mousedown",this.sliderMouseDownEvent,!1),m.animation.slider.removeEventListener("input",this.sliderInputEvent,!1),m.animation.slider.removeEventListener("mouseup",this.sliderMouseupEvent,!1),m.animation.clipsSelection.removeEventListener("change",this.clipsChangeEvent,!1)}},{key:"update",value:function(e){this.currentMixer&&this.currentAction&&!this.isPaused&&(this.currentMixer.update(e/1e3),this.setSliderValue(this.currentAction.time))}},{key:"initAnimation",value:function(e){var t=this;e.animations&&0!==e.animations.length&&(e.animations.forEach(function(n){if(n instanceof THREE.AnimationClip){var i=new THREE.AnimationMixer(e),o=i.clipAction(n);t.clips.push(n),t.mixers.push(i),t.actions.push(o),t.animationNames.push(n.name),m.animation.clipsSelection.appendChild(new Option(n.name,n.name))}else console.warn("Some animations are not valid THREE.AnimationClips. Skipping these.")}),0!==this.animationNames.length&&(this.selectCurrentAnimation(this.animationNames[0]),m.animation.controls.classList.remove("hide"),this.initPlayPauseControls(),this.initSlider(),this.initSelectionMenu()))}},{key:"selectCurrentAnimation",value:function(e){var t=this.animationNames.indexOf(e);-1===t?console.warn("Animation "+e+" not found."):(this.currentAction&&this.currentAction.stop(),this.currentMixer=this.mixers[t],this.currentAction=this.actions[t],this.currentClip=this.clips[t],m.animation.slider.max=String(this.currentClip.duration),m.animation.slider.step=String(this.currentClip.duration/150),this.currentAction.play())}},{key:"setSliderValue",value:function(e){m.animation.slider.value=String(e)}},{key:"initPlayPauseControls",value:function(){var e=this;this.playPause=function(t){t.preventDefault(),e.togglePause()},m.animation.playbackControl.addEventListener("click",this.playPause,!1)}},{key:"togglePause",value:function(){this.isPaused?(this.pauseButtonActive=!1,this.play()):(this.pauseButtonActive=!0,this.pause())}},{key:"pause",value:function(){this.isPaused=!0,m.animation.playButton.classList.remove("hide"),m.animation.pauseButton.classList.add("hide")}},{key:"play",value:function(){this.isPaused=!1,m.animation.playButton.classList.add("hide"),m.animation.pauseButton.classList.remove("hide")}},{key:"initSlider",value:function(){var e=this;this.sliderMouseDownEvent=function(t){e.pauseButtonActive||e.pause()},m.animation.slider.addEventListener("mousedown",this.sliderMouseDownEvent,!1),this.sliderInputEvent=function(t){var n=e.currentMixer.time,i=m.animation.slider.value;e.currentMixer.update(i-n)},m.animation.slider.addEventListener("input",this.sliderInputEvent,!1),this.sliderMouseupEvent=function(t){e.pauseButtonActive||e.play()},m.animation.slider.addEventListener("mouseup",this.sliderMouseupEvent,!1)}},{key:"initSelectionMenu",value:function(){var e=this;m.animation.clipsSelection.selectedIndex=1,this.clipsChangeEvent=function(t){t.preventDefault(),"static"===t.target.value?e.currentAction.stop():e.selectCurrentAnimation(t.target.value)},m.animation.clipsSelection.addEventListener("change",this.clipsChangeEvent,!1)}},{key:"initExportAnims",value:function(){var e=this;m.exportAnims.addEventListener("click",function(t){var n,i;(t.preventDefault(),0!==e.clips.length)&&(n=e.currentClip,i=(i=JSON.stringify(THREE.AnimationClip.toJSON(n),null,"\t")).replace(/[^{]*/i,"").replace(/\]$/i,""),S(i,"blackThreadAnimations.json"))},!1)}}]),n}(),T=function(){function n(t){e(this,n),this.app=t,this.initMaterials(),this.initMesh(),this.initButton(),this.lightControls()}return t(n,[{key:"initMesh",value:function(){var e=new THREE.PlaneBufferGeometry(2,2,1),t=new THREE.Mesh(e,this.mat);this.app.camera.add(t)}},{key:"initMaterials",value:function(){var e=(new THREE.TextureLoader).load("/images/textures/noise-256.jpg");e.wrapS=e.wrapT=THREE.RepeatWrapping,this.colA=new THREE.Color(16777215),this.colB=new THREE.Color(2635844);var t={color1:{value:this.colA},color2:{value:this.colB},noiseTexture:{value:e},vignetteAmount:{value:0},mixAmount:{value:.08}};this.mat=new THREE.RawShaderMaterial({uniforms:t,depthFunc:THREE.NeverDepth,vertexShader:"#define GLSLIFY 1\nattribute vec3 position;\nvarying vec2 uv;\nvoid main() {\n\tgl_Position = vec4( vec3( position.x, position.y, 1.0 ), 1.0 );\n\tuv = vec2(position.x, position.y) * 0.5;\n}\n",fragmentShader:"precision mediump float;\n#define GLSLIFY 1\nuniform vec3 color1;\nuniform vec3 color2;\nuniform float vignetteAmount;\nuniform float mixAmount;\nuniform vec2 smooth;\nuniform sampler2D noiseTexture;\nvarying vec2 uv;\nvoid main() {\n\tfloat dst = length( uv );\n\tvec3 color = mix( color1, color2, dst );\n  vec2 texSize = vec2( 0.25, 0.25 );\n  vec2 phase = fract(  uv / texSize );\n\tvec3 noise = mix( color, texture2D( noiseTexture, phase ).rgb, mixAmount );\n\tvec4 col = vec4( mix( noise, vec3( vignetteAmount ), dot( uv, uv ) ), 1.0 );\n\tgl_FragColor = col;\n}"})}},{key:"initButton",value:function(){var e=this,t=!1;m.controls.toggleBackground.addEventListener("click",function(n){n.preventDefault(),t?(e.mat.uniforms.mixAmount.value=.08,e.mat.uniforms.vignetteAmount.value=0,e.lightControls()):(e.mat.uniforms.mixAmount.value=.8,e.mat.uniforms.vignetteAmount.value=-1.6,e.darkControls()),t=!t},!1)}},{key:"darkControls",value:function(){m.controls.main.classList.add("backgroundToggle");for(var e=0;e<m.controls.sliders.length;e++)m.controls.sliders[e].classList.remove("light-slider"),m.controls.sliders[e].classList.add("dark-slider")}},{key:"lightControls",value:function(){m.controls.main.classList.remove("backgroundToggle");for(var e=0;e<m.controls.sliders.length;e++)m.controls.sliders[e].classList.remove("dark-slider"),m.controls.sliders[e].classList.add("light-slider")}}]),n}(),x=function(){function n(t){e(this,n),this.materials=t,this.loadMaps(),this.initButton()}return t(n,[{key:"loadMaps",value:function(){this.maps=[];var e=(new THREE.TextureLoader).load("/images/textures/env_maps/test_env_map.jpg");e.mapping=THREE.EquirectangularReflectionMapping,e.magFilter=THREE.LinearFilter,e.minFilter=THREE.LinearMipMapLinearFilter,this.maps.push(e);var t="/images/textures/cube_maps/Bridge2/",n=[t+"posx.jpg",t+"negx.jpg",t+"posy.jpg",t+"negy.jpg",t+"posz.jpg",t+"negz.jpg"],i=(new THREE.CubeTextureLoader).load(n);i.format=THREE.RGBFormat,i.mapping=THREE.CubeReflectionMapping,this.maps.push(i)}},{key:"initButton",value:function(){var e=this,t=0;m.controls.toggleEnvironment.addEventListener("click",function(n){n.preventDefault();var i=e.maps[t%e.maps.length];t++,e.materials.forEach(function(e){void 0!==e.reflectivity&&(e.reflectivity=.5),void 0!==e.envMapIntensity&&(e.envMapIntensity=.5),void 0!==e.envMap&&(e.envMap=i),e.needsUpdate=!0})})}},{key:"default",value:function(){var e=this;this.materials.forEach(function(t){void 0!==t.reflectivity&&(t.reflectivity=.25),void 0!==t.envMapIntensity&&(t.envMapIntensity=.25),void 0!==t.envMap&&(t.envMap=e.maps[0]),t.needsUpdate=!0})}}]),n}(),B=function(){function n(t){e(this,n),this.app=t,this.initLights(),this.initSlider(),this.initialStrength=1.2,this.reset()}return t(n,[{key:"initLights",value:function(){var e=new THREE.AmbientLight(16777215,.3);this.app.scene.add(e),this.light=new THREE.PointLight(16777215,this.initialStrength),this.app.camera.add(this.light),this.app.scene.add(this.app.camera)}},{key:"initSlider",value:function(){var e=this;m.lighting.slider.addEventListener("input",function(t){t.preventDefault(),e.light.intensity=m.lighting.slider.value},!1),m.lighting.symbol.addEventListener("click",function(t){t.preventDefault(),e.reset()},!1)}},{key:"reset",value:function(){this.light.intensity=this.initialStrength,m.lighting.slider.value=String(this.light.intensity)}}]),n}(),R=function(){function n(t){e(this,n),this.camera=t.camera,this.scene=t.scene,this.renderer=t.renderer,this.initButton()}return t(n,[{key:"initButton",value:function(){var e=this;m.screenshot.button.addEventListener("click",function(t){t.preventDefault(),e.takeScreenshot()},!1)}},{key:"takeScreenshot",value:function(){this.renderer.render(this.scene,this.camera,null,!1);var e='\n      <iframe\n        src="'+this.renderer.domElement.toDataURL("image/png")+'"\n        frameborder="0"\n        style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;"\n        allowfullscreen>\n      </iframe>',t=window.open();t.document.open(),t.document.write(e),t.document.close()}}]),n}(),A=function(){function n(t){e(this,n),this.app=t,this.size=0,this.gridHelper=new THREE.GridHelper,this.axesHelper=new THREE.AxesHelper,this.helpers=new THREE.Group,this.helpers.add(this.gridHelper,this.axesHelper),this.helpers.visible=!1,this.initButton()}return t(n,[{key:"setSize",value:function(){this.size=Math.floor(.5*this.app.camera.far),this.size%2!=0&&this.size++,this.updateGrid(),this.updateAxes()}},{key:"updateGrid",value:function(){var e=new THREE.GridHelper(this.size,10);this.helpers.remove(this.gridHelper),this.gridHelper=e,this.helpers.add(this.gridHelper)}},{key:"updateAxes",value:function(){var e=new THREE.AxesHelper(this.size/2);this.helpers.remove(this.axesHelper),this.axesHelper=e,this.helpers.add(this.axesHelper)}},{key:"initButton",value:function(){var e=this;m.controls.toggleGrid.addEventListener("click",function(t){t.preventDefault(),e.setSize(),e.helpers.visible=!e.helpers.visible})}}]),n}(),H=function(){function n(t,i){e(this,n),this.renderer=t.renderer,this.objects=i,this.modelInfo=this.boundingBox=new THREE.Box3,this.initButton()}return t(n,[{key:"update",value:function(){this.boundingBox.expandByObject(this.objects);var e=Math.abs(this.boundingBox.max.z-this.boundingBox.min.z),t=Math.abs(this.boundingBox.max.x-this.boundingBox.min.x),n=Math.abs(this.boundingBox.max.y-this.boundingBox.min.y);m.modelInfo.bbDepth.innerHTML=e.toPrecision(4),m.modelInfo.bbWidth.innerHTML=t.toPrecision(4),m.modelInfo.bbHeight.innerHTML=n.toPrecision(4),m.modelInfo.faces.innerHTML=this.renderer.info.render.faces,m.modelInfo.vertices.innerHTML=this.renderer.info.render.vertices}},{key:"initButton",value:function(){m.controls.toggleInfo.addEventListener("click",function(e){e.preventDefault(),m.modelInfo.infoBox.classList.toggle("hide")})}}]),n}();!function(e){if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=function(e){return e&&DataView.prototype.isPrototypeOf(e)},o=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};u.prototype.append=function(e,t){e=a(e),t=l(t);var n=this.map[e];this.map[e]=n?n+","+t:t},u.prototype.delete=function(e){delete this.map[a(e)]},u.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},u.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},u.prototype.set=function(e,t){this.map[a(e)]=l(t)},u.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},u.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),c(e)},u.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),c(e)},u.prototype.entries=function(){var e=[];return this.forEach(function(t,n){e.push([n,t])}),c(e)},t.iterable&&(u.prototype[Symbol.iterator]=u.prototype.entries);var r=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];v.prototype.clone=function(){return new v(this,{body:this._bodyInit})},m.call(v.prototype),m.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new u(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var s=[301,302,303,307,308];g.redirect=function(e,t){if(-1===s.indexOf(t))throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})},e.Headers=u,e.Request=v,e.Response=g,e.fetch=function(e,n){return new Promise(function(i,o){var r=new v(e,n),s=new XMLHttpRequest;s.onload=function(){var e,t,n={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new u,e.split(/\r?\n/).forEach(function(e){var n=e.split(":"),i=n.shift().trim();if(i){var o=n.join(":").trim();t.append(i,o)}}),t)};n.url="responseURL"in s?s.responseURL:n.headers.get("X-Request-URL");var o="response"in s?s.response:s.responseText;i(new g(o,n))},s.onerror=function(){o(new TypeError("Network request failed"))},s.ontimeout=function(){o(new TypeError("Network request failed"))},s.open(r.method,r.url,!0),"include"===r.credentials&&(s.withCredentials=!0),"responseType"in s&&t.blob&&(s.responseType="blob"),r.headers.forEach(function(e,t){s.setRequestHeader(t,e)}),s.send(void 0===r._bodyInit?null:r._bodyInit)})},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function l(e){return"string"!=typeof e&&(e=String(e)),e}function c(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function u(e){this.map={},e instanceof u?e.forEach(function(e,t){this.append(t,e)},this):Array.isArray(e)?e.forEach(function(e){this.append(e[0],e[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function d(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise(function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}})}function f(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function p(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function m(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&i(e))this._bodyArrayBuffer=p(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!o(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=p(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=d(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?d(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,n,i=d(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),i=0;i<t.length;i++)n[i]=String.fromCharCode(t[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(y)}),this.json=function(){return this.text().then(JSON.parse)},this}function v(e,t){var n,i,o=(t=t||{}).body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new u(e.headers)),this.method=e.method,this.mode=e.mode,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new u(t.headers)),this.method=(n=t.method||this.method||"GET",i=n.toUpperCase(),r.indexOf(i)>-1?i:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function y(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var n=e.split("="),i=n.shift().replace(/\+/g," "),o=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(o))}}),t}function g(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new u(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:void 0);var j=new THREE.LoadingManager,P=0,O=null;function C(e,t){if(!(e instanceof Blob))throw new TypeError("Must be a File or Blob");return new Promise(function(n,i){var o=new FileReader;o.onload=function(e){n(e.target.result)},o.onerror=function(t){i(new Error("Error reading"+e.name+": "+t.target.result))},o["readAs"+t](e)})}j.onStart=function(){null===O&&(m.setOnLoadStartState(),O=setInterval(function(){(P+=5)>=100?clearInterval(O):m.loading.progress.style.width=P+"%"},100))},j.onLoad=function(){m.setOnLoadEndState(),clearInterval(O)},j.onProgress=function(){P>=100||(P+=1,m.loading.progress.style.width=P+"%")},j.onError=function(e){console.error(e)},THREE.Loader.Handlers.add(/\.dds$/i,new THREE.DDSLoader);var F=null,M=null,q=null,D=null,U=null,I=null,z=null,_=null,G=null,W=function(e){return function(t){return new Promise(function(n,i){e.load(t,n,j.onProgress,i)})}},N=new function t(){return e(this,t),{get objectLoader(){return null===F&&(F=W(new THREE.ObjectLoader(j))),F},get bufferGeometryLoader(){return null===M&&(M=W(new THREE.BufferGeometryLoader(j))),M},get jsonLoader(){return null===q&&(q=W(new THREE.JSONLoader(j))),q},get fbxLoader(){return null===D&&(D=W(new THREE.FBXLoader(j))),D},get gltfLoader(){return null===U&&(U=W(new THREE.GLTFLoader(j))),U},get objLoader(){return null===G&&(G=new THREE.OBJLoader(j),(I=W(G)).setMaterials=function(e){G.setMaterials(e)}),I},get mtlLoader(){return null===z&&(z=W(new THREE.MTLLoader(j))),z},get colladaLoader(){return null===_&&(_=W(new THREE.ColladaLoader(j))),_}}},J=new THREE.MeshBasicMaterial({wireframe:!0,color:0}),X=function(){function n(){e(this,n)}return t(n,null,[{key:"onJSONLoad",value:function(e,t){var n=this,i=JSON.parse(e);if(i.metadata&&i.metadata.type){var o=i.metadata.type.toLowerCase();C(t,"DataURL").then(function(e){"buffergeometry"===o?n.onJSONBufferGeometryLoad(e):"geometry"===o?n.onJSONGeometryLoad(e):"object"===o&&n.onJSONObjectLoad(e)}).catch(function(e){return console.error(e)})}else console.error("Error: Invalid JSON file.")}},{key:"onJSONBufferGeometryLoad",value:function(e){console.log("Using THREE.BufferGeometryLoader");var t=N.bufferGeometryLoader(e);return t.then(function(e){console.log(e);var t=new THREE.Mesh(e,J);re.addObjectToScene(t)}).catch(function(e){console.log(e)}),t}},{key:"onJSONGeometryLoad",value:function(e){console.log("Using THREE.JSONLoader");var t=N.jsonLoader(e);return t.then(function(e){console.log(e);var t=new THREE.Mesh(e,J);re.addObjectToScene(t)}).catch(function(e){console.log(e)}),t}},{key:"onJSONObjectLoad",value:function(e){console.log("Using THREE.ObjectLoader");var t=N.objectLoader(e);return t.then(function(e){console.log(e),re.addObjectToScene(e)}).catch(function(e){console.log(e)}),t}},{key:"onFBXLoad",value:function(e){console.log("Using THREE.FBXLoader");var t=N.fbxLoader(e);return t.then(function(e){console.log(e),re.addObjectToScene(e)}).catch(function(e){console.log(e)}),t}},{key:"onGLTFLoad",value:function(e){var t=new Promise(function(e,t){});return console.log("Using THREE.GLTFLoader"),(t=N.gltfLoader(e)).then(function(e){console.log(e),e.scenes.length>1?e.scenes.forEach(function(t){e.animations&&(t.animations=e.animations),re.addObjectToScene(t)}):e.scene?(e.animations&&(e.scene.animations=e.animations),re.addObjectToScene(e.scene)):console.error("No scene found in GLTF file.")}).catch(function(e){console.log(e)}),t}},{key:"onMTLLoad",value:function(e){new Promise(function(e,t){});return N.mtlLoader(e)}},{key:"onOBJLoad",value:function(e,t){var n=new Promise(function(e,t){});return N.objLoader.setMaterials(t),(n=N.objLoader(e)).then(function(e){console.log(e),re.addObjectToScene(e)}).catch(function(e){console.log(e)}),n}},{key:"onDAELoad",value:function(e){var t=new Promise(function(e){});return(t=N.colladaLoader(e)).then(function(e){console.log(e);var t=e.scene;e.animations&&e.animations.length>0&&(t.animations=e.animations),re.addObjectToScene(t)}).catch(function(e){console.log(e)}),t}}]),n}();window.File&&window.FileReader&&window.FileList&&window.Blob||console.error("This loader requires the File API. Please upgrade your browser");var V=function(e){return new RegExp("(png|jpg|jpeg|gif|bmp|dds|tga|bin|vert|frag|txt|mtl)$").test(e)},$=function(e){return new RegExp("(json|js|fbx|gltf|glb|dae|obj)$").test(e)},Y=[],K={},Q=[];j.setURLModifier(function(e){if("."===e[e.length-3]||"."===e[e.length-4]){var t=e.split(".").pop().toLowerCase();V(t)&&(e=(e=(e=e.replace("data:application/","")).split("/"))[e.length-1])}return void 0===K[e]?e:K[e]});var Z=function(e){var t,n=e.name.split(".").pop().toLowerCase();if(V(t=n)||$(t))if("js"===n||"json"===n){var i=C(e,"Text").then(function(t){Y.push([t,n,e])}).catch(function(e){return console.error(e)});Q.push(i)}else{var o=C(e,"DataURL").then(function(t){$(n)?"obj"===n?Y.push([t,n,e]):Y.push([t,n]):V(n)&&(K[e.name]=t)}).catch(function(e){return console.error(e)});Q.push(o)}},ee=function(e){Y=[],K={},Q=[];for(var t=0;t<e.length;t++)Z(e[t]);Promise.all(Q).then(function(){Y.forEach(function(e){return function(e){var t=e[0],n=e[1],i=e[2];switch(n){case"fbx":j.onStart(),X.onFBXLoad(t);break;case"gltf":case"glb":j.onStart(),X.onGLTFLoad(t);break;case"obj":j.onStart(),X.onMTLLoad(K[i.name.replace(".obj",".mtl")]).then(function(e){X.onOBJLoad(t,e)}).catch(function(e){return console.error(e)});break;case"dae":j.onStart(),X.onDAELoad(t);break;case"json":case"js":j.onStart(),X.onJSONLoad(t,i);break;default:console.error("Unsupported file type "+n+" - please load one of the supported model formats.")}}(e)})}).catch(function(e){return console.error(e)})},te=m.fileUpload.form,ne=m.fileUpload.button;ne.addEventListener("click",function(e){e.preventDefault(),m.fileUpload.input.click()},!1),m.fileUpload.input.addEventListener("change",function(e){e.preventDefault();var t=e.target.files;ee(t)},!1),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){return te.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation()})}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(function(e){return document.addEventListener(e,function(e){e.preventDefault(),e.stopPropagation()})}),["dragover","dragenter"].forEach(function(e){return te.addEventListener(e,function(){te.classList.add("border"),ne.classList.add("highlight")})}),["dragend","dragleave","drop"].forEach(function(e){return te.addEventListener(e,function(){te.classList.remove("border"),ne.classList.remove("highlight")})}),m.fileUpload.form.addEventListener("drop",function(e){var t=e.dataTransfer.files;ee(t)}),m.controls.exampleDuck.addEventListener("click",function(e){e.preventDefault(),j.onStart(),X.onGLTFLoad("/models/gltf/Duck.gltf")});var ie=document.createElement("a");ie.style.display="none",document.body.appendChild(ie);var oe=function(e,t){var n,i;n=new Blob([e],{type:"text/plain"}),i=t,ie.href=URL.createObjectURL(n),ie.download=i||"data.json",ie.click()};THREE.Cache.enabled=!0;var re=new(function(){function n(t){e(this,n);var i=this;this.canvas=t,this.app=new L(this.canvas),this.animationControls=new k,this.app.onUpdate=function(){i.animationControls.update(i.app.delta)},this.app.onWindowResize=function(){},this.loadedObjects=new THREE.Group,this.loadedMaterials=[],this.app.scene.add(this.loadedObjects),this.lighting=new B(this.app),this.grid=new A(this.app),this.background=new T(this.app),this.environment=new x(this.loadedMaterials),this.info=new H(this.app,this.loadedObjects),this.app.scene.add(this.grid.helpers),this.app.initControls(),this.screenshotHandler=new R(this.app),this.initReset(),this.initExport()}return t(n,[{key:"addObjectToScene",value:function(e){var t=this;void 0!==e?(this.animationControls.initAnimation(e),this.loadedObjects.add(e),this.app.fitCameraToObject(this.loadedObjects,.9),this.app.play(),this.info.update(),this.loadedObjects.traverse(function(e){void 0!==e.material&&t.loadedMaterials.push(e.material)}),this.environment.default()):console.error("Oops! An unspecified error occurred :(")}},{key:"initExport",value:function(){var e=this;m.controls.exportGLTF.addEventListener("click",function(t){var n,i;t.preventDefault(),n=e.loadedObjects,i=new THREE.GLTFExporter,console.log(n),i.parse(n.children[0].children[0],function(e){var t=JSON.stringify(e,null,2);oe(t,"blackThreadGLTF.gltf")},{trs:!1,onlyVisible:!0,truncateDrawRange:!0,binary:!1,embedImages:!0})})}},{key:"initReset",value:function(){var e=this;m.reset.addEventListener("click",function(){for(;e.loadedObjects.children.length>0;){var t=e.loadedObjects.children[0];e.loadedObjects.remove(t),t=null}e.loadedMaterials=[],e.animationControls.reset(),e.lighting.reset(),m.setInitialState()})}}]),n}())(m.canvas)}();