"use strict";void 0===THREE.LoaderSupport&&(THREE.LoaderSupport={}),THREE.LoaderSupport.Validator={isValid:function(e){return null!==e&&void 0!==e},verifyInput:function(e,t){return null===e||void 0===e?t:e}},THREE.LoaderSupport.Callbacks=function(){var e=THREE.LoaderSupport.Validator;function t(){this.onProgress=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null}return t.prototype.setCallbackOnProgress=function(t){this.onProgress=e.verifyInput(t,this.onProgress)},t.prototype.setCallbackOnMeshAlter=function(t){this.onMeshAlter=e.verifyInput(t,this.onMeshAlter)},t.prototype.setCallbackOnLoad=function(t){this.onLoad=e.verifyInput(t,this.onLoad)},t.prototype.setCallbackOnLoadMaterials=function(t){this.onLoadMaterials=e.verifyInput(t,this.onLoadMaterials)},t}(),THREE.LoaderSupport.LoadedMeshUserOverride=function(){function e(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]}return e.prototype.addMesh=function(e){this.meshes.push(e),this.alteredMesh=!0},e.prototype.isDisregardMesh=function(){return this.disregardMesh},e.prototype.providesAlteredMeshes=function(){return this.alteredMesh},e}(),THREE.LoaderSupport.ResourceDescriptor=function(){var e=THREE.LoaderSupport.Validator;function t(t,r){var i=t.split("/");i.length<2?(this.path=null,this.name=t,this.url=t):(this.path=e.verifyInput(i.slice(0,i.length-1).join("/")+"/",null),this.name=e.verifyInput(i[i.length-1],null),this.url=t),this.extension=e.verifyInput(r,"default"),this.extension=this.extension.trim(),this.content=null}return t.prototype.setContent=function(t){this.content=e.verifyInput(t,null)},t}(),THREE.LoaderSupport.PrepData=function(){var e=THREE.LoaderSupport.Validator;function t(t){this.logging={enabled:!0,debug:!1},this.modelName=e.verifyInput(t,""),this.resources=[],this.callbacks=new THREE.LoaderSupport.Callbacks}return t.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},t.prototype.getCallbacks=function(){return this.callbacks},t.prototype.addResource=function(e){this.resources.push(e)},t.prototype.clone=function(){var e,t,r=new THREE.LoaderSupport.PrepData(this.modelName);for(e in r.logging.enabled=this.logging.enabled,r.logging.debug=this.logging.debug,r.resources=this.resources,r.callbacks=this.callbacks,this)t=this[e],r.hasOwnProperty(e)||"function"==typeof this[e]||(r[e]=t);return r},t.prototype.checkResourceDescriptorFiles=function(t,r){var i,o,n,s,a={};for(var l in t)if(i=t[l],s=!1,e.isValid(i.name))if(e.isValid(i.content)){for(n=0;n<r.length&&!s;n++)if(o=r[n],i.extension.toLowerCase()===o.ext.toLowerCase())if(o.ignore)s=!0;else if("ArrayBuffer"===o.type){if(!(i.content instanceof ArrayBuffer||i.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";a[o.ext]=i,s=!0}else if("String"===o.type){if(!("string"==typeof i.content||i.content instanceof String))throw"Provided  content is not of type String! Aborting...";a[o.ext]=i,s=!0}if(!s)throw'Unidentified resource "'+i.name+'": '+i.url}else{if(!("string"==typeof i.name||i.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(n=0;n<r.length&&!s;n++)o=r[n],i.extension.toLowerCase()===o.ext.toLowerCase()&&(o.ignore||(a[o.ext]=i),s=!0);if(!s)throw'Unidentified resource "'+i.name+'": '+i.url}return a},t}(),THREE.LoaderSupport.MeshBuilder=function(){var e="1.2.0",t=THREE.LoaderSupport.Validator;function r(){console.info("Using THREE.LoaderSupport.MeshBuilder version: "+e),this.logging={enabled:!0,debug:!1},this.callbacks=new THREE.LoaderSupport.Callbacks,this.materials=[]}return r.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},r.prototype.init=function(){var e=new THREE.MeshStandardMaterial({color:14479871});e.name="defaultMaterial";var t=new THREE.MeshStandardMaterial({color:14479871});t.name="defaultVertexColorMaterial",t.vertexColors=THREE.VertexColors;var r=new THREE.LineBasicMaterial;r.name="defaultLineMaterial";var i=new THREE.PointsMaterial({size:1});i.name="defaultPointMaterial";var o={};o[e.name]=e,o[t.name]=t,o[r.name]=r,o[i.name]=i,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:o}})},r.prototype.setMaterials=function(e){var r={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:t.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(e):e}};this.updateMaterials(r)},r.prototype._setCallbacks=function(e){t.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),t.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),t.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),t.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials)},r.prototype.processPayload=function(e){return"meshData"===e.cmd?this.buildMeshes(e):"materialData"===e.cmd?(this.updateMaterials(e),null):void 0},r.prototype.buildMeshes=function(e){var r,i,o,n=e.params.meshName,s=new THREE.BufferGeometry;s.addAttribute("position",new THREE.BufferAttribute(new Float32Array(e.buffers.vertices),3)),t.isValid(e.buffers.indices)&&s.setIndex(new THREE.BufferAttribute(new Uint32Array(e.buffers.indices),1)),t.isValid(e.buffers.colors)&&s.addAttribute("color",new THREE.BufferAttribute(new Float32Array(e.buffers.colors),3)),t.isValid(e.buffers.normals)?s.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(e.buffers.normals),3)):s.computeVertexNormals(),t.isValid(e.buffers.uvs)&&s.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(e.buffers.uvs),2));var a=e.materials.materialNames,l=e.materials.multiMaterial,u=[];for(o in a)i=a[o],r=this.materials[i],l&&u.push(r);if(l){r=u;var c,p=e.materials.materialGroups;for(o in p)c=p[o],s.addGroup(c.start,c.count,c.index)}var d,h,g,f=[],m=this.callbacks.onMeshAlter,b=!0,k=t.verifyInput(e.geometryType,0);if(t.isValid(m)&&(h=m({detail:{meshName:n,bufferGeometry:s,material:r,geometryType:k}}),t.isValid(h))){if(!h.isDisregardMesh()&&h.providesAlteredMeshes())for(var y in h.meshes)f.push(h.meshes[y]);b=!1}if(b&&(e.computeBoundingSphere&&s.computeBoundingSphere(),(d=0===k?new THREE.Mesh(s,r):1===k?new THREE.LineSegments(s,r):new THREE.Points(s,r)).name=n,f.push(d)),t.isValid(f)&&f.length>0){var w=[];for(var y in f)d=f[y],w[y]=d.name;g="Adding mesh(es) ("+w.length+": "+w+") from input mesh: "+n,g+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)"}else g="Not adding mesh: "+n,g+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)";var R=this.callbacks.onProgress;t.isValid(R)&&R(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:e.params.meshName,text:g,numericalValue:e.progress.numericalValue}}));return f},r.prototype.updateMaterials=function(e){var r,i,o=e.materials.materialCloneInstructions;if(t.isValid(o)){var n=o.materialNameOrg,s=this.materials[n];if(t.isValid(n)){r=s.clone(),i=o.materialName,r.name=i;var a=o.materialProperties;for(var l in a)r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&(r[l]=a[l]);this.materials[i]=r}else console.warn('Requested material "'+n+'" is not available!')}var u=e.materials.serializedMaterials;if(t.isValid(u)&&Object.keys(u).length>0){var c,p=new THREE.MaterialLoader;for(i in u)c=u[i],t.isValid(c)&&(r=p.parse(c),this.logging.enabled&&console.info('De-serialized material with name "'+i+'" will be added.'),this.materials[i]=r)}if(u=e.materials.runtimeMaterials,t.isValid(u)&&Object.keys(u).length>0)for(i in u)r=u[i],this.logging.enabled&&console.info('Material with name "'+i+'" will be added.'),this.materials[i]=r},r.prototype.getMaterialsJSON=function(){var e,t={};for(var r in this.materials)e=this.materials[r],t[r]=e.toJSON();return t},r.prototype.getMaterials=function(){return this.materials},r}(),THREE.LoaderSupport.WorkerRunnerRefImpl=function(){function e(){var e=this;self.addEventListener("message",function(t){e.processMessage(t.data)},!1)}return e.prototype.applyProperties=function(e,t){var r,i,o;for(r in t)i="set"+r.substring(0,1).toLocaleUpperCase()+r.substring(1),o=t[r],"function"==typeof e[i]?e[i](o):e.hasOwnProperty(r)&&(e[r]=o)},e.prototype.processMessage=function(e){if("run"===e.cmd){var t={callbackMeshBuilder:function(e){self.postMessage(e)},callbackProgress:function(t){e.logging.enabled&&e.logging.debug&&console.debug("WorkerRunner: progress: "+t)}},r=new Parser;"function"==typeof r.setLogging&&r.setLogging(e.logging.enabled,e.logging.debug),this.applyProperties(r,e.params),this.applyProperties(r,e.materials),this.applyProperties(r,t),r.workerScope=self,r.parse(e.data.input,e.data.options),e.logging.enabled&&console.log("WorkerRunner: Run complete!"),t.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+e.cmd)},e}(),THREE.LoaderSupport.WorkerSupport=function(){var e="2.2.0",t=THREE.LoaderSupport.Validator,r=function(){function e(){this._reset()}return e.prototype._reset=function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},e.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},e.prototype.setForceCopy=function(e){this.forceCopy=!0===e},e.prototype.initWorker=function(e,t){this.runnerImplName=t;var r=new Blob([e],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(r)),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},e.prototype._receiveWorkerMessage=function(e){var t=e.data;switch(t.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(t);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+t.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+t.cmd)}},e.prototype.setCallbacks=function(e,r){this.callbacks.meshBuilder=t.verifyInput(e,this.callbacks.meshBuilder),this.callbacks.onLoad=t.verifyInput(r,this.callbacks.onLoad)},e.prototype.run=function(e){if(t.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=e,this.started=!0,!t.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!t.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==e.cmd&&(e.cmd="run"),t.isValid(e.logging)?(e.logging.enabled=!0===e.logging.enabled,e.logging.debug=!0===e.logging.debug):e.logging={enabled:!0,debug:!1},this._postMessage()}},e.prototype._postMessage=function(){var e;t.isValid(this.queuedMessage)&&t.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(e=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[e])):this.worker.postMessage(this.queuedMessage))},e.prototype.setTerminateRequested=function(e){this.terminateRequested=!0===e,this.terminateRequested&&t.isValid(this.worker)&&!t.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},e.prototype._terminate=function(){this.worker.terminate(),this._reset()},e}();function i(){if(console.info("Using THREE.LoaderSupport.WorkerSupport version: "+e),this.logging={enabled:!0,debug:!1},void 0===window.Worker)throw"This browser does not support web workers!";if(void 0===window.Blob)throw"This browser does not support Blob!";if("function"!=typeof window.URL.createObjectURL)throw"This browser does not support Object creation from URL!";this.loaderWorker=new r}i.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},i.prototype.setForceWorkerDataCopy=function(e){this.loaderWorker.setForceCopy(e)},i.prototype.validate=function(e,r,i,s,a){if(!t.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),t.isValid(a)?this.logging.enabled&&console.info('WorkerSupport: Using "'+a.name+'" as Runner class for worker.'):(a=THREE.LoaderSupport.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "THREE.LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.'));var l=e(o,n);l+="var Parser = "+r+";\n\n",l+=n(a.name,a),l+="new "+a.name+"();\n\n";var u=this;if(t.isValid(i)&&i.length>0){var c="",p=function(e,t){if(0===t.length)u.loaderWorker.initWorker(c+l,a.name),u.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var r=new THREE.FileLoader;r.setPath(e),r.setResponseType("text"),r.load(t[0],function(r){c+=r,p(e,t)}),t.shift()}};p(s,i)}else this.loaderWorker.initWorker(l,a.name),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},i.prototype.setCallbacks=function(e,t){this.loaderWorker.setCallbacks(e,t)},i.prototype.run=function(e){this.loaderWorker.run(e)},i.prototype.setTerminateRequested=function(e){this.loaderWorker.setTerminateRequested(e)};var o=function(e,t){var r,i=e+" = {\n";for(var o in t)"string"==typeof(r=t[o])||r instanceof String?i+="\t"+o+': "'+(r=(r=r.replace("\n","\\n")).replace("\r","\\r"))+'",\n':r instanceof Array?i+="\t"+o+": ["+r+"],\n":Number.isInteger(r)?i+="\t"+o+": "+r+",\n":"function"==typeof r&&(i+="\t"+o+": "+r+",\n");return i+="}\n\n"},n=function(e,r,i,o,n){var s,a,l="",u=t.isValid(i)?i:r.name;for(var c in n=t.verifyInput(n,[]),r.prototype)s=r.prototype[c],"constructor"===c?a="\tfunction "+u+s.toString().replace("function","")+";\n\n":"function"==typeof s&&n.indexOf(c)<0&&(l+="\t"+u+".prototype."+c+" = "+s.toString()+";\n\n");l+="\treturn "+u+";\n",l+="})();\n\n";var p="";return t.isValid(o)&&(p+="\n",p+=u+".prototype = Object.create( "+o+".prototype );\n",p+=u+".constructor = "+u+";\n",p+="\n"),t.isValid(a)?l=e+" = (function () {\n\n"+p+a+l:(a=e+" = (function () {\n\n",l=(a+=p+"\t"+r.prototype.constructor.toString()+"\n\n")+l),l};return i}(),THREE.LoaderSupport.WorkerDirector=function(){var e="2.2.0",t=THREE.LoaderSupport.Validator,r=16,i=8192;function o(o){if(console.info("Using THREE.LoaderSupport.WorkerDirector version: "+e),this.logging={enabled:!0,debug:!1},this.maxQueueSize=i,this.maxWebWorkers=r,this.crossOrigin=null,!t.isValid(o))throw"Provided invalid classDef: "+o;this.workerDescription={classDef:o,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null}return o.prototype.setLogging=function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},o.prototype.getMaxQueueSize=function(){return this.maxQueueSize},o.prototype.getMaxWebWorkers=function(){return this.maxWebWorkers},o.prototype.setCrossOrigin=function(e){this.crossOrigin=e},o.prototype.setForceWorkerDataCopy=function(e){this.workerDescription.forceWorkerDataCopy=!0===e},o.prototype.prepareWorkers=function(e,o,n){t.isValid(e)&&(this.workerDescription.globalCallbacks=e),this.maxQueueSize=Math.min(o,i),this.maxWebWorkers=Math.min(n,r),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0;for(var s=0;s<this.maxWebWorkers;s++){var a=new THREE.LoaderSupport.WorkerSupport;a.setLogging(this.logging.enabled,this.logging.debug),a.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[s]={instanceNo:s,inUse:!1,terminateRequested:!1,workerSupport:a,loader:null}}},o.prototype.enqueueForRun=function(e){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(e)},o.prototype.isRunning=function(){var e=Object.keys(this.workerDescription.workerSupports);return this.instructionQueue.length>0&&this.instructionQueuePointer<this.instructionQueue.length||e.length>0},o.prototype.processQueue=function(){var e,t;for(var r in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[r]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(e=this.instructionQueue[this.instructionQueuePointer],this._kickWorkerRun(e,t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},o.prototype._kickWorkerRun=function(e,r){r.inUse=!0,r.workerSupport.setTerminateRequested(r.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var i=this,o=e.getCallbacks(),n=this.workerDescription.globalCallbacks;r.loader=this._buildLoader(r.instanceNo);var s=new THREE.LoaderSupport.Callbacks;s.setCallbackOnLoad(function(e){t.isValid(n.onLoad)&&n.onLoad(e),t.isValid(o.onLoad)&&o.onLoad(e),i.objectsCompleted++,r.inUse=!1,i.processQueue()}),s.setCallbackOnProgress(function(e){t.isValid(n.onProgress)&&n.onProgress(e),t.isValid(o.onProgress)&&o.onProgress(e)}),s.setCallbackOnMeshAlter(function(e){t.isValid(n.onMeshAlter)&&n.onMeshAlter(e),t.isValid(o.onMeshAlter)&&o.onMeshAlter(e)}),e.callbacks=s,r.loader.run(e,r.workerSupport)},o.prototype._buildLoader=function(e){var r=this.workerDescription.classDef,i=Object.create(r.prototype);if(r.call(i,THREE.DefaultLoadingManager),!i.hasOwnProperty("instanceNo"))throw r.name+' has no property "instanceNo".';if(i.instanceNo=e,!i.hasOwnProperty("workerSupport"))throw r.name+' has no property "workerSupport".';if("function"!=typeof i.run)throw r.name+' has no function "run".';return i.hasOwnProperty("callbacks")&&t.isValid(i.callbacks)||(console.warn(r.name+' has an invalid property "callbacks". Will change to "THREE.LoaderSupport.Callbacks"'),i.callbacks=new THREE.LoaderSupport.Callbacks),i},o.prototype._deregister=function(e){if(t.isValid(e)){e.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+e.instanceNo+".");var r=e.loader.callbacks;t.isValid(r.onProgress)&&r.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[e.instanceNo]}},o.prototype.tearDown=function(e){for(var r in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=t.verifyInput(e,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[r].terminateRequested=!0},o}();