THREE.HDRLoader=THREE.RGBELoader=function(r){this.manager=void 0!==r?r:THREE.DefaultLoadingManager},THREE.RGBELoader.prototype=Object.create(THREE.DataTextureLoader.prototype),THREE.RGBELoader.prototype._parser=function(r){var e=function(r,e){switch(r){case 1:console.error("THREE.RGBELoader Read Error: "+(e||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(e||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(e||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(e||""))}return-1},a=function(r,e,a){e=e||1024;for(var t=r.pos,n=-1,o=0,i="",s=String.fromCharCode.apply(null,new Uint16Array(r.subarray(t,t+128)));0>(n=s.indexOf("\n"))&&o<e&&t<r.byteLength;)i+=s,o+=s.length,t+=128,s+=String.fromCharCode.apply(null,new Uint16Array(r.subarray(t,t+128)));return-1<n&&(!1!==a&&(r.pos+=o+n+1),i+s.slice(0,n))},t=new Uint8Array(r);t.byteLength;t.pos=0;var n=function(r){var t,n,o=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,i=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,d=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,f={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(r.pos>=r.byteLength||!(t=a(r)))return e(1,"no header found");if(!(n=t.match(/^#\?(\S+)$/)))return e(3,"bad initial token");for(f.valid|=1,f.programtype=n[1],f.string+=t+"\n";!1!==(t=a(r));)if(f.string+=t+"\n","#"!==t.charAt(0)){if((n=t.match(o))&&(f.gamma=parseFloat(n[1],10)),(n=t.match(i))&&(f.exposure=parseFloat(n[1],10)),(n=t.match(s))&&(f.valid|=2,f.format=n[1]),(n=t.match(d))&&(f.valid|=4,f.height=parseInt(n[1],10),f.width=parseInt(n[2],10)),2&f.valid&&4&f.valid)break}else f.comments+=t+"\n";return 2&f.valid?4&f.valid?f:e(3,"missing image size specifier"):e(3,"missing format specifier")}(t);if(-1!==n){var o=n.width,i=n.height,s=function(r,a,t){var n,o,i,s,d,f,E,l,u,c,g,h,p,m=a,y=t;if(m<8||m>32767||2!==r[0]||2!==r[1]||128&r[2])return new Uint8Array(r);if(m!==(r[2]<<8|r[3]))return e(3,"wrong scanline width");if(!(n=new Uint8Array(4*a*t))||!n.length)return e(4,"unable to allocate buffer space");for(o=0,i=0,l=4*m,p=new Uint8Array(4),f=new Uint8Array(l);y>0&&i<r.byteLength;){if(i+4>r.byteLength)return e(1);if(p[0]=r[i++],p[1]=r[i++],p[2]=r[i++],p[3]=r[i++],2!=p[0]||2!=p[1]||(p[2]<<8|p[3])!=m)return e(3,"bad rgbe scanline format");for(E=0;E<l&&i<r.byteLength;){if((h=(s=r[i++])>128)&&(s-=128),0===s||E+s>l)return e(3,"bad scanline data");if(h)for(d=r[i++],u=0;u<s;u++)f[E++]=d;else f.set(r.subarray(i,i+s),E),E+=s,i+=s}for(c=m,u=0;u<c;u++)g=0,n[o]=f[u+g],g+=m,n[o+1]=f[u+g],g+=m,n[o+2]=f[u+g],g+=m,n[o+3]=f[u+g],o+=4;y--}return n}(t.subarray(t.pos),o,i);if(-1!==s)return{width:o,height:i,data:s,header:n.string,gamma:n.gamma,exposure:n.exposure,format:THREE.RGBEFormat,type:THREE.UnsignedByteType}}return null};