!function(){function e(e){var r,t=e.Content,n=e.RelativeFilename||e.Filename,a=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(a){case"bmp":r="image/bmp";break;case"jpg":case"jpeg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;default:return void console.warn('FBXLoader: Image type "'+a+'" is not supported.')}if("string"==typeof t)return"data:"+r+";base64,"+t;var i=new Uint8Array(t);return window.URL.createObjectURL(new Blob([i],{type:r}))}function r(e,r,t,n){var a=function(e,r,t,n){var a,i=r.path,o=n.get(e.id).children;void 0!==o&&o.length>0&&void 0!==t[o[0].ID]&&(0!==(a=t[o[0].ID]).indexOf("blob:")&&0!==a.indexOf("data:")||r.setPath(void 0));var s=r.load(a);return r.setPath(i),s}(e,r,t,n);a.ID=e.id,a.name=e.attrName;var i=e.WrapModeU,o=e.WrapModeV,s=void 0!==i?i.value:0,u=void 0!==o?o.value:0;if(a.wrapS=0===s?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,a.wrapT=0===u?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,"Scaling"in e){var c=e.Scaling.value;a.repeat.x=c[0],a.repeat.y=c[1]}return a}function t(e,r,t,a){var i=r.id,o=r.attrName,s=r.ShadingModel;if("object"==typeof s&&(s=s.value),!a.has(i))return null;var u,c=function(e,r,t,a,i){var o={};r.BumpFactor&&(o.bumpScale=r.BumpFactor.value);r.Diffuse?o.color=(new THREE.Color).fromArray(r.Diffuse.value):r.DiffuseColor&&"Color"===r.DiffuseColor.type&&(o.color=(new THREE.Color).fromArray(r.DiffuseColor.value));r.DisplacementFactor&&(o.displacementScale=r.DisplacementFactor.value);r.ReflectionFactor&&(o.reflectivity=r.ReflectionFactor.value);r.Specular?o.specular=(new THREE.Color).fromArray(r.Specular.value):r.SpecularColor&&"Color"===r.SpecularColor.type&&(o.emissive=(new THREE.Color).fromArray(r.SpecularColor.value));r.Shininess&&(o.shininess=r.Shininess.value);r.Emissive?o.emissive=(new THREE.Color).fromArray(r.Emissive.value):r.EmissiveColor&&"Color"===r.EmissiveColor.type&&(o.emissive=(new THREE.Color).fromArray(r.EmissiveColor.value));r.EmissiveFactor&&(o.emissiveIntensity=parseFloat(r.EmissiveFactor.value));r.Opacity&&(o.opacity=parseFloat(r.Opacity.value));o.opacity<1&&(o.transparent=!0);return i.get(a).children.forEach(function(r){var a=r.relationship;switch(a){case"Bump":o.bumpMap=t.get(r.ID);break;case"DiffuseColor":o.map=n(e,t,r.ID,i);break;case"DisplacementColor":o.displacementMap=n(e,t,r.ID,i);break;case"EmissiveColor":o.emissiveMap=n(e,t,r.ID,i);break;case"NormalMap":o.normalMap=n(e,t,r.ID,i);break;case"ReflectionColor":o.envMap=n(e,t,r.ID,i),o.envMap.mapping=THREE.EquirectangularReflectionMapping;break;case"SpecularColor":o.specularMap=n(e,t,r.ID,i);break;case"TransparentColor":o.alphaMap=n(e,t,r.ID,i),o.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",a)}}),o}(e,r,t,i,a);switch(s.toLowerCase()){case"phong":u=new THREE.MeshPhongMaterial;break;case"lambert":u=new THREE.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',s),u=new THREE.MeshPhongMaterial({color:3342591})}return u.setValues(c),u.name=o,u}function n(e,r,t,n){return"LayeredTexture"in e.Objects&&t in e.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=n.get(t).children[0].ID),r.get(t)}function a(e,r){var t=[];return e.children.forEach(function(e){var n=r[e.ID];if("Cluster"===n.attrType){var a={ID:e.ID,indices:[],weights:[],transform:(new THREE.Matrix4).fromArray(n.Transform.a),transformLink:(new THREE.Matrix4).fromArray(n.TransformLink.a),linkMode:n.Mode};"Indexes"in n&&(a.indices=n.Indexes.a,a.weights=n.Weights.a),t.push(a)}}),{rawBones:t,bones:[]}}function i(e,r,t,n){switch(t.attrType){case"Mesh":return function(e,r,t,n){var a=r.parents.map(function(r){return e.Objects.Model[r.ID]});if(0===a.length)return;var i=r.children.reduce(function(e,r){return void 0!==n[r.ID]&&(e=n[r.ID]),e},null),s=new THREE.Matrix4,u=a[0];if("GeometricRotation"in u){var l=u.GeometricRotation.value.map(THREE.Math.degToRad);l[3]="ZYX",s.makeRotationFromEuler((new THREE.Euler).fromArray(l))}"GeometricTranslation"in u&&s.setPosition((new THREE.Vector3).fromArray(u.GeometricTranslation.value));"GeometricScaling"in u&&s.scale((new THREE.Vector3).fromArray(u.GeometricScaling.value));return function(e,r,t,n,a){var i=t.Vertices.a,s=t.PolygonVertexIndex.a,u=[],l=[],f=[],p=[],d=[],h=[],v=[];if(t.LayerElementColor)var E=function(e){var r=e.MappingInformationType,t=e.ReferenceInformationType,n=e.Colors.a,a=[];"IndexToDirect"===t&&(a=e.ColorIndex.a);return{dataSize:4,buffer:n,indices:a,mappingType:r,referenceType:t}}(t.LayerElementColor[0]);if(t.LayerElementMaterial)var g=function(e){var r=e.MappingInformationType,t=e.ReferenceInformationType;if("NoMappingInformation"===r)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:t};for(var n=e.Materials.a,a=[],i=0;i<n.length;++i)a.push(i);return{dataSize:1,buffer:n,indices:a,mappingType:r,referenceType:t}}(t.LayerElementMaterial[0]);if(t.LayerElementNormal)var m=function(e){var r=e.MappingInformationType,t=e.ReferenceInformationType,n=e.Normals.a,a=[];"IndexToDirect"===t&&("NormalIndex"in e?a=e.NormalIndex.a:"NormalsIndex"in e&&(a=e.NormalsIndex.a));return{dataSize:3,buffer:n,indices:a,mappingType:r,referenceType:t}}(t.LayerElementNormal[0]);if(t.LayerElementUV)for(var y=[],T=0;t.LayerElementUV[T];)y.push(o(t.LayerElementUV[T])),T++;var R={};null!==n&&n.rawBones.forEach(function(e,r){e.indices.forEach(function(t,n){void 0===R[t]&&(R[t]=[]),R[t].push({id:r,weight:e.weights[n]})})});var w=0,b=0,I=!1,H=[],L=[],A=[],S=[],C=[],F=[];s.forEach(function(e,r){var t=!1;e<0&&(e^=-1,s[r]=e,t=!0);var a=[],o=[];if(H.push(3*e,3*e+1,3*e+2),E){var T=c(r,w,e,E);A.push(T[0],T[1],T[2])}if(n){if(void 0!==R[e]&&R[e].forEach(function(e){o.push(e.weight),a.push(e.id)}),o.length>4){I||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),I=!0);var D=[0,0,0,0],N=[0,0,0,0];o.forEach(function(e,r){var t=e,n=a[r];N.forEach(function(e,r,a){if(t>e){a[r]=t,t=e;var i=D[r];D[r]=n,n=i}})}),a=D,o=N}for(;o.length<4;)o.push(0),a.push(0);for(var B=0;B<4;++B)C.push(o[B]),F.push(a[B])}if(m){var T=c(r,w,e,m);L.push(T[0],T[1],T[2])}if(g&&"AllSame"!==g.mappingType)var O=c(r,w,e,g)[0];if(y&&y.forEach(function(t,n){var a=c(r,w,e,t);void 0===S[n]&&(S[n]=[]),S[n].push(a[0]),S[n].push(a[1])}),b++,t){for(var B=2;B<b;B++)u.push(i[H[0]]),u.push(i[H[1]]),u.push(i[H[2]]),u.push(i[H[3*(B-1)]]),u.push(i[H[3*(B-1)+1]]),u.push(i[H[3*(B-1)+2]]),u.push(i[H[3*B]]),u.push(i[H[3*B+1]]),u.push(i[H[3*B+2]]),n&&(h.push(C[0]),h.push(C[1]),h.push(C[2]),h.push(C[3]),h.push(C[4*(B-1)]),h.push(C[4*(B-1)+1]),h.push(C[4*(B-1)+2]),h.push(C[4*(B-1)+3]),h.push(C[4*B]),h.push(C[4*B+1]),h.push(C[4*B+2]),h.push(C[4*B+3]),v.push(F[0]),v.push(F[1]),v.push(F[2]),v.push(F[3]),v.push(F[4*(B-1)]),v.push(F[4*(B-1)+1]),v.push(F[4*(B-1)+2]),v.push(F[4*(B-1)+3]),v.push(F[4*B]),v.push(F[4*B+1]),v.push(F[4*B+2]),v.push(F[4*B+3])),E&&(f.push(A[0]),f.push(A[1]),f.push(A[2]),f.push(A[3*(B-1)]),f.push(A[3*(B-1)+1]),f.push(A[3*(B-1)+2]),f.push(A[3*B]),f.push(A[3*B+1]),f.push(A[3*B+2])),g&&"AllSame"!==g.mappingType&&(d.push(O),d.push(O),d.push(O)),m&&(l.push(L[0]),l.push(L[1]),l.push(L[2]),l.push(L[3*(B-1)]),l.push(L[3*(B-1)+1]),l.push(L[3*(B-1)+2]),l.push(L[3*B]),l.push(L[3*B+1]),l.push(L[3*B+2])),y&&y.forEach(function(e,r){void 0===p[r]&&(p[r]=[]),p[r].push(S[r][0]),p[r].push(S[r][1]),p[r].push(S[r][2*(B-1)]),p[r].push(S[r][2*(B-1)+1]),p[r].push(S[r][2*B]),p[r].push(S[r][2*B+1])});w++,b=0,H=[],L=[],A=[],S=[],C=[],F=[]}});var D=new THREE.BufferGeometry;D.name=t.name;var N=new THREE.Float32BufferAttribute(u,3);a.applyToBufferAttribute(N),D.addAttribute("position",N),f.length>0&&D.addAttribute("color",new THREE.Float32BufferAttribute(f,3));n&&(D.addAttribute("skinIndex",new THREE.Float32BufferAttribute(v,4)),D.addAttribute("skinWeight",new THREE.Float32BufferAttribute(h,4)),D.FBX_Deformer=n);if(l.length>0){var B=new THREE.Float32BufferAttribute(l,3),O=(new THREE.Matrix3).getNormalMatrix(a);O.applyToBufferAttribute(B),D.addAttribute("normal",B)}if(p.forEach(function(e,r){var t="uv"+(r+1).toString();0===r&&(t="uv"),D.addAttribute(t,new THREE.Float32BufferAttribute(p[r],2))}),g&&"AllSame"!==g.mappingType){var M=d[0],P=0;if(d.forEach(function(e,r){e!==M&&(D.addGroup(P,r-P,M),M=e,P=r)}),D.groups.length>0){var x=D.groups[D.groups.length-1],k=x.start+x.count;k!==d.length&&D.addGroup(k,d.length-k,M)}0===D.groups.length&&D.addGroup(0,d.length,d[0])}return D}(0,0,t,i,s)}(e,r,t,n);case"NurbsCurve":return function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var r=parseInt(e.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new THREE.BufferGeometry;for(var t,n,a=r-1,i=e.KnotVector.a,o=[],s=e.Points.a,u=0,c=s.length;u<c;u+=4)o.push((new THREE.Vector4).fromArray(s,u));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){t=a,n=i.length-1-t;for(var u=0;u<a;++u)o.push(o[u])}var l=new THREE.NURBSCurve(a,i,o,t,n).getPoints(7*o.length),f=new Float32Array(3*l.length);l.forEach(function(e,r){e.toArray(f,3*r)});var p=new THREE.BufferGeometry;return p.addAttribute("position",new THREE.BufferAttribute(f,3)),p}(t)}}function o(e){var r=e.MappingInformationType,t=e.ReferenceInformationType,n=e.UV.a,a=[];return"IndexToDirect"===t&&(a=e.UVIndex.a),{dataSize:2,buffer:n,indices:a,mappingType:r,referenceType:t}}THREE.FBXLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.FBXLoader.prototype,{load:function(e,r,t,n){var a=this,i=THREE.LoaderUtils.extractUrlBase(e),o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(t){try{var o=a.parse(t,i);r(o)}catch(r){window.setTimeout(function(){n&&n(r),a.manager.itemError(e)},0)}},t,n)},parse:function(n,o){var s,u,c;if(c="Kaydara FBX Binary  \0",(u=n).byteLength>=c.length&&c===A(u,0,c.length))s=(new R).parse(n);else{var g=A(n);if(!function(e){var r=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],t=0;function n(r){var n=e[r-1];return e=e.slice(t+r),t++,n}for(var a=0;a<r.length;++a){var i=n(1);if(i===r[a])return!1}return!0}(g))throw new Error("THREE.FBXLoader: Unknown format.");if(I(g)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+I(g));s=(new T).parse(g)}var m,y,w,b,L,S,C,F,D=function(e){var r=new Map;if("Connections"in e){var t=e.Connections.connections;t.forEach(function(e){var t=e[0],n=e[1],a=e[2];r.has(t)||r.set(t,{parents:[],children:[]});var i={ID:n,relationship:a};r.get(t).parents.push(i),r.has(n)||r.set(n,{parents:[],children:[]});var o={ID:t,relationship:a};r.get(n).children.push(o)})}return r}(s),N=function(r){var t={},n={};if("Video"in r.Objects){var a=r.Objects.Video;for(var i in a){var o=a[i],s=parseInt(i);if(t[s]=o.Filename,"Content"in o){var u=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,c="string"==typeof o.Content&&""!==o.Content;if(u||c){var l=e(a[i]);n[o.Filename]=l}}}}for(var s in t){var f=t[s];void 0!==n[f]?t[s]=n[f]:t[s]=t[s].split("\\").pop()}return t}(s),B=function(e,r,n){var a=new Map;if("Material"in e.Objects){var i=e.Objects.Material;for(var o in i){var s=t(e,i[o],r,n);null!==s&&a.set(parseInt(o),s)}}return a}(s,function(e,t,n,a){var i=new Map;if("Texture"in e.Objects){var o=e.Objects.Texture;for(var s in o){var u=r(o[s],t,n,a);i.set(parseInt(s),u)}}return i}(s,new THREE.TextureLoader(this.manager).setPath(o),N,D),D),O=function(e,r){var t={};if("Deformer"in e.Objects){var n=e.Objects.Deformer;for(var i in n){var o=n[i];if("Skin"===o.attrType){var s=r.get(parseInt(i)),u=a(s,n);u.ID=i,s.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=s.parents[0].ID,t[i]=u}}}return t}(s,D),M=function(e,r,t){var n=new Map;if("Geometry"in e.Objects){var a=e.Objects.Geometry;for(var o in a){var s=r.get(parseInt(o)),u=i(e,s,a[o],t);n.set(parseInt(o),u)}}return n}(s,D,O);return m=s,y=D,w=O,b=M,L=B,S=new THREE.Group,C=function(e,r,t,n,a){var i=new Map,o=e.Objects.Model;for(var s in o){var u=parseInt(s),c=o[s],E=a.get(u),g=l(E,r,u,c.attrName);if(!g){switch(c.attrType){case"Camera":g=f(e,E);break;case"Light":g=p(e,E);break;case"Mesh":g=d(e,E,t,n);break;case"NurbsCurve":g=h(E,t);break;case"LimbNode":case"Null":default:g=new THREE.Group}g.name=THREE.PropertyBinding.sanitizeNodeName(c.attrName),g.ID=u}v(e,g,c),i.set(u,g)}return i}(m,w,b,L,y),F=m.Objects.Model,C.forEach(function(e){var r=F[e.ID];!function(e,r,t,n,a){if("LookAtProperty"in t){var i=n.get(r.ID).children;i.forEach(function(t){if("LookAtProperty"===t.relationship){var n=e.Objects.Model[t.ID];if("Lcl_Translation"in n){var i=n.Lcl_Translation.value;void 0!==r.target?(r.target.position.fromArray(i),a.add(r.target)):r.lookAt((new THREE.Vector3).fromArray(i))}}})}}(m,e,r,y,S),y.get(e.ID).parents.forEach(function(r){var t=C.get(r.ID);void 0!==t&&t.add(e)}),null===e.parent&&S.add(e)}),function(e,r,t,n,a){var i=function(e){var r={};if("Pose"in e.Objects){var t=e.Objects.Pose;for(var n in t)if("BindPose"===t[n].attrType){var a=t[n].PoseNode;Array.isArray(a)?a.forEach(function(e){r[e.Node]=(new THREE.Matrix4).fromArray(e.Matrix.a)}):r[a.Node]=(new THREE.Matrix4).fromArray(a.Matrix.a)}}return r}(e);for(var o in r){var s=r[o],u=a.get(parseInt(s.ID)).parents;u.forEach(function(e){if(t.has(e.ID)){var r=e.ID,o=a.get(r);o.parents.forEach(function(e){if(n.has(e.ID)){var r=n.get(e.ID);r.bind(new THREE.Skeleton(s.bones),i[e.ID])}})}})}}(m,w,b,C,y),function(e,r,t){t.animations=[];var n=function(e,r){if(void 0!==e.Objects.AnimationCurve){var t=function(e){var r=e.Objects.AnimationCurveNode,t=new Map;for(var n in r){var a=r[n];if(null!==a.attrName.match(/S|R|T/)){var i={id:a.id,attr:a.attrName,curves:{}};t.set(i.id,i)}}return t}(e);!function(e,r,t){var n=e.Objects.AnimationCurve;for(var a in n){var i={id:n[a].id,times:n[a].KeyTime.a.map(H),values:n[a].KeyValueFloat.a},o=r.get(i.id);if(void 0!==o){var s=o.parents[0].ID,u=o.parents[0].relationship,c="";if(u.match(/X/))c="x";else if(u.match(/Y/))c="y";else{if(!u.match(/Z/))continue;c="z"}t.get(s).curves[c]=i}}}(e,r,t);var n=function(e,r,t){var n=e.Objects.AnimationLayer,a=new Map;for(var i in n){var o=[],s=r.get(parseInt(i));if(void 0!==s){var u=s.children;u.forEach(function(n,a){if(t.has(n.ID)){var i=t.get(n.ID);if(void 0!==i.curves.x||void 0!==i.curves.y||void 0!==i.curves.z){if(void 0===o[a]){var s;r.get(n.ID).parents.forEach(function(e){void 0!==e.relationship&&(s=e.ID)});var u=e.Objects.Model[s.toString()],c={modelName:THREE.PropertyBinding.sanitizeNodeName(u.attrName),initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};"Lcl_Translation"in u&&(c.initialPosition=u.Lcl_Translation.value),"Lcl_Rotation"in u&&(c.initialRotation=u.Lcl_Rotation.value),"Lcl_Scaling"in u&&(c.initialScale=u.Lcl_Scaling.value),"PreRotation"in u&&(c.preRotations=u.PreRotation.value),o[a]=c}o[a][i.attr]=i}}}),a.set(parseInt(i),o)}}return a}(e,r,t);return function(e,r,t){var n=e.Objects.AnimationStack,a={};for(var i in n){var o=r.get(parseInt(i)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");var s=t.get(o[0].ID);a[i]={name:n[i].attrName,layer:s}}return a}(e,r,n)}}(e,r);if(void 0!==n)for(var a in n){var i=n[a],o=E(i);t.animations.push(o)}}(m,y,S),function(e,r){if("GlobalSettings"in e&&"AmbientColor"in e.GlobalSettings){var t=e.GlobalSettings.AmbientColor.value,n=t[0],a=t[1],i=t[2];if(0!==n||0!==a||0!==i){var o=new THREE.Color(n,a,i);r.add(new THREE.AmbientLight(o,1))}}}(m,S),S}});var s=[],u={ByPolygonVertex:{Direct:function(e,r,t,n){var a=e*n.dataSize,i=e*n.dataSize+n.dataSize;return S(s,n.buffer,a,i)},IndexToDirect:function(e,r,t,n){var a=n.indices[e],i=a*n.dataSize,o=a*n.dataSize+n.dataSize;return S(s,n.buffer,i,o)}},ByPolygon:{Direct:function(e,r,t,n){var a=r*n.dataSize,i=r*n.dataSize+n.dataSize;return S(s,n.buffer,a,i)},IndexToDirect:function(e,r,t,n){var a=n.indices[r],i=a*n.dataSize,o=a*n.dataSize+n.dataSize;return S(s,n.buffer,i,o)}},ByVertice:{Direct:function(e,r,t,n){var a=t*n.dataSize,i=t*n.dataSize+n.dataSize;return S(s,n.buffer,a,i)}},AllSame:{IndexToDirect:function(e,r,t,n){var a=n.indices[0]*n.dataSize,i=n.indices[0]*n.dataSize+n.dataSize;return S(s,n.buffer,a,i)}}};function c(e,r,t,n){return u[n.mappingType][n.referenceType](e,r,t,n)}function l(e,r,t,n){var a=null;return e.parents.forEach(function(e){for(var i in r){var o=r[i];o.rawBones.forEach(function(r,i){if(r.ID===e.ID){var s=a;(a=new THREE.Bone).matrixWorld.copy(r.transformLink),a.name=THREE.PropertyBinding.sanitizeNodeName(n),a.ID=t,o.bones[i]=a,null!==s&&a.add(s)}})}}),a}function f(e,r){var t,n;if(r.children.forEach(function(r){var t=e.Objects.NodeAttribute[r.ID];void 0!==t&&(n=t)}),void 0===n)t=new THREE.Object3D;else{var a=0;void 0!==n.CameraProjectionType&&1===n.CameraProjectionType.value&&(a=1);var i=1;void 0!==n.NearPlane&&(i=n.NearPlane.value/1e3);var o=1e3;void 0!==n.FarPlane&&(o=n.FarPlane.value/1e3);var s=window.innerWidth,u=window.innerHeight;void 0!==n.AspectWidth&&void 0!==n.AspectHeight&&(s=n.AspectWidth.value,u=n.AspectHeight.value);var c=s/u,l=45;void 0!==n.FieldOfView&&(l=n.FieldOfView.value);var f=n.FocalLength?n.FocalLength.value:null;switch(a){case 0:t=new THREE.PerspectiveCamera(l,c,i,o),null!==f&&t.setFocalLength(f);break;case 1:t=new THREE.OrthographicCamera(-s/2,s/2,u/2,-u/2,i,o);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+a+"."),t=new THREE.Object3D}}return t}function p(e,r){var t,n;if(r.children.forEach(function(r){var t=e.Objects.NodeAttribute[r.ID];void 0!==t&&(n=t)}),void 0===n)t=new THREE.Object3D;else{var a;a=void 0===n.LightType?0:n.LightType.value;var i=16777215;void 0!==n.Color&&(i=(new THREE.Color).fromArray(n.Color.value));var o=void 0===n.Intensity?1:n.Intensity.value/100;void 0!==n.CastLightOnObject&&0===n.CastLightOnObject.value&&(o=0);var s=0;void 0!==n.FarAttenuationEnd&&(s=void 0!==n.EnableFarAttenuation&&0===n.EnableFarAttenuation.value?0:n.FarAttenuationEnd.value);switch(a){case 0:t=new THREE.PointLight(i,o,s,1);break;case 1:t=new THREE.DirectionalLight(i,o);break;case 2:var u=Math.PI/3;void 0!==n.InnerAngle&&(u=THREE.Math.degToRad(n.InnerAngle.value));var c=0;void 0!==n.OuterAngle&&(c=THREE.Math.degToRad(n.OuterAngle.value),c=Math.max(c,1)),t=new THREE.SpotLight(i,o,s,u,c,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a THREE.PointLight."),t=new THREE.PointLight(i,o)}void 0!==n.CastShadows&&1===n.CastShadows.value&&(t.castShadow=!0)}return t}function d(e,r,t,n){var a,i=null,o=null,s=[];return r.children.forEach(function(e){t.has(e.ID)&&(i=t.get(e.ID)),n.has(e.ID)&&s.push(n.get(e.ID))}),s.length>1?o=s:s.length>0?o=s[0]:(o=new THREE.MeshPhongMaterial({color:13421772}),s.push(o)),"color"in i.attributes&&s.forEach(function(e){e.vertexColors=THREE.VertexColors}),i.FBX_Deformer?(s.forEach(function(e){e.skinning=!0}),a=new THREE.SkinnedMesh(i,o)):a=new THREE.Mesh(i,o),a}function h(e,r){var t=e.children.reduce(function(e,t){return r.has(t.ID)&&(e=r.get(t.ID)),e},null),n=new THREE.LineBasicMaterial({color:3342591,linewidth:1});return new THREE.Line(t,n)}function v(e,r,t){if("RotationOrder"in t){var n=parseInt(t.RotationOrder.value,10);n>0&&n<6?console.warn("THREE.FBXLoader: unsupported Euler Order: %s. Currently only XYZ order is supported. Animations and rotations may be incorrect.",["XYZ","XZY","YZX","ZXY","YXZ","ZYX","SphericXYZ"][n]):6===n&&console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect.")}if("Lcl_Translation"in t&&r.position.fromArray(t.Lcl_Translation.value),"Lcl_Rotation"in t){var a=t.Lcl_Rotation.value.map(THREE.Math.degToRad);a.push("ZYX"),r.quaternion.setFromEuler((new THREE.Euler).fromArray(a))}if("Lcl_Scaling"in t&&r.scale.fromArray(t.Lcl_Scaling.value),"PreRotation"in t){var i=t.PreRotation.value.map(THREE.Math.degToRad);i[3]="ZYX";var o=(new THREE.Euler).fromArray(i);o=(new THREE.Quaternion).setFromEuler(o),r.quaternion.premultiply(o)}}function E(e){var r=[];return e.layer.forEach(function(e){r=r.concat(function(e){var r=[];if(void 0!==e.T&&Object.keys(e.T.curves).length>0){var t=g(e.modelName,e.T.curves,e.initialPosition,"position");void 0!==t&&r.push(t)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){var n=function(e,r,t,n){void 0!==r.x&&(r.x.values=r.x.values.map(THREE.Math.degToRad));void 0!==r.y&&(r.y.values=r.y.values.map(THREE.Math.degToRad));void 0!==r.z&&(r.z.values=r.z.values.map(THREE.Math.degToRad));var a=y(r),i=m(a,r,t);void 0!==n&&((n=n.map(THREE.Math.degToRad)).push("ZYX"),n=(new THREE.Euler).fromArray(n),n=(new THREE.Quaternion).setFromEuler(n));for(var o=new THREE.Quaternion,s=new THREE.Euler,u=[],c=0;c<i.length;c+=3)s.set(i[c],i[c+1],i[c+2],"ZYX"),o.setFromEuler(s),void 0!==n&&o.premultiply(n),o.toArray(u,c/3*4);return new THREE.QuaternionKeyframeTrack(e+".quaternion",a,u)}(e.modelName,e.R.curves,e.initialRotation,e.preRotations);void 0!==n&&r.push(n)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){var a=g(e.modelName,e.S.curves,e.initialScale,"scale");void 0!==a&&r.push(a)}return r}(e))}),new THREE.AnimationClip(e.name,-1,r)}function g(e,r,t,n){var a=y(r),i=m(a,r,t);return new THREE.VectorKeyframeTrack(e+"."+n,a,i)}function m(e,r,t){var n=t,a=[],i=-1,o=-1,s=-1;return e.forEach(function(e){if(r.x&&(i=r.x.times.indexOf(e)),r.y&&(o=r.y.times.indexOf(e)),r.z&&(s=r.z.times.indexOf(e)),-1!==i){var t=r.x.values[i];a.push(t),n[0]=t}else a.push(n[0]);if(-1!==o){var u=r.y.values[o];a.push(u),n[1]=u}else a.push(n[1]);if(-1!==s){var c=r.z.values[s];a.push(c),n[2]=c}else a.push(n[2])}),a}function y(e){var r=[];return void 0!==e.x&&(r=r.concat(e.x.times)),void 0!==e.y&&(r=r.concat(e.y.times)),void 0!==e.z&&(r=r.concat(e.z.times)),r=r.sort(function(e,r){return e-r}).filter(function(e,r,t){return t.indexOf(e)==r})}function T(){}function R(){}function w(e,r){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===r||r}function b(){}function I(e){var r=e.match(/FBXVersion: (\d+)/);if(r)return parseInt(r[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function H(e){return e/46186158e3}function L(e){return e.split(",").map(function(e){return parseFloat(e)})}function A(e,r,t){return void 0===r&&(r=0),void 0===t&&(t=e.byteLength),THREE.LoaderUtils.decodeText(new Uint8Array(e,r,t))}function S(e,r,t,n){for(var a=t,i=0;a<n;a++,i++)e[i]=r[a];return e}Object.assign(T.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,r){this.currentProp=e,this.currentPropName=r},parse:function(e){this.currentIndent=0,this.allNodes=new b,this.nodeStack=[],this.currentProp=[],this.currentPropName="";var r=this,t=e.split("\n");return t.forEach(function(e,n){var a=e.match(/^[\s\t]*;/),i=e.match(/^[\s\t]*$/);if(!a&&!i){var o=e.match("^\\t{"+r.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+r.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),u=e.match("^\\t{"+(r.currentIndent-1)+"}}");o?r.parseNodeBegin(e,o):s?r.parseNodeProperty(e,s,t[++n]):u?r.popStack():e.match(/^[^\s\t}]/)&&r.parseNodePropertyContinued(e)}}),this.allNodes},parseNodeBegin:function(e,r){var t=r[1].trim().replace(/^"/,"").replace(/"$/,""),n=r[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),a={name:t},i=this.parseNodeAttr(n),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(t,a):t in o?("PoseNode"===t?o.PoseNode.push(a):void 0!==o[t].id&&(o[t]={},o[t][o[t].id]=o[t]),""!==i.id&&(o[t][i.id]=a)):"number"==typeof i.id?(o[t]={},o[t][i.id]=a):"Properties70"!==t&&(o[t]="PoseNode"===t?[a]:a),"number"==typeof i.id&&(a.id=i.id),""!==i.name&&(a.attrName=i.name),""!==i.type&&(a.attrType=i.type),this.pushStack(a)},parseNodeAttr:function(e){var r=e[0];""!==e[0]&&(r=parseInt(e[0]),isNaN(r)&&(r=e[0]));var t="",n="";return e.length>1&&(t=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:r,name:t,type:n}},parseNodeProperty:function(e,r,t){var n=r[1].replace(/^"/,"").replace(/"$/,"").trim(),a=r[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===n&&","===a&&(a=t.replace(/"/g,"").replace(/,$/,"").trim());var i=this.getCurrentNode();if("Properties70"!==i.name){if("C"===n){var o=a.split(",").slice(1),s=parseInt(o[0]),u=parseInt(o[1]),c=a.split(",").slice(3);n="connections",function(e,r){for(var t=0,n=e.length,a=r.length;t<a;t++,n++)e[n]=r[t]}(a=[s,u],c=c.map(function(e){return e.trim().replace(/^"/,"")})),void 0===i[n]&&(i[n]=[])}"Node"===n&&(i.id=a),n in i&&Array.isArray(i[n])?i[n].push(a):"a"!==n?i[n]=a:i.a=a,this.setCurrentProp(i,n),"a"===n&&","!==a.slice(-1)&&(i.a=L(a))}else this.parseNodeSpecialProperty(e,n,a)},parseNodePropertyContinued:function(e){var r=this.getCurrentNode();r.a+=e,","!==e.slice(-1)&&(r.a=L(r.a))},parseNodeSpecialProperty:function(e,r,t){var n=t.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),a=n[0],i=n[1],o=n[2],s=n[3],u=n[4];switch(i){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":u=parseFloat(u);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":u=L(u)}this.getPrevNode()[a]={type:i,type2:o,flag:s,value:u},this.setCurrentProp(this.getPrevNode(),a)}}),Object.assign(R.prototype,{parse:function(e){var r=new w(e);r.skip(23);var t=r.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+t);for(var n=new b;!this.endOfContent(r);){var a=this.parseNode(r,t);null!==a&&n.add(a.name,a)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,r){var t={},n=r>=7500?e.getUint64():e.getUint32(),a=r>=7500?e.getUint64():e.getUint32(),i=(r>=7500?e.getUint64():e.getUint32(),e.getUint8()),o=e.getString(i);if(0===n)return null;for(var s=[],u=0;u<a;u++)s.push(this.parseProperty(e));var c=s.length>0?s[0]:"",l=s.length>1?s[1]:"",f=s.length>2?s[2]:"";for(t.singleProperty=1===a&&e.getOffset()===n;n>e.getOffset();){var p=this.parseNode(e,r);null!==p&&this.parseSubNode(o,t,p)}return t.propertyList=s,"number"==typeof c&&(t.id=c),""!==l&&(t.attrName=l),""!==f&&(t.attrType=f),""!==o&&(t.name=o),t},parseSubNode:function(e,r,t){if(!0===t.singleProperty){var n=t.propertyList[0];Array.isArray(n)?(r[t.name]=t,t.a=n):r[t.name]=n}else if("Connections"===e&&"C"===t.name){var a=[];t.propertyList.forEach(function(e,r){0!==r&&a.push(e)}),void 0===r.connections&&(r.connections=[]),r.connections.push(a)}else if("Properties70"===t.name){Object.keys(t).forEach(function(e){r[e]=t[e]})}else if("Properties70"===e&&"P"===t.name){var i,o=t.propertyList[0],s=t.propertyList[1],u=t.propertyList[2],c=t.propertyList[3];0===o.indexOf("Lcl ")&&(o=o.replace("Lcl ","Lcl_")),0===s.indexOf("Lcl ")&&(s=s.replace("Lcl ","Lcl_")),i="Color"===s||"ColorRGB"===s||"Vector"===s||"Vector3D"===s||0===s.indexOf("Lcl_")?[t.propertyList[4],t.propertyList[5],t.propertyList[6]]:t.propertyList[4],r[o]={type:s,type2:u,flag:c,value:i}}else void 0===r[t.name]?"number"==typeof t.id?(r[t.name]={},r[t.name][t.id]=t):r[t.name]=t:"PoseNode"===t.name?(Array.isArray(r[t.name])||(r[t.name]=[r[t.name]]),r[t.name].push(t)):void 0===r[t.name][t.id]&&(r[t.name][t.id]=t)},parseProperty:function(e){var r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":var t=e.getUint32();return e.getArrayBuffer(t);case"S":t=e.getUint32();return e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":var n=e.getUint32(),a=e.getUint32(),i=e.getUint32();if(0===a)switch(r){case"b":case"c":return e.getBooleanArray(n);case"d":return e.getFloat64Array(n);case"f":return e.getFloat32Array(n);case"i":return e.getInt32Array(n);case"l":return e.getInt64Array(n)}void 0===window.Zlib&&console.error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var o=new w(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(i))).decompress().buffer);switch(r){case"b":case"c":return o.getBooleanArray(n);case"d":return o.getFloat64Array(n);case"f":return o.getFloat32Array(n);case"i":return o.getInt32Array(n);case"l":return o.getInt64Array(n)}default:throw new Error("THREE.FBXLoader: Unknown property type "+r)}}}),Object.assign(w.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getBoolean());return r},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getInt32());return r},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getInt64:function(){var e,r;return this.littleEndian?(e=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),e=this.getUint32()),2147483648&r?(r=4294967295&~r,4294967295===(e=4294967295&~e)&&(r=r+1&4294967295),-(4294967296*r+(e=e+1&4294967295))):4294967296*r+e},getInt64Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getInt64());return r},getUint64:function(){var e,r;return this.littleEndian?(e=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),e=this.getUint32()),4294967296*r+e},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getFloat32());return r},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getFloat64());return r},getArrayBuffer:function(e){var r=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r},getString:function(e){for(var r=new Uint8Array(e),t=0;t<e;t++)r[t]=this.getUint8();var n=r.indexOf(0);return n>=0&&(r=r.slice(0,n)),THREE.LoaderUtils.decodeText(r)}}),Object.assign(b.prototype,{add:function(e,r){this[e]=r}})}();