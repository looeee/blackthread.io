"use strict";THREE.SEA3D.prototype.toAmmoVec3=function(t){return new Ammo.btVector3(t.x,t.y,t.z)},THREE.SEA3D.prototype.readSphere=function(t){var e=new Ammo.btSphereShape(t.radius);this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readBox=function(t){var e=new Ammo.btBoxShape(new Ammo.btVector3(.5*t.width,.5*t.height,.5*t.depth));this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readCone=function(t){var e=new Ammo.btConeShape(t.radius,t.height);this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readCylinder=function(t){var e=new Ammo.btCylinderShape(new Ammo.btVector3(t.height,t.radius,t.radius));this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readCapsule=function(t){var e=new Ammo.btCapsuleShape(t.radius,t.height);this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readConvexGeometry=function(t){if(this.config.convexHull)var e=SEA3D.AMMO.createConvexHull(t.geometry.tag,t.subGeometryIndex);else{var i=SEA3D.AMMO.createTriangleMesh(t.geometry.tag,t.subGeometryIndex);e=new Ammo.btConvexTriangleMeshShape(i,!0)}this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readTriangleGeometry=function(t){var e=SEA3D.AMMO.createTriangleMesh(t.geometry.tag,t.subGeometryIndex),i=new Ammo.btBvhTriangleMeshShape(e,!0,!0);this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=i)},THREE.SEA3D.prototype.readCompound=function(t){for(var e=new Ammo.btCompoundShape,i=0;i<t.compounds.length;i++){var s=t.compounds[i];THREE.SEA3D.MTXBUF.elements=s.transform;var o=SEA3D.AMMO.getTransformFromMatrix(THREE.SEA3D.MTXBUF);e.addChildShape(o,s.shape.tag)}this.domain.shapes=this.shapes=this.shapes||[],this.shapes.push(this.objects["shpe/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readRigidBodyBase=function(t){var e,i,s=t.shape.tag;t.target?((i=t.target.tag).physics={enabled:!0},i.updateMatrix(),e=SEA3D.AMMO.getTransformFromMatrix(t.target.tag.matrix)):(THREE.SEA3D.MTXBUF.fromArray(t.transform),e=SEA3D.AMMO.getTransformFromMatrix(THREE.SEA3D.MTXBUF));var o=new Ammo.btDefaultMotionState(e),a=new Ammo.btVector3(0,0,0);s.calculateLocalInertia(t.mass,a);var n=new Ammo.btRigidBodyConstructionInfo(t.mass,o,s,a);n.set_m_friction(t.friction),n.set_m_restitution(t.restitution),n.set_m_linearDamping(t.linearDamping),n.set_m_angularDamping(t.angularDamping);var r=new Ammo.btRigidBody(n);if(i&&(i.physics.rigidBody=r,t.offset)){var h=new THREE.Matrix4;h.fromArray(t.offset),i.physics.offset=h}return Ammo.destroy(n),this.domain.rigidBodies=this.rigidBodies=this.rigidBodies||[],this.rigidBodies.push(this.objects["rb/"+t.name]=t.tag=r),r},THREE.SEA3D.prototype.readRigidBody=function(t){var e=this.readRigidBodyBase(t);SEA3D.AMMO.addRigidBody(e,t.target?t.target.tag:void 0,this.config.enabledPhysics)},THREE.SEA3D.prototype.readCarController=function(t){var e=this.readRigidBodyBase(t);e.setActivationState(SEA3D.AMMO.DISABLE_DEACTIVATION);var i=new Ammo.btDefaultVehicleRaycaster(SEA3D.AMMO.world),s=new Ammo.btVehicleTuning;s.set_m_suspensionStiffness(t.suspensionStiffness),s.set_m_suspensionDamping(t.suspensionDamping),s.set_m_suspensionCompression(t.suspensionCompression),s.set_m_maxSuspensionTravelCm(t.maxSuspensionTravelCm),s.set_m_maxSuspensionForce(t.maxSuspensionForce),s.set_m_frictionSlip(t.frictionSlip);var o=new Ammo.btRaycastVehicle(s,e,i),a=[];o.setCoordinateSystem(0,1,2);for(var n=0;n<t.wheel.length;n++){var r=t.wheel[n],h=o.addWheel(this.toAmmoVec3(r.pos),this.toAmmoVec3(r.dir),this.toAmmoVec3(r.axle),r.suspensionRestLength,r.radius,s,r.isFront),p=a[n]=r.target?r.target.tag:void 0;if(p){if(p.physics={enabled:!0,rigidBody:h},r.offset){var m=new THREE.Matrix4;m.fromArray(r.offset),p.physics.offset=m}p.parent&&p.parent.remove(p),this.container&&this.container.add(p)}h.set_m_suspensionStiffness(t.suspensionStiffness),h.set_m_wheelsDampingRelaxation(t.dampingRelaxation),h.set_m_wheelsDampingCompression(t.dampingCompression),h.set_m_frictionSlip(t.frictionSlip)}SEA3D.AMMO.addVehicle(o,a),SEA3D.AMMO.addRigidBody(e,t.target?t.target.tag:void 0,this.config.enabledPhysics),this.domain.vehicles=this.vehicles=this.vehicles||[],this.vehicles.push(this.objects["vhc/"+t.name]=t.tag=o)},THREE.SEA3D.prototype.readP2PConstraint=function(t){var e;e=t.targetB?new Ammo.btPoint2PointConstraint(t.targetA.tag,t.targetB.tag,this.toAmmoVec3(t.pointA),this.toAmmoVec3(t.pointB)):new Ammo.btPoint2PointConstraint(t.targetA.tag,this.toAmmoVec3(t.pointA)),SEA3D.AMMO.addConstraint(e),this.domain.constraints=this.constraints=this.constraints||[],this.constraints.push(this.objects["ctnt/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readHingeConstraint=function(t){var e;e=t.targetB?new Ammo.btHingeConstraint(t.targetA.tag,t.targetB.tag,this.toAmmoVec3(t.pointA),this.toAmmoVec3(t.pointB),this.toAmmoVec3(t.axisA),this.toAmmoVec3(t.axisB),!1):new Ammo.btHingeConstraint(t.targetA.tag,this.toAmmoVec3(t.pointA),this.toAmmoVec3(t.axisA),!1),t.limit&&e.setLimit(t.limit.low,t.limit.high,t.limit.softness,t.limit.biasFactor,t.limit.relaxationFactor),t.angularMotor&&e.enableAngularMotor(!0,t.angularMotor.velocity,t.angularMotor.impulse),SEA3D.AMMO.addConstraint(e),this.domain.constraints=this.constraints=this.constraints||[],this.constraints.push(this.objects["ctnt/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readConeTwistConstraint=function(t){var e;e=t.targetB?new Ammo.btConeTwistConstraint(t.targetA.tag,t.targetB.tag,this.toAmmoVec3(t.pointA),this.toAmmoVec3(t.pointB),!1):new Ammo.btConeTwistConstraint(t.targetA.tag,this.toAmmoVec3(t.pointA),!1),SEA3D.AMMO.addConstraint(e),this.domain.constraints=this.constraints=this.constraints||[],this.constraints.push(this.objects["ctnt/"+t.name]=t.tag=e)},THREE.SEA3D.Domain.prototype.enabledPhysics=function(t){for(var e=this.rigidBodies?this.rigidBodies.length:0;e--;)SEA3D.AMMO.setEnabledRigidBody(this.rigidBodies[e],t)},THREE.SEA3D.Domain.prototype.applyContainerTransform=function(){this.container.updateMatrix();var t=this.container.matrix.clone();this.container.position.set(0,0,0),this.container.rotation.set(0,0,0),this.container.scale.set(1,1,1),this.applyTransform(t)},THREE.SEA3D.Domain.prototype.applyTransform=function(t){for(var e=THREE.SEA3D.MTXBUF,i=THREE.SEA3D.VECBUF,s=this.rigidBodies?this.rigidBodies.length:0,o=this.container?this.container.children:[],a=[];s--;){var n=this.rigidBodies[s],r=SEA3D.AMMO.getTargetByRigidBody(n),h=n.getWorldTransform(),p=SEA3D.AMMO.getMatrixFromTransform(h);p.multiplyMatrices(p,t),h=SEA3D.AMMO.getTransformFromMatrix(p),n.setWorldTransform(h),r&&a.push(r)}for(s=0;s<o.length;s++){var m=o[s];a.indexOf(m)>-1||(m.updateMatrix(),e.copy(m.matrix),e.multiplyMatrices(t,e),m.position.setFromMatrixPosition(e),m.scale.setFromMatrixScale(e),e.scale(i.set(1/m.scale.x,1/m.scale.y,1/m.scale.z)),m.rotation.setFromRotationMatrix(e))}},THREE.SEA3D.Domain.prototype.getShape=THREE.SEA3D.prototype.getShape=function(t){return this.objects["shpe/"+t]},THREE.SEA3D.Domain.prototype.getRigidBody=THREE.SEA3D.prototype.getRigidBody=function(t){return this.objects["rb/"+t]},THREE.SEA3D.Domain.prototype.getConstraint=THREE.SEA3D.prototype.getConstraint=function(t){return this.objects["ctnt/"+t]},THREE.SEA3D.EXTENSIONS_LOADER.push({parse:function(){delete this.shapes,delete this.rigidBodies,delete this.vehicles,delete this.constraints},setTypeRead:function(){this.config.physics=void 0===this.config.physics||this.config.physics,this.config.convexHull=void 0===this.config.convexHull||this.config.convexHull,this.config.enabledPhysics=void 0===this.config.enabledPhysics||this.config.enabledPhysics,this.config.physics&&(this.file.typeRead[SEA3D.Sphere.prototype.type]=this.readSphere,this.file.typeRead[SEA3D.Box.prototype.type]=this.readBox,this.file.typeRead[SEA3D.Capsule.prototype.type]=this.readCapsule,this.file.typeRead[SEA3D.Cone.prototype.type]=this.readCone,this.file.typeRead[SEA3D.Cylinder.prototype.type]=this.readCylinder,this.file.typeRead[SEA3D.ConvexGeometry.prototype.type]=this.readConvexGeometry,this.file.typeRead[SEA3D.TriangleGeometry.prototype.type]=this.readTriangleGeometry,this.file.typeRead[SEA3D.Compound.prototype.type]=this.readCompound,this.file.typeRead[SEA3D.P2PConstraint.prototype.type]=this.readP2PConstraint,this.file.typeRead[SEA3D.HingeConstraint.prototype.type]=this.readHingeConstraint,this.file.typeRead[SEA3D.ConeTwistConstraint.prototype.type]=this.readConeTwistConstraint,this.file.typeRead[SEA3D.RigidBody.prototype.type]=this.readRigidBody,this.file.typeRead[SEA3D.CarController.prototype.type]=this.readCarController)}}),THREE.SEA3D.EXTENSIONS_DOMAIN.push({dispose:function(){var t;for(t=this.rigidBodies?this.rigidBodies.length:0;t--;)SEA3D.AMMO.removeRigidBody(this.rigidBodies[t],!0);for(t=this.vehicles?this.vehicles.length:0;t--;)SEA3D.AMMO.removeVehicle(this.vehicles[t],!0);for(t=this.constraints?this.constraints.length:0;t--;)SEA3D.AMMO.removeConstraint(this.constraints[t],!0);for(t=this.shapes?this.shapes.length:0;t--;)Ammo.destroy(this.shapes[t])}});