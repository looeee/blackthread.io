"use strict";SEA3D.AMMO={world:null,rigidBodies:[],rigidBodiesTarget:[],rigidBodiesEnabled:[],constraints:[],vehicles:[],vehiclesWheels:[],ACTIVE:1,ISLAND_SLEEPING:2,WANTS_DEACTIVATION:3,DISABLE_DEACTIVATION:4,DISABLE_SIMULATION:5,VERSION:.8,init:function(i,t,e){switch(i=void 0!==i?i:-90.8,this.worldScale=void 0==t?1:t,this.broadphase=void 0==e?"bvt":e,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.collisionConfig=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfig),this.broadphase){case"bvt":this.broadphase=new Ammo.btDbvtBroadphase;break;case"sap":this.broadphase=new Ammo.btAxisSweep3(new Ammo.btVector3(-this.worldScale,-this.worldScale,-this.worldScale),new Ammo.btVector3(this.worldScale,this.worldScale,this.worldScale),4096);break;case"simple":this.broadphase=new Ammo.btSimpleBroadphase}this.world=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.broadphase,this.solver,this.collisionConfig),this.setGravity(i),console.log("THREE.AMMO "+this.VERSION)},setGravity:function(i){return this.gravity=i,this.world.setGravity(new Ammo.btVector3(0,i,0)),this},getGravity:function(){return this.gravity},setEnabledRigidBody:function(i,t){var e=this.rigidBodies.indexOf(i);if(this.rigidBodiesEnabled[e]!=t)return t?this.world.addRigidBody(i):this.world.removeRigidBody(i),this.rigidBodiesEnabled[e]=!0,this},getEnabledRigidBody:function(i){return this.rigidBodiesEnabled[this.rigidBodies.indexOf(i)]},addRigidBody:function(i,t,e){return e=void 0===e||e,this.rigidBodies.push(i),this.rigidBodiesTarget.push(t),this.rigidBodiesEnabled.push(!1),this.setEnabledRigidBody(i,e),this},removeRigidBody:function(i,t){var e=this.rigidBodies.indexOf(i);return this.setEnabledRigidBody(i,!1),this.rigidBodies.splice(e,1),this.rigidBodiesTarget.splice(e,1),this.rigidBodiesEnabled.splice(e,1),t&&Ammo.destroy(i),this},containsRigidBody:function(i){return this.rigidBodies.indexOf(i)>-1},addConstraint:function(i,t){return t=void 0==t||t,this.constraints.push(i),this.world.addConstraint(i,t),this},removeConstraint:function(i,t){return this.constraints.splice(this.constraints.indexOf(i),1),this.world.removeConstraint(i),t&&Ammo.destroy(i),this},containsConstraint:function(i){return this.constraints.indexOf(rb)>-1},addVehicle:function(i,t){return this.vehicles.push(i),this.vehiclesWheels.push(void 0!=t?t:[]),this.world.addAction(i),this},removeVehicle:function(i,t){var e=this.vehicles.indexOf(i);return this.vehicles.splice(e,1),this.vehiclesWheels.splice(e,1),this.world.removeAction(i),t&&Ammo.destroy(i),this},containsVehicle:function(i){return this.vehicles.indexOf(i)>-1},createTriangleMesh:function(i,t,e){t=void 0==t?-1:t,e=void 0!=e&&e;for(var s=new Ammo.btTriangleMesh,r=new Ammo.btVector3(0,0,0),o=new Ammo.btVector3(0,0,0),n=new Ammo.btVector3(0,0,0),a=i.getAttribute("position").array,d=i.getIndex().array,h=t>=0?i.groups[t]:void 0,l=h?h.start:0,c=h?h.count:d.length,u=1/this.worldScale,g=l;g<c;g+=3){var m=3*d[g],v=3*d[g+1],f=3*d[g+2];r.setValue(a[m]*u,a[m+1]*u,a[m+2]*u),o.setValue(a[v]*u,a[v+1]*u,a[v+2]*u),n.setValue(a[f]*u,a[f+1]*u,a[f+2]*u),s.addTriangle(r,o,n,e)}return s},createConvexHull:function(i,t){t=void 0==t?-1:t;for(var e=new Ammo.btConvexHullShape,s=(new Ammo.btVector3(0,0,0),i.getAttribute("position").array),r=i.getIndex().array,o=t>=0?i.groups[t]:void 0,n=o?o.start:0,a=o?o.count:r.length,d=1/this.worldScale,h=n;h<a;h+=3){var l=3*r[h],c=new Ammo.btVector3(s[l]*d,s[l+1]*d,s[l+2]*d);e.addPoint(c)}return e},getTargetByRigidBody:function(i){return this.rigidBodiesTarget[this.rigidBodies.indexOf(i)]},getRigidBodyByTarget:function(i){return this.rigidBodies[this.rigidBodiesTarget.indexOf(i)]},getTransformFromMatrix:function(i){var t=new Ammo.btTransform,e=THREE.SEA3D.VECBUF.setFromMatrixPosition(i);t.setOrigin(new Ammo.btVector3(e.x,e.y,e.z));var s=THREE.SEA3D.VECBUF.setFromMatrixScale(i);i.scale(s.set(1/s.x,1/s.y,1/s.z));var r=(new THREE.Quaternion).setFromRotationMatrix(i),o=new Ammo.btQuaternion;return o.setValue(r.x,r.y,r.z,r.w),t.setRotation(o),Ammo.destroy(o),t},getMatrixFromTransform:function(i){var t=new THREE.Vector3,e=new THREE.Quaternion,s=new THREE.Vector3(1,1,1);return function(i,r){r=r||new THREE.Matrix4;var o=i.getOrigin(),n=i.getRotation();return t.set(o.x(),o.y(),o.z()),e.set(n.x(),n.y(),n.z(),n.w()),r.compose(t,e,s),r}}(),updateTargetTransform:function(){var i=new THREE.Matrix4,t=new THREE.Vector3,e=new THREE.Quaternion,s=new THREE.Vector3(1,1,1);return function(r,o,n){var a=o.getOrigin(),d=o.getRotation();return n?(t.set(a.x(),a.y(),a.z()),e.set(d.x(),d.y(),d.z(),d.w()),i.compose(t,e,s),i.multiplyMatrices(i,n),r.position.setFromMatrixPosition(i),r.quaternion.setFromRotationMatrix(i)):(r.position.set(a.x(),a.y(),a.z()),r.quaternion.set(d.x(),d.y(),d.z(),d.w())),this}}(),update:function(i,t,e){var s,r;for(this.world.stepSimulation(i,t||0,e||.06),s=0;s<this.vehicles.length;s++){var o=this.vehicles[s],n=o.getNumWheels(),a=this.vehiclesWheels[s];for(r=0;r<n;r++){o.updateWheelTransform(r,!0);var d=o.getWheelTransformWS(r),h=a[r];h&&this.updateTargetTransform(h,d,h.physics?h.physics.offset:null)}}for(s=0;s<this.rigidBodies.length;s++){var l=this.rigidBodies[s],c=this.rigidBodiesTarget[s];c&&l.isActive()&&this.updateTargetTransform(c,l.getWorldTransform(),c.physics?c.physics.offset:null)}return this}};