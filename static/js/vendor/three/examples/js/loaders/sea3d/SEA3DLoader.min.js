"use strict";THREE.SEA3D=function(t){this.config={id:"",scripts:!0,runScripts:!0,autoPlay:!1,dummys:!0,multiplier:1,bounding:!0,audioRolloffFactor:10,lights:!0,useEnvironment:!0,useVertexTexture:!0,forceStatic:!1,streaming:!0,async:!0,paths:{},timeLimit:10},t&&this.loadConfig(t)},void 0===THREE.Float32BufferAttribute&&(THREE.Float32BufferAttribute=THREE.Float32Attribute),THREE.SEA3D.useMultiMaterial=THREE.MultiMaterial.prototype.isMultiMaterial,THREE.SEA3D.MTXBUF=new THREE.Matrix4,THREE.SEA3D.VECBUF=new THREE.Vector3,THREE.SEA3D.QUABUF=new THREE.Quaternion,THREE.SEA3D.BACKGROUND_COLOR=3355443,THREE.SEA3D.HELPER_COLOR=10140133,THREE.SEA3D.RTT_SIZE=512,THREE.SEA3D.identityMatrixScale=function(){var t=new THREE.Vector3;return function(e){return t.setFromMatrixScale(e),e.scale(t.set(1/t.x,1/t.y,1/t.z))}}(),THREE.SEA3D.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D,setShadowMap:function(t){t.shadow.mapSize.width=2048,t.shadow.mapSize.height=1024,t.castShadow=!0,t.shadow.camera.left=-200,t.shadow.camera.right=200,t.shadow.camera.top=200,t.shadow.camera.bottom=-200,t.shadow.camera.near=1,t.shadow.camera.far=3e3,t.shadow.camera.fov=45,t.shadow.bias=-.001}}),Object.defineProperties(THREE.SEA3D.prototype,{container:{set:function(t){this.config.container=t},get:function(){return this.config.container}},elapsedTime:{get:function(){return this.file.timer.elapsedTime}}}),THREE.SEA3D.Domain=function(t,e,i){this.id=t,this.objects=e,this.container=i,this.sources=[],this.local={},this.scriptTargets=[],this.events=new THREE.EventDispatcher},THREE.SEA3D.Domain.global={},THREE.SEA3D.Domain.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D.Domain,add:function(t){this.sources.push(t)},remove:function(t){this.sources.splice(this.sources.indexOf(t),1)},contains:function(t){return-1!=this.sources.indexOf(t)},addEventListener:function(t,e){this.events.addEventListener(t,e)},hasEventListener:function(t,e){return this.events.hasEventListener(t,e)},removeEventListener:function(t,e){this.events.removeEventListener(t,e)},print:function(){console.log.apply(console,arguments)},watch:function(){console.log.apply(console,"watch:",arguments)},runScripts:function(){for(var t=0;t<this.scriptTargets.length;t++)this.runJSMList(this.scriptTargets[t])},runJSMList:function(t){for(var e=t.scripts,i=0;i<e.length;i++)this.runJSM(t,e[i]);return e},runJSM:function(t,e){var i={print:this.print,watch:this.watch,sea3d:this,scene:this.container,source:new THREE.SEA3D.ScriptDomain(this,t instanceof THREE.SEA3D.Domain)};Object.freeze(i.source),THREE.SEA3D.ScriptHandler.add(i.source);try{this.methods[e.method](i,this.getReference,THREE.SEA3D.Domain.global,this.local,t,e.params)}catch(t){console.error('SEA3D JavaScript: Error running method "'+e.method+'".'),console.error(t)}},getReference:function(ns){return eval(ns)},disposeList:function(t){if(t&&t.length)for(var e=(t=t.concat()).length;e--;)t[e].dispose()},dispatchEvent:function(t){t.domain=this;for(var e=this.sources.concat(),i=e.length;i--;)e[i].dispatchEvent(t);this.events.dispatchEvent(t)},dispose:function(){for(this.disposeList(this.sources);this.container.children.length;)this.container.remove(this.container.children[0]);for(var t=THREE.SEA3D.EXTENSIONS_DOMAIN.length;t--;){var e=THREE.SEA3D.EXTENSIONS_DOMAIN[t];e.dispose&&e.dispose.call(this)}this.disposeList(this.materials),this.disposeList(this.dummys),this.dispatchEvent({type:"dispose"})}}),THREE.SEA3D.DomainManager=function(t){this.domains=[],this.autoDisposeRootDomain=void 0===t||t},Object.assign(THREE.SEA3D.DomainManager.prototype,{onDisposeDomain:function(t){this.remove(t.domain),this.autoDisposeRootDomain&&1==this.domains.length&&this.dispose()},add:function(t){this._onDisposeDomain=this._onDisposeDomain||this.onDisposeDomain.bind(this),t.on("dispose",this._onDisposeDomain),this.domains.push(t),this.textures=this.textures||t.textures,this.cubemaps=this.cubemaps||t.cubemaps,this.geometries=this.geometries||t.geometries},remove:function(t){t.removeEvent("dispose",this._onDisposeDomain),this.domains.splice(this.domains.indexOf(t),1)},contains:function(t){return-1!=this.domains.indexOf(t)},disposeList:function(t){if(t&&t.length)for(var e=(t=t.concat()).length;e--;)t[e].dispose()},dispose:function(){this.disposeList(this.domains),this.disposeList(this.textures),this.disposeList(this.cubemaps),this.disposeList(this.geometries)}}),THREE.SEA3D.ScriptDomain=function(t,e){(t=t||new THREE.SEA3D.Domain).add(this);var i=new THREE.EventDispatcher;this.getId=function(){return t.id},this.isRoot=function(){return e},this.addEventListener=function(t,e){i.addEventListener(t,e)},this.hasEventListener=function(t,e){return i.hasEventListener(t,e)},this.removeEventListener=function(t,e){i.removeEventListener(t,e)},this.dispatchEvent=function(t){t.script=this,i.dispatchEvent(t)},this.dispose=function(){t.remove(this),e&&t.dispose(),this.dispatchEvent({type:"dispose"})}},THREE.SEA3D.ScriptManager=function(){this.scripts=[];var t=function(t){this.remove(t.script)}.bind(this);this.add=function(e){e.addEventListener("dispose",t),this.scripts.push(e)},this.remove=function(e){e.removeEventListener("dispose",t),this.scripts.splice(this.scripts.indexOf(e),1)},this.contains=function(t){return this.scripts.indexOf(t)>-1},this.dispatchEvent=function(t){for(var e=this.scripts.concat(),i=e.length;i--;)e[i].dispatchEvent(t)}},THREE.SEA3D.ScriptHandler=new THREE.SEA3D.ScriptManager,THREE.SEA3D.ScriptHandler.dispatchUpdate=function(t){this.dispatchEvent({type:"update",delta:t})},THREE.SEA3D.AnimationClip=function(t,e,i,n){THREE.AnimationClip.call(this,t,e,i),this.repeat=void 0===n||n},THREE.SEA3D.AnimationClip.fromClip=function(t,e){return new THREE.SEA3D.AnimationClip(t.name,t.duration,t.tracks,e)},THREE.SEA3D.AnimationClip.prototype=Object.assign(Object.create(THREE.AnimationClip.prototype),{constructor:THREE.SEA3D.AnimationClip}),THREE.SEA3D.Animation=function(t,e){this.clip=t,this.timeScale=void 0!==e?e:1},THREE.SEA3D.Animation.COMPLETE="animationComplete",THREE.SEA3D.Animation.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D.Animation,onComplete:function(t){this.dispatchEvent({type:THREE.SEA3D.Animation.COMPLETE,target:this})}}),Object.defineProperties(THREE.SEA3D.Animation.prototype,{name:{get:function(){return this.clip.name}},repeat:{get:function(){return this.clip.repeat}},duration:{get:function(){return this.clip.duration}},mixer:{set:function(t){this.mx&&(this.mx.uncacheClip(this.clip),delete this.mx),t&&(this.mx=t,this.mx.clipAction(this.clip))},get:function(){return this.mx}}}),THREE.SEA3D.Animator=function(t,e){this.updateAnimations(t,e),this.clone=function(t){return new this.constructor(this.clips,new THREE.AnimationMixer(t)).copyFrom(this)}.bind(this)},Object.assign(THREE.SEA3D.Animator.prototype,{update:function(t){return this.mixer.update(t||0),this.currentAnimationAction&&this.currentAnimationAction.paused&&(this.pause(),this.currentAnimation&&this.currentAnimation.onComplete(this)),this},updateAnimations:function(t,e){if(this.playing&&this.stop(),this.mixer&&THREE.SEA3D.AnimationHandler.remove(this),this.mixer=e,this.relative=!1,this.playing=!1,this.paused=!1,this.timeScale=1,this.animations=[],this.animation={},this.clips=[],t)for(var i=0;i<t.length;i++)this.addAnimation(t[i]);return this},addAnimation:function(t){return t instanceof THREE.AnimationClip&&(this.clips.push(t),t=new THREE.SEA3D.Animation(t)),this.animations.push(t),this.animation[t.name]=t,t.mixer=this.mixer,t},removeAnimation:function(t){return t instanceof THREE.AnimationClip&&(t=this.getAnimationByClip(t)),this.clips.splice(this.clips.indexOf(t.clip),1),delete this.animation[t.name],this.animations.splice(this.animations.indexOf(t),1),t.mixer=null,t},getAnimationByClip:function(t){for(var e=0;e<this.animations.length;e++)if(this.animations[e].clip===t)return t},getAnimationByName:function(t){return"number"==typeof t?this.animations[t]:this.animation[t]},setAnimationWeight:function(t,e){this.mixer.clipAction(this.getAnimationByName(t).clip).setEffectiveWeight(e)},getAnimationWeight:function(t){return this.mixer.clipAction(this.getAnimationByName(t).clip).getEffectiveWeight()},pause:function(){return this.playing&&this.currentAnimation&&(THREE.SEA3D.AnimationHandler.remove(this),this.playing=!1),this},resume:function(){return!this.playing&&this.currentAnimation&&(THREE.SEA3D.AnimationHandler.add(this),this.playing=!0),this},setTimeScale:function(t){return this.timeScale=t,this.currentAnimationAction&&this.updateTimeScale(),this},getTimeScale:function(){return this.timeScale},updateTimeScale:function(){return this.currentAnimationAction.setEffectiveTimeScale(this.timeScale*(this.currentAnimation?this.currentAnimation.timeScale:1)),this},play:function(t,e,i,n){var o=this.getAnimationByName(t);if(!o)throw new Error('Animation "'+t+'" not found.');return o==this.currentAnimation?(void 0===i&&o.repeat||(this.currentAnimationAction.time=void 0!==i?i:this.currentAnimationAction.timeScale>=0?0:this.currentAnimation.duration),this.currentAnimationAction.setEffectiveWeight(void 0!==n?n:1),this.currentAnimationAction.paused=!1,this.resume()):(this.previousAnimation=this.currentAnimation,this.currentAnimation=o,this.previousAnimationAction=this.currentAnimationAction,this.currentAnimationAction=this.mixer.clipAction(o.clip).setLoop(o.repeat?THREE.LoopRepeat:THREE.LoopOnce,1/0).reset(),this.currentAnimationAction.clampWhenFinished=!o.repeat,this.currentAnimationAction.paused=!1,this.updateTimeScale(),void 0===i&&o.repeat||(this.currentAnimationAction.time=void 0!==i?i:this.currentAnimationAction.timeScale>=0?0:this.currentAnimation.duration),this.currentAnimationAction.setEffectiveWeight(void 0!==n?n:1),this.currentAnimationAction.play(),this.playing||this.mixer.update(0),this.playing=!0,this.previousAnimation&&this.previousAnimationAction.crossFadeTo(this.currentAnimationAction,e||0,!1),THREE.SEA3D.AnimationHandler.add(this),this)},stop:function(){return this.playing&&THREE.SEA3D.AnimationHandler.remove(this),this.currentAnimation&&(this.currentAnimationAction.stop(),this.previousAnimation=this.currentAnimation,this.previousAnimationAction=this.currentAnimationAction,delete this.currentAnimationAction,delete this.currentAnimation,this.playing=!1),this},playw:function(t,e){this.playing||this.paused||THREE.SEA3D.AnimationHandler.add(this);var i=this.getAnimationByName(t);this.playing=!0;var n=this.mixer.clipAction(i.clip);return n.setLoop(i.repeat?THREE.LoopRepeat:THREE.LoopOnce,1/0).reset(),n.clampWhenFinished=!i.repeat,n.paused=!1,n.setEffectiveWeight(e).play(),n},crossFade:function(t,e,i,n){this.mixer.stopAllAction();var o=this.playw(t,1),a=this.playw(e,1);return o.crossFadeTo(a,i,void 0!==n&&n),this},stopAll:function(){return this.stop().mixer.stopAllAction(),this.playing=!1,this},unPauseAll:function(){return this.mixer.timeScale=1,this.playing=!0,this.paused=!1,this},pauseAll:function(){return this.mixer.timeScale=0,this.playing=!1,this.paused=!0,this},setRelative:function(t){if(this.relative!=t)return this.stop(),this.relative=t,this},getRelative:function(){return this.relative},copyFrom:function(t){for(var e=0;e<this.animations.length;e++)this.animations[e].timeScale=t.animations[e].timeScale;return this}}),THREE.SEA3D.Object3DAnimator=function(t,e){this.object3d=e,THREE.SEA3D.Animator.call(this,t,new THREE.AnimationMixer(e)),this.clone=function(t){return new this.constructor(this.clips,t).copyFrom(this)}.bind(this)},THREE.SEA3D.Object3DAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Animator.prototype),{constructor:THREE.SEA3D.Object3DAnimator,stop:function(){if(this.currentAnimation){var t=this.object3d.animate;t&&this instanceof THREE.SEA3D.Object3DAnimator&&(t.position.set(0,0,0),t.quaternion.set(0,0,0,1),t.scale.set(1,1,1))}THREE.SEA3D.Animator.prototype.stop.call(this)},setRelative:function(t){THREE.SEA3D.Animator.prototype.setRelative.call(this,t),this.object3d.setAnimator(this.relative),this.updateAnimations(this.clips,new THREE.AnimationMixer(this.relative?this.object3d.animate:this.object3d))}}),THREE.SEA3D.CameraAnimator=function(t,e){THREE.SEA3D.Object3DAnimator.call(this,t,e)},THREE.SEA3D.CameraAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Object3DAnimator.prototype),{constructor:THREE.SEA3D.CameraAnimator}),THREE.SEA3D.SoundAnimator=function(t,e){THREE.SEA3D.Object3DAnimator.call(this,t,e)},THREE.SEA3D.SoundAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Object3DAnimator.prototype),{constructor:THREE.SEA3D.SoundAnimator}),THREE.SEA3D.LightAnimator=function(t,e){THREE.SEA3D.Object3DAnimator.call(this,t,e)},THREE.SEA3D.LightAnimator.prototype=Object.assign(Object.create(THREE.SEA3D.Object3DAnimator.prototype),{constructor:THREE.SEA3D.LightAnimator}),THREE.SEA3D.Object3D=function(){THREE.Object3D.call(this)},THREE.SEA3D.Object3D.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.SEA3D.Object3D,updateAnimateMatrix:function(t){!0===this.matrixAutoUpdate&&this.updateMatrix(),!0!==this.matrixWorldNeedsUpdate&&!0!==t||(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.animate.updateMatrix(),this.matrixWorld.multiplyMatrices(this.matrixWorld,this.animate.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)},setAnimator:function(t){this.getAnimator()!=t&&(t?(this.animate=new THREE.Object3D,this.updateMatrixWorld=THREE.SEA3D.Object3D.prototype.updateAnimateMatrix):(delete this.animate,this.updateMatrixWorld=THREE.Object3D.prototype.updateMatrixWorld),this.matrixWorldNeedsUpdate=!0)},getAnimator:function(){return void 0!=this.animate},copy:function(t){return THREE.Object3D.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.Dummy=function(t,e,i){this.width=void 0!=t?t:100,this.height=void 0!=e?e:100,this.depth=void 0!=i?i:100;var n=new THREE.BoxGeometry(this.width,this.height,this.depth,1,1,1);n.computeBoundingBox(),n.computeBoundingSphere(),THREE.Mesh.call(this,n,THREE.SEA3D.Dummy.MATERIAL)},THREE.SEA3D.Dummy.MATERIAL=new THREE.MeshBasicMaterial({wireframe:!0,color:THREE.SEA3D.HELPER_COLOR}),THREE.SEA3D.Dummy.prototype=Object.assign(Object.create(THREE.Mesh.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.Dummy,copy:function(t){return THREE.Mesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this},dispose:function(){this.geometry.dispose()}}),THREE.SEA3D.Mesh=function(t,e){THREE.Mesh.call(this,t,e)},THREE.SEA3D.Mesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.Mesh,setWeight:function(t,e){var i="number"==typeof t?t:this.morphTargetDictionary[t];this.morphTargetInfluences[i]=e},getWeight:function(t){var e="number"==typeof t?t:this.morphTargetDictionary[t];return this.morphTargetInfluences[e]},copy:function(t){return THREE.Mesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.SkinnedMesh=function(t,e,i){THREE.SkinnedMesh.call(this,t,e,i),this.updateAnimations(t.animations,new THREE.AnimationMixer(this))},THREE.SEA3D.SkinnedMesh.prototype=Object.assign(Object.create(THREE.SkinnedMesh.prototype),THREE.SEA3D.Mesh.prototype,THREE.SEA3D.Animator.prototype,{constructor:THREE.SEA3D.SkinnedMesh,boneByName:function(t){for(var e=this.skeleton.bones,i=0,n=e.length;i<n;i++)if(t==e[i].name)return e[i]},copy:function(t){return THREE.SkinnedMesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.VertexAnimationMesh=function(t,e){THREE.Mesh.call(this,t,e),this.type="MorphAnimMesh",this.updateAnimations(t.animations,new THREE.AnimationMixer(this))},THREE.SEA3D.VertexAnimationMesh.prototype=Object.assign(Object.create(THREE.Mesh.prototype),THREE.SEA3D.Mesh.prototype,THREE.SEA3D.Animator.prototype,{constructor:THREE.SEA3D.VertexAnimationMesh,copy:function(t){return THREE.Mesh.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.Camera=function(t,e,i,n){THREE.PerspectiveCamera.call(this,t,e,i,n)},THREE.SEA3D.Camera.prototype=Object.assign(Object.create(THREE.PerspectiveCamera.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.Camera,copy:function(t){return THREE.PerspectiveCamera.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.OrthographicCamera=function(t,e,i,n,o,a){THREE.OrthographicCamera.call(this,t,e,i,n,o,a)},THREE.SEA3D.OrthographicCamera.prototype=Object.assign(Object.create(THREE.OrthographicCamera.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.OrthographicCamera,copy:function(t){return THREE.OrthographicCamera.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.PointLight=function(t,e,i,n){THREE.PointLight.call(this,t,e,i,n)},THREE.SEA3D.PointLight.prototype=Object.assign(Object.create(THREE.PointLight.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.PointLight,copy:function(t){return THREE.PointLight.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.PointSound=function(t,e){THREE.PositionalAudio.call(this,t),this.setSound(e)},THREE.SEA3D.PointSound.prototype=Object.assign(Object.create(THREE.PositionalAudio.prototype),THREE.SEA3D.Object3D.prototype,{constructor:THREE.SEA3D.PointSound,setSound:function(t){return this.sound=t,t&&(t.buffer?this.setBuffer(t.buffer):t.addEventListener("complete",function(e){this.setBuffer(t.buffer)}.bind(this))),this},copy:function(t){return THREE.PositionalAudio.prototype.copy.call(this,t),this.attribs=t.attribs,this.scripts=t.scripts,t.animator&&(this.animator=t.animator.clone(this)),this}}),THREE.SEA3D.AnimationHandler={animators:[],update:function(t){for(var e=0;e<this.animators.length;)this.animators[e++].update(t)},add:function(t){-1===this.animators.indexOf(t)&&this.animators.push(t)},remove:function(t){var e=this.animators.indexOf(t);-1!==e&&this.animators.splice(e,1)}},THREE.SEA3D.Sound=function(t){this.uuid=THREE.Math.generateUUID(),this.src=t,(new THREE.AudioLoader).load(t,function(t){this.buffer=t,this.dispatchEvent({type:"complete"})}.bind(this))},THREE.SEA3D.Sound.prototype=Object.assign(Object.create(THREE.EventDispatcher.prototype),{constructor:THREE.SEA3D.Sound}),THREE.SEA3D.Domain.prototype.getMesh=THREE.SEA3D.prototype.getMesh=function(t){return this.objects["m3d/"+t]},THREE.SEA3D.Domain.prototype.getDummy=THREE.SEA3D.prototype.getDummy=function(t){return this.objects["dmy/"+t]},THREE.SEA3D.Domain.prototype.getLine=THREE.SEA3D.prototype.getLine=function(t){return this.objects["line/"+t]},THREE.SEA3D.Domain.prototype.getSound3D=THREE.SEA3D.prototype.getSound3D=function(t){return this.objects["sn3d/"+t]},THREE.SEA3D.Domain.prototype.getMaterial=THREE.SEA3D.prototype.getMaterial=function(t){return this.objects["mat/"+t]},THREE.SEA3D.Domain.prototype.getLight=THREE.SEA3D.prototype.getLight=function(t){return this.objects["lht/"+t]},THREE.SEA3D.Domain.prototype.getGLSL=THREE.SEA3D.prototype.getGLSL=function(t){return this.objects["glsl/"+t]},THREE.SEA3D.Domain.prototype.getCamera=THREE.SEA3D.prototype.getCamera=function(t){return this.objects["cam/"+t]},THREE.SEA3D.Domain.prototype.getTexture=THREE.SEA3D.prototype.getTexture=function(t){return this.objects["tex/"+t]},THREE.SEA3D.Domain.prototype.getCubeMap=THREE.SEA3D.prototype.getCubeMap=function(t){return this.objects["cmap/"+t]},THREE.SEA3D.Domain.prototype.getJointObject=THREE.SEA3D.prototype.getJointObject=function(t){return this.objects["jnt/"+t]},THREE.SEA3D.Domain.prototype.getContainer3D=THREE.SEA3D.prototype.getContainer3D=function(t){return this.objects["c3d/"+t]},THREE.SEA3D.Domain.prototype.getSprite=THREE.SEA3D.prototype.getSprite=function(t){return this.objects["m2d/"+t]},THREE.SEA3D.Domain.prototype.getProperties=THREE.SEA3D.prototype.getProperties=function(t){return this.objects["prop/"+t]},THREE.SEA3D.prototype.isPowerOfTwo=function(t){return!!t&&(t&-t)==t},THREE.SEA3D.prototype.nearestPowerOfTwo=function(t){return Math.pow(2,Math.round(Math.log(t)/Math.LN2))},THREE.SEA3D.prototype.updateTransform=function(t,e){var i=THREE.SEA3D.MTXBUF;THREE.SEA3D.VECBUF;e.transform?i.fromArray(e.transform):i.makeTranslation(e.position.x,e.position.y,e.position.z),t.position.setFromMatrixPosition(i),t.scale.setFromMatrixScale(i),t.rotation.setFromRotationMatrix(THREE.SEA3D.identityMatrixScale(i)),(this.config.forceStatic||e.isStatic)&&(t.updateMatrix(),t.matrixAutoUpdate=!1)},THREE.SEA3D.prototype.toVector3=function(t){return new THREE.Vector3(t.x,t.y,t.z)},THREE.SEA3D.prototype.toFaces=function(t){var e=[];return e[0]=t[1],e[1]=t[0],e[2]=t[3],e[3]=t[2],e[4]=t[5],e[5]=t[4],e},THREE.SEA3D.prototype.updateScene=function(){if(void 0!=this.materials)for(var t=0,e=this.materials.length;t<e;++t)this.materials[t].needsUpdate=!0},THREE.SEA3D.prototype.addSceneObject=function(t,e){(e=e||t.tag).visible=t.visible,t.parent?t.parent.tag.add(e):this.config.container&&this.config.container.add(e),t.attributes&&(e.attribs=t.attributes.tag),t.scripts&&(e.scripts=this.getJSMList(e,t.scripts),this.config.scripts&&this.config.runScripts&&this.domain.runJSMList(e))},THREE.SEA3D.prototype.createObjectURL=function(t,e){return(window.URL||window.webkitURL).createObjectURL(new Blob([t],{type:e}))},THREE.SEA3D.prototype.parsePath=function(t){var e=this.config.paths;for(var i in e)t=t.replace(new RegExp("%"+i+"%","g"),e[i]);return t},THREE.SEA3D.prototype.addDefaultAnimation=function(t,e){for(var i=t.tag,n=0,o=t.animations?t.animations.length:0;n<o;n++){var a=t.animations[n];switch(a.tag.type){case SEA3D.Animation.prototype.type:var s=a.tag.tag||this.getModifier({sea:a.tag,scope:i,relative:a.relative});return i.animator=new e(s,i),i.animator.setRelative(a.relative),this.config.autoPlay&&i.animator.play(0),i.animator}}},THREE.SEA3D.prototype.readGeometryBuffer=function(t){for(var e=t.tag||new THREE.BufferGeometry,i=0;i<t.groups.length;i++){var n=t.groups[i];e.addGroup(n.start,n.count,i)}t.indexes&&e.setIndex(new THREE.BufferAttribute(t.indexes,1)),e.addAttribute("position",new THREE.BufferAttribute(t.vertex,3)),t.uv&&(e.addAttribute("uv",new THREE.BufferAttribute(t.uv[0],2)),t.uv.length>1&&e.addAttribute("uv2",new THREE.BufferAttribute(t.uv[1],2))),t.normal?e.addAttribute("normal",new THREE.BufferAttribute(t.normal,3)):e.computeVertexNormals(),t.tangent4&&e.addAttribute("tangent",new THREE.BufferAttribute(t.tangent4,4)),t.color&&e.addAttribute("color",new THREE.BufferAttribute(t.color[0],t.numColor)),t.joint&&(e.addAttribute("skinIndex",new THREE.Float32BufferAttribute(t.joint,t.jointPerVertex)),e.addAttribute("skinWeight",new THREE.Float32BufferAttribute(t.weight,t.jointPerVertex))),this.config.bounding&&(e.computeBoundingBox(),e.computeBoundingSphere()),e.name=t.name,this.domain.geometries=this.geometries=this.geometries||[],this.geometries.push(this.objects["geo/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readDummy=function(t){var e=new THREE.SEA3D.Dummy(t.width,t.height,t.depth);e.name=t.name,this.domain.dummys=this.dummys=this.dummys||[],this.dummys.push(this.objects["dmy/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readLine=function(t){var e=new THREE.BufferGeometry;t.closed&&t.vertex.push(t.vertex[0],t.vertex[1],t.vertex[2]),e.addAttribute("position",new THREE.Float32BufferAttribute(t.vertex,3));var i=new THREE.Line(e,new THREE.LineBasicMaterial({color:THREE.SEA3D.HELPER_COLOR,linewidth:3}));i.name=t.name,this.lines=this.lines||[],this.lines.push(this.objects["line/"+t.name]=t.tag=i),this.addSceneObject(t),this.updateTransform(i,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readContainer3D=function(t){var e=new THREE.SEA3D.Object3D;this.domain.containers=this.containers=this.containers||[],this.containers.push(this.objects["c3d/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readSprite=function(t){var e;if(t.material)if(t.material.tag.sprite)e=t.material.tag.sprite;else{e=t.material.tag.sprite=new THREE.SpriteMaterial,this.setBlending(e,t.blendMode);var i=t.material.tag.map;i&&(i.flipY=!0,e.map=i),e.color.set(t.material.tag.color),e.opacity=t.material.tag.opacity,e.fog=t.material.receiveFog}var n=new THREE.Sprite(e);n.name=t.name,this.domain.sprites=this.sprites=this.sprites||[],this.sprites.push(this.objects["m2d/"+t.name]=t.tag=n),this.addSceneObject(t),this.updateTransform(n,t),n.scale.set(t.width,t.height,1)},THREE.SEA3D.prototype.readMesh=function(t){var e,i,n,o,a,s,r,E,p,h,c=t.geometry.tag;for(e=0,i=t.modifiers?t.modifiers.length:0;e<i;e++){var m=t.modifiers[e];switch(m.type){case SEA3D.Skeleton.prototype.type:case SEA3D.SkeletonLocal.prototype.type:a=m,c.bones=a.tag;break;case SEA3D.Morph.prototype.type:s=m.tag||this.getModifier({sea:m,geometry:t.geometry}),c.morphAttributes=s.attribs,c.morphTargets=s.targets}}for(e=0,i=t.animations?t.animations.length:0;e<i;e++){var u=t.animations[e].tag;switch(u.type){case SEA3D.SkeletonAnimation.prototype.type:r=u,c.animations=r.tag||this.getModifier({sea:r,skeleton:a,relative:!0});break;case SEA3D.VertexAnimation.prototype.type:E=u,c.morphAttributes=E.tag.attribs,c.morphTargets=E.tag.targets,c.animations=E.tag.animations;break;case SEA3D.UVWAnimation.prototype.type:p=u.tag||this.getModifier({sea:u});break;case SEA3D.MorphAnimation.prototype.type:h=u.tag||this.getModifier({sea:u})}}var d=void 0!=s||void 0!=E,l=s&&void 0!=s.attribs.normal||E&&void 0!=E.tag.attribs.normal;if(t.material)if(t.material.length>1){var A=[];for(e=0;e<t.material.length;e++)A[e]=t.material[e].tag,A[e].skinning=void 0!=a,A[e].morphTargets=d,A[e].morphNormals=l,A[e].vertexColors=t.geometry.color?THREE.VertexColors:THREE.NoColors;o=THREE.SEA3D.useMultiMaterial?new THREE.MultiMaterial(A):A}else(o=t.material[0].tag).skinning=void 0!=a,o.morphTargets=d,o.morphNormals=l,o.vertexColors=t.geometry.color?THREE.VertexColors:THREE.NoColors;a?(n=new THREE.SEA3D.SkinnedMesh(c,o,this.config.useVertexTexture),this.config.autoPlay&&r&&n.play(0)):E?(n=new THREE.SEA3D.VertexAnimationMesh(c,o),this.config.autoPlay&&n.play(0)):n=new THREE.SEA3D.Mesh(c,o),p&&(n.uvwAnimator=new THREE.SEA3D.Animator(p,new THREE.AnimationMixer(o.map)),this.config.autoPlay&&n.uvwAnimator.play(0)),h&&(n.morphAnimator=new THREE.SEA3D.Animator(h,new THREE.AnimationMixer(n)),this.config.autoPlay&&n.morphAnimator.play(0)),n.name=t.name,n.castShadow=t.castShadows,n.receiveShadow=!t.material||t.material[0].receiveShadows,this.domain.meshes=this.meshes=this.meshes||[],this.meshes.push(this.objects["m3d/"+t.name]=t.tag=n),this.addSceneObject(t),this.updateTransform(n,t),this.addDefaultAnimation(t,THREE.SEA3D.Object3DAnimator)},THREE.SEA3D.prototype.readSoundPoint=function(t){this.audioListener||(this.audioListener=new THREE.AudioListener,this.config.container&&this.config.container.add(this.audioListener));var e=new THREE.SEA3D.PointSound(this.audioListener);e.autoplay=t.autoPlay,e.setLoop(t.autoPlay),e.setVolume(t.volume),e.setRefDistance(t.distance),e.setRolloffFactor(this.config.audioRolloffFactor),e.setSound(t.sound.tag),e.name=t.name,this.domain.sounds3d=this.sounds3d=this.sounds3d||[],this.sounds3d.push(this.objects["sn3d/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.SoundAnimator)},THREE.SEA3D.prototype.readCubeRender=function(t){var e=new THREE.CubeCamera(.1,5e3,THREE.SEA3D.RTT_SIZE);e.renderTarget.cubeCamera=e,t.tag=e.renderTarget,this.domain.cubeRenderers=this.cubeRenderers=this.cubeRenderers||[],this.cubeRenderers.push(this.objects["rttc/"+t.name]=e),this.addSceneObject(t,e),this.updateTransform(e,t)},THREE.SEA3D.prototype.readTexture=function(t){var e=new Image,i=new THREE.Texture;i.name=t.name,i.wrapS=i.wrapT=THREE.RepeatWrapping,i.flipY=!1,i.image=e,void 0!==this.config.anisotropy&&(i.anisotropy=this.config.anisotropy),e.onload=function(){i.needsUpdate=!0},e.src=this.createObjectURL(t.data.buffer,"image/"+t.type),this.domain.textures=this.textures=this.textures||[],this.textures.push(this.objects["tex/"+t.name]=t.tag=i)},THREE.SEA3D.prototype.readCubeMap=function(t){var e=this.toFaces(t.faces),i=new THREE.CubeTexture([]),n=0;i.name=t.name,i.flipY=!1,i.format=THREE.RGBFormat;for(var o=function(){6==++n&&(i.needsUpdate=!0,this.config.async||(this.file.resume=!0))}.bind(this),a=0;a<e.length;++a){var s=new Image;s.onload=o,s.src=this.createObjectURL(e[a].buffer,"image/"+t.extension),i.images[a]=s}this.config.async||(this.file.resume=!1),this.domain.cubemaps=this.cubemaps=this.cubemaps||[],this.cubemaps.push(this.objects["cmap/"+t.name]=t.tag=i)},THREE.SEA3D.prototype.readTextureUpdate=function(t){var e=this.file.objects[t.index],i=e.tag,n=new Image;n.onload=function(){i.image=n,i.needsUpdate=!0},n.src=this.createObjectURL(t.bytes.buffer,"image/"+e.type)},THREE.SEA3D.prototype.readSound=function(t){var e=new THREE.SEA3D.Sound(this.createObjectURL(t.data.buffer,"audio/"+t.type));e.name=t.name,this.domain.sounds=this.sounds=this.sounds||[],this.sounds.push(this.objects["snd/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readScriptURL=function(t){this.file.resume=!1,(new THREE.FileLoader).setResponseType("text").load(t.url,function(e){this.file.resume=!0,this.domain.scripts=this.scripts=this.scripts||[],this.scripts.push(this.objects["src/"+t.name]=t.tag=e)}.bind(this))},THREE.SEA3D.prototype.readTextureURL=function(t){var e=(new THREE.TextureLoader).load(this.parsePath(t.url));e.name=t.name,e.wrapS=e.wrapT=THREE.RepeatWrapping,e.flipY=!1,void 0!==this.config.anisotropy&&(e.anisotropy=this.config.anisotropy),this.domain.textures=this.textures=this.textures||[],this.textures.push(this.objects["tex/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readCubeMapURL=function(t){for(var e=this.toFaces(t.faces),i=0;i<e.length;i++)e[i]=this.parsePath(e[i]);var n;if("hdr"==e[0].substr(-3)){var o=null!=THREE.PMREMGenerator;this.file.resume=!o,n=(new THREE.HDRCubeTextureLoader).load(THREE.UnsignedByteType,e,function(e){if(o){var i=new THREE.PMREMGenerator(e);i.update(this.config.renderer);var n=new THREE.PMREMCubeUVPacker(i.cubeLods);n.update(this.config.renderer),e.dispose(),this.objects["cmap/"+t.name]=t.tag=n.CubeUVRenderTarget.texture,this.file.resume=!0}}.bind(this))}else n=(new THREE.CubeTextureLoader).load(e);n.name=t.name,n.wrapS=n.wrapT=THREE.RepeatWrapping,n.flipY=!1,void 0!==this.config.anisotropy&&(n.anisotropy=this.config.anisotropy),this.domain.cubemaps=this.cubemaps=this.cubemaps||[],this.cubemaps.push(this.objects["cmap/"+t.name]=t.tag=n)},THREE.SEA3D.prototype.getJSMList=function(t,e){for(var i=[],n=0;n<e.length;n++){var o=e[n];o.tag.type==SEA3D.JavaScriptMethod.prototype.type&&i.push(o)}return this.domain.scriptTargets=this.scriptTargets=this.scriptTargets||[],this.scriptTargets.push(t),i},THREE.SEA3D.prototype.readJavaScriptMethod=function(sea){try{var src="(function() {\nvar $METHOD = {}\n",declare='function($INC, $REF, global, local, self, $PARAM) {\nvar watch = $INC["watch"],\nscene = $INC["scene"],\nsea3d = $INC["sea3d"],\nprint = $INC["print"];\n';for(var name in declare+='var $SRC = $INC["source"],\naddEventListener = $SRC.addEventListener.bind( $SRC ),\nhasEventListener = $SRC.hasEventListener.bind( $SRC ),\nremoveEventListener = $SRC.removeEventListener.bind( $SRC ),\ndispatchEvent = $SRC.dispatchEvent.bind( $SRC ),\ndispose = $SRC.dispose.bind( $SRC );\n',sea.methods)src+='$METHOD["'+name+'"] = '+declare+sea.methods[name].src+"}\n";src+="return $METHOD; })",this.domain.methods=eval(src)()}catch(t){console.error('SEA3D JavaScriptMethod: Error running "'+sea.name+'".'),console.error(t)}},THREE.SEA3D.prototype.readGLSL=function(t){this.domain.glsl=this.glsl=this.glsl||[],this.glsl.push(this.objects["glsl/"+t.name]=t.tag=t.src)},THREE.SEA3D.prototype.materialTechnique=function(){var t={onComplete:function(t,e){(e.alpha<1||t.blending>THREE.NormalBlending)&&(t.opacity=e.alpha,t.transparent=!0)}};return t[SEA3D.Material.PHYSICAL]=function(t,e){t.color.setHex(e.color),t.roughness=e.roughness,t.metalness=e.metalness},t[SEA3D.Material.REFLECTIVITY]=function(t,e){t.reflectivity=e.strength},t[SEA3D.Material.CLEAR_COAT]=function(t,e){t.clearCoat=e.strength,t.clearCoatRoughness=e.roughness},t[SEA3D.Material.PHONG]=function(t,e){t.color.setHex(e.diffuseColor),t.specular.setHex(e.specularColor).multiplyScalar(e.specular),t.shininess=e.gloss},t[SEA3D.Material.DIFFUSE_MAP]=function(t,e,i){t.map=e.texture.tag,t.color.setHex(16777215),t.map.wrapS=t.map.wrapT=i.repeat?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,e.texture.transparent&&(t.transparent=!0)},t[SEA3D.Material.ROUGHNESS_MAP]=function(t,e){t.roughnessMap=e.texture.tag},t[SEA3D.Material.METALNESS_MAP]=function(t,e){t.metalnessMap=e.texture.tag},t[SEA3D.Material.SPECULAR_MAP]=function(t,e){t.specular&&(t.specularMap=e.texture.tag,t.specular.setHex(16777215))},t[SEA3D.Material.NORMAL_MAP]=function(t,e){t.normalMap=e.texture.tag},t[SEA3D.Material.REFLECTION]=t[SEA3D.Material.FRESNEL_REFLECTION]=function(t,e){t.envMap=e.texture.tag,t.envMap.mapping=THREE.CubeReflectionMapping,t.combine=THREE.MixOperation,t.reflectivity=e.alpha},t[SEA3D.Material.REFLECTION_SPHERICAL]=function(t,e){t.envMap=e.texture.tag,t.envMap.mapping=THREE.SphericalReflectionMapping,t.combine=THREE.MixOperation,t.reflectivity=e.alpha},t[SEA3D.Material.REFRACTION_MAP]=function(t,e){t.envMap=e.texture.tag,t.envMap.mapping=THREE.CubeRefractionMapping,t.refractionRatio=e.ior,t.reflectivity=e.alpha},t[SEA3D.Material.LIGHT_MAP]=function(t,e){"multiply"==e.blendMode?t.aoMap=e.texture.tag:t.lightMap=e.texture.tag},t[SEA3D.Material.EMISSIVE]=function(t,e){t.emissive.setHex(e.color)},t[SEA3D.Material.EMISSIVE_MAP]=function(t,e){t.emissiveMap=e.texture.tag},t[SEA3D.Material.ALPHA_MAP]=function(t,e,i){t.alphaMap=e.texture.tag,t.transparent=!0,t.alphaMap.wrapS=t.alphaMap.wrapT=i.repeat?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping},t}(),THREE.SEA3D.prototype.createMaterial=function(t){return t.tecniquesDict[SEA3D.Material.REFLECTIVITY]||t.tecniquesDict[SEA3D.Material.CLEAR_COAT]?new THREE.MeshPhysicalMaterial:t.tecniquesDict[SEA3D.Material.PHYSICAL]?new THREE.MeshStandardMaterial:new THREE.MeshPhongMaterial},THREE.SEA3D.prototype.setBlending=function(t,e){if("normal"!==e){switch(e){case"add":t.blending=THREE.AdditiveBlending;break;case"subtract":t.blending=THREE.SubtractiveBlending;break;case"multiply":t.blending=THREE.MultiplyBlending;break;case"screen":t.blending=THREE.CustomBlending,t.blendSrc=THREE.OneFactor,t.blendDst=THREE.OneMinusSrcColorFactor,t.blendEquation=THREE.AddEquation}t.transparent=!0}},THREE.SEA3D.prototype.readMaterial=function(t){var e=this.createMaterial(t);e.name=t.name,e.lights=t.receiveLights,e.fog=t.receiveFog,e.depthWrite=t.depthWrite,e.depthTest=t.depthTest,e.premultipliedAlpha=t.premultipliedAlpha,e.side=t.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.setBlending(e,t.blendMode);for(var i=0;i<t.technique.length;i++){var n=t.technique[i];this.materialTechnique[n.kind]&&this.materialTechnique[n.kind].call(this,e,n,t)}this.materialTechnique.onComplete&&this.materialTechnique.onComplete.call(this,e,t),this.domain.materials=this.materials=this.materials||[],this.materials.push(this.objects["mat/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readPointLight=function(t){var e=new THREE.SEA3D.PointLight(t.color,t.multiplier*this.config.multiplier);e.name=t.name,t.attenuation&&(e.distance=t.attenuation.end),t.shadow&&this.setShadowMap(e),this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readHemisphereLight=function(t){var e=new THREE.HemisphereLight(t.color,t.secondColor,t.multiplier*this.config.multiplier);e.position.set(0,500,0),e.name=t.name,this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readAmbientLight=function(t){var e=new THREE.AmbientLight(t.color,t.multiplier*this.config.multiplier);e.name=t.name,this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readDirectionalLight=function(t){var e=new THREE.DirectionalLight(t.color,t.multiplier*this.config.multiplier);e.name=t.name,t.shadow&&this.setShadowMap(e),this.domain.lights=this.lights=this.lights||[],this.lights.push(this.objects["lht/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.LightAnimator),this.updateScene()},THREE.SEA3D.prototype.readCamera=function(t){var e=new THREE.SEA3D.Camera(t.fov);e.name=t.name,this.domain.cameras=this.cameras=this.cameras||[],this.cameras.push(this.objects["cam/"+t.name]=t.tag=e),this.addSceneObject(t),this.updateTransform(e,t),this.addDefaultAnimation(t,THREE.SEA3D.CameraAnimator)},THREE.SEA3D.prototype.readOrthographicCamera=function(t){var e,i,n,o=void 0!==this.config.stageWidth?this.config.stageWidth:window?window.innerWidth:1024,a=void 0!==this.config.stageHeight?this.config.stageHeight:window?window.innerHeight:1024;o>a?(e=o/a,i=t.height*e,n=t.height):(e=a/o,i=t.height,n=t.height*e);var s=new THREE.SEA3D.OrthographicCamera(-i,i,n,-n);s.name=t.name,this.domain.cameras=this.cameras=this.cameras||[],this.cameras.push(this.objects["cam/"+t.name]=t.tag=s),this.addSceneObject(t),this.updateTransform(s,t),this.addDefaultAnimation(t,THREE.SEA3D.CameraAnimator)},THREE.SEA3D.prototype.getSkeletonFromBones=function(t){var e,i,n,o,a=[];for(n=0,o=t.length;n<o;n++)i=t[n],e=new THREE.Bone,a.push(e),e.name=i.name,e.position.fromArray(i.pos),e.quaternion.fromArray(i.rotq),void 0!==i.scl&&e.scale.fromArray(i.scl);for(n=0,o=t.length;n<o;n++)-1!==(i=t[n]).parent&&null!==i.parent&&void 0!==a[i.parent]&&a[i.parent].add(a[n]);return new THREE.Skeleton(a)},THREE.SEA3D.prototype.readSkeletonLocal=function(t){for(var e=[],i=0;i<t.joint.length;i++){var n=t.joint[i];e[i]={name:n.name,pos:[n.x,n.y,n.z],rotq:[n.qx,n.qy,n.qz,n.qw],parent:n.parentIndex}}this.domain.bones=this.bones=this.bones||[],this.bones.push(this.objects[t.name+".sklq"]=t.tag=e)},THREE.SEA3D.prototype.readJointObject=function(t){var e=t.target.tag.skeleton.bones[t.joint];this.domain.joints=this.joints=this.joints||[],this.joints.push(this.objects["jnt/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readMorph=function(t){for(var e={position:[]},i=[],n=0;n<t.node.length;n++){var o=t.node[n];e.position[n]=new THREE.Float32BufferAttribute(o.vertex,3),e.position[n].name=o.name,o.normal&&(e.normal=e.normal||[],e.normal[n]=new THREE.Float32BufferAttribute(o.normal,3)),i[n]={name:o.name}}t.tag={attribs:e,targets:i}},THREE.SEA3D.prototype.readAnimation=function(t){for(var e=[],i=1e3/t.frameRate/1e3,n=0;n<t.sequence.length;n++){for(var o=t.sequence[n],a=[],s=0;s<t.dataList.length;s++){var r,E,p,h,c=t.dataList[s],m=c.data,u=o.start*c.blockSize,d=u+o.count*c.blockSize,l=!!o.intrpl&&THREE.InterpolateLinear,A=null;switch(c.kind){case SEA3D.Animation.POSITION:A=".position";break;case SEA3D.Animation.ROTATION:A=".quaternion";break;case SEA3D.Animation.SCALE:A=".scale";break;case SEA3D.Animation.COLOR:A=".color";break;case SEA3D.Animation.MULTIPLIER:A=".intensity";break;case SEA3D.Animation.FOV:A=".fov";break;case SEA3D.Animation.OFFSET_U:A=".offset[x]";break;case SEA3D.Animation.OFFSET_V:A=".offset[y]";break;case SEA3D.Animation.SCALE_U:A=".repeat[x]";break;case SEA3D.Animation.SCALE_V:A=".repeat[y]";break;case SEA3D.Animation.MORPH:A=".morphTargetInfluences["+c.name+"]"}if(A)switch(c.type){case SEA3D.Stream.BYTE:case SEA3D.Stream.UBYTE:case SEA3D.Stream.INT:case SEA3D.Stream.UINT:case SEA3D.Stream.FLOAT:case SEA3D.Stream.DOUBLE:case SEA3D.Stream.DECIMAL:for(h=m.subarray(u,d),p=new Float32Array(h.length),r=0,E=0;E<p.length;E++)p[E]=r,r+=i;a.push(new THREE.NumberKeyframeTrack(A,p,h,l));break;case SEA3D.Stream.VECTOR3D:for(h=m.subarray(u,d),p=new Float32Array(h.length/c.blockSize),r=0,E=0;E<p.length;E++)p[E]=r,r+=i;a.push(new THREE.VectorKeyframeTrack(A,p,h,l));break;case SEA3D.Stream.VECTOR4D:for(h=m.subarray(u,d),p=new Float32Array(h.length/c.blockSize),r=0,E=0;E<p.length;E++)p[E]=r,r+=i;a.push(new THREE.QuaternionKeyframeTrack(A,p,h,l));break;case SEA3D.Stream.INT24:case SEA3D.Stream.UINT24:for(h=new Float32Array(3*(d-u)),p=new Float32Array(h.length/3),r=0,E=0;E<p.length;E++)h[3*E]=(m[E]>>16&255)/255,h[3*E+1]=(m[E]>>8&255)/255,h[3*E+2]=(255&m[E])/255,p[E]=r,r+=i;a.push(new THREE.VectorKeyframeTrack(A,p,h,l))}}e.push(new THREE.SEA3D.AnimationClip(o.name,-1,a,o.repeat))}this.domain.clips=this.clips=this.clips||[],this.clips.push(this.objects[t.name+".anm"]=t.tag=e)},THREE.SEA3D.prototype.readSkeletonAnimation=function(t,e){if(!(e=!e&&t.metadata&&t.metadata.skeleton?t.metadata.skeleton:e)||t.tag)return t.tag;for(var i=[],n=1e3/t.frameRate/1e3,o=0;o<t.sequence.length;o++){for(var a=t.sequence[o],s=a.start,r=s+a.count,E={name:a.name,fps:t.frameRate,length:n*a.count,hierarchy:[]},p=t.numJoints,h=t.raw,c=0;c<p;c++){for(var m={parent:e.joint[c].parentIndex,keys:[]},u=m.keys,d=0,l=s;l<r;l++){var A=l*p*7+7*c;u.push({time:d,pos:[h[A],h[A+1],h[A+2]],rot:[h[A+3],h[A+4],h[A+5],h[A+6]],scl:[1,1,1]}),d+=n}E.hierarchy[c]=m}i.push(THREE.SEA3D.AnimationClip.fromClip(THREE.AnimationClip.parseAnimation(E,e.tag),a.repeat))}this.domain.clips=this.clips=this.clips||[],this.clips.push(this.objects[t.name+".skla"]=t.tag=i)},THREE.SEA3D.prototype.readVertexAnimation=function(t){var e,i,n,o={position:[]},a=[],s=[];for(e=0,n=t.frame.length;e<n;e++){var r=t.frame[e];o.position[e]=new THREE.Float32BufferAttribute(r.vertex,3),r.normal&&(o.normal=o.normal||[],o.normal[e]=new THREE.Float32BufferAttribute(r.normal,3)),a[e]={name:e}}for(e=0;e<t.sequence.length;e++){var E=t.sequence[e],p=[];for(i=0;i<E.count;i++)p[i]=a[E.start+i];s.push(THREE.SEA3D.AnimationClip.fromClip(THREE.AnimationClip.CreateFromMorphTargetSequence(E.name,p,t.frameRate),E.repeat))}t.tag={attribs:o,targets:a,animations:s},this.domain.clips=this.clips=this.clips||[],this.clips.push(this.objects[t.name+".vtxa"]=t.tag)},THREE.SEA3D.prototype.getModifier=function(t){var e=t.sea;switch(e.type){case SEA3D.SkeletonAnimation.prototype.type:this.readSkeletonAnimation(e,t.skeleton);break;case SEA3D.Animation.prototype.type:case SEA3D.MorphAnimation.prototype.type:case SEA3D.UVWAnimation.prototype.type:this.readAnimation(e);break;case SEA3D.Morph.prototype.type:this.readMorph(e,t.geometry)}return e.tag},THREE.SEA3D.prototype.applyEnvironment=function(t){for(var e=0,i=this.materials.length;e<i;++e){var n=this.materials[e];if(n instanceof THREE.MeshStandardMaterial){if(n.envMap)continue;n.envMap=t,n.envMap.mapping=THREE.CubeReflectionMapping,n.needsUpdate=!0}}},THREE.SEA3D.prototype.readActions=function(t){for(var e=0;e<t.actions.length;e++){var i=t.actions[e];switch(i.kind){case SEA3D.Actions.ATTRIBUTES:this.attribs=this.domain.attribs=i.attributes.tag;break;case SEA3D.Actions.SCRIPTS:this.domain.scripts=this.getJSMList(this.domain,i.scripts),this.config.scripts&&this.config.runScripts&&this.domain.runJSMList(this.domain);break;case SEA3D.Actions.CAMERA:this.domain.camera=this.camera=i.camera.tag;break;case SEA3D.Actions.ENVIRONMENT_COLOR:this.domain.background=this.background=this.background||{},this.background.color=new THREE.Color(i.color);break;case SEA3D.Actions.ENVIRONMENT:this.domain.background=this.background=this.background||{},this.background.texture=i.texture.tag,this.config.useEnvironment&&void 0!=this.materials&&this.applyEnvironment(i.texture.tag)}}},THREE.SEA3D.prototype.updatePropertiesAssets=function(t,e){for(var i in e)switch(e.__type[i]){case SEA3D.Stream.ASSET:e.__asset||(e.__asset={}),e.__asset[i]||(e.__asset[i]=e[i]),e[i]=e.__asset[i].tag;break;case SEA3D.Stream.GROUP:e[i]=this.updatePropertiesAssets(t,e[i])}return e},THREE.SEA3D.prototype.readProperties=function(t){var e=this.updatePropertiesAssets(t,t.props);this.domain.properties=this.properties=this.properties||[],this.properties.push(this.objects["prop/"+t.name]=t.tag=e)},THREE.SEA3D.prototype.readFileInfo=function(t){this.domain.info=this.updatePropertiesAssets(t,t.info)},THREE.SEA3D.Event={PROGRESS:"sea3d_progress",LOAD_PROGRESS:"sea3d_load",DOWNLOAD_PROGRESS:"sea3d_download",COMPLETE:"sea3d_complete",OBJECT_COMPLETE:"sea3d_object",PARSE_PROGRESS:"parse_progress",PARSE_COMPLETE:"parse_complete",ERROR:"sea3d_error"},THREE.SEA3D.prototype.onProgress=function(t){t.status=t.type,t.progress=t.loaded/t.total,t.type=THREE.SEA3D.Event.PROGRESS,this.dispatchEvent(t)},THREE.SEA3D.prototype.onLoadProgress=function(t){t.type=THREE.SEA3D.Event.LOAD_PROGRESS,this.dispatchEvent(t),this.onProgress(t)},THREE.SEA3D.prototype.onDownloadProgress=function(t){t.type=THREE.SEA3D.Event.DOWNLOAD_PROGRESS,this.dispatchEvent(t),this.onProgress(t)},THREE.SEA3D.prototype.onComplete=function(t){t.type=THREE.SEA3D.Event.COMPLETE,this.dispatchEvent(t)},THREE.SEA3D.prototype.onCompleteObject=function(t){t.type=THREE.SEA3D.Event.OBJECT_COMPLETE,this.dispatchEvent(t)},THREE.SEA3D.prototype.onParseProgress=function(t){t.type=THREE.SEA3D.Event.PARSE_PROGRESS,this.dispatchEvent(t)},THREE.SEA3D.prototype.onParseComplete=function(t){t.type=THREE.SEA3D.Event.PARSE_COMPLETE,this.dispatchEvent(t)},THREE.SEA3D.prototype.onError=function(t){t.type=THREE.SEA3D.Event.ERROR,this.dispatchEvent(t)},THREE.SEA3D.prototype.createDomain=function(){return this.domain=new THREE.SEA3D.Domain(this.config.id,this.objects={},this.config.container)},THREE.SEA3D.prototype.clone=function(t,e,i){if(!this.file.isDone())throw new Error("Previous parse is not completed.");this.config.container=t&&void 0!==t.container?t.container:new THREE.Object3D,t&&this.loadConfig(t);var n=this.config.timeLimit;return this.config.timeLimit=t&&void 0!==t.timeLimit?t.timeLimit:1/0,this.parse(e,i),this.config.timeLimit=n,this.domain},THREE.SEA3D.prototype.loadConfig=function(t){for(var e in t)this.config[e]=t[e]},THREE.SEA3D.prototype.parse=function(t,e){delete this.cameras,delete this.containers,delete this.lights,delete this.joints,delete this.meshes,delete this.materials,delete this.sprites,delete this.sounds3d,delete this.cubeRenderers,delete this.sounds,delete this.glsl,delete this.dummy,delete this.camera,delete this.background,delete this.properties,delete this.scriptTargets,delete this.domain,this.createDomain(),this.setTypeRead(),this.file.onParseComplete=function(e){this.config.manager&&this.config.manager.add(this.domain),(t||this.onParseComplete).call(this,e)}.bind(this),this.file.onParseProgress=e||this.onParseProgress;for(var i=THREE.SEA3D.EXTENSIONS_LOADER.length;i--;){var n=THREE.SEA3D.EXTENSIONS_LOADER[i];n.parse&&n.parse.call(this)}return this.file.parse(),this.domain},THREE.SEA3D.prototype.onHead=function(t){if("TJS"!=t.sign)throw new Error("Sign '"+t.sign+"' not supported! Use SEA3D Studio to publish or SEA3DLegacy.js")},THREE.SEA3D.EXTENSIONS_LOADER=[],THREE.SEA3D.EXTENSIONS_DOMAIN=[],THREE.SEA3D.prototype.setTypeRead=function(){this.file.typeRead={},this.file.typeRead[SEA3D.Geometry.prototype.type]=this.readGeometryBuffer,this.file.typeRead[SEA3D.Mesh.prototype.type]=this.readMesh,this.file.typeRead[SEA3D.Sprite.prototype.type]=this.readSprite,this.file.typeRead[SEA3D.Container3D.prototype.type]=this.readContainer3D,this.file.typeRead[SEA3D.Line.prototype.type]=this.readLine,this.file.typeRead[SEA3D.Material.prototype.type]=this.readMaterial,this.file.typeRead[SEA3D.Camera.prototype.type]=this.readCamera,this.file.typeRead[SEA3D.OrthographicCamera.prototype.type]=this.readOrthographicCamera,this.file.typeRead[SEA3D.SkeletonLocal.prototype.type]=this.readSkeletonLocal,this.file.typeRead[SEA3D.SkeletonAnimation.prototype.type]=this.readSkeletonAnimation,this.file.typeRead[SEA3D.JointObject.prototype.type]=this.readJointObject,this.file.typeRead[SEA3D.CubeMap.prototype.type]=this.readCubeMap,this.file.typeRead[SEA3D.CubeRender.prototype.type]=this.readCubeRender,this.file.typeRead[SEA3D.Animation.prototype.type]=this.file.typeRead[SEA3D.MorphAnimation.prototype.type]=this.file.typeRead[SEA3D.UVWAnimation.prototype.type]=this.readAnimation,this.file.typeRead[SEA3D.SoundPoint.prototype.type]=this.readSoundPoint,this.file.typeRead[SEA3D.TextureURL.prototype.type]=this.readTextureURL,this.file.typeRead[SEA3D.CubeMapURL.prototype.type]=this.readCubeMapURL,this.file.typeRead[SEA3D.TextureUpdate.prototype.type]=this.readTextureUpdate,this.file.typeRead[SEA3D.Morph.prototype.type]=this.readMorph,this.file.typeRead[SEA3D.VertexAnimation.prototype.type]=this.readVertexAnimation,this.file.typeRead[SEA3D.Actions.prototype.type]=this.readActions,this.file.typeRead[SEA3D.FileInfo.prototype.type]=this.readFileInfo,this.file.typeRead[SEA3D.Properties.prototype.type]=this.readProperties,this.config.dummys&&(this.file.typeRead[SEA3D.Dummy.prototype.type]=this.readDummy),this.config.scripts&&(this.file.typeRead[SEA3D.ScriptURL.prototype.type]=this.readScriptURL,this.file.typeRead[SEA3D.JavaScriptMethod.prototype.type]=this.readJavaScriptMethod),this.config.lights&&(this.file.typeRead[SEA3D.PointLight.prototype.type]=this.readPointLight,this.file.typeRead[SEA3D.DirectionalLight.prototype.type]=this.readDirectionalLight,this.file.typeRead[SEA3D.HemisphereLight.prototype.type]=this.readHemisphereLight,this.file.typeRead[SEA3D.AmbientLight.prototype.type]=this.readAmbientLight),this.file.typeRead[SEA3D.JPEG.prototype.type]=this.file.typeRead[SEA3D.JPEG_XR.prototype.type]=this.file.typeRead[SEA3D.PNG.prototype.type]=this.file.typeRead[SEA3D.GIF.prototype.type]=this.readTexture,this.file.typeRead[SEA3D.MP3.prototype.type]=this.readSound,this.file.typeRead[SEA3D.GLSL.prototype.type]=this.readGLSL;for(var t=THREE.SEA3D.EXTENSIONS_LOADER.length;t--;){var e=THREE.SEA3D.EXTENSIONS_LOADER[t];e.setTypeRead&&e.setTypeRead.call(this)}},THREE.SEA3D.prototype.load=function(t){this.file=new SEA3D.File,this.file.scope=this,this.file.config=this.config,this.file.onProgress=this.onLoadProgress.bind(this),this.file.onCompleteObject=this.onCompleteObject.bind(this),this.file.onDownloadProgress=this.onDownloadProgress.bind(this),this.file.onParseProgress=this.onParseProgress.bind(this),this.file.onParseComplete=this.onParseComplete.bind(this),this.file.onError=this.onError.bind(this),this.file.onHead=this.onHead.bind(this),this.file.onComplete=function(t){this.config.manager&&this.config.manager.add(this.domain),this.onComplete.call(this,t)}.bind(this),this.createDomain(),this.setTypeRead(),void 0!==t&&("string"==typeof t?this.file.load(t):this.file.read(t))};