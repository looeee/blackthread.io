"use strict";var SEA3D={VERSION:18110,getVersion:function(){var t=SEA3D.VERSION.toString(),e=t.length;return t.substring(0,e-4)+"."+t.substring(e-4,e-3)+"."+t.substring(e-3,e-2)+"."+parseFloat(t.substring(e-2,e)).toString()}};console.log("SEA3D "+SEA3D.getVersion()),SEA3D.Stream=function(t){this.position=0,this.buffer=t||new ArrayBuffer},SEA3D.Stream.NONE=0,SEA3D.Stream.BOOLEAN=1,SEA3D.Stream.BYTE=2,SEA3D.Stream.UBYTE=3,SEA3D.Stream.SHORT=4,SEA3D.Stream.USHORT=5,SEA3D.Stream.INT24=6,SEA3D.Stream.UINT24=7,SEA3D.Stream.INT=8,SEA3D.Stream.UINT=9,SEA3D.Stream.FLOAT=10,SEA3D.Stream.DOUBLE=11,SEA3D.Stream.DECIMAL=12,SEA3D.Stream.VECTOR3D=74,SEA3D.Stream.VECTOR4D=106,SEA3D.Stream.STRING_TINY=128,SEA3D.Stream.STRING_SHORT=129,SEA3D.Stream.STRING_LONG=130,SEA3D.Stream.ASSET=200,SEA3D.Stream.GROUP=255,SEA3D.Stream.BLEND_MODE=["normal","add","subtract","multiply","dividing","mix","alpha","screen","darken","overlay","colorburn","linearburn","lighten","colordodge","lineardodge","softlight","hardlight","pinlight","spotlight","spotlightblend","hardmix","average","difference","exclusion","hue","saturation","color","value","linearlight","grainextract","reflect","glow","darkercolor","lightercolor","phoenix","negation"],SEA3D.Stream.INTERPOLATION_TABLE=["normal","linear","sine.in","sine.out","sine.inout","cubic.in","cubic.out","cubic.inout","quint.in","quint.out","quint.inout","circ.in","circ.out","circ.inout","back.in","back.out","back.inout","quad.in","quad.out","quad.inout","quart.in","quart.out","quart.inout","expo.in","expo.out","expo.inout","elastic.in","elastic.out","elastic.inout","bounce.in","bounce.out","bounce.inout"],SEA3D.Stream.sizeOf=function(t){return 0==t?0:t>=1&&t<=31?1:t>=32&&t<=63?2:t>=64&&t<=95?3:t>=96&&t<=125?4:-1},SEA3D.Stream.prototype={constructor:SEA3D.Stream,set buffer(t){this.buf=t,this.data=new DataView(t)},get buffer(){return this.buf},get bytesAvailable(){return this.length-this.position},get length(){return this.buf.byteLength}},SEA3D.Stream.prototype.getByte=function(t){return this.data.getInt8(t)},SEA3D.Stream.prototype.readBytes=function(t){var e=this.buf.slice(this.position,this.position+t);return this.position+=t,e},SEA3D.Stream.prototype.readByte=function(){return this.data.getInt8(this.position++)},SEA3D.Stream.prototype.readUByte=function(){return this.data.getUint8(this.position++)},SEA3D.Stream.prototype.readBool=function(){return 0!=this.data.getInt8(this.position++)},SEA3D.Stream.prototype.readShort=function(){var t=this.data.getInt16(this.position,!0);return this.position+=2,t},SEA3D.Stream.prototype.readUShort=function(){var t=this.data.getUint16(this.position,!0);return this.position+=2,t},SEA3D.Stream.prototype.readUInt24=function(){var t=16777215&this.data.getUint32(this.position,!0);return this.position+=3,t},SEA3D.Stream.prototype.readUInt24F=function(){return this.readUShort()|this.readUByte()<<16},SEA3D.Stream.prototype.readInt=function(){var t=this.data.getInt32(this.position,!0);return this.position+=4,t},SEA3D.Stream.prototype.readUInt=function(){var t=this.data.getUint32(this.position,!0);return this.position+=4,t},SEA3D.Stream.prototype.readFloat=function(){var t=this.data.getFloat32(this.position,!0);return this.position+=4,t},SEA3D.Stream.prototype.readUInteger=function(){var t=this.readUByte(),e=127&t;return 0!=(128&t)&&(e|=(127&(t=this.readUByte()))<<7,0!=(128&t)&&(e|=(127&(t=this.readUByte()))<<13)),e},SEA3D.Stream.prototype.readVector2=function(){return{x:this.readFloat(),y:this.readFloat()}},SEA3D.Stream.prototype.readVector3=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat()}},SEA3D.Stream.prototype.readVector4=function(){return{x:this.readFloat(),y:this.readFloat(),z:this.readFloat(),w:this.readFloat()}},SEA3D.Stream.prototype.readMatrix=function(){var t=new Float32Array(16);return t[0]=this.readFloat(),t[1]=this.readFloat(),t[2]=this.readFloat(),t[3]=0,t[4]=this.readFloat(),t[5]=this.readFloat(),t[6]=this.readFloat(),t[7]=0,t[8]=this.readFloat(),t[9]=this.readFloat(),t[10]=this.readFloat(),t[11]=0,t[12]=this.readFloat(),t[13]=this.readFloat(),t[14]=this.readFloat(),t[15]=1,t},SEA3D.Stream.prototype.readUTF8=function(t){var e=this.readBytes(t);return THREE.LoaderUtils.decodeText(new Uint8Array(e))},SEA3D.Stream.prototype.readExt=function(){return this.readUTF8(4).replace(/\0/g,"")},SEA3D.Stream.prototype.readUTF8Tiny=function(){return this.readUTF8(this.readUByte())},SEA3D.Stream.prototype.readUTF8Short=function(){return this.readUTF8(this.readUShort())},SEA3D.Stream.prototype.readUTF8Long=function(){return this.readUTF8(this.readUInt())},SEA3D.Stream.prototype.readUByteArray=function(t){var e=new Uint8Array(t);return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,t),this.position+=t,e},SEA3D.Stream.prototype.readUShortArray=function(t){var e=new Uint16Array(t),a=2*t;return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,a),this.position+=a,e},SEA3D.Stream.prototype.readUInt24Array=function(t){for(var e=new Uint32Array(t),a=0;a<t;a++)e[a]=this.readUInt24();return e},SEA3D.Stream.prototype.readUIntArray=function(t){var e=new Uint32Array(t),a=4*t;return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,a),this.position+=a,e},SEA3D.Stream.prototype.readFloatArray=function(t){var e=new Float32Array(t),a=4*t;return SEA3D.Stream.memcpy(e.buffer,0,this.buffer,this.position,a),this.position+=a,e},SEA3D.Stream.prototype.readBlendMode=function(){return SEA3D.Stream.BLEND_MODE[this.readUByte()]},SEA3D.Stream.prototype.readInterpolation=function(){return SEA3D.Stream.INTERPOLATION_TABLE[this.readUByte()]},SEA3D.Stream.prototype.readTags=function(t){for(var e=this.readUByte(),a=0;a<e;++a){var r=this.readUShort(),i=this.readUInt(),s=this.position;t(r,this,i),this.position=s+=i}},SEA3D.Stream.prototype.readProperties=function(t){var e=this.readUByte(),a={},r={};a.__type=r;for(var i=0;i<e;i++){var s=this.readUTF8Tiny(),o=this.readUByte();r[s]=o,a[s]=o==SEA3D.Stream.GROUP?this.readProperties(t):this.readToken(o,t)}return a},SEA3D.Stream.prototype.readAnimationList=function(t){for(var e=[],a=this.readUByte(),r=0;r<a;){var i=this.readUByte(),s={};s.relative=0!=(1&i),2&i&&(s.timeScale=this.readFloat()),s.tag=t.getObject(this.readUInt()),e[r++]=s}return e},SEA3D.Stream.prototype.readScriptList=function(t){for(var e=[],a=this.readUByte(),r=0;r<a;){var i=this.readUByte(),s={};if(s.priority=1&i|2&i,4&i){var o=this.readUByte();s.params={};for(var n=0;n<o;n++){var h=this.readUTF8Tiny();s.params[h]=this.readObject(t)}}8&i&&(s.method=this.readUTF8Tiny()),s.tag=t.getObject(this.readUInt()),e[r++]=s}return e},SEA3D.Stream.prototype.readObject=function(t){return this.readToken(this.readUByte(),t)},SEA3D.Stream.prototype.readToken=function(t,e){switch(t){case SEA3D.Stream.BOOLEAN:return this.readBool();case SEA3D.Stream.UBYTE:return this.readUByte();case SEA3D.Stream.USHORT:return this.readUShort();case SEA3D.Stream.UINT24:return this.readUInt24();case SEA3D.Stream.INT:return this.readInt();case SEA3D.Stream.UINT:return this.readUInt();case SEA3D.Stream.FLOAT:return this.readFloat();case SEA3D.Stream.VECTOR3D:return this.readVector3();case SEA3D.Stream.VECTOR4D:return this.readVector4();case SEA3D.Stream.STRING_TINY:return this.readUTF8Tiny();case SEA3D.Stream.STRING_SHORT:return this.readUTF8Short();case SEA3D.Stream.STRING_LONG:return this.readUTF8Long();case SEA3D.Stream.ASSET:var a=this.readUInt();return a>0?e.getObject(a-1):null;default:console.error("DataType not found!")}return null},SEA3D.Stream.prototype.readVector=function(t,e,a){var r=SEA3D.Stream.sizeOf(t),i=a*r+e*r;switch(t){case SEA3D.Stream.BOOLEAN:case SEA3D.Stream.UBYTE:return this.readUByteArray(i);case SEA3D.Stream.USHORT:return this.readUShortArray(i);case SEA3D.Stream.UINT24:return this.readUInt24Array(i);case SEA3D.Stream.UINT:return this.readUIntArray(i);case SEA3D.Stream.FLOAT:case SEA3D.Stream.VECTOR3D:case SEA3D.Stream.VECTOR4D:return this.readFloatArray(i)}},SEA3D.Stream.prototype.append=function(t){var e=new ArrayBuffer(this.data.byteLength+t.byteLength);SEA3D.Stream.memcpy(e,0,this.data.buffer,0,this.data.byteLength),SEA3D.Stream.memcpy(e,this.data.byteLength,t,0,t.byteLength),this.buffer=e},SEA3D.Stream.prototype.concat=function(t,e){return new SEA3D.Stream(this.buffer.slice(t,t+e))},SEA3D.Stream.memcpy=function(t,e,a,r,i){var s=new Uint8Array(t,e,i),o=new Uint8Array(a,r,i);s.set(o)},SEA3D.UByteArray=function(){this.ubytes=[],this.length=0},SEA3D.UByteArray.prototype={constructor:SEA3D.UByteArray,add:function(t){this.ubytes.push(t),this.length+=t.byteLength},toBuffer:function(){for(var t=new Uint8Array(this.length),e=0,a=0;e<this.ubytes.length;e++)t.set(this.ubytes[e],a),a+=this.ubytes[e].byteLength;return t.buffer}},SEA3D.Math={RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180},SEA3D.Math.angle=function(t){var e=t<0;return(t=(e?-t:t)%360)>180&&(t=t-180-180),e?-t:t},SEA3D.Math.angleDiff=function(t,e){return t*=this.DEG_TO_RAD,e*=this.DEG_TO_RAD,Math.atan2(Math.sin(t-e),Math.cos(t-e))*this.RAD_TO_DEG},SEA3D.Math.angleArea=function(t,e,a){return Math.abs(this.angleDiff(t,e))<=a},SEA3D.Math.direction=function(t,e,a,r){return Math.atan2(r-e,a-t)},SEA3D.Math.physicalLerp=function(t,e,a,r){var i=a/r;return i>1&&(i=1),t+(e-t)*i},SEA3D.Math.physicalAngle=function(t,e,a,r){Math.abs(t-e)>180&&(t>e?e+=360:e-=360);var i=a/r;return i>1&&(i=1),this.angle(t+(e-t)*i)},SEA3D.Math.zero=function(t,e){return e=e||.001,(t<0?-t:t)-e<0&&(t=0),t},SEA3D.Math.round=function(t,e){return e=Math.pow(10,e),Math.round(t*e)/e},SEA3D.Math.lerpAngle=function(t,e,a){return Math.abs(t-e)>180&&(t>e?e+=360:e-=360),t+=(e-t)*a,SEA3D.Math.angle(t)},SEA3D.Math.lerpColor=function(t,e,a){var r=t>>24&255,i=t>>16&255,s=t>>8&255,o=255&t;return(r+=((e>>24&255)-r)*a)<<24|(i+=((e>>16&255)-i)*a)<<16|(s+=((e>>8&255)-s)*a)<<8|(o+=((255&e)-o)*a)},SEA3D.Math.lerp=function(t,e,a){return t+(e-t)*a},SEA3D.Timer=function(){this.time=this.start=Date.now()},SEA3D.Timer.prototype={constructor:SEA3D.Timer,get now(){return Date.now()},get deltaTime(){return Date.now()-this.time},get elapsedTime(){return Date.now()-this.start},update:function(){this.time=Date.now()}},SEA3D.Object=function(t,e,a,r){this.name=t,this.data=e,this.type=a,this.sea3d=r},SEA3D.GeometryBase=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.attrib=e.readUShort(),this.isBig=0!=(1&this.attrib),e.readVInt=this.isBig?e.readUInt:e.readUShort,this.numVertex=e.readVInt(),this.length=3*this.numVertex},SEA3D.Geometry=function(t,e,a){var r,i,s;if(SEA3D.GeometryBase.call(this,t,e,a),4&this.attrib&&(this.normal=e.readFloatArray(this.length)),8&this.attrib&&(this.tangent=e.readFloatArray(this.length)),32&this.attrib){var o=e.readUByte();if(o)for(this.uv=[],s=2*this.numVertex,r=0;r<o;)this.uv[r++]=e.readFloatArray(s)}if(64&this.attrib){this.jointPerVertex=e.readUByte();var n=this.numVertex*this.jointPerVertex;this.joint=e.readUShortArray(n),this.weight=e.readFloatArray(n)}if(128&this.attrib){var h=e.readUByte(),d=e.readUByte();if(d)for(this.numColor=1+((64&h)>>6|(128&h)>>6),this.color=[],r=0;r<d;r++)this.color.push(e.readFloatArray(this.numVertex*this.numColor))}this.vertex=e.readFloatArray(this.length);var S=e.readUByte();if(this.groups=[],1024&this.attrib){for(r=0,s=0;r<S;r++)i=3*e.readVInt(),this.groups.push({start:s,count:i}),s+=i;2048&this.attrib||(this.indexes=this.isBig?e.readUIntArray(s):e.readUShortArray(s))}else{var A=this.isBig?4:2,p=new SEA3D.UByteArray;for(r=0,i=0;r<S;r++)s=3*e.readVInt(),this.groups.push({start:i,count:s}),i+=s,p.add(e.readUByteArray(s*A));this.indexes=this.isBig?new Uint32Array(p.toBuffer()):new Uint16Array(p.toBuffer())}},SEA3D.Geometry.prototype=Object.create(SEA3D.GeometryBase.prototype),SEA3D.Geometry.prototype.constructor=SEA3D.Geometry,SEA3D.Geometry.prototype.type="geo",SEA3D.Object3D=function(t,e,a){if(this.name=t,this.data=e,this.sea3d=a,this.isStatic=!1,this.visible=!0,this.attrib=e.readUShort(),1&this.attrib&&(this.parent=a.getObject(e.readUInt())),2&this.attrib&&(this.animations=e.readAnimationList(a)),4&this.attrib&&(this.scripts=e.readScriptList(a)),16&this.attrib&&(this.attributes=a.getObject(e.readUInt())),32&this.attrib){var r=e.readUByte();this.isStatic=0!=(1&r),this.visible=0==(2&r)}},SEA3D.Object3D.prototype.readTag=function(t,e,a){},SEA3D.Entity3D=function(t,e,a){if(SEA3D.Object3D.call(this,t,e,a),this.castShadows=!0,64&this.attrib){var r=e.readUByte();this.castShadows=0==(1&r)}},SEA3D.Entity3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Entity3D.prototype.constructor=SEA3D.Entity3D,SEA3D.Sound3D=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),this.autoPlay=0!=(64&this.attrib),128&this.attrib&&(this.mixer=a.getObject(e.readUInt())),this.sound=a.getObject(e.readUInt()),this.volume=e.readFloat()},SEA3D.Sound3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Sound3D.prototype.constructor=SEA3D.Sound3D,SEA3D.SoundPoint=function(t,e,a){SEA3D.Sound3D.call(this,t,e,a),this.position=e.readVector3(),this.distance=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.SoundPoint.prototype=Object.create(SEA3D.Sound3D.prototype),SEA3D.SoundPoint.prototype.constructor=SEA3D.SoundPoint,SEA3D.SoundPoint.prototype.type="sp",SEA3D.Container3D=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),this.transform=e.readMatrix(),e.readTags(this.readTag.bind(this))},SEA3D.Container3D.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Container3D.prototype.constructor=SEA3D.Container3D,SEA3D.Container3D.prototype.type="c3d",SEA3D.ScriptURL=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.url=e.readUTF8(e.length)},SEA3D.ScriptURL.prototype.type="src",SEA3D.TextureURL=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.url=a.config.path+e.readUTF8(e.length)},SEA3D.TextureURL.prototype.type="urlT",SEA3D.CubeMapURL=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.faces=[];for(var r=0;r<6;r++)this.faces[r]=e.readUTF8Tiny()},SEA3D.CubeMapURL.prototype.type="cURL",SEA3D.Actions=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.count=e.readUInt(),this.actions=[];for(var r=0;r<this.count;r++){var i=e.readUByte(),s=e.readUShort(),o=e.readUShort(),n=e.position,h=this.actions[r]={kind:s};switch(1&i&&(h.range=[e.readUInt(),e.readUInt()]),2&i&&(h.time=e.readUInt()),4&i&&(h.intrpl=e.readInterpolation(),0==h.intrpl.indexOf("back.")?h.intrplParam0=e.readFloat():0==h.intrpl.indexOf("elastic.")&&(h.intrplParam0=e.readFloat(),h.intrplParam1=e.readFloat())),s){case SEA3D.Actions.RTT_TARGET:case SEA3D.Actions.LOOK_AT:h.source=a.getObject(e.readUInt()),h.target=a.getObject(e.readUInt());break;case SEA3D.Actions.PLAY_SOUND:h.sound=a.getObject(e.readUInt()),h.offset=e.readUInt();break;case SEA3D.Actions.PLAY_ANIMATION:h.object=a.getObject(e.readUInt()),h.name=e.readUTF8Tiny();break;case SEA3D.Actions.FOG:h.color=e.readUInt24(),h.min=e.readFloat(),h.max=e.readFloat();break;case SEA3D.Actions.ENVIRONMENT:h.texture=a.getObject(e.readUInt());break;case SEA3D.Actions.ENVIRONMENT_COLOR:h.color=e.readUInt24F();break;case SEA3D.Actions.CAMERA:h.camera=a.getObject(e.readUInt());break;case SEA3D.Actions.SCRIPTS:h.scripts=e.readScriptList(a);break;case SEA3D.Actions.CLASS_OF:h.classof=a.getObject(e.readUInt());break;case SEA3D.Actions.ATTRIBUTES:h.attributes=a.getObject(e.readUInt());break;default:console.log('Action "'+s+'" not found.')}e.position=n+o}},SEA3D.Actions.SCENE=0,SEA3D.Actions.ENVIRONMENT_COLOR=1,SEA3D.Actions.ENVIRONMENT=2,SEA3D.Actions.FOG=3,SEA3D.Actions.PLAY_ANIMATION=4,SEA3D.Actions.PLAY_SOUND=5,SEA3D.Actions.ANIMATION_AUDIO_SYNC=6,SEA3D.Actions.LOOK_AT=7,SEA3D.Actions.RTT_TARGET=8,SEA3D.Actions.CAMERA=9,SEA3D.Actions.SCRIPTS=10,SEA3D.Actions.CLASS_OF=11,SEA3D.Actions.ATTRIBUTES=12,SEA3D.Actions.prototype.type="act",SEA3D.Properties=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.props=e.readProperties(a),this.props.__name=t},SEA3D.Properties.prototype.type="prop",SEA3D.FileInfo=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.info=e.readProperties(a),this.info.__name=t,a.info=this.info},SEA3D.FileInfo.prototype.type="info",SEA3D.JavaScript=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.src=e.readUTF8(e.length)},SEA3D.JavaScript.prototype.type="js",SEA3D.JavaScriptMethod=function(t,e,a){this.name=t,this.data=e,this.sea3d=a;var r=e.readUShort();this.methods={};for(var i=0;i<r;i++){e.readUByte();var s=e.readUTF8Tiny();this.methods[s]={src:e.readUTF8Long()}}},SEA3D.JavaScriptMethod.prototype.type="jsm",SEA3D.GLSL=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.src=e.readUTF8(e.length)},SEA3D.GLSL.prototype.type="glsl",SEA3D.Dummy=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),this.transform=e.readMatrix(),this.width=e.readFloat(),this.height=e.readFloat(),this.depth=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.Dummy.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Dummy.prototype.constructor=SEA3D.Dummy,SEA3D.Dummy.prototype.type="dmy",SEA3D.Line=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),this.count=3*(64&this.attrib?e.readUInt():e.readUShort()),this.closed=0!=(128&this.attrib),this.transform=e.readMatrix(),this.vertex=[];for(var r=0;r<this.count;)this.vertex[r++]=e.readFloat();e.readTags(this.readTag.bind(this))},SEA3D.Line.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Line.prototype.constructor=SEA3D.Line,SEA3D.Line.prototype.type="line",SEA3D.Sprite=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),256&this.attrib&&(this.material=a.getObject(e.readUInt())),this.position=e.readVector3(),this.width=e.readFloat(),this.height=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.Sprite.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Sprite.prototype.constructor=SEA3D.Sprite,SEA3D.Sprite.prototype.type="m2d",SEA3D.Mesh=function(t,e,a){if(SEA3D.Entity3D.call(this,t,e,a),256&this.attrib)if(this.material=[],1==(s=e.readUByte()))this.material[0]=a.getObject(e.readUInt());else for(var r=0;r<s;){var i=e.readUInt();this.material[r++]=i>0?a.getObject(i-1):void 0}if(512&this.attrib){this.modifiers=[];var s=e.readUByte();for(r=0;r<s;r++)this.modifiers[r]=a.getObject(e.readUInt())}1024&this.attrib&&(this.reference={type:e.readUByte(),ref:a.getObject(e.readUInt())}),this.transform=e.readMatrix(),this.geometry=a.getObject(e.readUInt()),e.readTags(this.readTag.bind(this))},SEA3D.Mesh.prototype=Object.create(SEA3D.Entity3D.prototype),SEA3D.Mesh.prototype.constructor=SEA3D.Mesh,SEA3D.Mesh.prototype.type="m3d",SEA3D.Skeleton=function(t,e,a){this.name=t,this.data=e,this.sea3d=a;var r=e.readUShort();this.joint=[];for(var i=0;i<r;i++)this.joint[i]={name:e.readUTF8Tiny(),parentIndex:e.readUShort()-1,inverseBindMatrix:e.readMatrix()}},SEA3D.Skeleton.prototype.type="skl",SEA3D.SkeletonLocal=function(t,e,a){this.name=t,this.data=e,this.sea3d=a;var r=e.readUShort();this.joint=[];for(var i=0;i<r;i++)this.joint[i]={name:e.readUTF8Tiny(),parentIndex:e.readUShort()-1,x:e.readFloat(),y:e.readFloat(),z:e.readFloat(),qx:e.readFloat(),qy:e.readFloat(),qz:e.readFloat(),qw:e.readFloat()}},SEA3D.SkeletonLocal.prototype.type="sklq",SEA3D.AnimationBase=function(t,e,a){this.name=t,this.data=e,this.sea3d=a;var r=e.readUByte();if(this.sequence=[],1&r)for(var i=e.readUShort(),s=0;s<i;s++){var o=e.readUByte();this.sequence[s]={name:e.readUTF8Tiny(),start:e.readUInt(),count:e.readUInt(),repeat:0!=(1&o),intrpl:0==(2&o)}}this.frameRate=e.readUByte(),this.numFrames=e.readUInt(),0==this.sequence.length&&(this.sequence[0]={name:"root",start:0,count:this.numFrames,repeat:!0,intrpl:!0})},SEA3D.Animation=function(t,e,a){SEA3D.AnimationBase.call(this,t,e,a),this.dataList=[];for(var r=0,i=e.readUByte();r<i;r++){var s=e.readUShort(),o=e.readUByte(),n=e.readVector(o,this.numFrames,0);this.dataList.push({kind:s,type:o,blockSize:SEA3D.Stream.sizeOf(o),data:n})}},SEA3D.Animation.POSITION=0,SEA3D.Animation.ROTATION=1,SEA3D.Animation.SCALE=2,SEA3D.Animation.COLOR=3,SEA3D.Animation.MULTIPLIER=4,SEA3D.Animation.ATTENUATION_START=5,SEA3D.Animation.ATTENUATION_END=6,SEA3D.Animation.FOV=7,SEA3D.Animation.OFFSET_U=8,SEA3D.Animation.OFFSET_V=9,SEA3D.Animation.SCALE_U=10,SEA3D.Animation.SCALE_V=11,SEA3D.Animation.ANGLE=12,SEA3D.Animation.ALPHA=13,SEA3D.Animation.VOLUME=14,SEA3D.Animation.MORPH=250,SEA3D.Animation.prototype=Object.create(SEA3D.AnimationBase.prototype),SEA3D.Animation.prototype.constructor=SEA3D.Animation,SEA3D.Animation.prototype.type="anm",SEA3D.SkeletonAnimation=function(t,e,a){SEA3D.AnimationBase.call(this,t,e,a),this.name=t,this.data=e,this.sea3d=a,this.numJoints=e.readUShort(),this.raw=e.readFloatArray(this.numFrames*this.numJoints*7)},SEA3D.SkeletonAnimation.prototype.type="skla",SEA3D.UVWAnimation=function(t,e,a){SEA3D.Animation.call(this,t,e,a)},SEA3D.UVWAnimation.prototype.type="auvw",SEA3D.Morph=function(t,e,a){SEA3D.GeometryBase.call(this,t,e,a);var r=0!=(2&this.attrib),i=0!=(4&this.attrib),s=e.readUShort();this.node=[];for(var o=0;o<s;o++){var n,h,d=e.readUTF8Tiny();r&&(n=e.readFloatArray(this.length)),i&&(h=e.readFloatArray(this.length)),this.node[o]={vertex:n,normal:h,name:d}}},SEA3D.Morph.prototype=Object.create(SEA3D.GeometryBase.prototype),SEA3D.Morph.prototype.constructor=SEA3D.Morph,SEA3D.Morph.prototype.type="mph",SEA3D.MorphAnimation=function(t,e,a){SEA3D.AnimationBase.call(this,t,e,a),this.dataList=[];for(var r=0,i=e.readUByte();r<i;r++)this.dataList.push({kind:SEA3D.Animation.MORPH,type:SEA3D.Stream.FLOAT,name:e.readUTF8Tiny(),blockSize:1,data:e.readVector(SEA3D.Stream.FLOAT,this.numFrames,0)})},SEA3D.MorphAnimation.prototype.type="mpha",SEA3D.VertexAnimation=function(t,e,a){SEA3D.AnimationBase.call(this,t,e,a);var r=e.readUByte();this.isBig=0!=(1&r),e.readVInt=this.isBig?e.readUInt:e.readUShort,this.numVertex=e.readVInt(),this.length=3*this.numVertex;var i,s,o,n=0!=(2&r),h=0!=(4&r);for(this.frame=[],i=0;i<this.numFrames;i++)n&&(s=e.readFloatArray(this.length)),h&&(o=e.readFloatArray(this.length)),this.frame[i]={vertex:s,normal:o}},SEA3D.VertexAnimation.prototype=Object.create(SEA3D.AnimationBase.prototype),SEA3D.VertexAnimation.prototype.constructor=SEA3D.VertexAnimation,SEA3D.VertexAnimation.prototype.type="vtxa",SEA3D.Camera=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),64&this.attrib&&(this.dof={distance:e.readFloat(),range:e.readFloat()}),this.transform=e.readMatrix(),this.fov=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.Camera.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Camera.prototype.constructor=SEA3D.Camera,SEA3D.Camera.prototype.type="cam",SEA3D.OrthographicCamera=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),this.transform=e.readMatrix(),this.height=e.readFloat(),e.readTags(this.readTag.bind(this))},SEA3D.OrthographicCamera.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.OrthographicCamera.prototype.constructor=SEA3D.OrthographicCamera,SEA3D.OrthographicCamera.prototype.type="camo",SEA3D.JointObject=function(t,e,a){SEA3D.Object3D.call(this,t,e,a),this.target=a.getObject(e.readUInt()),this.joint=e.readUShort(),e.readTags(this.readTag.bind(this))},SEA3D.JointObject.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.JointObject.prototype.constructor=SEA3D.JointObject,SEA3D.JointObject.prototype.type="jnt",SEA3D.Light=function(t,e,a){if(SEA3D.Object3D.call(this,t,e,a),this.attenStart=Number.MAX_VALUE,this.attenEnd=Number.MAX_VALUE,64&this.attrib){var r=e.readUByte();this.shadow={},this.shadow.opacity=1&r?e.readFloat():1,this.shadow.color=2&r?e.readUInt24():0}512&this.attrib&&(this.attenStart=e.readFloat(),this.attenEnd=e.readFloat()),this.color=e.readUInt24(),this.multiplier=e.readFloat()},SEA3D.Light.prototype=Object.create(SEA3D.Object3D.prototype),SEA3D.Light.prototype.constructor=SEA3D.Light,SEA3D.PointLight=function(t,e,a){SEA3D.Light.call(this,t,e,a),128&this.attrib&&(this.attenuation={start:e.readFloat(),end:e.readFloat()}),this.position=e.readVector3(),e.readTags(this.readTag.bind(this))},SEA3D.PointLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.PointLight.prototype.constructor=SEA3D.PointLight,SEA3D.PointLight.prototype.type="plht",SEA3D.HemisphereLight=function(t,e,a){SEA3D.Light.call(this,t,e,a),128&this.attrib&&(this.attenuation={start:e.readFloat(),end:e.readFloat()}),this.secondColor=e.readUInt24(),e.readTags(this.readTag.bind(this))},SEA3D.HemisphereLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.HemisphereLight.prototype.constructor=SEA3D.HemisphereLight,SEA3D.HemisphereLight.prototype.type="hlht",SEA3D.AmbientLight=function(t,e,a){SEA3D.Light.call(this,t,e,a),e.readTags(this.readTag.bind(this))},SEA3D.AmbientLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.AmbientLight.prototype.constructor=SEA3D.AmbientLight,SEA3D.AmbientLight.prototype.type="alht",SEA3D.DirectionalLight=function(t,e,a){SEA3D.Light.call(this,t,e,a),this.transform=e.readMatrix(),e.readTags(this.readTag.bind(this))},SEA3D.DirectionalLight.prototype=Object.create(SEA3D.Light.prototype),SEA3D.DirectionalLight.prototype.constructor=SEA3D.DirectionalLight,SEA3D.DirectionalLight.prototype.type="dlht",SEA3D.Material=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.technique=[],this.tecniquesDict={},this.attrib=e.readUShort(),this.alpha=1,this.blendMode="normal",this.doubleSided=0!=(1&this.attrib),this.receiveLights=0==(2&this.attrib),this.receiveShadows=0==(4&this.attrib),this.receiveFog=0==(8&this.attrib),this.repeat=0==(16&this.attrib),32&this.attrib&&(this.alpha=e.readFloat()),64&this.attrib&&(this.blendMode=e.readBlendMode()),128&this.attrib&&(this.animations=e.readAnimationList(a)),this.depthWrite=0==(256&this.attrib),this.depthTest=0==(512&this.attrib),this.premultipliedAlpha=0!=(1024&this.attrib);for(var r=e.readUByte(),i=0;i<r;++i){var s,o,n=e.readUShort(),h=e.readUShort(),d=e.position;switch(n){case SEA3D.Material.PHONG:s={ambientColor:e.readUInt24(),diffuseColor:e.readUInt24(),specularColor:e.readUInt24(),specular:e.readFloat(),gloss:e.readFloat()};break;case SEA3D.Material.PHYSICAL:s={color:e.readUInt24(),roughness:e.readFloat(),metalness:e.readFloat()};break;case SEA3D.Material.ANISOTROPIC:break;case SEA3D.Material.COMPOSITE_TEXTURE:s={composite:a.getObject(e.readUInt())};break;case SEA3D.Material.DIFFUSE_MAP:case SEA3D.Material.SPECULAR_MAP:case SEA3D.Material.NORMAL_MAP:case SEA3D.Material.AMBIENT_MAP:case SEA3D.Material.ALPHA_MAP:case SEA3D.Material.EMISSIVE_MAP:case SEA3D.Material.ROUGHNESS_MAP:case SEA3D.Material.METALNESS_MAP:s={texture:a.getObject(e.readUInt())};break;case SEA3D.Material.REFLECTION:case SEA3D.Material.FRESNEL_REFLECTION:s={texture:a.getObject(e.readUInt()),alpha:e.readFloat()},n==SEA3D.Material.FRESNEL_REFLECTION&&(s.power=e.readFloat(),s.normal=e.readFloat());break;case SEA3D.Material.REFRACTION:s={texture:a.getObject(e.readUInt()),alpha:e.readFloat(),ior:e.readFloat()};break;case SEA3D.Material.RIM:s={color:e.readUInt24(),strength:e.readFloat(),power:e.readFloat(),blendMode:e.readBlendMode()};break;case SEA3D.Material.LIGHT_MAP:s={texture:a.getObject(e.readUInt()),channel:e.readUByte(),blendMode:e.readBlendMode()};break;case SEA3D.Material.DETAIL_MAP:s={texture:a.getObject(e.readUInt()),scale:e.readFloat(),blendMode:e.readBlendMode()};break;case SEA3D.Material.CEL:s={color:e.readUInt24(),levels:e.readUByte(),size:e.readFloat(),specularCutOff:e.readFloat(),smoothness:e.readFloat()};break;case SEA3D.Material.TRANSLUCENT:s={translucency:e.readFloat(),scattering:e.readFloat()};break;case SEA3D.Material.BLEND_NORMAL_MAP:o=e.readUByte(),s={texture:a.getObject(e.readUInt()),secondaryTexture:a.getObject(e.readUInt())},1&o?(s.offsetX0=e.readFloat(),s.offsetY0=e.readFloat(),s.offsetX1=e.readFloat(),s.offsetY1=e.readFloat()):s.offsetX0=s.offsetY0=s.offsetX1=s.offsetY1=0,s.animate=2&o;break;case SEA3D.Material.MIRROR_REFLECTION:s={texture:a.getObject(e.readUInt()),alpha:e.readFloat()};break;case SEA3D.Material.EMISSIVE:s={color:e.readUInt24F()};break;case SEA3D.Material.VERTEX_COLOR:s={blendMode:e.readBlendMode()};break;case SEA3D.Material.WRAP_LIGHTING:s={color:e.readUInt24(),strength:e.readFloat()};break;case SEA3D.Material.COLOR_REPLACE:o=e.readUByte(),s={red:e.readUInt24(),green:e.readUInt24(),blue:e.readUInt24F()},1&o&&(s.mask=a.getObject(e.readUInt())),2&o&&(s.alpha=e.readFloat());break;case SEA3D.Material.REFLECTION_SPHERICAL:s={texture:a.getObject(e.readUInt()),alpha:e.readFloat()};break;case SEA3D.Material.REFLECTIVITY:o=e.readUByte(),s={strength:e.readFloat()},1&o&&(s.mask=a.getObject(e.readUInt()));break;case SEA3D.Material.CLEAR_COAT:s={strength:e.readFloat(),roughness:e.readFloat()};break;case SEA3D.Material.FLACCIDITY:o=e.readUByte(),s={target:a.getObject(e.readUInt()),scale:e.readFloat(),spring:e.readFloat(),damping:e.readFloat()},1&o&&(s.mask=a.getObject(e.readUInt()));break;default:console.warn("SEA3D: MaterialTechnique not found:",n.toString(16)),e.position=d+=h;continue}s.kind=n,this.technique.push(s),this.tecniquesDict[n]=s,e.position=d+=h}},SEA3D.Material.PHONG=0,SEA3D.Material.COMPOSITE_TEXTURE=1,SEA3D.Material.DIFFUSE_MAP=2,SEA3D.Material.SPECULAR_MAP=3,SEA3D.Material.REFLECTION=4,SEA3D.Material.REFRACTION=5,SEA3D.Material.NORMAL_MAP=6,SEA3D.Material.FRESNEL_REFLECTION=7,SEA3D.Material.RIM=8,SEA3D.Material.LIGHT_MAP=9,SEA3D.Material.DETAIL_MAP=10,SEA3D.Material.CEL=11,SEA3D.Material.TRANSLUCENT=12,SEA3D.Material.BLEND_NORMAL_MAP=13,SEA3D.Material.MIRROR_REFLECTION=14,SEA3D.Material.AMBIENT_MAP=15,SEA3D.Material.ALPHA_MAP=16,SEA3D.Material.EMISSIVE_MAP=17,SEA3D.Material.VERTEX_COLOR=18,SEA3D.Material.WRAP_LIGHTING=19,SEA3D.Material.COLOR_REPLACE=20,SEA3D.Material.REFLECTION_SPHERICAL=21,SEA3D.Material.ANISOTROPIC=22,SEA3D.Material.EMISSIVE=23,SEA3D.Material.PHYSICAL=24,SEA3D.Material.ROUGHNESS_MAP=25,SEA3D.Material.METALNESS_MAP=26,SEA3D.Material.REFLECTIVITY=27,SEA3D.Material.CLEAR_COAT=28,SEA3D.Material.FLACCIDITY=29,SEA3D.Material.prototype.type="mat",SEA3D.Composite=function(t,e,a){this.name=t,this.data=e,this.sea3d=a;var r=e.readUByte();this.layer=[];for(var i=0;i<r;i++)this.layer[i]=new SEA3D.Composite.prototype.Layer(e,a)},SEA3D.Composite.prototype.getLayerByName=function(t){for(var e=0;e<this.layer.length;e++)if(this.layer[e].name==t)return this.layer[e]},SEA3D.Composite.prototype.Layer=function(t,e){var a=t.readUShort();1&a?this.texture=new SEA3D.Composite.LayerBitmap(t,e):this.color=t.readUInt24(),2&a&&(this.mask=new SEA3D.Composite.LayerBitmap(t,e)),4&a&&(this.name=t.readUTF8Tiny()),this.blendMode=8&a?t.readBlendMode():"normal",this.opacity=16&a?t.readFloat():1},SEA3D.Composite.LayerBitmap=function(t,e){this.map=e.getObject(t.readUInt());var a=t.readUShort();this.channel=1&a?t.readUByte():0,this.repeat=!1&a,this.offsetU=4&a?t.readFloat():0,this.offsetV=8&a?t.readFloat():0,this.scaleU=16&a?t.readFloat():1,this.scaleV=32&a?t.readFloat():1,this.rotation=64&a?t.readFloat():0,128&a&&(this.animation=t.readAnimationList(e))},SEA3D.Composite.prototype.type="ctex",SEA3D.PlanarRender=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.attrib=e.readUByte(),this.quality=1&this.attrib|2&this.attrib,this.transform=e.readMatrix()},SEA3D.PlanarRender.prototype.type="rttp",SEA3D.CubeRender=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.attrib=e.readUByte(),this.quality=1&this.attrib|2&this.attrib,this.position=e.readVector3()},SEA3D.CubeRender.prototype.type="rttc",SEA3D.CubeMap=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.transparent=!1,this.extension=e.readExt(),this.faces=[];for(var r=0;r<6;r++){var i=e.readUInt();this.faces[r]=e.concat(e.position,i),e.position+=i}},SEA3D.CubeMap.prototype.type="cmap",SEA3D.JPEG=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.transparent=!1},SEA3D.JPEG.prototype.type="jpg",SEA3D.JPEG_XR=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.transparent=!0},SEA3D.JPEG_XR.prototype.type="wdp",SEA3D.PNG=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.transparent=6==e.getByte(25)},SEA3D.PNG.prototype.type="png",SEA3D.GIF=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.transparent=e.getByte(11)>0},SEA3D.GIF.prototype.type="gif",SEA3D.OGG=function(t,e,a){this.name=t,this.data=e,this.sea3d=a},SEA3D.OGG.prototype.type="ogg",SEA3D.MP3=function(t,e,a){this.name=t,this.data=e,this.sea3d=a},SEA3D.MP3.prototype.type="mp3",SEA3D.TextureUpdate=function(t,e,a){this.name=t,this.data=e,this.sea3d=a,this.index=e.readUInt(),this.bytes=e.concat(e.position,e.length-e.position)},SEA3D.TextureUpdate.prototype.type="uTex",SEA3D.File=function(t){this.config={streaming:!0,timeLimit:60,progressive:!1},t&&(void 0!==t.streaming&&(this.config.streaming=t.streaming),void 0!==t.timeLimit&&(this.config.timeLimit=t.timeLimit),void 0!==t.progressive&&(this.config.progressive=t.progressive),void 0!==t.path&&(this.config.path=t.path)),this.version=SEA3D.VERSION,this.objects=[],this.typeClass={},this.typeRead={},this.typeUnique={},this.position=this.dataPosition=0,this.scope=this,this.addClass(SEA3D.FileInfo,!0),this.addClass(SEA3D.Geometry,!0),this.addClass(SEA3D.Mesh),this.addClass(SEA3D.Sprite),this.addClass(SEA3D.Material),this.addClass(SEA3D.Composite),this.addClass(SEA3D.PointLight),this.addClass(SEA3D.DirectionalLight),this.addClass(SEA3D.HemisphereLight),this.addClass(SEA3D.AmbientLight),this.addClass(SEA3D.Animation,!0),this.addClass(SEA3D.Skeleton,!0),this.addClass(SEA3D.SkeletonLocal,!0),this.addClass(SEA3D.SkeletonAnimation,!0),this.addClass(SEA3D.UVWAnimation,!0),this.addClass(SEA3D.JointObject),this.addClass(SEA3D.Camera),this.addClass(SEA3D.OrthographicCamera),this.addClass(SEA3D.Morph,!0),this.addClass(SEA3D.MorphAnimation,!0),this.addClass(SEA3D.VertexAnimation,!0),this.addClass(SEA3D.CubeMap,!0),this.addClass(SEA3D.Dummy),this.addClass(SEA3D.Line),this.addClass(SEA3D.SoundPoint),this.addClass(SEA3D.PlanarRender),this.addClass(SEA3D.CubeRender),this.addClass(SEA3D.Actions),this.addClass(SEA3D.Container3D),this.addClass(SEA3D.Properties),this.addClass(SEA3D.ScriptURL,!0),this.addClass(SEA3D.TextureURL,!0),this.addClass(SEA3D.CubeMapURL,!0),this.addClass(SEA3D.JPEG,!0),this.addClass(SEA3D.JPEG_XR,!0),this.addClass(SEA3D.PNG,!0),this.addClass(SEA3D.GIF,!0),this.addClass(SEA3D.OGG,!0),this.addClass(SEA3D.MP3,!0),this.addClass(SEA3D.JavaScript,!0),this.addClass(SEA3D.JavaScriptMethod,!0),this.addClass(SEA3D.GLSL,!0),this.addClass(SEA3D.TextureUpdate,!0);for(var e=SEA3D.File.Extensions.length;e--;)SEA3D.File.Extensions[e].call(this)},SEA3D.File.Extensions=[],SEA3D.File.CompressionLibs={},SEA3D.File.DecompressionMethod={},SEA3D.File.setExtension=function(t){SEA3D.File.Extensions.push(t)},SEA3D.File.setDecompressionEngine=function(t,e,a){SEA3D.File.CompressionLibs[t]=e,SEA3D.File.DecompressionMethod[t]=a},SEA3D.File.prototype.addClass=function(t,e){this.typeClass[t.prototype.type]=t,this.typeUnique[t.prototype.type]=!0===e},SEA3D.File.prototype.readHead=function(){if(this.stream.bytesAvailable<16)return!1;if("SEA"!=this.stream.readUTF8(3))throw new Error("Invalid SEA3D format.");if(this.sign=this.stream.readUTF8(3),this.version=this.stream.readUInt24(),0!=this.stream.readUByte())throw new Error("Protection algorithm not compatible.");if(this.compressionID=this.stream.readUByte(),this.compressionAlgorithm=SEA3D.File.CompressionLibs[this.compressionID],this.decompressionMethod=SEA3D.File.DecompressionMethod[this.compressionID],this.compressionID>0&&!this.decompressionMethod)throw new Error("Compression algorithm not compatible.");return this.length=this.stream.readUInt(),this.dataPosition=this.stream.position,this.objects.length=0,this.state=this.readBody,this.onHead&&this.onHead({file:this,sign:this.sign}),!0},SEA3D.File.prototype.getObject=function(t){return this.objects[t]},SEA3D.File.prototype.getObjectByName=function(t){return this.objects[t]},SEA3D.File.prototype.readSEAObject=function(){if(this.stream.bytesAvailable<4)return null;var t=this.stream.readUInt(),e=this.stream.position;if(this.stream.bytesAvailable<t)return null;var a=this.stream.readUByte(),r=this.stream.readExt(),i=null,s=1&a?this.stream.readUTF8Tiny():"",o=0!=(2&a),n=0!=(4&a);if(8&a){var h=this.stream.readUShort(),d=this.stream.concat(this.stream.position,h);this.stream.position+=h,o&&this.decompressionMethod&&(d.buffer=this.decompressionMethod(d.buffer)),i=d.readProperties(this)}t-=this.stream.position-e,e=this.stream.position;var S,A=this.stream.concat(e,t);return this.typeClass[r]?(o&&this.decompressionMethod&&(A.buffer=this.decompressionMethod(A.buffer)),S=new this.typeClass[r](s,A,this),(this.config.streaming&&n||this.config.forceStreaming)&&this.typeRead[r]&&this.typeRead[r].call(this.scope,S)):(S=new SEA3D.Object(s,A,r,this),console.warn('SEA3D: Unknown format "'+r+'" of file "'+s+'". Add a module referring for this format.')),S.streaming=n,S.metadata=i,this.objects.push(this.objects[S.name+"."+S.type]=S),this.dataPosition=e+t,++this.position,S},SEA3D.File.prototype.isDone=function(){return this.position==this.length},SEA3D.File.prototype.readBody=function(){if(this.timer.update(),!this.resume)return!1;for(;this.position<this.length;){if(!(this.timer.deltaTime<this.config.timeLimit))return!1;this.stream.position=this.dataPosition;var t=this.readSEAObject();if(!t)return!1;this.dispatchCompleteObject(t)}return this.state=this.readComplete,!0},SEA3D.File.prototype.initParse=function(){this.timer=new SEA3D.Timer,this.position=0,this.resume=!0},SEA3D.File.prototype.parse=function(){this.initParse(),isFinite(this.config.timeLimit)?requestAnimationFrame(this.parseObject.bind(this)):this.parseObject()},SEA3D.File.prototype.parseObject=function(){for(this.timer.update();this.position<this.length&&this.timer.deltaTime<this.config.timeLimit;){var t=this.objects[this.position++],e=t.type;this.typeUnique[e]||delete t.tag,(t.streaming||this.config.forceStreaming)&&this.typeRead[e]&&void 0==t.tag&&this.typeRead[e].call(this.scope,t)}if(this.position==this.length){var a=this.timer.elapsedTime,r=a+"ms, "+this.objects.length+" objects";this.onParseComplete?this.onParseComplete({file:this,timeTotal:a,message:r}):console.log("SEA3D Parse Complete:",r)}else this.onParseProgress&&this.onParseProgress({file:this,loaded:this.position,total:this.length}),setTimeout(this.parseObject.bind(this),10)},SEA3D.File.prototype.readComplete=function(){return this.stream.position=this.dataPosition,6202321!=this.stream.readUInt24F()&&console.warn("SEA3D file is corrupted."),delete this.state,!1},SEA3D.File.prototype.readState=function(){for(;this.state();)continue;this.state?(requestAnimationFrame(this.readState.bind(this)),this.dispatchProgress()):this.dispatchComplete()},SEA3D.File.prototype.append=function(t){this.state?this.stream.append(t):this.read(t)},SEA3D.File.prototype.read=function(t){if(!t)throw new Error("No data found.");this.initParse(),this.stream=new SEA3D.Stream(t),this.state=this.readHead,this.readState()},SEA3D.File.prototype.dispatchCompleteObject=function(t){this.onCompleteObject&&this.onCompleteObject({file:this,object:t})},SEA3D.File.prototype.dispatchProgress=function(){this.onProgress&&this.onProgress({file:this,loaded:this.position,total:this.length})},SEA3D.File.prototype.dispatchDownloadProgress=function(t,e){this.onDownloadProgress&&this.onDownloadProgress({file:this,loaded:t,total:e})},SEA3D.File.prototype.dispatchComplete=function(){var t=this.timer.elapsedTime,e=t+"ms, "+this.objects.length+" objects";this.onComplete?this.onComplete({file:this,timeTotal:t,message:e}):console.log("SEA3D:",e)},SEA3D.File.prototype.dispatchError=function(t,e){this.onError?this.onError({file:this,id:t,message:e}):console.error("SEA3D: #"+t,e)},SEA3D.File.prototype.load=function(t){var e=this,a=new XMLHttpRequest;if(a.open("GET",t,!0),this.config.path||(this.config.path=THREE.LoaderUtils.extractUrlBase(t)),e.config.progressive){var r=0;a.overrideMimeType("text/plain; charset=x-user-defined")}else a.responseType="arraybuffer";a.onprogress=function(t){if(e.config.progressive){for(var i=a.responseText.substring(r),s=new Uint8Array(i.length),o=0;o<i.length;o++)s[o]=255&i.charCodeAt(o);r+=i.length,e.append(s.buffer)}e.dispatchDownloadProgress(t.loaded,t.total)},e.config.progressive||(a.onreadystatechange=function(){4===a.readyState&&(200===a.status||0===a.status?e.read(this.response):this.dispatchError(1001,"Couldn't load ["+t+"] ["+a.status+"]"))}),a.send()};