THREE.ThreeMFLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.availableExtensions=[]},THREE.ThreeMFLoader.prototype={constructor:THREE.ThreeMFLoader,load:function(e,t,r,a){var n=this,o=new THREE.FileLoader(n.manager);o.setResponseType("arraybuffer"),o.load(e,function(e){t(n.parse(e))},r,a)},parse:function(e){var t=this;function r(e){var t={type:e.getAttribute("type")},r=e.getAttribute("id");r&&(t.id=r);var a=e.getAttribute("pid");a&&(t.pid=a);var n=e.getAttribute("pindex");n&&(t.pindex=n);var o=e.getAttribute("thumbnail");o&&(t.thumbnail=o);var i=e.getAttribute("partnumber");i&&(t.partnumber=i);var s=e.getAttribute("name");s&&(t.name=s);var l=e.querySelector("mesh");l&&(t.mesh=function(e,t){for(var r={},a=[],n=e.querySelectorAll("vertices vertex"),o=0;o<n.length;o++){var i=n[o],s=i.getAttribute("x"),l=i.getAttribute("y"),u=i.getAttribute("z");a.push(parseFloat(s),parseFloat(l),parseFloat(u))}for(r.vertices=new Float32Array(a.length),o=0;o<a.length;o++)r.vertices[o]=a[o];var c=[],g=[],p=e.querySelectorAll("triangles triangle");for(o=0;o<p.length;o++){var f=p[o],d=f.getAttribute("v1"),h=f.getAttribute("v2"),v=f.getAttribute("v3"),b=f.getAttribute("p1"),m=f.getAttribute("p2"),E=f.getAttribute("p3"),A=f.getAttribute("pid");g.push(parseInt(d,10),parseInt(h,10),parseInt(v,10));var y={};b&&(y.p1=parseInt(b,10)),m&&(y.p2=parseInt(m,10)),E&&(y.p3=parseInt(E,10)),A&&(y.pid=A),0<Object.keys(y).length&&c.push(y)}for(r.triangleProperties=c,r.triangles=new Uint32Array(g.length),o=0;o<g.length;o++)r.triangles[o]=g[o];return r}(l));var u=e.querySelector("components");return u&&(t.components=void 0),t}function a(e){var t={unit:e.getAttribute("unit")||"millimeter"},a=e.querySelectorAll("metadata");a&&(t.metadata=function(e){for(var t={},r=0;r<e.length;r++){var a=e[r],n=a.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(n)&&(t[n]=a.textContent)}return t}(a));var n=e.querySelector("resources");n&&(t.resources=function(e){var t={},a=e.querySelector("basematerials");a&&(t.basematerial=void 0),t.object={};for(var n=e.querySelectorAll("object"),o=0;o<n.length;o++){var i=r(n[o]);t.object[i.id]=i}return t}(n));var o=e.querySelector("build");return o&&(t.build=function(e){for(var t=[],r=e.querySelectorAll("item"),a=0;a<r.length;a++){var n=r[a],o={objectid:n.getAttribute("objectid")},i=n.getAttribute("transform");if(i){var s=[];i.split(" ").forEach(function(e){s.push(parseFloat(e))});var l=new THREE.Matrix4;o.transform=l.set(s[0],s[3],s[6],s[9],s[1],s[4],s[7],s[10],s[2],s[5],s[8],s[11],0,0,0,1)}t.push(o)}return t}(o)),t}function n(e,t){var r=new THREE.BufferGeometry;r.setIndex(new THREE.BufferAttribute(e.triangles,1)),r.addAttribute("position",new THREE.BufferAttribute(e.vertices,3)),e.colors&&r.addAttribute("color",new THREE.BufferAttribute(e.colors,3)),r.computeBoundingSphere();var a={flatShading:!0};e.colors&&0<e.colors.length?a.vertexColors=THREE.VertexColors:a.color=11184895;var n=new THREE.MeshPhongMaterial(a);return new THREE.Mesh(r,n)}function o(e,r,a,n){if(e){for(var o=[],i=Object.keys(e),s=0;s<i.length;s++)for(var l=i[s],u=0;u<t.availableExtensions.length;u++){(c=t.availableExtensions[u]).ns===l&&o.push(c)}for(s=0;s<o.length;s++){var c;(c=o[s]).apply(a,e[c.ns],r)}}}var i=function(e){var t,r,n=null,o=null,i=[],s=[],l=[],u=[],c={},g={};try{n=new JSZip(e)}catch(e){if(e instanceof ReferenceError)return console.error("THREE.ThreeMFLoader: jszip missing and file is compressed."),null}for(o in n.files)o.match(/\.rels$/)?t=o:o.match(/^3D\/.*\.model$/)?i.push(o):o.match(/^3D\/Metadata\/.*\.xml$/)?s.push(o):o.match(/^3D\/Textures\/.*/)?l.push(o):o.match(/^3D\/Other\/.*/)&&u.push(o);var p,f,d,h,v,b=new Uint8Array(n.file(t).asArrayBuffer()),m=THREE.LoaderUtils.decodeText(b);p=m,f=(new DOMParser).parseFromString(p,"application/xml").querySelector("Relationship"),d=f.getAttribute("Target"),h=f.getAttribute("Id"),v=f.getAttribute("Type"),r={target:d,id:h,type:v};for(var E=0;E<i.length;E++){var A=i[E],y=new Uint8Array(n.file(A).asArrayBuffer()),T=THREE.LoaderUtils.decodeText(y),x=(new DOMParser).parseFromString(T,"application/xml");"model"!==x.documentElement.nodeName.toLowerCase()&&console.error("THREE.ThreeMFLoader: Error loading 3MF - no 3MF document found: ",A);var R=x.querySelector("model"),H={};for(E=0;E<R.attributes.length;E++){var w=R.attributes[E];w.name.match(/^xmlns:(.+)$/)&&(H[w.value]=RegExp.$1)}var M=a(R);M.xml=R,0<Object.keys(H).length&&(M.extensions=H),c[A]=M}for(E=0;E<l.length;E++){var S=l[E];g[S]=n.file(S).asBinary()}return{rels:r,model:c,printTicket:{},texture:g,other:{}}}(e);return function(e,t,r){for(var a=new THREE.Group,n=r.model[t.target.substring(1)].build,o=0;o<n.length;o++){var i=n[o],s=e[i.objectid];i.transform&&s.geometry.applyMatrix(i.transform),a.add(s)}return a}(function(e){for(var t=e.model,r={},a=Object.keys(t),i=0;i<a.length;i++)for(var s=t[a[i]],l=s.xml,u=s.extensions,c=Object.keys(s.resources.object),g=0;g<c.length;g++){var p=c[g],f=s.resources.object[p].mesh;o(u,f,l),r[p]=n(f)}return r}(i),i.rels,i)},addExtension:function(e){this.availableExtensions.push(e)}};