THREE.ColladaLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"Anonymous",load:function(e,t,a,r){var n=this,i=void 0===n.path?THREE.LoaderUtils.extractUrlBase(e):n.path;new THREE.FileLoader(n.manager).load(e,function(e){t(n.parse(e,i))},a,r)},setPath:function(e){this.path=e},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function a(e,t){for(var a=[],r=e.childNodes,n=0,i=r.length;n<i;n++){var s=r[n];s.nodeName===t&&a.push(s)}return a}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),a=new Array(t.length),r=0,n=t.length;r<n;r++)a[r]=t[r];return a}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),a=new Array(t.length),r=0,n=t.length;r<n;r++)a[r]=parseFloat(t[r]);return a}function i(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),a=new Array(t.length),r=0,n=t.length;r<n;r++)a[r]=parseInt(t[r]);return a}function s(e){return e.substring(1)}function o(e){return 0===Object.keys(e).length}function c(e,t,r,n){var i=a(e,t)[0];if(void 0!==i)for(var s=a(i,r),o=0;o<s.length;o++)n(s[o])}function l(e,t){for(var a in e){e[a].build=t(e[a])}}function d(e,t){return void 0!==e.build?e.build:(e.build=t(e),e.build)}function u(e){for(var t={inputs:{}},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"input":var i=s(n.getAttribute("source")),o=n.getAttribute("semantic");t.inputs[o]=i}}return t}function f(e){var t={},a=e.getAttribute("target").split("/"),r=a.shift(),n=a.shift(),i=-1!==n.indexOf("("),o=-1!==n.indexOf(".");if(o)n=(a=n.split(".")).shift(),t.member=a.shift();else if(i){var c=n.split("(");n=c.shift();for(var l=0;l<c.length;l++)c[l]=parseInt(c[l].replace(/\)/,""));t.indices=c}return t.id=r,t.sid=n,t.arraySyntax=i,t.memberSyntax=o,t.sampler=s(e.getAttribute("source")),t}function h(e){var t=[],a=e.channels,r=e.samplers,n=e.sources;for(var i in a)if(a.hasOwnProperty(i)){var s=a[i],o=r[s.sampler],c=o.inputs.INPUT,l=o.inputs.OUTPUT;E(p(s,n[c],n[l]),t)}return t}function m(e){return d(Ue.animations[e],h)}function p(e,t,a){var r,n,i,s,o,c,l=Ue.nodes[e.id],d=xe(l.id),u=l.transforms[e.sid],f=l.matrix.clone().transpose(),h={};switch(u){case"matrix":for(i=0,s=t.array.length;i<s;i++)if(r=t.array[i],n=i*a.stride,void 0===h[r]&&(h[r]={}),!0===e.arraySyntax){var m=a.array[n],p=e.indices[0]+4*e.indices[1];h[r][p]=m}else for(o=0,c=a.stride;o<c;o++)h[r][o]=a.array[n+o];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}var v=function(e,t){var a=[];for(var r in e)a.push({time:parseFloat(r),value:e[r]});a.sort(function(e,t){return e.time-t.time});for(var n=0;n<16;n++)y(a,n,t.elements[n]);return a}(h,f);return{name:d.uuid,keyframes:v}}var v=new THREE.Vector3,g=new THREE.Vector3,b=new THREE.Quaternion;function E(e,t){for(var a=e.keyframes,r=e.name,n=[],i=[],s=[],o=[],c=0,l=a.length;c<l;c++){var d=a[c],u=d.time,f=d.value;pe.fromArray(f).transpose(),pe.decompose(v,b,g),n.push(u),i.push(v.x,v.y,v.z),s.push(b.x,b.y,b.z,b.w),o.push(g.x,g.y,g.z)}return i.length>0&&t.push(new THREE.VectorKeyframeTrack(r+".position",n,i)),s.length>0&&t.push(new THREE.QuaternionKeyframeTrack(r+".quaternion",n,s)),o.length>0&&t.push(new THREE.VectorKeyframeTrack(r+".scale",n,o)),t}function y(e,t,a){var r,n,i,s=!0;for(n=0,i=e.length;n<i;n++)void 0===(r=e[n]).value[t]?r.value[t]=null:s=!1;if(!0===s)for(n=0,i=e.length;n<i;n++)(r=e[n]).value[t]=a;else!function(e,t){for(var a,r,n=0,i=e.length;n<i;n++){var s=e[n];if(null===s.value[t]){if(a=N(e,n,t),r=T(e,n,t),null===a){s.value[t]=r.value[t];continue}if(null===r){s.value[t]=a.value[t];continue}w(s,a,r,t)}}}(e,t)}function N(e,t,a){for(;t>=0;){var r=e[t];if(null!==r.value[a])return r;t--}return null}function T(e,t,a){for(;t<e.length;){var r=e[t];if(null!==r.value[a])return r;t++}return null}function w(e,t,a,r){a.time-t.time!=0?e.value[r]=(e.time-t.time)*(a.value[r]-t.value[r])/(a.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function x(e){for(var t=[],a=e.name,r=e.end-e.start||-1,n=e.animations,i=0,s=n.length;i<s;i++)for(var o=m(n[i]),c=0,l=o.length;c<l;c++)t.push(o[c]);return new THREE.AnimationClip(a,r,t)}function A(e){for(var t={sources:{}},a=0,r=e.childNodes.length;a<r;a++){var i=e.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=n(i.textContent);break;case"source":var s=i.getAttribute("id");t.sources[s]=Y(i);break;case"joints":t.joints=k(i);break;case"vertex_weights":t.vertexWeights=R(i)}}return t}function k(e){for(var t={inputs:{}},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"input":var i=n.getAttribute("semantic"),o=s(n.getAttribute("source"));t.inputs[i]=o}}return t}function R(e){for(var t={inputs:{}},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"input":var o=n.getAttribute("semantic"),c=s(n.getAttribute("source")),l=parseInt(n.getAttribute("offset"));t.inputs[o]={id:c,offset:l};break;case"vcount":t.vcount=i(n.textContent);break;case"v":t.v=i(n.textContent)}}return t}function H(e){var t={id:e.id},a=Ue.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,a,r,n={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},i=e.sources,s=e.vertexWeights,o=s.vcount,c=s.v,l=s.inputs.JOINT.offset,d=s.inputs.WEIGHT.offset,u=e.sources[e.joints.inputs.JOINT],f=e.sources[e.joints.inputs.INV_BIND_MATRIX],h=i[s.inputs.WEIGHT.id].array,m=0;for(t=0,r=o.length;t<r;t++){var p=o[t],v=[];for(a=0;a<p;a++){var g=c[m+l],b=c[m+d],E=h[b];v.push({index:g,weight:E}),m+=2}for(v.sort(w),a=0;a<4;a++){var y=v[a];void 0!==y?(n.indices.array.push(y.index),n.weights.array.push(y.weight)):(n.indices.array.push(0),n.weights.array.push(0))}}for(n.bindMatrix=(new THREE.Matrix4).fromArray(e.bindShapeMatrix).transpose(),t=0,r=u.array.length;t<r;t++){var N=u.array[t],T=(new THREE.Matrix4).fromArray(f.array,t*f.stride).transpose();n.joints.push({name:N,boneInverse:T})}return n;function w(e,t){return t.weight-e.weight}}(e.skin),a.sources.skinIndices=t.skin.indices,a.sources.skinWeights=t.skin.weights),t}function C(e){return void 0!==e.build?e.build:e.init_from}function _(e){return d(Ue.images[e],C)}function L(e){for(var t={surfaces:{},samplers:{}},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"newparam":M(n,t);break;case"technique":t.technique=q(n);break;case"extra":t.extra=P(n)}}return t}function M(e,t){for(var a=e.getAttribute("sid"),r=0,n=e.childNodes.length;r<n;r++){var i=e.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"surface":t.surfaces[a]=O(i);break;case"sampler2D":t.samplers[a]=j(i)}}}function O(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function j(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function q(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=I(n)}}return t}function I(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":t[n.nodeName]=S(n);break;case"transparent":t[n.nodeName]={opaque:n.getAttribute("opaque"),data:S(n)}}}return t}function S(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var i=e.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"color":t[i.nodeName]=n(i.textContent);break;case"float":t[i.nodeName]=parseFloat(i.textContent);break;case"texture":t[i.nodeName]={id:i.getAttribute("texture"),extra:U(i)}}}return t}function U(e){for(var t={technique:{}},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"extra":F(n,t)}}return t}function F(e,t){for(var a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"technique":V(n,t)}}}function V(e,t){for(var a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function P(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"technique":t.technique=B(n)}}return t}function B(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"double_sided":t[n.nodeName]=parseInt(n.textContent)}}return t}function D(e){return e}function z(e){var t,a,r=(t=e.url,d(Ue.effects[t],D)),n=r.profile.technique,i=r.profile.extra;switch(n.type){case"phong":case"blinn":a=new THREE.MeshPhongMaterial;break;case"lambert":a=new THREE.MeshLambertMaterial;break;default:a=new THREE.MeshBasicMaterial}function s(e){var t,a=r.profile.samplers[e.id];void 0!==a?t=_(r.profile.surfaces[a.source].init_from):(console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),t=_(e.id));if(void 0!==t){var n=je.load(t),i=e.extra;if(void 0!==i&&void 0!==i.technique&&!1===o(i.technique)){var s=i.technique;n.wrapS=s.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.wrapT=s.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,n.offset.set(s.offsetU||0,s.offsetV||0),n.repeat.set(s.repeatU||1,s.repeatV||1)}else n.wrapS=THREE.RepeatWrapping,n.wrapT=THREE.RepeatWrapping;return n}return console.error("THREE.ColladaLoader: Unable to load texture with ID:",e.id),null}a.name=e.name;var c=n.parameters;for(var l in c){var u=c[l];switch(l){case"diffuse":u.color&&a.color.fromArray(u.color),u.texture&&(a.map=s(u.texture));break;case"specular":u.color&&a.specular&&a.specular.fromArray(u.color),u.texture&&(a.specularMap=s(u.texture));break;case"shininess":u.float&&a.shininess&&(a.shininess=u.float);break;case"emission":u.color&&a.emissive&&a.emissive.fromArray(u.color)}}var f=c.transparent,h=c.transparency;if(void 0===h&&f&&(h={float:1}),void 0===f&&h&&(f={opaque:"A_ONE",data:{color:[1,1,1,1]}}),f&&h)if(f.data.texture)a.alphaMap=s(f.data.texture),a.transparent=!0;else{var m=f.data.color;switch(f.opaque){case"A_ONE":a.opacity=m[3]*h.float;break;case"RGB_ZERO":a.opacity=1-m[0]*h.float;break;case"A_ZERO":a.opacity=1-m[3]*h.float;break;case"RGB_ONE":a.opacity=m[0]*h.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',f.opaque)}a.opacity<1&&(a.transparent=!0)}return void 0!==i&&void 0!==i.technique&&1===i.technique.double_sided&&(a.side=THREE.DoubleSide),a}function W(e){for(var t=0;t<e.childNodes.length;t++){var a=e.childNodes[t];switch(a.nodeName){case"technique_common":return J(a)}}return{}}function J(e){for(var t={},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=G(r)}}return t}function G(e){for(var t={},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function K(e){var t;switch(e.optics.technique){case"perspective":t=new THREE.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var a=e.optics.parameters.ymag,r=e.optics.parameters.xmag,n=e.optics.parameters.aspect_ratio;r=void 0===r?a*n:r,a=void 0===a?r/n:a,r*=.5,a*=.5,t=new THREE.OrthographicCamera(-r,r,a,-a,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new THREE.PerspectiveCamera}return t.name=e.name,t}function X(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=Z(n)}}return t}function Z(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var i=e.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"color":var s=n(i.textContent);t.color=(new THREE.Color).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(i.textContent);break;case"quadratic_attenuation":var o=parseFloat(i.textContent);t.distance=o?Math.sqrt(1/o):0}}return t}function Q(e){var t;switch(e.technique){case"directional":t=new THREE.DirectionalLight;break;case"point":t=new THREE.PointLight;break;case"spot":t=new THREE.SpotLight;break;case"ambient":t=new THREE.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t}function Y(e){for(var t={array:[],stride:3},i=0;i<e.childNodes.length;i++){var s=e.childNodes[i];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=n(s.textContent);break;case"Name_array":t.array=r(s.textContent);break;case"technique_common":var o=a(s,"accessor")[0];void 0!==o&&(t.stride=parseInt(o.getAttribute("stride")))}}return t}function $(e){for(var t={},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];1===r.nodeType&&(t[r.getAttribute("semantic")]=s(r.getAttribute("source")))}return t}function ee(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0,hasUV:!1},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"input":var o=s(n.getAttribute("source")),c=n.getAttribute("semantic"),l=parseInt(n.getAttribute("offset"));t.inputs[c]={id:o,offset:l},t.stride=Math.max(t.stride,l+1),"TEXCOORD"===c&&(t.hasUV=!0);break;case"vcount":t.vcount=i(n.textContent);break;case"p":t.p=i(n.textContent)}}return t}function te(e){for(var t=0,a=0,r=e.length;a<r;a++){!0===e[a].hasUV&&t++}t>0&&t<e.length&&(e.uvsNeedsFix=!0)}function ae(e){var t={},a=e.sources,r=e.vertices,n=e.primitives;if(0===n.length)return{};var i=function(e){for(var t={},a=0;a<e.length;a++){var r=e[a];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(n);for(var s in i){var o=i[s];te(o),t[s]=re(o,a,r)}return t}function re(e,t,a){for(var r={},n={array:[],stride:0},i={array:[],stride:0},s={array:[],stride:0},o={array:[],stride:0},c=[],l=4,d=[],u=4,f=new THREE.BufferGeometry,h=[],m=0,p=0,v=0;v<e.length;v++){var g=e[v],b=g.inputs,E=1;for(var y in g.vcount&&4===g.vcount[0]&&(E=2),p="lines"===g.type||"linestrips"===g.type?2*g.count:3*g.count*E,f.addGroup(m,p,v),m+=p,g.material&&h.push(g.material),b){var N=b[y];switch(y){case"VERTEX":for(var T in a){var w=a[T];switch(T){case"POSITION":var x=n.array.length;if(ne(g,t[w],N.offset,n.array),n.stride=t[w].stride,t.skinWeights&&t.skinIndices&&(ne(g,t.skinIndices,N.offset,c),ne(g,t.skinWeights,N.offset,d)),!1===g.hasUV&&!0===e.uvsNeedsFix){p=(n.array.length-x)/n.stride;for(var A=0;A<p;A++)s.array.push(0,0)}break;case"NORMAL":ne(g,t[w],N.offset,i.array),i.stride=t[w].stride;break;case"COLOR":ne(g,t[w],N.offset,o.array),o.stride=t[w].stride;break;case"TEXCOORD":ne(g,t[w],N.offset,s.array),s.stride=t[w].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',T)}}break;case"NORMAL":ne(g,t[N.id],N.offset,i.array),i.stride=t[N.id].stride;break;case"COLOR":ne(g,t[N.id],N.offset,o.array),o.stride=t[N.id].stride;break;case"TEXCOORD":ne(g,t[N.id],N.offset,s.array),s.stride=t[N.id].stride}}}return n.array.length>0&&f.addAttribute("position",new THREE.Float32BufferAttribute(n.array,n.stride)),i.array.length>0&&f.addAttribute("normal",new THREE.Float32BufferAttribute(i.array,i.stride)),o.array.length>0&&f.addAttribute("color",new THREE.Float32BufferAttribute(o.array,o.stride)),s.array.length>0&&f.addAttribute("uv",new THREE.Float32BufferAttribute(s.array,s.stride)),c.length>0&&f.addAttribute("skinIndex",new THREE.Float32BufferAttribute(c,l)),d.length>0&&f.addAttribute("skinWeight",new THREE.Float32BufferAttribute(d,u)),r.data=f,r.type=e[0].type,r.materialKeys=h,r}function ne(e,t,a,r){var n=e.p,i=e.stride,s=e.vcount;function o(e){for(var t=n[e+a]*d,i=t+d;t<i;t++)r.push(l[t])}var c=0,l=t.array,d=t.stride;if(void 0!==e.vcount){for(var u=0,f=0,h=s.length;f<h;f++){var m=s[f];if(4===m){var p=u+1*i,v=u+2*i,g=u+3*i;o(u+0*i),o(p),o(g),o(p),o(v),o(g)}else if(3===m){p=u+1*i,v=u+2*i;o(u+0*i),o(p),o(v)}else c=Math.max(c,m);u+=i*m}c>0&&console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(f=0,h=n.length;f<h;f+=i)o(f)}function ie(e){return d(Ue.geometries[e],ae)}function se(e){return void 0!==e.build?e.build:e}function oe(e,t){for(var a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=ce(r);break;case"link":t.links.push(de(r))}}}function ce(e){for(var t,a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=le(r)}}return t}function le(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"axis":var i=n(r.textContent);t.axis.fromArray(i);break;case"limits":var s=r.getElementsByTagName("max")[0],o=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(o.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function de(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(ue(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(fe(r))}}return t}function ue(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(de(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(fe(r))}}return t}function fe(e){var t={type:e.nodeName},a=n(e.textContent);switch(t.type){case"matrix":t.obj=new THREE.Matrix4,t.obj.fromArray(a).transpose();break;case"translate":t.obj=new THREE.Vector3,t.obj.fromArray(a);break;case"rotate":t.obj=new THREE.Vector3,t.obj.fromArray(a),t.angle=THREE.Math.degToRad(a[3])}return t}function he(e){for(var t={target:e.getAttribute("target").split("/").pop()},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"axis":var n=r.getElementsByTagName("param")[0];t.axis=n.textContent;var i=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=i.substr(0,i.length-1)}}return t}function me(e){return void 0!==e.build?e.build:e}var pe=new THREE.Matrix4,ve=new THREE.Vector3;function ge(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),ge(r);break;case"instance_camera":t.instanceCameras.push(s(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(be(r));break;case"instance_light":t.instanceLights.push(s(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(be(r));break;case"instance_node":t.instanceNodes.push(s(r.getAttribute("url")));break;case"matrix":var i=n(r.textContent);t.matrix.multiply(pe.fromArray(i).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":i=n(r.textContent);ve.fromArray(i),t.matrix.multiply(pe.makeTranslation(ve.x,ve.y,ve.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":i=n(r.textContent);var o=THREE.Math.degToRad(i[3]);t.matrix.multiply(pe.makeRotationAxis(ve.fromArray(i),o)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":i=n(r.textContent);t.matrix.scale(ve.fromArray(i)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return Ue.nodes[t.id]=t,t}function be(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];switch(r.nodeName){case"bind_material":for(var n=r.getElementsByTagName("instance_material"),i=0;i<n.length;i++){var o=n[i],c=o.getAttribute("symbol"),l=o.getAttribute("target");t.materials[c]=s(l)}break;case"skeleton":t.skeletons.push(s(r.textContent))}}return t}function Ee(e,t){var a,r,n,i,s=[],o=[];for(a=0;a<e.length;a++){var c=e[a];if(i=c,void 0!==Ue.nodes[i])ye(xe(c),t,s);else if(n=c,void 0!==Ue.visualScenes[n])for(var l=Ue.visualScenes[c].children,d=0;d<l.length;d++){var u=l[d];if("JOINT"===u.type)ye(xe(u.id),t,s)}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",c)}for(a=0;a<t.length;a++)for(d=0;d<s.length;d++)if((r=s[d]).bone.name===t[a].name){o[a]=r,r.processed=!0;break}for(a=0;a<s.length;a++)!1===(r=s[a]).processed&&(o.push(r),r.processed=!0);var f=[],h=[];for(a=0;a<o.length;a++)r=o[a],f.push(r.bone),h.push(r.boneInverse);return new THREE.Skeleton(f,h)}function ye(e,t,a){e.traverse(function(e){if(!0===e.isBone){for(var r,n=0;n<t.length;n++){var i=t[n];if(i.name===e.name){r=i.boneInverse;break}}void 0===r&&(r=new THREE.Matrix4),a.push({bone:e,boneInverse:r,processed:!1})}})}function Ne(e){for(var t,a,r,n,i,s=[],o=e.matrix,c=e.nodes,l=e.type,u=e.instanceCameras,f=e.instanceControllers,h=e.instanceLights,m=e.instanceGeometries,p=e.instanceNodes,v=0,g=c.length;v<g;v++)s.push(xe(c[v]));for(v=0,g=u.length;v<g;v++){var b=(t=u[v],void 0,void 0!==(a=Ue.cameras[t])?d(a,K):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",t),null));null!==b&&s.push(b.clone())}for(v=0,g=f.length;v<g;v++)for(var E=f[v],y=(r=E.id,d(Ue.controllers[r],H)),N=we(ie(y.id),E.materials),T=Ee(E.skeletons,y.skin.joints),w=0,x=N.length;w<x;w++){var A;(A=N[w]).isSkinnedMesh&&(A.bind(T,y.skin.bindMatrix),A.normalizeSkinWeights()),s.push(A)}for(v=0,g=h.length;v<g;v++){var k=(n=h[v],void 0,void 0!==(i=Ue.lights[n])?d(i,Q):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",n),null));null!==k&&s.push(k.clone())}for(v=0,g=m.length;v<g;v++)for(w=0,x=(N=we(ie((E=m[v]).id),E.materials)).length;w<x;w++)s.push(N[w]);for(v=0,g=p.length;v<g;v++)s.push(xe(p[v]).clone());if(0===c.length&&1===s.length)A=s[0];else{A="JOINT"===l?new THREE.Bone:new THREE.Group;for(v=0;v<s.length;v++)A.add(s[v])}return""===A.name&&(A.name="JOINT"===l?e.sid:e.name),A.matrix.copy(o),A.matrix.decompose(A.position,A.quaternion,A.scale),A}function Te(e,t){for(var a,r=[],n=0,i=e.length;n<i;n++){var s=t[e[n]];r.push((a=s,d(Ue.materials[a],z)))}return r}function we(e,t){var a=[];for(var r in e){var n=e[r],i=Te(n.materialKeys,t);0===i.length&&("lines"===r||"linestrips"===r?i.push(new THREE.LineBasicMaterial):i.push(new THREE.MeshPhongMaterial));var s=void 0!==n.data.attributes.skinIndex;if(s)for(var o=0,c=i.length;o<c;o++)i[o].skinning=!0;var l,d=1===i.length?i[0]:i;switch(r){case"lines":l=new THREE.LineSegments(n.data,d);break;case"linestrips":l=new THREE.Line(n.data,d);break;case"triangles":case"polylist":l=s?new THREE.SkinnedMesh(n.data,d):new THREE.Mesh(n.data,d)}a.push(l)}return a}function xe(e){return d(Ue.nodes[e],Ne)}function Ae(e){var t=new THREE.Group;t.name=e.name;for(var a=e.children,r=0;r<a.length;r++){var n=a[r];t.add(xe(n.id))}return t}function ke(e){return d(Ue.visualScenes[e],Ae)}if(console.time("THREE.ColladaLoader"),0===e.length)return{scene:new THREE.Scene};console.time("THREE.ColladaLoader: DOMParser");var Re=(new DOMParser).parseFromString(e,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var He=a(Re,"COLLADA")[0],Ce=He.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ce);var _e,Le,Me,Oe=(_e=a(He,"asset")[0],{unit:(Me=a(_e,"unit")[0],void 0!==Me&&!0===Me.hasAttribute("meter")?parseFloat(Me.getAttribute("meter")):1),upAxis:(Le=a(_e,"up_axis")[0],void 0!==Le?Le.textContent:"Y_UP")}),je=new THREE.TextureLoader(this.manager);je.setPath(t).setCrossOrigin(this.crossOrigin);var qe=[],Ie={},Se=0,Ue={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse"),c(He,"library_animations","animation",function(e){for(var t={sources:{},samplers:{},channels:{}},a=0,r=e.childNodes.length;a<r;a++){var n,i=e.childNodes[a];if(1===i.nodeType)switch(i.nodeName){case"source":n=i.getAttribute("id"),t.sources[n]=Y(i);break;case"sampler":n=i.getAttribute("id"),t.samplers[n]=u(i);break;case"channel":n=i.getAttribute("target"),t.channels[n]=f(i);break;default:console.log(i)}}Ue.animations[e.getAttribute("id")]=t}),c(He,"library_animation_clips","animation_clip",function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(s(n.getAttribute("url")))}}Ue.clips[e.getAttribute("id")]=t}),c(He,"library_controllers","controller",function(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=s(n.getAttribute("source")),t.skin=A(n);break;case"morph":t.id=s(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ue.controllers[e.getAttribute("id")]=t}),c(He,"library_images","image",function(e){var t={init_from:a(e,"init_from")[0].textContent};Ue.images[e.getAttribute("id")]=t}),c(He,"library_effects","effect",function(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=L(n)}}Ue.effects[e.getAttribute("id")]=t}),c(He,"library_materials","material",function(e){for(var t={name:e.getAttribute("name")},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=s(n.getAttribute("url"))}}Ue.materials[e.getAttribute("id")]=t}),c(He,"library_cameras","camera",function(e){for(var t={name:e.getAttribute("name")},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=W(n)}}Ue.cameras[e.getAttribute("id")]=t}),c(He,"library_lights","light",function(e){for(var t={},a=0,r=e.childNodes.length;a<r;a++){var n=e.childNodes[a];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=X(n)}}Ue.lights[e.getAttribute("id")]=t}),c(He,"library_geometries","geometry",function(e){var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=a(e,"mesh")[0];if(void 0!==r){for(var n=0;n<r.childNodes.length;n++){var i=r.childNodes[n];if(1===i.nodeType){var s=i.getAttribute("id");switch(i.nodeName){case"source":t.sources[s]=Y(i);break;case"vertices":t.vertices=$(i);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",i.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(ee(i));break;default:console.log(i)}}}Ue.geometries[e.getAttribute("id")]=t}}),c(He,"library_nodes","node",ge),c(He,"library_visual_scenes","visual_scene",function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),a=0;a<t.length;a++){var r=t[a];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+Se++)}}(e);for(var r=a(e,"node"),n=0;n<r.length;n++)t.children.push(ge(r[n]));Ue.visualScenes[e.getAttribute("id")]=t}),c(He,"library_kinematics_models","kinematics_model",function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"technique_common":oe(r,t)}}Ue.kinematicsModels[e.getAttribute("id")]=t}),c(He,"scene","instance_kinematics_scene",function(e){for(var t={bindJointAxis:[]},a=0;a<e.childNodes.length;a++){var r=e.childNodes[a];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":t.bindJointAxis.push(he(r))}}Ue.kinematicsScenes[s(e.getAttribute("url"))]=t}),console.timeEnd("THREE.ColladaLoader: Parse"),console.time("THREE.ColladaLoader: Build"),l(Ue.animations,h),l(Ue.clips,x),l(Ue.controllers,H),l(Ue.images,C),l(Ue.effects,D),l(Ue.materials,z),l(Ue.cameras,K),l(Ue.lights,Q),l(Ue.geometries,ae),l(Ue.visualScenes,Ae),console.timeEnd("THREE.ColladaLoader: Build"),function(){var e,t=Ue.clips;if(!0===o(t)){if(!1===o(Ue.animations)){var a=[];for(var r in Ue.animations)for(var n=m(r),i=0,s=n.length;i<s;i++)a.push(n[i]);qe.push(new THREE.AnimationClip("default",-1,a))}}else for(var r in t)qe.push((e=r,d(Ue.clips[e],x)))}(),function(){var e=Object.keys(Ue.kinematicsModels)[0],t=Object.keys(Ue.kinematicsScenes)[0],a=Object.keys(Ue.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var r,i,s=(r=e,d(Ue.kinematicsModels[r],se)),o=(i=t,d(Ue.kinematicsScenes[i],me)),c=ke(a),l=o.bindJointAxis,u={},f=0,h=l.length;f<h;f++){var m=l[f],p=He.querySelector('[sid="'+m.target+'"]');if(p){var v=p.parentElement;b(m.jointIndex,v)}}var g=new THREE.Matrix4;Ie={joints:s&&s.joints,getJointValue:function(e){var t=u[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var a=u[e];if(a){var r=a.joint;if(t>r.limits.max||t<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var n=a.object,i=r.axis,s=a.transforms;pe.identity();for(var o=0;o<s.length;o++){var c=s[o];if(c.sid&&-1!==c.sid.indexOf(e))switch(r.type){case"revolute":pe.multiply(g.makeRotationAxis(i,THREE.Math.degToRad(t)));break;case"prismatic":pe.multiply(g.makeTranslation(i.x*t,i.y*t,i.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(c.type){case"matrix":pe.multiply(c.obj);break;case"translate":pe.multiply(g.makeTranslation(c.obj.x,c.obj.y,c.obj.z));break;case"scale":pe.scale(c.obj);break;case"rotate":pe.multiply(g.makeRotationAxis(c.obj,c.angle))}}n.matrix.copy(pe),n.matrix.decompose(n.position,n.quaternion,n.scale),u[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function b(e,t){var a=t.getAttribute("name"),r=s.joints[e];c.traverse(function(i){i.name===a&&(u[e]={object:i,transforms:function(e){for(var t=[],a=He.querySelector('[id="'+e.id+'"]'),r=0;r<a.childNodes.length;r++){var i=a.childNodes[r];if(1===i.nodeType)switch(i.nodeName){case"matrix":var s=n(i.textContent),o=(new THREE.Matrix4).fromArray(s).transpose();t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:o});break;case"translate":case"scale":var s=n(i.textContent),c=(new THREE.Vector3).fromArray(s);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:c});break;case"rotate":var s=n(i.textContent),c=(new THREE.Vector3).fromArray(s),l=THREE.Math.degToRad(s[3]);t.push({sid:i.getAttribute("sid"),type:i.nodeName,obj:c,angle:l})}}return t}(t),joint:r,position:r.zeroPosition})})}}();var Fe=ke(s(a(a(He,"scene")[0],"instance_visual_scene")[0].getAttribute("url")));return"Z_UP"===Oe.upAxis&&Fe.quaternion.setFromEuler(new THREE.Euler(-Math.PI/2,0,0)),Fe.scale.multiplyScalar(Oe.unit),console.timeEnd("THREE.ColladaLoader"),{animations:qe,kinematics:Ie,library:Ue,scene:Fe}}};