THREE.GLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,t,a,r){var s=this,n=void 0!==this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),i=new THREE.FileLoader(s.manager);i.setResponseType("arraybuffer"),i.load(e,function(e){try{s.parse(e,n,t,r)}catch(e){if(void 0===r)throw e;r(e)}},a,r)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},parse:function(e,i,o,l){var u,p={};if("string"==typeof e)u=e;else if(THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===r){try{p[t.KHR_BINARY_GLTF]=new function(e){this.name=t.KHR_BINARY_GLTF,this.content=null,this.body=null;var a=new DataView(e,0,s);{if(this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:a.getUint32(4,!0),length:a.getUint32(8,!0)},this.header.magic!==r)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.")}var i=new DataView(e,s),o=0;for(;o<i.byteLength;){var l=i.getUint32(o,!0);o+=4;var u=i.getUint32(o,!0);if(o+=4,u===n.JSON){var p=new Uint8Array(e,s+o,l);this.content=THREE.LoaderUtils.decodeText(p)}else if(u===n.BIN){var c=s+o;this.body=e.slice(c,c+l)}o+=l}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}(e)}catch(e){return void(l&&l(e))}u=p[t.KHR_BINARY_GLTF].content}else u=THREE.LoaderUtils.decodeText(new Uint8Array(e));var c=JSON.parse(u);void 0===c.asset||c.asset.version[0]<2?l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead.")):(c.extensionsUsed&&(c.extensionsUsed.indexOf(t.KHR_LIGHTS)>=0&&(p[t.KHR_LIGHTS]=new function(e){this.name=t.KHR_LIGHTS,this.lights={};var a=(e.extensions&&e.extensions[t.KHR_LIGHTS]||{}).lights||{};for(var r in a){var s,n=a[r],i=(new THREE.Color).fromArray(n.color);switch(n.type){case"directional":(s=new THREE.DirectionalLight(i)).position.set(0,0,1);break;case"point":s=new THREE.PointLight(i);break;case"spot":(s=new THREE.SpotLight(i)).position.set(0,0,1);break;case"ambient":s=new THREE.AmbientLight(i)}s&&(void 0!==n.constantAttenuation&&(s.intensity=n.constantAttenuation),void 0!==n.linearAttenuation&&(s.distance=1/n.linearAttenuation),void 0!==n.quadraticAttenuation&&(s.decay=n.quadraticAttenuation),void 0!==n.fallOffAngle&&(s.angle=n.fallOffAngle),void 0!==n.fallOffExponent&&console.warn("THREE.GLTFLoader:: light.fallOffExponent not currently supported."),s.name=n.name||"light_"+r,this.lights[r]=s)}}(c)),c.extensionsUsed.indexOf(t.KHR_MATERIALS_COMMON)>=0&&(p[t.KHR_MATERIALS_COMMON]=new a(c)),c.extensionsUsed.indexOf(t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)>=0&&(p[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new function(){return{name:t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return THREE.ShaderMaterial},extendParams:function(e,t,a){var r=t.extensions[this.name],s=THREE.ShaderLib.standard,n=THREE.UniformsUtils.clone(s.uniforms),i=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),o=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),u=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),p=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),c=s.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",i).replace("#include <metalnessmap_pars_fragment>",o).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",u).replace("#include <lights_physical_fragment>",p);delete n.roughness,delete n.metalness,delete n.roughnessMap,delete n.metalnessMap,n.specular={value:(new THREE.Color).setHex(1118481)},n.glossiness={value:.5},n.specularMap={value:null},n.glossinessMap={value:null},e.vertexShader=s.vertexShader,e.fragmentShader=c,e.uniforms=n,e.defines={STANDARD:""},e.color=new THREE.Color(1,1,1),e.opacity=1;var d=[];if(Array.isArray(r.diffuseFactor)){var m=r.diffuseFactor;e.color.fromArray(m),e.opacity=m[3]}if(void 0!==r.diffuseTexture&&d.push(a.assignTexture(e,"map",r.diffuseTexture.index)),e.emissive=new THREE.Color(0,0,0),e.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,e.specular=new THREE.Color(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var f=r.specularGlossinessTexture.index;d.push(a.assignTexture(e,"glossinessMap",f)),d.push(a.assignTexture(e,"specularMap",f))}return Promise.all(d)},createMaterial:function(e){var t=new THREE.ShaderMaterial({defines:e.defines,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,fog:!0,lights:!0,opacity:e.opacity,transparent:e.transparent});return t.isGLTFSpecularGlossinessMaterial=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t.extensions.derivatives=!0,t},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var a=this.specularGlossinessParams,r=0,s=a.length;r<s;r++)t[a[r]]=e[a[r]];return t},refreshUniforms:function(e,t,a,r,s,n){var i,o,l,u=s.uniforms,p=s.defines;if(u.opacity.value=s.opacity,u.diffuse.value.copy(s.color),u.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),u.map.value=s.map,u.specularMap.value=s.specularMap,u.alphaMap.value=s.alphaMap,u.lightMap.value=s.lightMap,u.lightMapIntensity.value=s.lightMapIntensity,u.aoMap.value=s.aoMap,u.aoMapIntensity.value=s.aoMapIntensity,s.map?i=s.map:s.specularMap?i=s.specularMap:s.displacementMap?i=s.displacementMap:s.normalMap?i=s.normalMap:s.bumpMap?i=s.bumpMap:s.glossinessMap?i=s.glossinessMap:s.alphaMap?i=s.alphaMap:s.emissiveMap&&(i=s.emissiveMap),void 0!==i)if(i.isWebGLRenderTarget&&(i=i.texture),void 0!==i.matrix){if(!0===i.matrixAutoUpdate){o=i.offset,l=i.repeat;var c=i.rotation,d=i.center;i.matrix.setUvTransform(o.x,o.y,l.x,l.y,c,d.x,d.y)}u.uvTransform.value.copy(i.matrix)}else o=i.offset,l=i.repeat,u.offsetRepeat.value.set(o.x,o.y,l.x,l.y);u.envMap.value=s.envMap,u.envMapIntensity.value=s.envMapIntensity,u.flipEnvMap.value=s.envMap&&s.envMap.isCubeTexture?-1:1,u.refractionRatio.value=s.refractionRatio,u.specular.value.copy(s.specular),u.glossiness.value=s.glossiness,u.glossinessMap.value=s.glossinessMap,u.emissiveMap.value=s.emissiveMap,u.bumpMap.value=s.bumpMap,u.normalMap.value=s.normalMap,u.displacementMap.value=s.displacementMap,u.displacementScale.value=s.displacementScale,u.displacementBias.value=s.displacementBias,null!==u.glossinessMap.value&&void 0===p.USE_GLOSSINESSMAP&&(p.USE_GLOSSINESSMAP="",p.USE_ROUGHNESSMAP=""),null===u.glossinessMap.value&&void 0!==p.USE_GLOSSINESSMAP&&(delete p.USE_GLOSSINESSMAP,delete p.USE_ROUGHNESSMAP)}}})),console.time("GLTFLoader"),new _(c,p,{path:i||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(function(e,t,a,r,s){console.timeEnd("GLTFLoader"),o({scene:e,scenes:t,cameras:a,animations:r,asset:s})},l))}};var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_COMMON:"KHR_materials_common",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness"};function a(e){this.name=t.KHR_MATERIALS_COMMON}a.prototype.getMaterialType=function(e){switch(e.extensions[this.name].type){case"commonBlinn":case"commonPhong":return THREE.MeshPhongMaterial;case"commonLambert":return THREE.MeshLambertMaterial;case"commonConstant":default:return THREE.MeshBasicMaterial}},a.prototype.extendParams=function(e,t,a){var r=t.extensions[this.name],s=[],n=[];switch(r.type){case"commonBlinn":case"commonPhong":n.push("diffuseFactor","diffuseTexture","specularFactor","specularTexture","shininessFactor");break;case"commonLambert":n.push("diffuseFactor","diffuseTexture")}var i={};return n.forEach(function(e){void 0!==r[e]&&(i[e]=r[e])}),void 0!==i.diffuseFactor&&(e.color=(new THREE.Color).fromArray(i.diffuseFactor),e.opacity=i.diffuseFactor[3]),void 0!==i.diffuseTexture&&s.push(a.assignTexture(e,"map",i.diffuseTexture.index)),void 0!==i.specularFactor&&(e.specular=(new THREE.Color).fromArray(i.specularFactor)),void 0!==i.specularTexture&&s.push(a.assignTexture(e,"specularMap",i.specularTexture.index)),void 0!==i.shininessFactor&&(e.shininess=i.shininessFactor),Promise.all(s)};var r="glTF",s=12,n={JSON:1313821514,BIN:5130562};function i(e,t,a,r){THREE.Interpolant.call(this,e,t,a,r)}i.prototype=Object.create(THREE.Interpolant.prototype),i.prototype.constructor=i,i.prototype.interpolate_=function(e,t,a,r){for(var s=this.resultBuffer,n=this.sampleValues,i=this.valueSize,o=2*i,l=3*i,u=r-t,p=(a-t)/u,c=p*p,d=c*p,m=e*l,f=m-l,h=2*d-3*c+1,E=d-2*c+p,v=-2*d+3*c,T=d-c,R=0;R!==i;R++){var g=n[f+R+i],M=n[f+R+o]*u,S=n[m+R+i],H=n[m+R]*u;s[R]=h*g+E*M+v*S+T*H}return s};var o=0,l=1,u=2,p=3,c=4,d=5,m=6,f=(Number,THREE.Matrix3,THREE.Matrix4,THREE.Vector2,THREE.Vector3,THREE.Vector4,THREE.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),h={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},E={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},v={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},T={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},R=(THREE.BackSide,THREE.FrontSide,THREE.NeverDepth,THREE.LessDepth,THREE.EqualDepth,THREE.LessEqualDepth,THREE.GreaterEqualDepth,THREE.NotEqualDepth,THREE.GreaterEqualDepth,THREE.AlwaysDepth,THREE.AddEquation,THREE.SubtractEquation,THREE.ReverseSubtractEquation,THREE.ZeroFactor,THREE.OneFactor,THREE.SrcColorFactor,THREE.OneMinusSrcColorFactor,THREE.SrcAlphaFactor,THREE.OneMinusSrcAlphaFactor,THREE.DstAlphaFactor,THREE.OneMinusDstAlphaFactor,THREE.DstColorFactor,THREE.OneMinusDstColorFactor,THREE.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),g={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},M={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},S="OPAQUE",H="MASK",y="BLEND";function L(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:/^blob:.*$/i.test(e)?e:t+e}function x(e,t,a,r){var s=e.geometry,n=e.material,i=a.targets,o=s.morphAttributes;o.position=[],o.normal=[],n.morphTargets=!0;for(var l=0,u=i.length;l<u;l++){var p,c,d=i[l],m="morphTarget"+l;if(void 0!==d.POSITION){p=b(r[d.POSITION]);for(var f=s.attributes.position,h=0,E=p.count;h<E;h++)p.setXYZ(h,p.getX(h)+f.getX(h),p.getY(h)+f.getY(h),p.getZ(h)+f.getZ(h))}else s.attributes.position&&(p=b(s.attributes.position));if(void 0!==p&&(p.name=m,o.position.push(p)),void 0!==d.NORMAL){n.morphNormals=!0,c=b(r[d.NORMAL]);var v=s.attributes.normal;for(h=0,E=c.count;h<E;h++)c.setXYZ(h,c.getX(h)+v.getX(h),c.getY(h)+v.getY(h),c.getZ(h)+v.getZ(h))}else void 0!==s.attributes.normal&&(c=b(s.attributes.normal));void 0!==c&&(c.name=m,o.normal.push(c))}if(e.updateMorphTargets(),void 0!==t.weights)for(l=0,u=t.weights.length;l<u;l++)e.morphTargetInfluences[l]=t.weights[l]}function A(e,t){if(e.indices!==t.indices)return!1;var a=e.attributes||{},r=t.attributes||{},s=Object.keys(a),n=Object.keys(r);if(s.length!==n.length)return!1;for(var i=0,o=s.length;i<o;i++){var l=s[i];if(a[l]!==r[l])return!1}return!0}function w(e,t){for(var a=0,r=e.length;a<r;a++){var s=e[a];if(A(s.primitive,t))return s.geometry}return null}function b(e){if(e.isInterleavedBufferAttribute){for(var t=e.count,a=e.itemSize,r=e.array.slice(0,t*a),s=0;s<t;++s)r[s]=e.getX(s),a>=2&&(r[s+1]=e.getY(s)),a>=3&&(r[s+2]=e.getZ(s)),a>=4&&(r[s+3]=e.getW(s));return new THREE.BufferAttribute(r,a,e.normalized)}return e.clone()}function _(e,t,a){this.json=e||{},this.extensions=t||{},this.options=a||{},this.cache=new function(){var e={};return{get:function(t){return e[t]},add:function(t,a){e[t]=a},remove:function(t){delete e[t]},removeAll:function(){e={}}}},this.primitiveCache=[],this.textureLoader=new THREE.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new THREE.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}return _.prototype.parse=function(e,t){var a=this.json;this.cache.removeAll(),this.markDefs(),this.getMultiDependencies(["scene","animation","camera"]).then(function(t){var r=t.scenes||[],s=r[a.scene||0],n=t.animations||[],i=a.asset,o=t.cameras||[];e(s,r,o,n,i)}).catch(t)},_.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],a=this.json.meshes||[],r={},s={},n=0,i=t.length;n<i;n++)for(var o=t[n].joints,l=0,u=o.length;l<u;l++)e[o[l]].isBone=!0;for(var p=0,c=e.length;p<c;p++){var d=e[p];void 0!==d.mesh&&(void 0===r[d.mesh]&&(r[d.mesh]=s[d.mesh]=0),r[d.mesh]++,void 0!==d.skin&&(a[d.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=s},_.prototype.getDependency=function(e,t){var a=e+":"+t,r=this.cache.get(a);r||(r=this["load"+e.charAt(0).toUpperCase()+e.slice(1)](t),this.cache.add(a,r));return r},_.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var a=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map(function(t,r){return a.getDependency(e,r)})),this.cache.add(e,t)}return t},_.prototype.getMultiDependencies=function(e){for(var t={},a=[],r=0,s=e.length;r<s;r++){var n=e[r],i=this.getDependencies(n);i=i.then(function(e,a){t[e]=a}.bind(this,n+("mesh"===n?"es":"s"))),a.push(i)}return Promise.all(a).then(function(){return t})},_.prototype.loadBuffer=function(e){var a=this.json.buffers[e],r=this.fileLoader;if(a.type&&"arraybuffer"!==a.type)throw new Error("THREE.GLTFLoader: "+a.type+" buffer type is not supported.");if(void 0===a.uri&&0===e)return Promise.resolve(this.extensions[t.KHR_BINARY_GLTF].body);var s=this.options;return new Promise(function(e,t){r.load(L(a.uri,s.path),e,void 0,function(){t(new Error('THREE.GLTFLoader: Failed to load buffer "'+a.uri+'".'))})})},_.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){var a=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+a)})},_.prototype.loadAccessor=function(e){var t=this,a=this.json,r=this.json.accessors[e],s=[];return void 0!==r.bufferView?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),void 0!==r.sparse&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(e){var s,n,i=e[0],o=R[r.type],l=f[r.componentType],u=l.BYTES_PER_ELEMENT,p=u*o,c=r.byteOffset||0,d=a.bufferViews[r.bufferView].byteStride,m=!0===r.normalized;if(d&&d!==p){var h="InterleavedBuffer:"+r.bufferView+":"+r.componentType,E=t.cache.get(h);E||(s=new l(i),E=new THREE.InterleavedBuffer(s,d/u),t.cache.add(h,E)),n=new THREE.InterleavedBufferAttribute(E,o,c/u,m)}else s=null===i?new l(r.count*o):new l(i,c,r.count*o),n=new THREE.BufferAttribute(s,o,m);if(void 0!==r.sparse){var v=R.SCALAR,T=f[r.sparse.indices.componentType],g=r.sparse.indices.byteOffset||0,M=r.sparse.values.byteOffset||0,S=new T(e[1],g,r.sparse.count*v),H=new l(e[2],M,r.sparse.count*o);null!==i&&n.setArray(n.array.slice());for(var y=0,L=S.length;y<L;y++){var x=S[y];if(n.setX(x,H[y*o]),o>=2&&n.setY(x,H[y*o+1]),o>=3&&n.setZ(x,H[y*o+2]),o>=4&&n.setW(x,H[y*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n})},_.prototype.loadTexture=function(e){var t=this.json,a=this.options,r=this.textureLoader,s=window.URL||window.webkitURL,n=t.textures[e],i=t.images[n.source],o=i.uri,l=!1;return void 0!==i.bufferView&&(o=this.getDependency("bufferView",i.bufferView).then(function(e){l=!0;var t=new Blob([e],{type:i.mimeType});return o=s.createObjectURL(t)})),Promise.resolve(o).then(function(e){var t=THREE.Loader.Handlers.get(e)||r;return new Promise(function(r,s){t.load(L(e,a.path),r,void 0,s)})}).then(function(e){!0===l&&s.revokeObjectURL(o),e.flipY=!1,void 0!==n.name&&(e.name=n.name),e.format=void 0!==n.format?v[n.format]:THREE.RGBAFormat,void 0!==n.internalFormat&&e.format!==v[n.internalFormat]&&console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),e.type=void 0!==n.type?T[n.type]:THREE.UnsignedByteType;var a=(t.samplers||{})[n.sampler]||{};return e.magFilter=h[a.magFilter]||THREE.LinearFilter,e.minFilter=h[a.minFilter]||THREE.LinearMipMapLinearFilter,e.wrapS=E[a.wrapS]||THREE.RepeatWrapping,e.wrapT=E[a.wrapT]||THREE.RepeatWrapping,e})},_.prototype.assignTexture=function(e,t,a){return this.getDependency("texture",a).then(function(a){e[t]=a})},_.prototype.loadMaterial=function(e){var a,r=this,s=(this.json,this.extensions),n=this.json.materials[e],i={},o=n.extensions||{},l=[];if(o[t.KHR_MATERIALS_COMMON]){var u=s[t.KHR_MATERIALS_COMMON];a=u.getMaterialType(n),l.push(u.extendParams(i,n,r))}else if(o[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var p=s[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=p.getMaterialType(n),l.push(p.extendParams(i,n,r))}else if(void 0!==n.pbrMetallicRoughness){a=THREE.MeshStandardMaterial;var c=n.pbrMetallicRoughness;if(i.color=new THREE.Color(1,1,1),i.opacity=1,Array.isArray(c.baseColorFactor)){var d=c.baseColorFactor;i.color.fromArray(d),i.opacity=d[3]}if(void 0!==c.baseColorTexture&&l.push(r.assignTexture(i,"map",c.baseColorTexture.index)),i.metalness=void 0!==c.metallicFactor?c.metallicFactor:1,i.roughness=void 0!==c.roughnessFactor?c.roughnessFactor:1,void 0!==c.metallicRoughnessTexture){var m=c.metallicRoughnessTexture.index;l.push(r.assignTexture(i,"metalnessMap",m)),l.push(r.assignTexture(i,"roughnessMap",m))}}else a=THREE.MeshPhongMaterial;!0===n.doubleSided&&(i.side=THREE.DoubleSide);var f=n.alphaMode||S;return f===y?i.transparent=!0:(i.transparent=!1,f===H&&(i.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&(l.push(r.assignTexture(i,"normalMap",n.normalTexture.index)),i.normalScale=new THREE.Vector2(1,1),void 0!==n.normalTexture.scale&&i.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&(l.push(r.assignTexture(i,"aoMap",n.occlusionTexture.index)),void 0!==n.occlusionTexture.strength&&(i.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&(a===THREE.MeshBasicMaterial?i.color=(new THREE.Color).fromArray(n.emissiveFactor):i.emissive=(new THREE.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&(a===THREE.MeshBasicMaterial?l.push(r.assignTexture(i,"map",n.emissiveTexture.index)):l.push(r.assignTexture(i,"emissiveMap",n.emissiveTexture.index))),Promise.all(l).then(function(){var e;return e=a===THREE.ShaderMaterial?s[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(i):new a(i),void 0!==n.name&&(e.name=n.name),e.normalScale&&(e.normalScale.x=-e.normalScale.x),e.map&&(e.map.encoding=THREE.sRGBEncoding),e.emissiveMap&&(e.emissiveMap.encoding=THREE.sRGBEncoding),n.extras&&(e.userData=n.extras),e})},_.prototype.loadGeometries=function(e){var t=this.primitiveCache;return this.getDependencies("accessor").then(function(a){for(var r=[],s=0,n=e.length;s<n;s++){var i=e[s],o=w(t,i);if(o)r.push(o);else{var l=new THREE.BufferGeometry,u=i.attributes;for(var p in u){var c=a[u[p]];switch(p){case"POSITION":l.addAttribute("position",c);break;case"NORMAL":l.addAttribute("normal",c);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":l.addAttribute("uv",c);break;case"TEXCOORD_1":l.addAttribute("uv2",c);break;case"COLOR_0":case"COLOR0":case"COLOR":l.addAttribute("color",c);break;case"WEIGHTS_0":case"WEIGHT":l.addAttribute("skinWeight",c);break;case"JOINTS_0":case"JOINT":l.addAttribute("skinIndex",c)}}void 0!==i.indices&&l.setIndex(a[i.indices]),t.push({primitive:i,geometry:l}),r.push(l)}}return r})},_.prototype.loadMesh=function(e){var a=this,r=(this.json,this.extensions),s=this.json.meshes[e];return this.getMultiDependencies(["accessor","material"]).then(function(n){var i=new THREE.Group,f=s.primitives;return a.loadGeometries(f).then(function(a){for(var h=0,E=f.length;h<E;h++){var v=f[h],T=a[h],R=void 0===v.material?new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide}):n.materials[v.material];R.aoMap&&void 0===T.attributes.uv2&&void 0!==T.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),T.addAttribute("uv2",new THREE.BufferAttribute(T.attributes.uv.array,2)));var g,M=void 0!==T.attributes.color,S=void 0===T.attributes.normal,H=!0===s.isSkinnedMesh,y=void 0!==v.targets;if(M||S||H||y)if(R.isGLTFSpecularGlossinessMaterial)R=r[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(R);else R=R.clone();if(M&&(R.vertexColors=THREE.VertexColors,R.needsUpdate=!0),S&&(R.flatShading=!0),v.mode===c||v.mode===d||v.mode===m||void 0===v.mode)H?(g=new THREE.SkinnedMesh(T,R),R.skinning=!0):g=new THREE.Mesh(T,R),v.mode===d?g.drawMode=THREE.TriangleStripDrawMode:v.mode===m&&(g.drawMode=THREE.TriangleFanDrawMode);else if(v.mode===l)g=new THREE.LineSegments(T,R);else if(v.mode===p)g=new THREE.Line(T,R);else if(v.mode===u)g=new THREE.LineLoop(T,R);else{if(v.mode!==o)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);g=new THREE.Points(T,R)}if(g.name=s.name||"mesh_"+e,y&&x(g,s,v,n.accessors),void 0!==s.extras&&(g.userData=s.extras),void 0!==v.extras&&(g.geometry.userData=v.extras),!0===R.isGLTFSpecularGlossinessMaterial&&(g.onBeforeRender=r[t.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),!(f.length>1))return g;g.name+="_"+h,i.add(g)}return i})})},_.prototype.loadCamera=function(e){var t,a=this.json.cameras[e],r=a[a.type];if(r){if("perspective"===a.type){var s=r.aspectRatio||1,n=r.yfov*s;t=new THREE.PerspectiveCamera(THREE.Math.radToDeg(n),s,r.znear||1,r.zfar||2e6)}else"orthographic"===a.type&&(t=new THREE.OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar));return void 0!==a.name&&(t.name=a.name),a.extras&&(t.userData=a.extras),Promise.resolve(t)}console.warn("THREE.GLTFLoader: Missing camera parameters.")},_.prototype.loadSkin=function(e){var t=this.json.skins[e],a={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(a):this.getDependency("accessor",t.inverseBindMatrices).then(function(e){return a.inverseBindMatrices=e,a})},_.prototype.loadAnimation=function(e){this.json;var t=this.json.animations[e];return this.getMultiDependencies(["accessor","node"]).then(function(a){for(var r=[],s=0,n=t.channels.length;s<n;s++){var o=t.channels[s],l=t.samplers[o.sampler];if(l){var u=o.target,p=void 0!==u.node?u.node:u.id,c=void 0!==t.parameters?t.parameters[l.input]:l.input,d=void 0!==t.parameters?t.parameters[l.output]:l.output,m=a.accessors[c],f=a.accessors[d],h=a.nodes[p];if(h){var E;switch(h.updateMatrix(),h.matrixAutoUpdate=!0,g[u.path]){case g.weights:E=THREE.NumberKeyframeTrack;break;case g.rotation:E=THREE.QuaternionKeyframeTrack;break;case g.position:case g.scale:default:E=THREE.VectorKeyframeTrack}var v=h.name?h.name:h.uuid,T=void 0!==l.interpolation?M[l.interpolation]:THREE.InterpolateLinear,R=[];g[u.path]===g.weights?h.traverse(function(e){!0===e.isMesh&&!0===e.material.morphTargets&&R.push(e.name?e.name:e.uuid)}):R.push(v);for(var S=0,H=R.length;S<H;S++){var y=new E(R[S]+"."+g[u.path],THREE.AnimationUtils.arraySlice(m.array,0),THREE.AnimationUtils.arraySlice(f.array,0),T);"CUBICSPLINE"===l.interpolation&&(y.createInterpolant=function(e){return new i(this.times,this.values,this.getValueSize()/3,e)}),r.push(y)}}}}p=void 0!==t.name?t.name:"animation_"+e;return new THREE.AnimationClip(p,void 0,r)})},_.prototype.loadNode=function(e){this.json;var a=this.extensions,r=this.json.meshReferences,s=this.json.meshUses,n=this.json.nodes[e];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(e){var i;if(!0===n.isBone)i=new THREE.Bone;else if(void 0!==n.mesh){var o=e.meshes[n.mesh];if(i=o.clone(),!0===o.isGroup)for(var l=0,u=o.children.length;l<u;l++){var p=o.children[l];p.material&&!0===p.material.isGLTFSpecularGlossinessMaterial&&(i.children[l].onBeforeRender=p.onBeforeRender)}else o.material&&!0===o.material.isGLTFSpecularGlossinessMaterial&&(i.onBeforeRender=o.onBeforeRender);r[n.mesh]>1&&(i.name+="_instance_"+s[n.mesh]++)}else if(void 0!==n.camera)i=e.cameras[n.camera];else if(n.extensions&&n.extensions[t.KHR_LIGHTS]&&void 0!==n.extensions[t.KHR_LIGHTS].light){i=a[t.KHR_LIGHTS].lights[n.extensions[t.KHR_LIGHTS].light]}else i=new THREE.Object3D;if(void 0!==n.name&&(i.name=THREE.PropertyBinding.sanitizeNodeName(n.name)),n.extras&&(i.userData=n.extras),void 0!==n.matrix){var c=new THREE.Matrix4;c.fromArray(n.matrix),i.applyMatrix(c)}else void 0!==n.translation&&i.position.fromArray(n.translation),void 0!==n.rotation&&i.quaternion.fromArray(n.rotation),void 0!==n.scale&&i.scale.fromArray(n.scale);return i})},_.prototype.loadScene=function(){function e(t,a,r,s,n){var i=s[t],o=r.nodes[t];if(void 0!==o.skin)for(var l=!0===i.isGroup?i.children:[i],u=0,p=l.length;u<p;u++){for(var c=l[u],d=n[o.skin],m=[],f=[],h=0,E=d.joints.length;h<E;h++){var v=d.joints[h],T=s[v];if(T){m.push(T);var R=new THREE.Matrix4;void 0!==d.inverseBindMatrices&&R.fromArray(d.inverseBindMatrices.array,16*h),f.push(R)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',v)}c.bind(new THREE.Skeleton(m,f),c.matrixWorld)}if(a.add(i),o.children){var g=o.children;for(u=0,p=g.length;u<p;u++){e(g[u],i,r,s,n)}}}return function(a){var r=this.json,s=this.extensions,n=this.json.scenes[a];return this.getMultiDependencies(["node","skin"]).then(function(a){var i=new THREE.Scene;void 0!==n.name&&(i.name=n.name),n.extras&&(i.userData=n.extras);for(var o=n.nodes||[],l=0,u=o.length;l<u;l++)e(o[l],i,r,a.nodes,a.skins);if(n.extensions&&n.extensions[t.KHR_LIGHTS]&&void 0!==n.extensions[t.KHR_LIGHTS].light){var p=s[t.KHR_LIGHTS].lights;i.add(p[n.extensions[t.KHR_LIGHTS].light])}return i})}}(),e}();