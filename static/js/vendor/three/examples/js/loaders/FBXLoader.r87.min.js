!function(){function e(e){var r,t=e.properties.Content,n=e.properties.RelativeFilename||e.properties.Filename,i=n.slice(n.lastIndexOf(".")+1).toLowerCase();switch(i){case"bmp":r="image/bmp";break;case"jpg":r="image/jpeg";break;case"png":r="image/png";break;case"tif":r="image/tiff";break;default:return void console.warn("FBXLoader: No support image type "+i)}if("string"==typeof t)return"data:"+r+";base64,"+t;var a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:r}))}function r(e,r,t,n){var i,a=e.id,o=e.name,s=e.properties.FileName,u=e.properties.RelativeFilename,c=n.get(a).children;if(void 0!==c&&c.length>0&&t.has(c[0].ID))i=t.get(c[0].ID);else if(void 0!==u&&"/"!==u[0]&&null===u.match(/^[a-zA-Z]:/))i=u;else{var p=s.split(/[\\\/]/);i=p.length>0?p[p.length-1]:s}var f=r.path;0!==i.indexOf("blob:")&&0!==i.indexOf("data:")||r.setPath(void 0);var l=r.load(i);l.name=o,l.FBX_ID=a;var h=e.properties.WrapModeU,d=e.properties.WrapModeV,v=void 0!==h?h.value:0,g=void 0!==d?d.value:0;return l.wrapS=0===v?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,l.wrapT=0===g?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,r.setPath(f),l}function t(e,r,t){var n=e.id,i=e.attrName,a=e.properties.ShadingModel;"object"==typeof a&&(a=a.value);var o,s=t.get(n).children,u=function(e,r,t){var n={};e.Diffuse&&(n.color=D(e.Diffuse));e.Specular&&(n.specular=D(e.Specular));e.Shininess&&(n.shininess=e.Shininess.value);e.Emissive&&(n.emissive=D(e.Emissive));e.EmissiveFactor&&(n.emissiveIntensity=e.EmissiveFactor.value);e.Opacity&&(n.opacity=e.Opacity.value);n.opacity<1&&(n.transparent=!0);for(var i=0,a=t.length;i<a;++i){var o=t[i],s=o.relationship;switch(s){case"DiffuseColor":case' "DiffuseColor':n.map=r.get(o.ID);break;case"Bump":case' "Bump':n.bumpMap=r.get(o.ID);break;case"NormalMap":case' "NormalMap':n.normalMap=r.get(o.ID);break;case"AmbientColor":case"EmissiveColor":case' "AmbientColor':case' "EmissiveColor':default:console.warn("THREE.FBXLoader: Unknown texture application of type %s, skipping texture.",s)}}return n}(e.properties,r,s);switch(a.toLowerCase()){case"phong":o=new THREE.MeshPhongMaterial;break;case"lambert":o=new THREE.MeshLambertMaterial;break;default:console.warn("THREE.FBXLoader: No implementation given for material type %s in FBXLoader.js. Defaulting to basic material.",a),o=new THREE.MeshBasicMaterial({color:3342591})}return o.setValues(u),o.name=i,o}function n(e,r){for(var t={},n=e.children,i=0,a=n.length;i<a;++i){var o=n[i],s=r[o.ID],u={FBX_ID:o.ID,index:i,indices:[],weights:[],transform:k(s.subNodes.Transform.properties.a),transformLink:k(s.subNodes.TransformLink.properties.a),linkMode:s.properties.Mode};"Indexes"in s.subNodes&&(u.indices=x(s.subNodes.Indexes.properties.a),u.weights=A(s.subNodes.Weights.properties.a)),t[o.ID]=u}return{map:t,bones:[]}}function i(e,r,t){switch(e.attrType){case"Mesh":return function(e,r,t){for(var n=0;n<r.children.length;++n){var i=t[r.children[n].ID];if(void 0!==i)break}return function(e,r){var t=new I,n=e.subNodes,i=A(n.Vertices.properties.a),a=x(n.PolygonVertexIndex.properties.a);if(n.LayerElementNormal)var o=function(e){var r=e.properties.MappingInformationType,t=e.properties.ReferenceInformationType,n=A(e.subNodes.Normals.properties.a),i=[];"IndexToDirect"===t&&("NormalIndex"in e.subNodes?i=x(e.subNodes.NormalIndex.properties.a):"NormalsIndex"in e.subNodes&&(i=x(e.subNodes.NormalsIndex.properties.a)));return{dataSize:3,buffer:n,indices:i,mappingType:r,referenceType:t}}(n.LayerElementNormal[0]);if(n.LayerElementUV)var u=function(e){var r=e.properties.MappingInformationType,t=e.properties.ReferenceInformationType,n=A(e.subNodes.UV.properties.a),i=[];"IndexToDirect"===t&&(i=x(e.subNodes.UVIndex.properties.a));return{dataSize:2,buffer:n,indices:i,mappingType:r,referenceType:t}}(n.LayerElementUV[0]);if(n.LayerElementColor)var c=function(e){var r=e.properties.MappingInformationType,t=e.properties.ReferenceInformationType,n=A(e.subNodes.Colors.properties.a),i=[];"IndexToDirect"===t&&(i=A(e.subNodes.ColorIndex.properties.a));return{dataSize:4,buffer:n,indices:i,mappingType:r,referenceType:t}}(n.LayerElementColor[0]);if(n.LayerElementMaterial)var p=function(e){var r=e.properties.MappingInformationType,t=e.properties.ReferenceInformationType;if("NoMappingInformation"===r)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:t};for(var n=x(e.subNodes.Materials.properties.a),i=[],a=0,o=n.length;a<o;++a)i.push(a);return{dataSize:1,buffer:n,indices:i,mappingType:r,referenceType:t}}(n.LayerElementMaterial[0]);var f={};if(r){var l=r.map;for(var h in l)for(var d=l[h],v=d.indices,g=0;g<v.length;g++){var m=v[g],E=d.weights[g];void 0===f[m]&&(f[m]=[]),f[m].push({id:d.index,weight:E})}}for(var T=[],_=0,w=!1,N=0;N<a.length;N++){var R=a[N],B=!1;R<0&&(R^=-1,a[N]=R,B=!0);var F=new y,D=[],k=[];if(F.position.fromArray(i,3*R),r){if(void 0!==f[R])for(var S=f[R],g=0,L=S.length;g<L;g++)k.push(S[g].weight),D.push(S[g].id);if(k.length>4){w||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),w=!0);var H=[0,0,0,0],C=[0,0,0,0];k.forEach(function(e,r){var t=e,n=D[r];C.forEach(function(e,r,i){if(t>e){i[r]=t,t=e;var a=H[r];H[r]=n,n=a}})}),D=H,k=C}for(var U=k.length;U<4;++U)k[U]=0,D[U]=0;F.skinWeights.fromArray(k),F.skinIndices.fromArray(D)}if(o&&F.normal.fromArray(s(N,_,R,o)),u&&F.uv.fromArray(s(N,_,R,u)),c&&F.color.fromArray(s(N,_,R,c)),T.push(F),B){var M=new b;if(M.genTrianglesFromVertices(T),void 0!==p){var O=s(N,_,R,p);M.materialIndex=O[0]}else M.materialIndex=0;t.faces.push(M),T=[],_++,B=!1}}var P=t.flattenToBuffers(),X=new THREE.BufferGeometry;X.name=e.name,X.addAttribute("position",new THREE.Float32BufferAttribute(P.vertexBuffer,3)),P.normalBuffer.length>0&&X.addAttribute("normal",new THREE.Float32BufferAttribute(P.normalBuffer,3));P.uvBuffer.length>0&&X.addAttribute("uv",new THREE.Float32BufferAttribute(P.uvBuffer,2));n.LayerElementColor&&X.addAttribute("color",new THREE.Float32BufferAttribute(P.colorBuffer,3));r&&(X.addAttribute("skinIndex",new THREE.Float32BufferAttribute(P.skinIndexBuffer,4)),X.addAttribute("skinWeight",new THREE.Float32BufferAttribute(P.skinWeightBuffer,4)),X.FBX_Deformer=r);for(var z=P.materialIndexBuffer,j=z[0],V=0,U=0;U<z.length;++U)z[U]!==j&&(X.addGroup(V,U-V,j),j=z[U],V=U);return X}(e,i)}(e,r,t);case"NurbsCurve":return function(e){if(void 0===THREE.NURBSCurve)return console.error("THREE.FBXLoader: The loader relies on THREE.NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new THREE.BufferGeometry;var r=parseInt(e.properties.Order);if(isNaN(r))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.properties.Order,e.id),new THREE.BufferGeometry;for(var t,n,i=r-1,a=A(e.subNodes.KnotVector.properties.a),o=[],s=A(e.subNodes.Points.properties.a),u=0,c=s.length;u<c;u+=4)o.push((new THREE.Vector4).fromArray(s,u));if("Closed"===e.properties.Form)o.push(o[0]);else if("Periodic"===e.properties.Form){t=i,n=a.length-1-t;for(var u=0;u<i;++u)o.push(o[u])}for(var p=new THREE.NURBSCurve(i,a,o,t,n).getPoints(7*o.length),f=new Float32Array(3*p.length),u=0,c=p.length;u<c;++u)p[u].toArray(f,3*u);var l=new THREE.BufferGeometry;return l.addAttribute("position",new THREE.BufferAttribute(f,3)),l}(e)}}THREE.FBXLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},Object.assign(THREE.FBXLoader.prototype,{load:function(e,r,t,n){var i=this,a=THREE.Loader.prototype.extractUrlBase(e),o=new THREE.FileLoader(this.manager);o.setResponseType("arraybuffer"),o.load(e,function(t){try{console.time("parse r87: ");var o=i.parse(t,a);console.timeEnd("parse r87: "),r(o)}catch(r){window.setTimeout(function(){n&&n(r),i.manager.itemError(e)},0)}},t,n)},parse:function(a,o){var s,p,f;if(f="Kaydara FBX Binary  \0",(p=a).byteLength>=f.length&&f===S(p,0,f.length))s=(new _).parse(a);else{var l=S(a);if(!function(e){var r=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],t=0;function n(r){var n=e[r-1];return e=e.slice(t+r),t++,n}for(var i=0;i<r.length;++i){var a=n(1);if(a===r[i])return!1}return!0}(l))throw new Error("THREE.FBXLoader: Unknown format.");if(R(l)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+R(l));s=(new T).parse(l)}var h=function(e){var r=new Map;if("Connections"in e)for(var t=e.Connections.properties.connections,n=0,i=t.length;n<i;++n){var a=t[n];r.has(a[0])||r.set(a[0],{parents:[],children:[]});var o={ID:a[1],relationship:a[2]};r.get(a[0]).parents.push(o),r.has(a[1])||r.set(a[1],{parents:[],children:[]});var s={ID:a[0],relationship:a[2]};r.get(a[1]).children.push(s)}return r}(s),v=function(r){var t=new Map;if("Video"in r.Objects.subNodes){var n=r.Objects.subNodes.Video;for(var i in n){var a=n[i];if("Content"in a.properties){var o=e(n[i]);t.set(parseInt(i),o)}}}return t}(s),g=function(e,r,n){var i=new Map;if("Material"in e.Objects.subNodes){var a=e.Objects.subNodes.Material;for(var o in a){var s=t(a[o],r,n);i.set(parseInt(o),s)}}return i}(s,function(e,t,n,i){var a=new Map;if("Texture"in e.Objects.subNodes){var o=e.Objects.subNodes.Texture;for(var s in o){var u=r(o[s],t,n,i);a.set(parseInt(s),u)}}return a}(s,new THREE.TextureLoader(this.manager).setPath(o),v,h),h),m=function(e,r){var t={};if("Deformer"in e.Objects.subNodes){var i=e.Objects.subNodes.Deformer;for(var a in i){var o=i[a];if("Skin"===o.attrType){var s=r.get(parseInt(a)),u=n(s,i);u.FBX_ID=parseInt(a),t[a]=u}}}return t}(s,h);return function(e,r,t,n,i){var a=new THREE.Group,o=e.Objects.subNodes.Model,s=[],p=new Map;for(var f in o){for(var l=parseInt(f),h=o[f],v=r.get(l),g=null,m=0;m<v.parents.length;++m)for(var y in t){var E=t[y],b=E.map,I=b[v.parents[m].ID];if(I){var T=g;g=new THREE.Bone,E.bones[I.index]=g,null!==T&&g.add(T)}}if(!g)switch(h.attrType){case"Mesh":for(var _=null,w=null,N=[],R=0,D=v.children.length;R<D;++R){var S=v.children[R];n.has(S.ID)&&(_=n.get(S.ID)),i.has(S.ID)&&N.push(i.get(S.ID))}if(N.length>1?w=N:N.length>0?w=N[0]:(w=new THREE.MeshBasicMaterial({color:3342591}),N.push(w)),"color"in _.attributes)for(var U=0,M=N.length;U<M;++U)N[U].vertexColors=THREE.VertexColors;if(_.FBX_Deformer){for(var O=0,P=N.length;O<P;++O)N[O].skinning=!0;g=new THREE.SkinnedMesh(_,w)}else g=new THREE.Mesh(_,w);break;case"NurbsCurve":for(var _=null,R=0,D=v.children.length;R<D;++R){var S=v.children[R];n.has(S.ID)&&(_=n.get(S.ID))}w=new THREE.LineBasicMaterial({color:3342591,linewidth:5}),g=new THREE.Line(_,w);break;default:g=new THREE.Object3D}g.name=h.attrName.replace(/:/,"").replace(/_/,"").replace(/-/,""),g.FBX_ID=l,s.push(g),p.set(l,g)}for(var X=0,z=s.length;X<z;++X){var g=s[X],h=o[g.FBX_ID];if("Lcl_Translation"in h.properties&&g.position.fromArray(A(h.properties.Lcl_Translation.value)),"Lcl_Rotation"in h.properties){var j=A(h.properties.Lcl_Rotation.value).map(L);j.push("ZYX"),g.rotation.fromArray(j)}if("Lcl_Scaling"in h.properties&&g.scale.fromArray(A(h.properties.Lcl_Scaling.value)),"PreRotation"in h.properties){var V=(new THREE.Euler).setFromVector3(F(h.properties.PreRotation).multiplyScalar(H),"ZYX");V=(new THREE.Quaternion).setFromEuler(V);var W=(new THREE.Quaternion).setFromEuler(g.rotation);V.multiply(W),g.rotation.setFromQuaternion(V,"ZYX")}for(var v=r.get(g.FBX_ID),Z=0;Z<v.parents.length;Z++){var Y=C(s,function(e){return e.FBX_ID===v.parents[Z].ID});if(Y>-1){s[Y].add(g);break}}null===g.parent&&a.add(g)}a.updateMatrixWorld(!0);var G=e.Objects.subNodes.Pose;for(var f in G)if("BindPose"===G[f].attrType){G=G[f];break}if(G)for(var $=G.subNodes.PoseNode,K=new Map,Q=0,q=$.length;Q<q;++Q){var h=$[Q],J=k(h.subNodes.Matrix.properties.a);K.set(parseInt(h.id),J)}for(var y in t){var E=t[y],b=E.map;for(var ee in b){var I=b[ee],re=I.index,te=E.bones[re];if(!K.has(te.FBX_ID))break;var ne=K.get(te.FBX_ID);te.matrixWorld.copy(ne)}E.skeleton=new THREE.Skeleton(E.bones);for(var v=r.get(E.FBX_ID),ie=v.parents,ae=0,oe=ie.length;ae<oe;++ae){var se=ie[ae];if(n.has(se.ID))for(var ue=se.ID,ce=r.get(ue),m=0;m<ce.parents.length;++m)if(p.has(ce.parents[m].ID)){var g=p.get(ce.parents[m].ID);g.bind(E.skeleton,g.matrixWorld);break}}}a.updateMatrixWorld(!0),a.skeleton={bones:s};var pe=function(e,r,t){var n=e.Objects.subNodes.AnimationCurveNode,i=e.Objects.subNodes.AnimationCurve,a=e.Objects.subNodes.AnimationLayer,o=e.Objects.subNodes.AnimationStack,s={curves:new Map,layers:{},stacks:{},length:0,fps:30,frames:0},p=[];for(var f in n)if(f.match(/\d+/)){var l=u(e,n[f],r,t);p.push(l)}for(var h=new Map,d=0;d<p.length;++d)null!==p[d]&&h.set(p[d].id,p[d]);var v=[];for(f in i)if(f.match(/\d+/)){var g={version:null,id:(I=i[f]).id,internalID:I.id,times:A(I.subNodes.KeyTime.properties.a).map(B),values:A(I.subNodes.KeyValueFloat.properties.a),attrFlag:x(I.subNodes.KeyAttrFlags.properties.a),attrData:A(I.subNodes.KeyAttrDataFloat.properties.a)};if(!r.has(g.id))continue;v.push(g);var m=r.get(g.id).parents[0],y=m.ID,E=m.relationship,b="";if(E.match(/X/))b="x";else if(E.match(/Y/))b="y";else{if(!E.match(/Z/))continue;b="z"}h.get(y).curves[b]=g}var I;for(var f in h.forEach(function(e){var r=e.containerBoneID;if(s.curves.has(r)||s.curves.set(r,{T:null,R:null,S:null}),s.curves.get(r)[e.attr]=e,"R"===e.attr){var t=e.curves;if(null===t.x&&(t.x={version:null,times:[0],values:[0]}),null===t.y&&(t.y={version:null,times:[0],values:[0]}),null===t.z&&(t.z={version:null,times:[0],values:[0]}),t.x.values=t.x.values.map(L),t.y.values=t.y.values.map(L),t.z.values=t.z.values.map(L),null!==e.preRotations){var n=(new THREE.Euler).setFromVector3(e.preRotations,"ZYX");n=(new THREE.Quaternion).setFromEuler(n);for(var i=new THREE.Euler,a=new THREE.Quaternion,o=0;o<t.x.times.length;++o)i.set(t.x.values[o],t.y.values[o],t.z.values[o],"ZYX"),a.setFromEuler(i).premultiply(n),i.setFromQuaternion(a,"ZYX"),t.x.values[o]=i.x,t.y.values[o]=i.y,t.z.values[o]=i.z}}}),a){for(var T=[],_=r.get(parseInt(f)).children,w=0;w<_.length;w++)if(h.has(_[w].ID)){var N=h.get(_[w].ID),R=N.containerBoneID;void 0===T[R]&&(T[R]={T:null,R:null,S:null}),T[R][N.attr]=N}s.layers[f]=T}for(var f in o){for(var F=[],_=r.get(parseInt(f)).children,D={max:0,min:Number.MAX_VALUE},w=0;w<_.length;++w){var k=s.layers[_[w].ID];if(void 0!==k){F.push(k);for(var S=0,H=k.length;S<H;++S){var T=k[S];T&&c(T,D)}}}D.max>D.min&&(s.stacks[f]={name:o[f].attrName,layers:F,length:D.max-D.min,frames:30*(D.max-D.min)})}return s}(e,r,a);return function(e,r){void 0===e.animations&&(e.animations=[]);var t=r.stacks;for(var n in t){for(var i=t[n],a={name:i.name,fps:30,length:i.length,hierarchy:[]},o=e.skeleton.bones,s=0,u=o.length;s<u;++s){var c=o[s],p=c.name.replace(/.*:/,""),f=C(o,function(e){return c.parent===e});a.hierarchy.push({parent:f,name:p,keys:[]})}for(var l=0;l<=i.frames;l++)for(var s=0,u=o.length;s<u;++s)for(var c=o[s],h=s,v=i.layers[0][h],g=0,m=a.hierarchy.length;g<m;++g){var y=a.hierarchy[g];y.name===c.name&&y.keys.push(d(r,v,c,l))}e.animations.push(THREE.AnimationClip.parseAnimation(a,o))}}(a,pe),a}(s,h,m,function(e,r,t){var n=new Map;if("Geometry"in e.Objects.subNodes){var a=e.Objects.subNodes.Geometry;for(var o in a){var s=r.get(parseInt(o)),u=i(a[o],s,t);n.set(parseInt(o),u)}}return n}(s,h,m),g)}});var a=[],o={ByPolygonVertex:{Direct:function(e,r,t,n){var i=e*n.dataSize,o=e*n.dataSize+n.dataSize;return M(a,n.buffer,i,o)},IndexToDirect:function(e,r,t,n){var i=n.indices[e],o=i*n.dataSize,s=i*n.dataSize+n.dataSize;return M(a,n.buffer,o,s)}},ByPolygon:{Direct:function(e,r,t,n){var i=r*n.dataSize,o=r*n.dataSize+n.dataSize;return M(a,n.buffer,i,o)},IndexToDirect:function(e,r,t,n){var i=n.indices[r],o=i*n.dataSize,s=i*n.dataSize+n.dataSize;return M(a,n.buffer,o,s)}},ByVertice:{Direct:function(e,r,t,n){var i=t*n.dataSize,o=t*n.dataSize+n.dataSize;return M(a,n.buffer,i,o)}},AllSame:{IndexToDirect:function(e,r,t,n){var i=n.indices[0]*n.dataSize,o=n.indices[0]*n.dataSize+n.dataSize;return M(a,n.buffer,i,o)}}};function s(e,r,t,n){return o[n.mappingType][n.referenceType](e,r,t,n)}function u(e,r,t,n){var i=e.Objects.subNodes.Model,a={id:r.id,attr:r.attrName,internalID:r.id,attrX:!1,attrY:!1,attrZ:!1,containerBoneID:-1,containerID:-1,curves:{x:null,y:null,z:null},preRotations:null};if(!a.attr.match(/S|R|T/))return null;for(var o in r.properties)o.match(/X/)&&(a.attrX=!0),o.match(/Y/)&&(a.attrY=!0),o.match(/Z/)&&(a.attrZ=!0);for(var s=t.get(a.id).parents,u=s.length-1;u>=0;--u){var c=C(n.skeleton.bones,function(e){return e.FBX_ID===s[u].ID});if(c>-1){a.containerBoneID=c,a.containerID=s[u].ID;var p=i[a.containerID.toString()];"PreRotation"in p.properties&&(a.preRotations=F(p.properties.PreRotation).multiplyScalar(Math.PI/180));break}}return a}function c(e,r){e.R&&p(e.R.curves,r),e.S&&p(e.S.curves,r),e.T&&p(e.T.curves,r)}function p(e,r){e.x&&f(e.x,r),e.y&&f(e.y,r),e.z&&f(e.z,r)}function f(e,r){r.max=e.times[e.times.length-1]>r.max?e.times[e.times.length-1]:r.max,r.min=e.times[0]<r.min?e.times[0]:r.min}var l=new THREE.Euler,h=new THREE.Quaternion;function d(e,r,t,n){var i={time:n/e.fps,pos:t.position.toArray(),rot:t.quaternion.toArray(),scl:t.scale.toArray()};if(void 0===r)return i;try{if(g(r,"T")&&m(r.T,n)&&(i.pos=[r.T.curves.x.values[n],r.T.curves.y.values[n],r.T.curves.z.values[n]]),g(r,"R")&&m(r.R,n)){var a=r.R.curves.x.values[n],o=r.R.curves.y.values[n],s=r.R.curves.z.values[n];h.setFromEuler(l.set(a,o,s,"ZYX")),i.rot=h.toArray()}g(r,"S")&&m(r.S,n)&&(i.scl=[r.S.curves.x.values[n],r.S.curves.y.values[n],r.S.curves.z.values[n]])}catch(e){console.log("THREE.FBXLoader: ",t),console.log("THREE.FBXLoader: ",e)}return i}var v=["x","y","z"];function g(e,r){if(void 0===e)return!1;var t=e[r];return!!t&&v.every(function(e){return null!==t.curves[e]})}function m(e,r){return v.every(function(t){return n=e.curves[t],i=r,void 0!==n.values[i];var n,i})}function y(){this.position=new THREE.Vector3,this.normal=new THREE.Vector3,this.uv=new THREE.Vector2,this.color=new THREE.Vector3,this.skinIndices=new THREE.Vector4(0,0,0,0),this.skinWeights=new THREE.Vector4(0,0,0,0)}function E(){this.vertices=[]}function b(){this.triangles=[],this.materialIndex=0}function I(){this.faces=[],this.skeleton=null}function T(){}function _(){}function w(e,r){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===r||r}function N(){}function R(e){var r=e.match(/FBXVersion: (\d+)/);if(r)return parseInt(r[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function B(e){return e/46186158e3}function A(e){for(var r=e.split(","),t=0,n=r.length;t<n;t++)r[t]=parseFloat(r[t]);return r}function x(e){for(var r=e.split(","),t=0,n=r.length;t<n;t++)r[t]=parseInt(r[t]);return r}function F(e){return(new THREE.Vector3).fromArray(e.value)}function D(e){return(new THREE.Color).fromArray(e.value)}function k(e){return(new THREE.Matrix4).fromArray(A(e))}function S(e,r,t){void 0===r&&(r=0),void 0===t&&(t=e.byteLength);var n=new Uint8Array(e,r,t);if(void 0!==window.TextDecoder)return(new TextDecoder).decode(n);for(var i="",a=0,o=n.length;a<o;a++)i+=String.fromCharCode(n[a]);return i}function L(e){return e*H}Object.assign(y.prototype,{copy:function(e){var r=e||new y;return r.position.copy(this.position),r.normal.copy(this.normal),r.uv.copy(this.uv),r.skinIndices.copy(this.skinIndices),r.skinWeights.copy(this.skinWeights),r},flattenToBuffers:function(e,r,t,n,i,a){this.position.toArray(e,e.length),this.normal.toArray(r,r.length),this.uv.toArray(t,t.length),this.color.toArray(n,n.length),this.skinIndices.toArray(i,i.length),this.skinWeights.toArray(a,a.length)}}),Object.assign(E.prototype,{copy:function(e){for(var r=e||new E,t=0;t<this.vertices.length;++t)this.vertices[t].copy(r.vertices[t]);return r},flattenToBuffers:function(e,r,t,n,i,a){for(var o=this.vertices,s=0,u=o.length;s<u;++s)o[s].flattenToBuffers(e,r,t,n,i,a)}}),Object.assign(b.prototype,{copy:function(e){for(var r=e||new b,t=0;t<this.triangles.length;++t)this.triangles[t].copy(r.triangles[t]);return r.materialIndex=this.materialIndex,r},genTrianglesFromVertices:function(e){for(var r=2;r<e.length;++r){var t=new E;t.vertices[0]=e[0],t.vertices[1]=e[r-1],t.vertices[2]=e[r],this.triangles.push(t)}},flattenToBuffers:function(e,r,t,n,i,a,o){for(var s=this.triangles,u=this.materialIndex,c=0,p=s.length;c<p;++c)s[c].flattenToBuffers(e,r,t,n,i,a),U(o,[u,u,u])}}),Object.assign(I.prototype,{flattenToBuffers:function(){for(var e=[],r=[],t=[],n=[],i=[],a=[],o=[],s=this.faces,u=0,c=s.length;u<c;++u)s[u].flattenToBuffers(e,r,t,n,i,a,o);return{vertexBuffer:e,normalBuffer:r,uvBuffer:t,colorBuffer:n,skinIndexBuffer:i,skinWeightBuffer:a,materialIndexBuffer:o}}}),Object.assign(T.prototype,{getPrevNode:function(){return this.nodeStack[this.currentIndent-2]},getCurrentNode:function(){return this.nodeStack[this.currentIndent-1]},getCurrentProp:function(){return this.currentProp},pushStack:function(e){this.nodeStack.push(e),this.currentIndent+=1},popStack:function(){this.nodeStack.pop(),this.currentIndent-=1},setCurrentProp:function(e,r){this.currentProp=e,this.currentPropName=r},parse:function(e){this.currentIndent=0,this.allNodes=new N,this.nodeStack=[],this.currentProp=[],this.currentPropName="";for(var r=e.split("\n"),t=0,n=r.length;t<n;t++){if(!(u=r[t]).match(/^[\s\t]*;/)&&!u.match(/^[\s\t]*$/)){var i=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):(.*){","");if(c=u.match(i)){for(var a=c[1].trim().replace(/^"/,"").replace(/"$/,""),o=c[2].split(","),s=0,u=o.length;s<u;s++)o[s]=o[s].trim().replace(/^"/,"").replace(/"$/,"");this.parseNodeBegin(u,a,o||null)}else{var c,p=new RegExp("^\\t{"+this.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)");if(c=u.match(p)){var f=c[1].replace(/^"/,"").replace(/"$/,"").trim(),l=c[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===f&&","===l&&(l=r[++t].replace(/"/g,"").trim()),this.parseNodeProperty(u,f,l)}else{var h=new RegExp("^\\t{"+(this.currentIndent-1)+"}}");u.match(h)?this.nodeEnd():u.match(/^[^\s\t}]/)&&this.parseNodePropertyContinued(u)}}}}return this.allNodes},parseNodeBegin:function(e,r,t){var n={name:r,properties:{},subNodes:{}},i=this.parseNodeAttr(t),a=this.getCurrentNode();if(0===this.currentIndent)this.allNodes.add(r,n);else if(r in a.subNodes){var o=a.subNodes[r];this.isFlattenNode(a.subNodes[r])&&(""===i.id?(a.subNodes[r]=[],a.subNodes[r].push(o)):(a.subNodes[r]={},a.subNodes[r][o.id]=o)),""===i.id?a.subNodes[r].push(n):a.subNodes[r][i.id]=n}else"number"==typeof i.id||i.id.match(/^\d+$/)?(a.subNodes[r]={},a.subNodes[r][i.id]=n):a.subNodes[r]=n;t&&(n.id=i.id,n.attrName=i.name,n.attrType=i.type),this.pushStack(n)},parseNodeAttr:function(e){var r=e[0];""!==e[0]&&(r=parseInt(e[0]),isNaN(r)&&(r=e[0]));var t="",n="";return e.length>1&&(t=e[1].replace(/^(\w+)::/,""),n=e[2]),{id:r,name:t,type:n}},parseNodeProperty:function(e,r,t){var n=this.getCurrentNode(),i=n.name;if(void 0!==i&&i.match(/Properties(\d)+/))return void this.parseNodeSpecialProperty(e,r,t);if("C"===r){var a=t.split(",").slice(1),o=parseInt(a[0]),s=parseInt(a[1]),u=t.split(",").slice(3);r="connections",U(t=[o,s],u),void 0===n.properties[r]&&(n.properties[r]=[])}if("Node"===r){var c=parseInt(t);n.properties.id=c,n.id=c}r in n.properties?Array.isArray(n.properties[r])?n.properties[r].push(t):n.properties[r]+=t:Array.isArray(n.properties[r])?n.properties[r].push(t):n.properties[r]=t,this.setCurrentProp(n.properties,r)},parseNodePropertyContinued:function(e){this.currentProp[this.currentPropName]+=e},parseNodeSpecialProperty:function(e,r,t){for(var n=t.split('",'),i=0,a=n.length;i<a;i++)n[i]=n[i].trim().replace(/^\"/,"").replace(/\s/,"_");var o=n[0],s=n[1],u=n[2],c=n[3],p=n[4];switch(s){case"int":p=parseInt(p);break;case"double":p=parseFloat(p);break;case"ColorRGB":case"Vector3D":p=A(p)}this.getPrevNode().properties[o]={type:s,type2:u,flag:c,value:p},this.setCurrentProp(this.getPrevNode().properties,o)},nodeEnd:function(){this.popStack()},isFlattenNode:function(e){return"subNodes"in e&&"properties"in e}}),Object.assign(_.prototype,{parse:function(e){var r=new w(e);r.skip(23);var t=r.getUint32();console.log("THREE.FBXLoader: FBX binary version: "+t);for(var n=new N;!this.endOfContent(r);){var i=this.parseNode(r,t);null!==i&&n.add(i.name,i)}return n},endOfContent:function(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()},parseNode:function(e,r){var t=r>=7500?e.getUint64():e.getUint32(),n=r>=7500?e.getUint64():e.getUint32(),i=(r>=7500?e.getUint64():e.getUint32(),e.getUint8()),a=e.getString(i);if(0===t)return null;for(var o=[],s=0;s<n;s++)o.push(this.parseProperty(e));var u=o.length>0?o[0]:"",c=o.length>1?o[1]:"",p=o.length>2?o[2]:"",f={},l={},h=!1;for(1===n&&e.getOffset()===t&&(h=!0);t>e.getOffset();){var d=this.parseNode(e,r);if(null!==d)if(!0!==d.singleProperty)if("Connections"!==a||"C"!==d.name)if(d.name.match(/^Properties\d+$/)){var v=Object.keys(d.properties);for(s=0,_=v.length;s<_;s++){var g=v[s];l[g]=d.properties[g]}}else if(a.match(/^Properties\d+$/)&&"P"===d.name){var m,y=d.propertyList[0],E=d.propertyList[1],b=d.propertyList[2],I=d.propertyList[3];0===y.indexOf("Lcl ")&&(y=y.replace("Lcl ","Lcl_")),0===E.indexOf("Lcl ")&&(E=E.replace("Lcl ","Lcl_")),m="ColorRGB"===E||"Vector"===E||"Vector3D"===E||0===E.indexOf("Lcl_")?[d.propertyList[4],d.propertyList[5],d.propertyList[6]]:d.propertyList[4],0===E.indexOf("Lcl_")&&(m=m.toString()),l[y]={type:E,type2:b,flag:I,value:m}}else void 0===f[d.name]?"number"==typeof d.id?(f[d.name]={},f[d.name][d.id]=d):f[d.name]=d:""===d.id?(Array.isArray(f[d.name])||(f[d.name]=[f[d.name]]),f[d.name].push(d)):void 0===f[d.name][d.id]?f[d.name][d.id]=d:(Array.isArray(f[d.name][d.id])||(f[d.name][d.id]=[f[d.name][d.id]]),f[d.name][d.id].push(d));else{for(var T=[],s=1,_=d.propertyList.length;s<_;s++)T[s-1]=d.propertyList[s];void 0===l.connections&&(l.connections=[]),l.connections.push(T)}else{var w=d.propertyList[0];Array.isArray(w)?(d.properties[d.name]=d.propertyList[0],f[d.name]=d,d.properties.a=w.toString()):l[d.name]=w}}return{singleProperty:h,id:u,attrName:c,attrType:p,name:a,properties:l,propertyList:o,subNodes:f}},parseProperty:function(e){var r=e.getChar();switch(r){case"F":return e.getFloat32();case"D":return e.getFloat64();case"L":return e.getInt64();case"I":return e.getInt32();case"Y":return e.getInt16();case"C":return e.getBoolean();case"f":case"d":case"l":case"i":case"b":var t=e.getUint32(),n=e.getUint32(),i=e.getUint32();if(0===n)switch(r){case"f":return e.getFloat32Array(t);case"d":return e.getFloat64Array(t);case"l":return e.getInt64Array(t);case"i":return e.getInt32Array(t);case"b":return e.getBooleanArray(t)}if(void 0===window.Zlib)throw new Error("THREE.FBXLoader: External library Inflate.min.js required, obtain or import from https://github.com/imaya/zlib.js");var a=new w(new Zlib.Inflate(new Uint8Array(e.getArrayBuffer(i))).decompress().buffer);switch(r){case"f":return a.getFloat32Array(t);case"d":return a.getFloat64Array(t);case"l":return a.getInt64Array(t);case"i":return a.getInt32Array(t);case"b":return a.getBooleanArray(t)}case"S":var o=e.getUint32();return e.getString(o);case"R":o=e.getUint32();return e.getArrayBuffer(o);default:throw new Error("THREE.FBXLoader: Unknown property type "+r)}}}),Object.assign(w.prototype,{getOffset:function(){return this.offset},size:function(){return this.dv.buffer.byteLength},skip:function(e){this.offset+=e},getBoolean:function(){return 1==(1&this.getUint8())},getBooleanArray:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getBoolean());return r},getInt8:function(){var e=this.dv.getInt8(this.offset);return this.offset+=1,e},getInt8Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getInt8());return r},getUint8:function(){var e=this.dv.getUint8(this.offset);return this.offset+=1,e},getUint8Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getUint8());return r},getInt16:function(){var e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e},getInt16Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getInt16());return r},getUint16:function(){var e=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,e},getUint16Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getUint16());return r},getInt32:function(){var e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e},getInt32Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getInt32());return r},getUint32:function(){var e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e},getUint32Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getUint32());return r},getInt64:function(){var e,r;return this.littleEndian?(e=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),e=this.getUint32()),2147483648&r?(r=4294967295&~r,4294967295===(e=4294967295&~e)&&(r=r+1&4294967295),-(4294967296*r+(e=e+1&4294967295))):4294967296*r+e},getInt64Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getInt64());return r},getUint64:function(){var e,r;return this.littleEndian?(e=this.getUint32(),r=this.getUint32()):(r=this.getUint32(),e=this.getUint32()),4294967296*r+e},getUint64Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getUint64());return r},getFloat32:function(){var e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e},getFloat32Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getFloat32());return r},getFloat64:function(){var e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e},getFloat64Array:function(e){for(var r=[],t=0;t<e;t++)r.push(this.getFloat64());return r},getArrayBuffer:function(e){var r=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,r},getChar:function(){return String.fromCharCode(this.getUint8())},getString:function(e){for(var r="";e>0;){var t=this.getUint8();if(e--,0===t)break;r+=String.fromCharCode(t)}return this.skip(e),r}}),Object.assign(N.prototype,{add:function(e,r){this[e]=r},searchConnectionParent:function(e){if(void 0===this.__cache_search_connection_parent&&(this.__cache_search_connection_parent=[]),void 0!==this.__cache_search_connection_parent[e])return this.__cache_search_connection_parent[e];this.__cache_search_connection_parent[e]=[];for(var r=this.Connections.properties.connections,t=[],n=0;n<r.length;++n)if(r[n][0]==e){var i=0===r[n][1]?-1:r[n][1];t.push(i)}return t.length>0?(U(this.__cache_search_connection_parent[e],t),t):(this.__cache_search_connection_parent[e]=[-1],[-1])},searchConnectionChildren:function(e){if(void 0===this.__cache_search_connection_children&&(this.__cache_search_connection_children=[]),void 0!==this.__cache_search_connection_children[e])return this.__cache_search_connection_children[e];this.__cache_search_connection_children[e]=[];for(var r=this.Connections.properties.connections,t=[],n=0;n<r.length;++n)r[n][1]==e&&t.push(0===r[n][0]?-1:r[n][0]);return t.length>0?(U(this.__cache_search_connection_children[e],t),t):(this.__cache_search_connection_children[e]=[],[])},searchConnectionType:function(e,r){var t=e+","+r;if(void 0===this.__cache_search_connection_type&&(this.__cache_search_connection_type={}),void 0!==this.__cache_search_connection_type[t])return this.__cache_search_connection_type[t];this.__cache_search_connection_type[t]="";for(var n=this.Connections.properties.connections,i=0;i<n.length;++i)if(n[i][0]==e&&n[i][1]==r)return this.__cache_search_connection_type[t]=n[i][2],n[i][2];return this.__cache_search_connection_type[e]=null,null}});var H=Math.PI/180;function C(e,r){for(var t=0,n=e.length;t<n;t++)if(r(e[t]))return t;return-1}function U(e,r){for(var t=0,n=e.length,i=r.length;t<i;t++,n++)e[n]=r[t]}function M(e,r,t,n){for(var i=t,a=0;i<n;i++,a++)e[a]=r[i];return e}}();