"use strict";void 0===THREE.OBJLoader2&&(THREE.OBJLoader2={}),void 0===THREE.LoaderSupport&&console.error('"THREE.LoaderSupport" is not available. "THREE.OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.'),THREE.OBJLoader2=function(){var e="2.2.1",t=THREE.LoaderSupport.LoaderBase,o=THREE.LoaderSupport.Validator,s=THREE.LoaderSupport.ConsoleLogger;function r(t,s){THREE.LoaderSupport.LoaderBase.call(this,t,s),this.logger.logInfo("Using THREE.OBJLoader2 version: "+e),this.materialPerSmoothingGroup=!1,this.fileLoader=o.verifyInput(this.fileLoader,new THREE.FileLoader(this.manager)),this.workerSupport=null,this.terminateWorkerOnLoad=!0}r.prototype=Object.create(THREE.LoaderSupport.LoaderBase.prototype),r.prototype.constructor=r,r.prototype.setMaterialPerSmoothingGroup=function(e){this.materialPerSmoothingGroup=!0===e},r.prototype.load=function(e,t,s,r,i,a){var n=this;if(!o.isValid(s)){var l=0,u=0;s=function(t){if(t.lengthComputable&&(u=t.loaded/t.total)>l){l=u;var o='Download of "'+e+'": '+(100*u).toFixed(2)+"%";n.onProgress("progressLoad",o,u)}}}o.isValid(r)||(r=function(t){var o='Error occurred while downloading "'+e+'"';n.logger.logError(o+": "+t),n.onProgress("error",o,-1)}),this.fileLoader.setPath(this.path),this.fileLoader.setResponseType("arraybuffer"),this.fileLoader.load(e,function(e){if(a)n.parseAsync(e,t);else{var o=new THREE.LoaderSupport.Callbacks;o.setCallbackOnMeshAlter(i),n._setCallbacks(o),t({detail:{loaderRootNode:n.parse(e),modelName:n.modelName,instanceNo:n.instanceNo}})}},s,r)},r.prototype.run=function(e,t){this._applyPrepData(e);var s=this._checkFiles(e.resources);o.isValid(t)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=t,this.logger=t.logger);var r=this;this._loadMtl(s.mtl,function(t){r.builder.setMaterials(t),o.isValid(s.obj.content)?e.useAsync?r.parseAsync(s.obj.content,r.callbacks.onLoad):r.parse(s.obj.content):(r.setPath(s.obj.path),r.load(s.obj.name,r.callbacks.onLoad,null,null,r.callbacks.onMeshAlter,e.useAsync))},e.crossOrigin)},r.prototype._applyPrepData=function(e){THREE.LoaderSupport.LoaderBase.prototype._applyPrepData.call(this,e),o.isValid(e)&&this.setMaterialPerSmoothingGroup(e.materialPerSmoothingGroup)},r.prototype.parse=function(e){this.logger.logTimeStart("OBJLoader2 parse: "+this.modelName);var t=new a;t.setLogConfig(this.logger.enabled,this.logger.debug),t.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),t.setUseIndices(this.useIndices),t.setDisregardNormals(this.disregardNormals),t.setMaterials(this.builder.getMaterials());var o=this;t.setCallbackBuilder(function(e){var t,s=o.builder.processPayload(e);for(var r in s)t=s[r],o.loaderRootNode.add(t)});if(t.setCallbackProgress(function(e,t){o.onProgress("progressParse",e,t)}),e instanceof ArrayBuffer||e instanceof Uint8Array)this.logger.logInfo("Parsing arrayBuffer..."),t.parse(e);else{if(!("string"==typeof e||e instanceof String))throw"Provided content was neither of type String nor Uint8Array! Aborting...";this.logger.logInfo("Parsing text..."),t.parseText(e)}return this.logger.logTimeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},r.prototype.parseAsync=function(e,r){this.logger.logTimeStart("OBJLoader2 parseAsync: "+this.modelName);var u=this;this.workerSupport=o.verifyInput(this.workerSupport,new THREE.LoaderSupport.WorkerSupport(this.logger));this.workerSupport.validate(function(e,r){var u="";return u+="/**\n",u+="  * This code was constructed by OBJLoader2 buildCode.\n",u+="  */\n\n",u+=e("Validator",o),u+=r("ConsoleLogger","ConsoleLogger",s),u+=r("LoaderBase","LoaderBase",t),u+=e("Consts",i),u+=r("Parser","Parser",a),u+=r("RawMesh","RawMesh",n),u+=r("RawMeshSubGroup","RawMeshSubGroup",l)},!1),this.workerSupport.setCallbacks(function(e){var t,o=u.builder.processPayload(e);for(var s in o)t=o[s],u.loaderRootNode.add(t)},function(){r({detail:{loaderRootNode:u.loaderRootNode,modelName:u.modelName,instanceNo:u.instanceNo}}),u.logger.logTimeEnd("OBJLoader2 parseAsync: "+u.modelName)}),u.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var h={},p=this.builder.getMaterials();for(var c in p)h[c]=c;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logger:{debug:this.logger.debug,enabled:this.logger.enabled},materials:{materials:h},data:{input:e,options:null}})};var i={CODE_LF:10,CODE_CR:13,CODE_SPACE:32,CODE_SLASH:47,STRING_LF:"\n",STRING_CR:"\r",STRING_SPACE:" ",STRING_SLASH:"/",LINE_F:"f",LINE_G:"g",LINE_L:"l",LINE_O:"o",LINE_S:"s",LINE_V:"v",LINE_VT:"vt",LINE_VN:"vn",LINE_MTLLIB:"mtllib",LINE_USEMTL:"usemtl"},a=function(){var e=THREE.LoaderSupport.ConsoleLogger;function t(){this.callbackProgress=null,this.callbackBuilder=null,this.materials={},this.rawMesh=null,this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useIndices=!1,this.disregardNormals=!1,this.inputObjectCount=1,this.outputObjectCount=1,this.counts={vertices:0,faces:0,doubleIndicesCount:0},this.logger=new e,this.totalBytes=0}return t.prototype.setUseAsync=function(e){this.useAsync=e},t.prototype.setMaterialPerSmoothingGroup=function(e){this.materialPerSmoothingGroup=e},t.prototype.setUseIndices=function(e){this.useIndices=e},t.prototype.setDisregardNormals=function(e){this.disregardNormals=e},t.prototype.setMaterials=function(e){this.materials=o.verifyInput(e,this.materials),this.materials=o.verifyInput(this.materials,{})},t.prototype.setCallbackBuilder=function(e){if(this.callbackBuilder=e,!o.isValid(this.callbackBuilder))throw'Unable to run as no "builder" callback is set.'},t.prototype.setCallbackProgress=function(e){this.callbackProgress=e},t.prototype.setLogConfig=function(e,t){this.logger.setEnabled(e),this.logger.setDebug(t)},t.prototype.configure=function(){if(this.rawMesh=new n(this.materialPerSmoothingGroup,this.useIndices,this.disregardNormals),this.logger.isEnabled()){var e=Object.keys(this.materials),t="OBJLoader2.Parser configuration:"+(e.length>0?"\n\tmaterialNames:\n\t\t- "+e.join("\n\t\t- "):"\n\tmaterialNames: None")+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackBuilderName: "+this.callbackBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name;this.logger.logInfo(t)}},t.prototype.parse=function(e){this.logger.logTimeStart("OBJLoader2.Parser.parse"),this.configure();var t=new Uint8Array(e),o=t.byteLength;this.totalBytes=o;for(var s,r=new Array(128),a=0,n=new Array(16),l=0,u="",h=0;h<o;h++)switch(s=t[h]){case i.CODE_SPACE:u.length>0&&(r[a++]=u),n[l++]=0,u="";break;case i.CODE_SLASH:u.length>0&&(r[a++]=u),n[l++]=1,u="";break;case i.CODE_LF:u.length>0&&(r[a++]=u),u="",this.processLine(r,a,n,l,h),a=0,l=0;break;case i.CODE_CR:break;default:u+=String.fromCharCode(s)}this.finalize(h),this.logger.logTimeEnd("OBJLoader2.Parser.parse")},t.prototype.parseText=function(e){this.logger.logTimeStart("OBJLoader2.Parser.parseText"),this.configure();var t=e.length;this.totalBytes=t;for(var o,s=new Array(128),r=0,a=new Array(16),n=0,l="",u=0;u<t;u++)switch(o=e[u]){case i.STRING_SPACE:l.length>0&&(s[r++]=l),a[n++]=0,l="";break;case i.STRING_SLASH:l.length>0&&(s[r++]=l),a[n++]=1,l="";break;case i.STRING_LF:l.length>0&&(s[r++]=l),l="",this.processLine(s,r,a,n,u),r=0,n=0;break;case i.STRING_CR:break;default:l+=o}this.finalize(u),this.logger.logTimeEnd("OBJLoader2.Parser.parseText")},t.prototype.processLine=function(e,t,o,s,r){if(!(t<1)){var a=function(e,t){for(var o=0,s=0;s<t;s++)o+=e[s];return o},n=function(e,t,o){var s="";if(2===t)s=e[1];else{for(var r=t-1,i=1;i<r;i++)s+=e[i]+(0===o[i]?" ":"/");s+=e[r]}return s},l=function(e,t){for(var o=0;o<t;o++)e[o]=""};switch(e[0]){case i.LINE_V:this.rawMesh.pushVertex(e,t>4);break;case i.LINE_VT:this.rawMesh.pushUv(e);break;case i.LINE_VN:this.rawMesh.pushNormal(e);break;case i.LINE_F:this.rawMesh.processFaces(e,t,a(o,s));break;case i.LINE_L:this.rawMesh.processLines(e,t,a(o,s));break;case i.LINE_S:this.rawMesh.pushSmoothingGroup(e[1]),l(e,t);break;case i.LINE_G:this.processCompletedMesh(r),this.rawMesh.pushGroup(n(e,t,o)),l(e,t);break;case i.LINE_O:this.rawMesh.pushObject(n(e,t,o)),l(e,t);break;case i.LINE_MTLLIB:this.rawMesh.pushMtllib(n(e,t,o)),l(e,t);break;case i.LINE_USEMTL:this.rawMesh.pushUsemtl(n(e,t,o)),l(e,t)}}},t.prototype.createRawMeshReport=function(e,t){var o=e.createReport(t);return"Input Object number: "+t+"\n\tObject name: "+o.objectName+"\n\tGroup name: "+o.groupName+"\n\tMtllib name: "+o.mtllibName+"\n\tVertex count: "+o.vertexCount+"\n\tNormal count: "+o.normalCount+"\n\tUV count: "+o.uvCount+"\n\tSmoothingGroup count: "+o.smoothingGroupCount+"\n\tMaterial count: "+o.mtlCount+"\n\tReal RawMeshSubGroup count: "+o.subGroups},t.prototype.processCompletedMesh=function(e){var t=this.rawMesh.finalize();if(o.isValid(t)){if(this.rawMesh.colors.length>0&&this.rawMesh.colors.length!==this.rawMesh.vertices.length)throw"Vertex Colors were detected, but vertex count and color count do not match!";this.logger.isDebug()&&this.logger.logDebug(this.createRawMeshReport(this.rawMesh,this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(t,e);var s=e/this.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*s).toFixed(2)+"%",s),this.rawMesh.reset(this.rawMesh.smoothingGroup.splitMaterials),!0}return!1},t.prototype.finalize=function(e){if(this.logger.logInfo("Global output object count: "+this.outputObjectCount),this.processCompletedMesh(e)&&this.logger.isEnabled()){var t="Overall counts: \n\tVertices: "+this.counts.vertices+"\n\tFaces: "+this.counts.faces+"\n\tMultiple definitions: "+this.counts.doubleIndicesCount;this.logger.logInfo(t)}},t.prototype.buildMesh=function(e,t){var s=e.subGroups,r=new Float32Array(e.absoluteVertexCount);this.counts.vertices+=e.absoluteVertexCount/3,this.counts.faces+=e.faceCount,this.counts.doubleIndicesCount+=e.doubleIndicesCount;var i,a,n,l,u,h,p,c=e.absoluteIndexCount>0?new Uint32Array(e.absoluteIndexCount):null,d=e.absoluteColorCount>0?new Float32Array(e.absoluteColorCount):null,g=e.absoluteNormalCount>0?new Float32Array(e.absoluteNormalCount):null,m=e.absoluteUvCount>0?new Float32Array(e.absoluteUvCount):null,f=o.isValid(d),b=[],v=s.length>1,N=0,y=[],L=[],C=0,E=0,I=0,M=0,S=0,w=0,G=0;for(var T in s)if(s.hasOwnProperty(T)){if(h=(p=(i=s[T]).materialName)+(f?"_vertexColor":"")+(0===i.smoothingGroup?"_flat":""),l=this.materials[p],u=this.materials[h],!o.isValid(l)&&!o.isValid(u)){var P=f?"vertexColorMaterial":"defaultMaterial";l=this.materials[P],this.logger.logWarn('object_group "'+i.objectName+"_"+i.groupName+'" was defined with unresolvable material "'+p+'"! Assigning "'+P+'".'),(p=P)===h&&(u=l,h=P)}if(!o.isValid(u)){var k={materialNameOrg:p,materialName:h,materialProperties:{vertexColors:f?2:0,flatShading:0===i.smoothingGroup}},R={cmd:"materialData",materials:{materialCloneInstructions:k}};this.callbackBuilder(R),this.useAsync&&(this.materials[h]=k)}if(v?((a=y[h])||(a=N,y[h]=N,b.push(h),N++),n={start:w,count:G=this.useIndices?i.indices.length:i.vertices.length/3,index:a},L.push(n),w+=G):b.push(h),r.set(i.vertices,C),C+=i.vertices.length,c&&(c.set(i.indices,E),E+=i.indices.length),d&&(d.set(i.colors,I),I+=i.colors.length),g&&(g.set(i.normals,M),M+=i.normals.length),m&&(m.set(i.uvs,S),S+=i.uvs.length),this.logger.isDebug()){var _=o.isValid(a)?"\n\t\tmaterialIndex: "+a:"",O="Output Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+i.groupName+_+"\n\t\tmaterialName: "+i.materialName+"\n\t\tsmoothingGroup: "+i.smoothingGroup+"\n\t\tobjectName: "+i.objectName+"\n\t\t#vertices: "+i.vertices.length/3+"\n\t\t#indices: "+i.indices.length+"\n\t\t#colors: "+i.colors.length/3+"\n\t\t#uvs: "+i.uvs.length/2+"\n\t\t#normals: "+i.normals.length/3;this.logger.logDebug(O)}}this.outputObjectCount++,this.callbackBuilder({cmd:"meshData",progress:{numericalValue:t/this.totalBytes},params:{meshName:e.name},materials:{multiMaterial:v,materialNames:b,materialGroups:L},buffers:{vertices:r,indices:c,colors:d,normals:g,uvs:m}},[r.buffer],o.isValid(c)?[c.buffer]:null,o.isValid(d)?[d.buffer]:null,o.isValid(g)?[g.buffer]:null,o.isValid(m)?[m.buffer]:null)},t}(),n=function(){function e(e,t,o){this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.useIndices=!0===t,this.disregardNormals=!0===o,this.objectName="",this.groupName="",this.activeMtlName="",this.mtllibName="",this.reset(e)}return e.prototype.reset=function(e){this.subGroups=[],this.subGroupInUse=null,this.smoothingGroup={splitMaterials:!0===e,normalized:-1,real:-1},this.pushSmoothingGroup(1),this.doubleIndicesCount=0,this.faceCount=0,this.mtlCount=0,this.smoothingGroupCount=0},e.prototype.pushVertex=function(e,t){this.vertices.push(parseFloat(e[1])),this.vertices.push(parseFloat(e[2])),this.vertices.push(parseFloat(e[3])),t&&(this.colors.push(parseFloat(e[4])),this.colors.push(parseFloat(e[5])),this.colors.push(parseFloat(e[6])))},e.prototype.pushUv=function(e){this.uvs.push(parseFloat(e[1])),this.uvs.push(parseFloat(e[2]))},e.prototype.pushNormal=function(e){this.normals.push(parseFloat(e[1])),this.normals.push(parseFloat(e[2])),this.normals.push(parseFloat(e[3]))},e.prototype.pushGroup=function(e){this.groupName=o.verifyInput(e,"")},e.prototype.pushObject=function(e){this.objectName=o.verifyInput(e,"")},e.prototype.pushMtllib=function(e){this.mtllibName=o.verifyInput(e,"")},e.prototype.pushUsemtl=function(e){this.activeMtlName!==e&&o.isValid(e)&&(this.activeMtlName=e,this.mtlCount++,this.verifyIndex())},e.prototype.pushSmoothingGroup=function(e){var t=parseInt(e);isNaN(t)&&(t="off"===e?0:1);var o=this.smoothingGroup.normalized;this.smoothingGroup.normalized=this.smoothingGroup.splitMaterials?t:0===t?0:1,this.smoothingGroup.real=t,o!==t&&(this.smoothingGroupCount++,this.verifyIndex())},e.prototype.verifyIndex=function(){var e=this.activeMtlName+"|"+this.smoothingGroup.normalized;this.subGroupInUse=this.subGroups[e],o.isValid(this.subGroupInUse)||(this.subGroupInUse=new l(this.objectName,this.groupName,this.activeMtlName,this.smoothingGroup.normalized),this.subGroups[e]=this.subGroupInUse)},e.prototype.processFaces=function(e,t,o){var s,r,i=t-1;if(0===o)for(s=2,r=i;s<r;s++)this.buildFace(e[1]),this.buildFace(e[s]),this.buildFace(e[s+1]);else if(i===2*o)for(s=3,r=i-2;s<r;s+=2)this.buildFace(e[1],e[2]),this.buildFace(e[s],e[s+1]),this.buildFace(e[s+2],e[s+3]);else if(2*i==3*o)for(s=4,r=i-3;s<r;s+=3)this.buildFace(e[1],e[2],e[3]),this.buildFace(e[s],e[s+1],e[s+2]),this.buildFace(e[s+3],e[s+4],e[s+5]);else for(s=3,r=i-2;s<r;s+=2)this.buildFace(e[1],void 0,e[2]),this.buildFace(e[s],void 0,e[s+1]),this.buildFace(e[s+2],void 0,e[s+3])},e.prototype.buildFace=function(e,t,s){var r=this.subGroupInUse;this.disregardNormals&&(s=void 0);var i=this,a=function(){var o=parseInt(e),a=3*(o>0?o-1:o+i.vertices.length/3),n=r.vertices;n.push(i.vertices[a++]),n.push(i.vertices[a++]),n.push(i.vertices[a]);var l=i.colors.length>0?a:null;if(null!==l){var u=r.colors;u.push(i.colors[l++]),u.push(i.colors[l++]),u.push(i.colors[l])}if(t){var h=parseInt(t),p=2*(h>0?h-1:h+i.uvs.length/2),c=r.uvs;c.push(i.uvs[p++]),c.push(i.uvs[p])}if(s){var d=parseInt(s),g=3*(d>0?d-1:d+i.normals.length/3),m=r.normals;m.push(i.normals[g++]),m.push(i.normals[g++]),m.push(i.normals[g])}};if(this.useIndices){var n=e+(t?"_"+t:"_n")+(s?"_"+s:"_n"),l=r.indexMappings[n];o.isValid(l)?this.doubleIndicesCount++:(l=r.vertices.length/3,a(),r.indexMappings[n]=l,r.indexMappingsCount++),r.indices.push(l)}else a();this.faceCount++},e.prototype.processLines=function(e,t,o){var s,r=1,i=t-1;if(i===2*o)for(s=i-2;r<s;r+=2)this.vertices.push(parseInt(e[r])),this.uvs.push(parseInt(e[r+1]));else for(s=i-1;r<s;r++)this.vertices.push(parseInt(e[r]))},e.prototype.finalize=function(){var e,t,o=[],s=0,r=0,i=0,a=0,n=0,l=0;for(var u in this.subGroups)if((e=this.subGroups[u]).vertices.length>0){if((t=e.indices).length>0&&r>0)for(var h in t)t[h]=t[h]+r;o.push(e),s+=e.vertices.length,r+=e.indexMappingsCount,i+=e.indices.length,a+=e.colors.length,l+=e.uvs.length,n+=e.normals.length}var p=null;return o.length>0&&(p={name:""!==this.groupName?this.groupName:this.objectName,subGroups:o,absoluteVertexCount:s,absoluteIndexCount:i,absoluteColorCount:a,absoluteNormalCount:n,absoluteUvCount:l,faceCount:this.faceCount,doubleIndicesCount:this.doubleIndicesCount}),p},e.prototype.createReport=function(){return{objectName:this.objectName,groupName:this.groupName,mtllibName:this.mtllibName,vertexCount:this.vertices.length/3,normalCount:this.normals.length/3,uvCount:this.uvs.length/2,smoothingGroupCount:this.smoothingGroupCount,mtlCount:this.mtlCount,subGroups:this.subGroups.length}},e}(),l=function(){function e(e,t,o,s){this.objectName=e,this.groupName=t,this.materialName=o,this.smoothingGroup=s,this._init()}return e.prototype._init=function(){this.vertices=[],this.indexMappingsCount=0,this.indexMappings=[],this.indices=[],this.colors=[],this.uvs=[],this.normals=[]},e}();return r.prototype._checkFiles=function(e){var t,s={mtl:null,obj:null};for(var r in e)if(t=e[r],o.isValid(t.name))if(o.isValid(t.content)){if("OBJ"===t.extension){if(!(t.content instanceof Uint8Array))throw"Provided content is not of type arraybuffer! Aborting...";s.obj=t}else if("MTL"===t.extension&&o.isValid(t.name)){if(!("string"==typeof t.content||t.content instanceof String))throw"Provided  content is not of type String! Aborting...";s.mtl=t}else if("ZIP"!==t.extension)throw'Unidentified resource "'+t.name+'": '+t.url}else{if(!("string"==typeof t.name||t.name instanceof String))throw"Provided file is not properly defined! Aborting...";if("OBJ"===t.extension)s.obj=t;else if("MTL"===t.extension)s.mtl=t;else if("ZIP"!==t.extension)throw'Unidentified resource "'+t.name+'": '+t.url}return s},r.prototype.loadMtl=function(e,t,o,s){var r=new THREE.LoaderSupport.ResourceDescriptor(e,"MTL");r.setContent(t),this._loadMtl(r,o,s)},r.prototype._loadMtl=function(e,t,s){void 0===THREE.MTLLoader&&console.error('"THREE.MTLLoader" is not available. "THREE.OBJLoader2" requires it for loading MTL files.'),o.isValid(e)&&this.logger.logTimeStart("Loading MTL: "+e.name);var r=[],i=this,a=function(s){var a=[];if(o.isValid(s))for(var n in s.preload(),a=s.materials)a.hasOwnProperty(n)&&(r[n]=a[n]);o.isValid(e)&&i.logger.logTimeEnd("Loading MTL: "+e.name),t(r)},n=new THREE.MTLLoader(this.manager);if(s=o.verifyInput(s,"anonymous"),n.setCrossOrigin(s),o.isValid(e)&&(o.isValid(e.content)||o.isValid(e.url))){if(n.setPath(e.path),o.isValid(e.content))a(o.isValid(e.content)?n.parse(e.content):null);else if(o.isValid(e.url)){n.load(e.name,a,void 0,function(t){var o='Error occurred while downloading "'+e.url+'"';throw i.logger.logError(o+": "+t),o})}}else a()},r}();