THREE.PLYLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.propertyNameMapping={}},THREE.PLYLoader.prototype={constructor:THREE.PLYLoader,load:function(e,t,n,r){var a=this,s=new THREE.FileLoader(this.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){t(a.parse(e))},n,r)},setPropertyNameMapping:function(e){this.propertyNameMapping=e},parse:function(e){function t(e){var t="",n=0,r=/ply([\s\S]*)end_header\s/.exec(e);null!==r&&(t=r[1],n=r[0].length);var a,s,i,o,u,c,p={comments:[],elements:[],headerLength:n},f=t.split("\n");for(var h=0;h<f.length;h++){var m=f[h];if(""!==(m=m.trim()))switch(s=(i=m.split(/\s+/)).shift(),m=i.join(" "),s){case"format":p.format=i[0],p.version=i[1];break;case"comment":p.comments.push(m);break;case"element":void 0!==a&&p.elements.push(a),(a={}).name=i[0],a.count=parseInt(i[1]),a.properties=[];break;case"property":a.properties.push((o=i,u=l.propertyNameMapping,c=void 0,"list"===(c={type:o[0]}).type?(c.name=o[3],c.countType=o[1],c.itemType=o[2]):c.name=o[1],c.name in u&&(c.name=u[c.name]),c));break;default:console.log("unhandled",s,i)}}return void 0!==a&&p.elements.push(a),p}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){for(var r=t.split(/\s+/),a={},s=0;s<e.length;s++)if("list"===e[s].type){for(var i=[],o=n(r.shift(),e[s].countType),u=0;u<o;u++)i.push(n(r.shift(),e[s].itemType));a[e[s].name]=i}else a[e[s].name]=n(r.shift(),e[s].type);return a}function a(e,t){var n,a={indices:[],vertices:[],normals:[],uvs:[],colors:[]},o="";null!==(n=/end_header\s([\s\S]*)$/.exec(e))&&(o=n[1]);for(var u=o.split("\n"),c=0,l=0,p=0;p<u.length;p++){var f=u[p];if(""!==(f=f.trim())){l>=t.elements[c].count&&(c++,l=0);var h=r(t.elements[c].properties,f);i(a,t.elements[c].name,h),l++}}return s(a)}function s(e){var t=new THREE.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.addAttribute("position",new THREE.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.addAttribute("normal",new THREE.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.addAttribute("uv",new THREE.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.addAttribute("color",new THREE.Float32BufferAttribute(e.colors,3)),t.computeBoundingSphere(),t}function i(e,t,n){if("vertex"===t)e.vertices.push(n.x,n.y,n.z),"nx"in n&&"ny"in n&&"nz"in n&&e.normals.push(n.nx,n.ny,n.nz),"s"in n&&"t"in n&&e.uvs.push(n.s,n.t),"red"in n&&"green"in n&&"blue"in n&&e.colors.push(n.red/255,n.green/255,n.blue/255);else if("face"===t){var r=n.vertex_indices||n.vertex_index;3===r.length?e.indices.push(r[0],r[1],r[2]):4===r.length&&(e.indices.push(r[0],r[1],r[3]),e.indices.push(r[1],r[2],r[3]))}}function o(e,t,n,r){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function u(e,t,n,r){for(var a,s={},i=0,u=0;u<n.length;u++)if("list"===n[u].type){var c=[],l=(a=o(e,t+i,n[u].countType,r))[0];i+=a[1];for(var p=0;p<l;p++)a=o(e,t+i,n[u].itemType,r),c.push(a[0]),i+=a[1];s[n[u].name]=c}else a=o(e,t+i,n[u].type,r),s[n[u].name]=a[0],i+=a[1];return[s,i]}var c,l=this;if(e instanceof ArrayBuffer){var p=THREE.LoaderUtils.decodeText(new Uint8Array(e)),f=t(p);c="ascii"===f.format?a(p,f):function(e,t){for(var n,r={indices:[],vertices:[],normals:[],uvs:[],colors:[]},a="binary_little_endian"===t.format,o=new DataView(e,t.headerLength),c=0,l=0;l<t.elements.length;l++)for(var p=0;p<t.elements[l].count;p++){c+=(n=u(o,c,t.elements[l].properties,a))[1];var f=n[0];i(r,t.elements[l].name,f)}return s(r)}(e,f)}else c=a(e,t(e));return c}};