THREE.AssimpLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.AssimpLoader.prototype={constructor:THREE.AssimpLoader,crossOrigin:"Anonymous",load:function(e,t,i,r){var s=this,n=THREE.LoaderUtils.extractUrlBase(e),m=new THREE.FileLoader(this.manager);m.setResponseType("arraybuffer"),m.load(e,function(e){t(s.parse(e,n))},i,r)},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=new THREE.TextureLoader(this.manager);i.setPath(t).setCrossOrigin(this.crossOrigin);var r={KeyFrame:function(e,t){this.time=e,this.matrix=t.clone(),this.position=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1),this.matrix.decompose(this.position,this.quaternion,this.scale),this.clone=function(){return new r.KeyFrame(this.time,this.matrix)},this.lerp=function(e,t){var i=(t-=this.time)/(e.time-this.time),s=1-i,n=this.position,m=this.quaternion,a=e.position,o=e.quaternion;return r.KeyFrame.tempAniPos.x=n.x*s+a.x*i,r.KeyFrame.tempAniPos.y=n.y*s+a.y*i,r.KeyFrame.tempAniPos.z=n.z*s+a.z*i,r.KeyFrame.tempAniQuat.set(m.x,m.y,m.z,m.w),r.KeyFrame.tempAniQuat.slerp(o,i),r.KeyFrame.tempAniMatrix.compose(r.KeyFrame.tempAniPos,r.KeyFrame.tempAniQuat,r.KeyFrame.tempAniScale)}}};r.KeyFrame.tempAniPos=new THREE.Vector3,r.KeyFrame.tempAniQuat=new THREE.Quaternion,r.KeyFrame.tempAniScale=new THREE.Vector3(1,1,1),r.KeyFrame.tempAniMatrix=new THREE.Matrix4,r.KeyFrameTrack=function(){this.keys=[],this.target=null,this.time=0,this.length=0,this._accelTable={},this.fps=20,this.addKey=function(e){this.keys.push(e)},this.init=function(){if(this.sortKeys(),this.keys.length>0?this.length=this.keys[this.keys.length-1].time:this.length=0,this.fps)for(var e=0;e<this.length*this.fps;e++)for(var t=0;t<this.keys.length;t++){if(this.keys[t].time==e){this._accelTable[e]=t;break}if(this.keys[t].time<e/this.fps&&this.keys[t+1]&&this.keys[t+1].time>=e/this.fps){this._accelTable[e]=t;break}}},this.parseFromThree=function(e){var t=e.fps;this.target=e.node;for(var i=e.hierarchy[0].keys,s=0;s<i.length;s++)this.addKey(new r.KeyFrame(s/t||i[s].time,i[s].targets[0].data));this.init()},this.parseFromCollada=function(e){for(var t=e.keys,i=this.fps,s=0;s<t.length;s++)this.addKey(new r.KeyFrame(s/i||t[s].time,t[s].matrix));this.init()},this.sortKeys=function(){this.keys.sort(this.keySortFunc)},this.keySortFunc=function(e,t){return e.time-t.time},this.clone=function(){var e=new r.KeyFrameTrack;e.target=this.target,e.time=this.time,e.length=this.length;for(var t=0;t<this.keys.length;t++)e.addKey(this.keys[t].clone());return e.init(),e},this.reTarget=function(e,t){t||(t=r.TrackTargetNodeNameCompare),this.target=t(e,this.target)},this.keySearchAccel=function(e){return e*=this.fps,e=Math.floor(e),this._accelTable[e]||0},this.setTime=function(e){e=Math.abs(e),this.length&&(e=e%this.length+.05);for(var t=null,i=null,r=this.keySearchAccel(e);r<this.keys.length;r++){if(this.keys[r].time==e){t=this.keys[r],i=this.keys[r];break}if(this.keys[r].time<e&&this.keys[r+1]&&this.keys[r+1].time>e){t=this.keys[r],i=this.keys[r+1];break}if(this.keys[r].time<e&&r==this.keys.length-1){t=this.keys[r],(i=this.keys[0].clone()).time+=this.length+.05;break}}return t&&i&&t!==i?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.lerp(i,e)),void(this.target.matrixWorldNeedsUpdate=!0)):t&&i&&t==i?(this.target.matrixAutoUpdate=!1,this.target.matrix.copy(t.matrix),void(this.target.matrixWorldNeedsUpdate=!0)):void 0}},r.TrackTargetNodeNameCompare=function(e,t){return function e(t,i){if(t.name==i)return t;for(var r=0;r<t.children.length;r++){var s=e(t.children[r],i);if(s)return s}return null}(e,t.name)},r.Animation=function(){this.tracks=[],this.length=0,this.addTrack=function(e){this.tracks.push(e),this.length=Math.max(e.length,this.length)},this.setTime=function(e){this.time=e;for(var t=0;t<this.tracks.length;t++)this.tracks[t].setTime(e)},this.clone=function(e,t){t||(t=r.TrackTargetNodeNameCompare);var i=new r.Animation;i.target=e;for(var s=0;s<this.tracks.length;s++){var n=this.tracks[s].clone();n.reTarget(e,t),i.addTrack(n)}return i}};var s=4660,n=4661,m=4662,a=4663,o=4664,h=4665,u=4666,f=4667,l=4668,c=4669,d=4670,p=1,y=2,g=4,N=256,T=65536,E=1,v=4,A=1,w=3,x=1,R=6,B=8,C=10,K=4;function k(e,t){var i=new THREE.Bone;for(var r in i.matrix.copy(e.matrix),i.matrixWorld.copy(e.matrixWorld),i.position.copy(e.position),i.quaternion.copy(e.quaternion),i.scale.copy(e.scale),t.nodeCount++,i.name="bone_"+e.name+t.nodeCount.toString(),t.nodeToBoneMap[e.name]||(t.nodeToBoneMap[e.name]=[]),t.nodeToBoneMap[e.name].push(i),e.children){var s=k(e.children[r],t);s&&i.add(s)}return i}function M(e,t){for(var i=[],r=0;r<e.length;r++)i.push({i:e[r],w:t[r]});for(i.sort(function(e,t){return t.w-e.w});i.length<4;)i.push({i:0,w:0});i.length>4&&(i.length=4);var s=0;for(r=0;r<4;r++)s+=i[r].w*i[r].w;s=Math.sqrt(s);for(r=0;r<4;r++)i[r].w=i[r].w/s,e[r]=i[r].i,t[r]=i[r].w}function H(e,t){if(0==e.name.indexOf("bone_"+t))return e;for(var i in e.children){var r=H(e.children[i],t);if(r)return r}}function b(){this.mPrimitiveTypes=0,this.mNumVertices=0,this.mNumFaces=0,this.mNumBones=0,this.mMaterialIndex=0,this.mVertices=[],this.mNormals=[],this.mTangents=[],this.mBitangents=[],this.mColors=[[]],this.mTextureCoords=[[]],this.mFaces=[],this.mBones=[],this.hookupSkeletons=function(e,t){if(0!=this.mBones.length){for(var i=[],r=[],s=e.findNode(this.mBones[0].mName);s.mParent&&s.mParent.isBone;)s=s.mParent;var n=k(o=s.toTHREE(e),e);this.threeNode.add(n);for(var m=0;m<this.mBones.length;m++){if(h=H(n,this.mBones[m].mName)){var a=h;i.push(a),r.push(this.mBones[m].mOffsetMatrix.toTHREE())}else{if(!(s=e.findNode(this.mBones[m].mName)))return;var o;(o=s.toTHREE(e)).parent,n=k(o,e);this.threeNode.add(n);var h;a=h=H(n,this.mBones[m].mName);i.push(a),r.push(this.mBones[m].mOffsetMatrix.toTHREE())}}var u=new THREE.Skeleton(i,r);this.threeNode.bind(u,new THREE.Matrix4),this.threeNode.material.skinning=!0}},this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t,i,r=new THREE.BufferGeometry;if(t=e.mMaterials[this.mMaterialIndex]?e.mMaterials[this.mMaterialIndex].toTHREE(e):new THREE.MeshLambertMaterial,r.setIndex(new THREE.BufferAttribute(new Uint32Array(this.mIndexArray),1)),r.addAttribute("position",new THREE.BufferAttribute(this.mVertexBuffer,3)),this.mNormalBuffer&&this.mNormalBuffer.length>0&&r.addAttribute("normal",new THREE.BufferAttribute(this.mNormalBuffer,3)),this.mColorBuffer&&this.mColorBuffer.length>0&&r.addAttribute("color",new THREE.BufferAttribute(this.mColorBuffer,4)),this.mTexCoordsBuffers[0]&&this.mTexCoordsBuffers[0].length>0&&r.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[0]),2)),this.mTexCoordsBuffers[1]&&this.mTexCoordsBuffers[1].length>0&&r.addAttribute("uv1",new THREE.BufferAttribute(new Float32Array(this.mTexCoordsBuffers[1]),2)),this.mTangentBuffer&&this.mTangentBuffer.length>0&&r.addAttribute("tangents",new THREE.BufferAttribute(this.mTangentBuffer,3)),this.mBitangentBuffer&&this.mBitangentBuffer.length>0&&r.addAttribute("bitangents",new THREE.BufferAttribute(this.mBitangentBuffer,3)),this.mBones.length>0){for(var s=[],n=[],m=0;m<this.mBones.length;m++)for(var a=0;a<this.mBones[m].mWeights.length;a++){var o=this.mBones[m].mWeights[a];o&&(s[o.mVertexId]||(s[o.mVertexId]=[]),n[o.mVertexId]||(n[o.mVertexId]=[]),s[o.mVertexId].push(o.mWeight),n[o.mVertexId].push(parseInt(m)))}for(var m in n)M(n[m],s[m]);var h=[],u=[];for(m=0;m<s.length;m++)for(a=0;a<4;a++)s[m]&&n[m]?(h.push(s[m][a]),u.push(n[m][a])):(h.push(0),u.push(0));r.addAttribute("skinWeight",new THREE.BufferAttribute(new Float32Array(h),K)),r.addAttribute("skinIndex",new THREE.BufferAttribute(new Float32Array(u),K))}return 0==this.mBones.length&&(i=new THREE.Mesh(r,t)),this.mBones.length>0&&(i=new THREE.SkinnedMesh(r,t)),this.threeNode=i,i}}function P(){this.mNumIndices=0,this.mIndices=[]}function S(){this.data=[],this.toString=function(){var e="";return this.data.forEach(function(t){e+=String.fromCharCode(t)}),e.replace(/[^\x20-\x7E]+/g,"")}}function V(){this.mName="",this.mTransformation=[],this.mNumChildren=0,this.mNumMeshes=0,this.mMeshes=[],this.mChildren=[],this.toTHREE=function(e){if(this.threeNode)return this.threeNode;var t=new THREE.Object3D;t.name=this.mName,t.matrix=this.mTransformation.toTHREE();for(var i=0;i<this.mChildren.length;i++)t.add(this.mChildren[i].toTHREE(e));for(i=0;i<this.mMeshes.length;i++)t.add(e.mMeshes[this.mMeshes[i]].toTHREE(e));return this.threeNode=t,t.matrix.decompose(t.position,t.quaternion,t.scale),t}}function F(){this.mName="",this.mNumWeights=0,this.mOffsetMatrix=0}function I(){this.mKey="",this.mSemantic=0,this.mIndex=0,this.mData=[],this.mDataLength=0,this.mType=0,this.dataAsColor=function(){var e=new Uint8Array(this.mData).buffer,t=new DataView(e),i=t.getFloat32(0,!0),r=t.getFloat32(4,!0),s=t.getFloat32(8,!0);return new THREE.Color(i,r,s)},this.dataAsFloat=function(){var e=new Uint8Array(this.mData).buffer;return new DataView(e).getFloat32(0,!0)},this.dataAsBool=function(){var e=new Uint8Array(this.mData).buffer;return!!new DataView(e).getFloat32(0,!0)},this.dataAsString=function(){var e=new S;return e.data=this.mData,e.toString()},this.dataAsMap=function(){var e=new S;e.data=this.mData;var t=e.toString();return-1!=(t=t.replace(/\\/g,"/")).indexOf("/")&&(t=t.substr(t.lastIndexOf("/")+1)),i.load(t)}}var O={"?mat.name":"name","$mat.shadingm":"shading","$mat.twosided":"twoSided","$mat.wireframe":"wireframe","$clr.ambient":"ambient","$clr.diffuse":"color","$clr.specular":"specular","$clr.emissive":"emissive","$clr.transparent":"transparent","$clr.reflective":"reflect","$mat.shininess":"shininess","$mat.reflectivity":"reflectivity","$mat.refracti":"refraction","$tex.file":"map"},D={"?mat.name":"string","$mat.shadingm":"bool","$mat.twosided":"bool","$mat.wireframe":"bool","$clr.ambient":"color","$clr.diffuse":"color","$clr.specular":"color","$clr.emissive":"color","$clr.transparent":"color","$clr.reflective":"color","$mat.shininess":"float","$mat.reflectivity":"float","$mat.refracti":"float","$tex.file":"map"};function $(){this.mNumAllocated=0,this.mNumProperties=0,this.mProperties=[],this.toTHREE=function(e){this.mProperties[0].dataAsString();for(var t=new THREE.MeshPhongMaterial,i=0;i<this.mProperties.length;i++)if("float"==D[this.mProperties[i].mKey]&&(t[O[this.mProperties[i].mKey]]=this.mProperties[i].dataAsFloat()),"color"==D[this.mProperties[i].mKey]&&(t[O[this.mProperties[i].mKey]]=this.mProperties[i].dataAsColor()),"bool"==D[this.mProperties[i].mKey]&&(t[O[this.mProperties[i].mKey]]=this.mProperties[i].dataAsBool()),"string"==D[this.mProperties[i].mKey]&&(t[O[this.mProperties[i].mKey]]=this.mProperties[i].dataAsString()),"map"==D[this.mProperties[i].mKey]){var r=this.mProperties[i];r.mSemantic==x&&(t.map=this.mProperties[i].dataAsMap()),r.mSemantic==R&&(t.normalMap=this.mProperties[i].dataAsMap()),r.mSemantic==C&&(t.lightMap=this.mProperties[i].dataAsMap()),r.mSemantic==B&&(t.alphaMap=this.mProperties[i].dataAsMap())}return t.ambient.r=.53,t.ambient.g=.53,t.ambient.b=.53,t.color.r=1,t.color.g=1,t.color.b=1,t}}function L(e,t,i){var r=new THREE.Vector3,s=1-i;return r.x=e.x*i+t.x*s,r.y=e.y*i+t.y*s,r.z=e.z*i+t.z*s,r}function U(e,t,i){return e.clone().slerp(t,1-i)}function W(e,t,i,r){if(1==e.length)return e[0].mValue.toTHREE();for(var s=1/0,n=null,m=null,a=0;a<e.length;a++){var o=Math.abs(e[a].mTime-t);o<s&&e[a].mTime<=t&&(s=o,n=e[a],m=e[a+1])}if(n){if(m){var h=m.mTime-n.mTime,u=(n.mTime-t)/h;return r(n.mValue.toTHREE(),m.mValue.toTHREE(),u)}(m=e[0].clone()).mTime+=i;h=m.mTime-n.mTime,u=(n.mTime-t)/h;return r(n.mValue.toTHREE(),m.mValue.toTHREE(),u)}return null}function z(){this.mNodeName="",this.mNumPositionKeys=0,this.mNumRotationKeys=0,this.mNumScalingKeys=0,this.mPositionKeys=[],this.mRotationKeys=[],this.mScalingKeys=[],this.mPreState="",this.mPostState="",this.init=function(e){function t(t){t.mTime/=e}e||(e=1),this.mPositionKeys.forEach(t),this.mRotationKeys.forEach(t),this.mScalingKeys.forEach(t)},this.sortKeys=function(){function e(e,t){return e.mTime-t.mTime}this.mPositionKeys.sort(e),this.mRotationKeys.sort(e),this.mScalingKeys.sort(e)},this.getLength=function(){return Math.max(Math.max.apply(null,this.mPositionKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mRotationKeys.map(function(e){return e.mTime})),Math.max.apply(null,this.mScalingKeys.map(function(e){return e.mTime})))},this.toTHREE=function(e,t){this.sortKeys();for(var i=this.getLength(),s=new r.KeyFrameTrack,n=0;n<i;n+=.05){var m=new THREE.Matrix4,a=n,o=W(this.mPositionKeys,a,i,L),h=W(this.mScalingKeys,a,i,L),u=W(this.mRotationKeys,a,i,U);m.compose(o,u,h);var f=new r.KeyFrame(a,m);s.addKey(f)}s.target=e.findNode(this.mNodeName).toTHREE();var l=[s];if(e.nodeToBoneMap[this.mNodeName])for(n=0;n<e.nodeToBoneMap[this.mNodeName].length;n++){var c=s.clone();c.target=e.nodeToBoneMap[this.mNodeName][n],l.push(c)}return l}}function Q(){this.mName="",this.mDuration=0,this.mTicksPerSecond=0,this.mNumChannels=0,this.mChannels=[],this.toTHREE=function(e){var t=new r.Animation;for(var i in this.mChannels){this.mChannels[i].init(this.mTicksPerSecond);var s=this.mChannels[i].toTHREE(e);for(var n in s)s[n].init(),t.addTrack(s[n])}return t.length=Math.max.apply(null,t.tracks.map(function(e){return e.length})),t}}function q(){this.mWidth=0,this.mHeight=0,this.texAchFormatHint=[],this.pcData=[]}function _(){this.mName="",this.mType=0,this.mAttenuationConstant=0,this.mAttenuationLinear=0,this.mAttenuationQuadratic=0,this.mAngleInnerCone=0,this.mAngleOuterCone=0,this.mColorDiffuse=null,this.mColorSpecular=null,this.mColorAmbient=null}function j(){this.mName="",this.mPosition=null,this.mLookAt=null,this.mUp=null,this.mHorizontalFOV=0,this.mClipPlaneNear=0,this.mClipPlaneFar=0,this.mAspect=0}var G=!0;function J(e){var t=e.getFloat32(e.readOffset,G);return e.readOffset+=4,t}function X(e){var t=e.getFloat64(e.readOffset,G);return e.readOffset+=8,t}function Y(e){var t=e.getUint16(e.readOffset,G);return e.readOffset+=2,t}function Z(e){var t=e.getUint32(e.readOffset,G);return e.readOffset+=4,t}function ee(e){var t=e.getUint32(e.readOffset,G);return e.readOffset+=4,t}function te(e){var t=new function(){this.x=0,this.y=0,this.z=0,this.toTHREE=function(){return new THREE.Vector3(this.x,this.y,this.z)}};return t.x=J(e),t.y=J(e),t.z=J(e),t}function ie(e){var t=new function(){this.r=0,this.g=0,this.b=0,this.a=0,this.toTHREE=function(){return new THREE.Color(this.r,this.g,this.b,1)}};return t.r=J(e),t.g=J(e),t.b=J(e),t}function re(e){var t=new function(){this.x=0,this.y=0,this.z=0,this.w=0,this.toTHREE=function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}};return t.w=J(e),t.x=J(e),t.y=J(e),t.z=J(e),t}function se(e){var t=new S,i=Z(e);return e.ReadBytes(t.data,1,i),t.toString()}function ne(e){for(var t=new function(){this.elements=[[],[],[],[]],this.toTHREE=function(){for(var e=new THREE.Matrix4,t=0;t<4;++t)for(var i=0;i<4;++i)e.elements[4*t+i]=this.elements[i][t];return e}},i=0;i<4;++i)for(var r=0;r<4;++r)t.elements[i][r]=J(e);return t}function me(e,t,i){for(var r=0;r<i;r++)t[r]=(s=e,n=void 0,(n=new function(){this.mTime=0,this.mValue=null}).mTime=X(s),n.mValue=te(s),n);var s,n}function ae(e,t,i){return e.Seek(sizeof(t)*i,pe)}function oe(e){if(!e)throw"asset failed"}function he(e,t){oe(ee(e)==a),ee(e),t.mPrimitiveTypes=Z(e),t.mNumVertices=Z(e),t.mNumFaces=Z(e),t.mNumBones=Z(e),t.mMaterialIndex=Z(e),t.mNumUVComponents=[];var i,r,s=Z(e);s&p&&(ce?ae(e,t.mVertices,t.mNumVertices):(t.mVertices=[],t.mVertexBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,pe))),s&y&&(ce?ae(e,t.mNormals,t.mNumVertices):(t.mNormals=[],t.mNormalBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,pe))),s&g&&(ce?(ae(e,t.mTangents,t.mNumVertices),ae(e,t.mBitangents,t.mNumVertices)):(t.mTangents=[],t.mTangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,pe),t.mBitangents=[],t.mBitangentBuffer=e.subArray32(e.readOffset,e.readOffset+3*t.mNumVertices*4),e.Seek(3*t.mNumVertices*4,pe)));for(var n=0;n<E&&s&T<<n;++n)ce?ae(e,t.mColors[n],t.mNumVertices):(t.mColors[n]=[],t.mColorBuffer=e.subArray32(e.readOffset,e.readOffset+4*t.mNumVertices*4),e.Seek(4*t.mNumVertices*4,pe));t.mTexCoordsBuffers=[];for(n=0;n<v&&s&N<<n;++n)if(t.mNumUVComponents[n]=Z(e),ce)ae(e,t.mTextureCoords[n],t.mNumVertices);else{t.mTextureCoords[n]=[],t.mTexCoordsBuffers[n]=[];for(var m=0;m<t.mNumVertices;m++)t.mTexCoordsBuffers[n].push(J(e)),t.mTexCoordsBuffers[n].push(J(e)),J(e)}if(ce)Z(e);else{t.mFaces=[];t.mIndexArray=[];for(var o=0;o<t.mNumFaces;++o){var h=t.mFaces[o]=new P;h.mNumIndices=Y(e),h.mIndices=[];for(var f=0;f<h.mNumIndices;++f)t.mNumVertices<65536?h.mIndices[f]=Y(e):h.mIndices[f]=Z(e);if(3===h.mNumIndices)t.mIndexArray.push(h.mIndices[0]),t.mIndexArray.push(h.mIndices[1]),t.mIndexArray.push(h.mIndices[2]);else{if(4!==h.mNumIndices)throw new Error("Sorry, can't currently triangulate polys. Use the triangulate preprocessor in Assimp.");t.mIndexArray.push(h.mIndices[0]),t.mIndexArray.push(h.mIndices[1]),t.mIndexArray.push(h.mIndices[2]),t.mIndexArray.push(h.mIndices[2]),t.mIndexArray.push(h.mIndices[3]),t.mIndexArray.push(h.mIndices[0])}}}if(t.mNumBones){t.mBones=[];for(f=0;f<t.mNumBones;++f)t.mBones[f]=new F,i=e,r=t.mBones[f],oe(ee(i)==u),ee(i),r.mName=se(i),r.mNumWeights=Z(i),r.mOffsetMatrix=ne(i),ce?ae(i,r.mWeights,r.mNumWeights):(r.mWeights=[],function(e,t,i){for(var r=0;r<i;r++)t[r]=(s=e,n=void 0,(n=new function(){this.mVertexId=0,this.mWeight=0}).mVertexId=Z(s),n.mWeight=J(s),n);var s,n}(i,r.mWeights,r.mNumWeights))}}function ue(e,t){var i,r;if(oe(ee(e)==c),ee(e),t.mNumAllocated=t.mNumProperties=Z(e),t.mNumProperties){t.mProperties&&delete t.mProperties,t.mProperties=[];for(var s=0;s<t.mNumProperties;++s)t.mProperties[s]=new I,i=e,r=t.mProperties[s],oe(ee(i)==d),ee(i),r.mKey=se(i),r.mSemantic=Z(i),r.mIndex=Z(i),r.mDataLength=Z(i),r.mType=Z(i),r.mData=[],i.ReadBytes(r.mData,1,r.mDataLength)}}function fe(e,t){var i,r;if(oe(ee(e)==f),ee(e),t.mName=se(e),t.mDuration=X(e),t.mTicksPerSecond=X(e),t.mNumChannels=Z(e),t.mNumChannels){t.mChannels=[];for(var s=0;s<t.mNumChannels;++s)t.mChannels[s]=new z,i=e,r=t.mChannels[s],oe(ee(i)==o),ee(i),r.mNodeName=se(i),r.mNumPositionKeys=Z(i),r.mNumRotationKeys=Z(i),r.mNumScalingKeys=Z(i),r.mPreState=Z(i),r.mPostState=Z(i),r.mNumPositionKeys&&(ce?ae(i,r.mPositionKeys,r.mNumPositionKeys):(r.mPositionKeys=[],me(i,r.mPositionKeys,r.mNumPositionKeys))),r.mNumRotationKeys&&(ce?ae(i,r.mRotationKeys,r.mNumRotationKeys):(r.mRotationKeys=[],function(e,t,i){for(var r=0;r<i;r++)t[r]=(s=e,n=void 0,(n=new function(){this.mTime=0,this.mValue=null}).mTime=X(s),n.mValue=re(s),n);var s,n}(i,r.mRotationKeys,r.mNumRotationKeys))),r.mNumScalingKeys&&(ce?ae(i,r.mScalingKeys,r.mNumScalingKeys):(r.mScalingKeys=[],me(i,r.mScalingKeys,r.mNumScalingKeys)))}}function le(e,t){var i,r,a,o,u,f;if(oe(ee(e)==h),ee(e),t.mFlags=Z(e),t.mNumMeshes=Z(e),t.mNumMaterials=Z(e),t.mNumAnimations=Z(e),t.mNumTextures=Z(e),t.mNumLights=Z(e),t.mNumCameras=Z(e),t.mRootNode=new V,t.mRootNode=function e(t,i,r){oe(ee(t)==l),ee(t);var s=new V;if(s.mParent=i,s.mDepth=r,s.mName=se(t),s.mTransformation=ne(t),s.mNumChildren=Z(t),s.mNumMeshes=Z(t),s.mNumMeshes){s.mMeshes=[];for(var n=0;n<s.mNumMeshes;++n)s.mMeshes[n]=Z(t)}if(s.mNumChildren)for(s.mChildren=[],n=0;n<s.mNumChildren;++n){var m=e(t,s,r++);s.mChildren[n]=m}return s}(e,null,0),t.mNumMeshes){t.mMeshes=[];for(var c=0;c<t.mNumMeshes;++c)t.mMeshes[c]=new b,he(e,t.mMeshes[c])}if(t.mNumMaterials){t.mMaterials=[];for(c=0;c<t.mNumMaterials;++c)t.mMaterials[c]=new $,ue(e,t.mMaterials[c])}if(t.mNumAnimations){t.mAnimations=[];for(c=0;c<t.mNumAnimations;++c)t.mAnimations[c]=new Q,fe(e,t.mAnimations[c])}if(t.mNumTextures){t.mTextures=[];for(c=0;c<t.mNumTextures;++c)t.mTextures[c]=new q,i=e,r=t.mTextures[c],oe(ee(i)==m),ee(i),r.mWidth=Z(i),r.mHeight=Z(i),i.ReadBytes(r.achFormatHint,1,4),ce||(r.mHeight?(r.pcData=[],i.ReadBytes(r.pcData,1,r.mWidth*r.mHeight*4)):(r.pcData=[],i.ReadBytes(r.pcData,1,r.mWidth)))}if(t.mNumLights){t.mLights=[];for(c=0;c<t.mNumLights;++c)t.mLights[c]=new _,a=e,o=t.mLights[c],oe(ee(a)==n),ee(a),o.mName=se(a),o.mType=Z(a),o.mType!=A&&(o.mAttenuationConstant=J(a),o.mAttenuationLinear=J(a),o.mAttenuationQuadratic=J(a)),o.mColorDiffuse=ie(a),o.mColorSpecular=ie(a),o.mColorAmbient=ie(a),o.mType==w&&(o.mAngleInnerCone=J(a),o.mAngleOuterCone=J(a))}if(t.mNumCameras){t.mCameras=[];for(c=0;c<t.mNumCameras;++c)t.mCameras[c]=new j,u=e,f=t.mCameras[c],oe(ee(u)==s),ee(u),f.mName=se(u),f.mPosition=te(u),f.mLookAt=te(u),f.mUp=te(u),f.mHorizontalFOV=J(u),f.mClipPlaneNear=J(u),f.mClipPlaneFar=J(u),f.mAspect=J(u)}}var ce,de,pe=0,ye=1;return function(e){var t,i=new function(){this.mFlags=0,this.mNumMeshes=0,this.mNumMaterials=0,this.mNumAnimations=0,this.mNumTextures=0,this.mNumLights=0,this.mNumCameras=0,this.mRootNode=null,this.mMeshes=[],this.mMaterials=[],this.mAnimations=[],this.mLights=[],this.mCameras=[],this.nodeToBoneMap={},this.findNode=function(e,t){if(t||(t=this.mRootNode),t.mName==e)return t;for(var i=0;i<t.mChildren.length;i++){var r=this.findNode(e,t.mChildren[i]);if(r)return r}return null},this.toTHREE=function(){this.nodeCount=0,function(e){for(var t in e.mMeshes){var i=e.mMeshes[t];for(var r in i.mBones){var s=e.findNode(i.mBones[r].mName);s&&(s.isBone=!0)}}}(this);var e=this.mRootNode.toTHREE(this);for(var t in this.mMeshes)this.mMeshes[t].hookupSkeletons(this,e);if(this.mAnimations.length>0)var i=this.mAnimations[0].toTHREE(this);return{object:e,animation:i}}},r=new DataView(e);if((t=r).readOffset=0,t.Seek=function(e,i){i==pe&&(t.readOffset+=e),i==ye&&(t.readOffset=e)},t.ReadBytes=function(e,t,i){for(var r,s,n=t*i,m=0;m<n;m++)e[m]=(s=(r=this).getUint8(r.readOffset),r.readOffset+=1,s)},t.subArray32=function(e,t){var i=this.buffer.slice(e,t);return new Float32Array(i)},t.subArrayUint16=function(e,t){var i=this.buffer.slice(e,t);return new Uint16Array(i)},t.subArrayUint8=function(e,t){var i=this.buffer.slice(e,t);return new Uint8Array(i)},t.subArrayUint32=function(e,t){var i=this.buffer.slice(e,t);return new Uint32Array(i)},r.Seek(44,pe),Z(r),Z(r),Z(r),Z(r),ce=Y(r)>0,de=Y(r)>0,ce)throw"Shortened binaries are not supported!";if(r.Seek(256,pe),r.Seek(128,pe),r.Seek(64,pe),!de)return le(r,i),i.toTHREE();var s=ee(r),n=r.FileSize()-r.Tell(),m=[];r.Read(m,1,n);var a=[];uncompress(a,s,m,n),le(new ArrayBuffer(a),i)}(e)}};