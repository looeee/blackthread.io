THREE.CTMLoader=function(){THREE.Loader.call(this)},THREE.CTMLoader.prototype=Object.create(THREE.Loader.prototype),THREE.CTMLoader.prototype.constructor=THREE.CTMLoader,THREE.CTMLoader.prototype.loadParts=function(e,t,r){r=r||{};var o=this,a=new XMLHttpRequest,s=r.basePath?r.basePath:THREE.LoaderUtils.extractUrlBase(e);a.onreadystatechange=function(){if(4===a.readyState&&(200===a.status||0===a.status)){var e=JSON.parse(a.responseText),n=[],d=[],i=0;for(var u=0;u<e.materials.length;u++)n[u]=o.createMaterial(e.materials[u],s);var f=s+e.data,l={useWorker:r.useWorker,worker:r.worker,offsets:e.offsets};o.load(f,function(r){i+=1,d.push(r),i===e.offsets.length&&t(d,n)},l)}},a.open("GET",e,!0),a.setRequestHeader("Content-Type","text/plain"),a.send(null)},THREE.CTMLoader.prototype.load=function(e,t,r){var o=this,a=void 0!==(r=r||{}).offsets?r.offsets:[0],s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status||0===s.status){var n=new Uint8Array(s.response),d=Date.now();if(r.useWorker){var i=r.worker||new Worker("js/loaders/ctm/CTMWorker.js");i.onmessage=function(e){for(var r=e.data,a=0;a<r.length;a++){var s=r[a],n=Date.now();o.createModel(s,t);var i=Date.now();console.log("model load time [worker]: "+(i-n)+" ms, total: "+(i-d))}},i.postMessage({data:n,offsets:a},[n.buffer])}else for(var u=0;u<a.length;u++){var f=new CTM.Stream(n);f.offset=a[u];var l=new CTM.File(f);o.createModel(l,t)}}else console.error("Couldn't load ["+e+"] ["+s.status+"]");else 3===s.readyState||2===s.readyState&&s.getResponseHeader("Content-Length")},s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null)},THREE.CTMLoader.prototype.createModel=function(e,t){var r=function(){THREE.BufferGeometry.call(this),this.materials=[];var t,r,o=e.body.indices,a=e.body.vertices,s=e.body.normals,n=e.body.uvMaps;void 0!==n&&n.length>0&&(t=n[0].uv);var d=e.body.attrMaps;void 0!==d&&d.length>0&&"Color"===d[0].name&&(r=d[0].attr),this.setIndex(new THREE.BufferAttribute(o,1)),this.addAttribute("position",new THREE.BufferAttribute(a,3)),void 0!==s&&this.addAttribute("normal",new THREE.BufferAttribute(s,3)),void 0!==t&&this.addAttribute("uv",new THREE.BufferAttribute(t,2)),void 0!==r&&this.addAttribute("color",new THREE.BufferAttribute(r,4))};(r.prototype=Object.create(THREE.BufferGeometry.prototype)).constructor=r;var o=new r;void 0===o.attributes.normal&&o.computeVertexNormals(),t(o)};