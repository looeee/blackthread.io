THREE.TGALoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TGALoader.prototype={constructor:THREE.TGALoader,load:function(e,a,r,o){var t=this,i=new THREE.Texture,n=new THREE.FileLoader(this.manager);return n.setResponseType("arraybuffer"),n.load(e,function(e){i.image=t.parse(e),i.needsUpdate=!0,void 0!==a&&a(i)},r,o),i},parse:function(e){var a=0,r=1,o=2,t=3,i=9,n=10,s=11,c=48,l=4,d=0,p=1,h=2,f=3;e.length<19&&console.error("THREE.TGALoader: Not enough data to contain header.");var g=new Uint8Array(e),E=0,u={id_length:g[E++],colormap_type:g[E++],image_type:g[E++],colormap_index:g[E++]|g[E++]<<8,colormap_length:g[E++]|g[E++]<<8,colormap_size:g[E++],origin:[g[E++]|g[E++]<<8,g[E++]|g[E++]<<8],width:g[E++]|g[E++]<<8,height:g[E++]|g[E++]<<8,pixel_size:g[E++],flags:g[E++]};!function(e){switch(e.image_type){case r:case i:(e.colormap_length>256||24!==e.colormap_size||1!==e.colormap_type)&&console.error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case o:case t:case n:case s:e.colormap_type&&console.error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case a:console.error("THREE.TGALoader: No data.");default:console.error('THREE.TGALoader: Invalid type "%s".',e.image_type)}(e.width<=0||e.height<=0)&&console.error("THREE.TGALoader: Invalid image size."),8!==e.pixel_size&&16!==e.pixel_size&&24!==e.pixel_size&&32!==e.pixel_size&&console.error('THREE.TGALoader: Invalid pixel size "%s".',e.pixel_size)}(u),u.id_length+E>e.length&&console.error("THREE.TGALoader: No data."),E+=u.id_length;var T=!1,_=!1,m=!1;switch(u.image_type){case i:T=!0,_=!0;break;case r:_=!0;break;case n:T=!0;break;case o:break;case s:T=!0,m=!0;break;case t:m=!0}var v=document.createElement("canvas");v.width=u.width,v.height=u.height;var w=v.getContext("2d"),y=w.createImageData(u.width,u.height),b=function(e,a,r,o,t){var i,n,s,c;if(n=r.pixel_size>>3,s=r.width*r.height*n,a&&(c=t.subarray(o,o+=r.colormap_length*(r.colormap_size>>3))),e){var l,d,p;i=new Uint8Array(s);for(var h=0,f=new Uint8Array(n);h<s;)if(d=1+(127&(l=t[o++])),128&l){for(p=0;p<n;++p)f[p]=t[o++];for(p=0;p<d;++p)i.set(f,h+p*n);h+=n*d}else{for(d*=n,p=0;p<d;++p)i[h+p]=t[o++];h+=d}}else i=t.subarray(o,o+=a?r.width*r.height:s);return{pixel_data:i,palettes:c}}(T,_,u,E,g);!function(e,a,r,o,t){var i,n,s,g,E,T;switch((u.flags&c)>>l){default:case h:i=0,s=1,E=a,n=0,g=1,T=r;break;case d:i=0,s=1,E=a,n=r-1,g=-1,T=-1;break;case f:i=a-1,s=-1,E=-1,n=0,g=1,T=r;break;case p:i=a-1,s=-1,E=-1,n=r-1,g=-1,T=-1}if(m)switch(u.pixel_size){case 8:!function(e,a,r,o,t,i,n,s){var c,l,d,p=0,h=u.width;for(d=a;d!==o;d+=r)for(l=t;l!==n;l+=i,p++)c=s[p],e[4*(l+h*d)+0]=c,e[4*(l+h*d)+1]=c,e[4*(l+h*d)+2]=c,e[4*(l+h*d)+3]=255}(e,n,g,T,i,s,E,o);break;case 16:!function(e,a,r,o,t,i,n,s){var c,l,d=0,p=u.width;for(l=a;l!==o;l+=r)for(c=t;c!==n;c+=i,d+=2)e[4*(c+p*l)+0]=s[d+0],e[4*(c+p*l)+1]=s[d+0],e[4*(c+p*l)+2]=s[d+0],e[4*(c+p*l)+3]=s[d+1]}(e,n,g,T,i,s,E,o);break;default:console.error("THREE.TGALoader: Format not supported.")}else switch(u.pixel_size){case 8:!function(e,a,r,o,t,i,n,s,c){var l,d,p,h=c,f=0,g=u.width;for(p=a;p!==o;p+=r)for(d=t;d!==n;d+=i,f++)l=s[f],e[4*(d+g*p)+3]=255,e[4*(d+g*p)+2]=h[3*l+0],e[4*(d+g*p)+1]=h[3*l+1],e[4*(d+g*p)+0]=h[3*l+2]}(e,n,g,T,i,s,E,o,t);break;case 16:!function(e,a,r,o,t,i,n,s){var c,l,d,p=0,h=u.width;for(d=a;d!==o;d+=r)for(l=t;l!==n;l+=i,p+=2)c=s[p+0]+(s[p+1]<<8),e[4*(l+h*d)+0]=(31744&c)>>7,e[4*(l+h*d)+1]=(992&c)>>2,e[4*(l+h*d)+2]=(31&c)>>3,e[4*(l+h*d)+3]=32768&c?0:255}(e,n,g,T,i,s,E,o);break;case 24:!function(e,a,r,o,t,i,n,s){var c,l,d=0,p=u.width;for(l=a;l!==o;l+=r)for(c=t;c!==n;c+=i,d+=3)e[4*(c+p*l)+3]=255,e[4*(c+p*l)+2]=s[d+0],e[4*(c+p*l)+1]=s[d+1],e[4*(c+p*l)+0]=s[d+2]}(e,n,g,T,i,s,E,o);break;case 32:!function(e,a,r,o,t,i,n,s){var c,l,d=0,p=u.width;for(l=a;l!==o;l+=r)for(c=t;c!==n;c+=i,d+=4)e[4*(c+p*l)+2]=s[d+0],e[4*(c+p*l)+1]=s[d+1],e[4*(c+p*l)+0]=s[d+2],e[4*(c+p*l)+3]=s[d+3]}(e,n,g,T,i,s,E,o);break;default:console.error("THREE.TGALoader: Format not supported.")}}(y.data,u.width,u.height,b.pixel_data,b.palettes);return w.putImageData(y,0,0),v}};