THREE.NodeMaterialLoader=function(e,t){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.nodes={},this.materials={},this.passes={},this.names={},this.library=t||{}},THREE.NodeMaterialLoaderUtils={replaceUUIDObject:function(e,t,s,a){if(a=void 0===a||a,"object"==typeof t&&(t=t.uuid),"object"==typeof e)for(var o=Object.keys(e),i=0;i<o.length;i++){var r=o[i];a&&(e[r]=this.replaceUUIDObject(e[r],t,s)),r===t&&(e[t]=e[r],delete e[r])}return e===t?s:e},replaceUUID:function(e,t,s){return this.replaceUUIDObject(e,t,s,!1),this.replaceUUIDObject(e.nodes,t,s),this.replaceUUIDObject(e.materials,t,s),this.replaceUUIDObject(e.passes,t,s),this.replaceUUIDObject(e.library,t,s,!1),e}},Object.assign(THREE.NodeMaterialLoader.prototype,{load:function(e,t,s,a){var o=this;return new THREE.FileLoader(o.manager).load(e,function(e){t(o.parse(JSON.parse(e)))},s,a),this},getObjectByName:function(e){return this.names[e]},getObjectById:function(e){return this.library[e]||this.nodes[e]||this.names[e]},getNode:function(e){var t=this.getObjectById(e);return t||console.warn('Node "'+e+'" not found.'),t},parse:function(e){var t,s,a,o,i;for(t in e.nodes)s=e.nodes[t],a=new THREE[s.type],s.name?(a.name=s.name,this.names[a.name]=a):a.readonly=!0,void 0!==s.readonly&&(a.readonly=s.readonly),this.nodes[t]=a;for(t in e.materials)s=e.materials[t],a=new THREE[s.type],s.name&&(a.name=s.name,this.names[a.name]=a),this.materials[t]=a;for(t in e.passes)s=e.passes[t],a=new THREE[s.type],s.name&&(a.name=s.name,this.names[a.name]=a),this.passes[t]=a;for(t in e.material&&(this.material=this.materials[t]),e.pass&&(this.pass=this.passes[t]),e.nodes)switch(s=e.nodes[t],a=this.nodes[t],s.type){case"FloatNode":a.number=s.number;break;case"ColorNode":a.value.copy(s);break;case"Vector2Node":a.x=s.x,a.y=s.y;break;case"Vector3Node":a.x=s.x,a.y=s.y,a.z=s.z;break;case"Vector4Node":a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w;break;case"Matrix3Node":case"Matrix4Node":a.value.fromArray(s.elements);break;case"OperatorNode":a.a=this.getNode(s.a),a.b=this.getNode(s.b),a.op=s.op;break;case"Math1Node":a.a=this.getNode(s.a),a.method=s.method;break;case"Math2Node":a.a=this.getNode(s.a),a.b=this.getNode(s.b),a.method=s.method;break;case"Math3Node":a.a=this.getNode(s.a),a.b=this.getNode(s.b),a.c=this.getNode(s.c),a.method=s.method;break;case"UVNode":case"ColorsNode":a.index=s.index;break;case"LuminanceNode":a.rgb=this.getNode(s.rgb);break;case"PositionNode":case"NormalNode":case"ReflectNode":case"LightNode":a.scope=s.scope;break;case"SwitchNode":a.node=this.getNode(s.node),a.components=s.components;break;case"JoinNode":for(o in s.inputs)a[o]=this.getNode(s.inputs[o]);break;case"CameraNode":switch(a.setScope(s.scope),s.camera&&a.setCamera(this.getNode(s.camera)),s.scope){case THREE.CameraNode.DEPTH:a.near.number=s.near,a.far.number=s.far}break;case"ColorAdjustmentNode":a.rgb=this.getNode(s.rgb),a.adjustment=this.getNode(s.adjustment),a.method=s.method;break;case"UVTransformNode":a.uv=this.getNode(s.uv),a.transform=this.getNode(s.transform);break;case"BumpNode":a.value=this.getNode(s.value),a.coord=this.getNode(s.coord),a.scale=this.getNode(s.scale);break;case"BlurNode":a.value=this.getNode(s.value),a.coord=this.getNode(s.coord),a.scale=this.getNode(s.scale),a.value=this.getNode(s.value),a.coord=this.getNode(s.coord),a.radius=this.getNode(s.radius),void 0!==s.size&&(a.size=new THREE.Vector2(s.size.x,s.size.y)),a.blurX=s.blurX,a.blurY=s.blurY;break;case"ResolutionNode":a.renderer=this.getNode(s.renderer);break;case"ScreenUVNode":a.resolution=this.getNode(s.resolution);break;case"VelocityNode":s.target&&a.setTarget(this.getNode(s.target)),a.setParams(s.params);break;case"TimerNode":a.scope=s.scope,a.scale=s.scale;break;case"ConstNode":a.name=s.name,a.type=s.out,a.value=s.value,a.useDefine=!0===s.useDefine;break;case"AttributeNode":case"VarNode":a.type=s.out;break;case"ReflectorNode":a.setMirror(this.getNode(s.mirror)),s.offset&&(a.offset=this.getNode(s.offset));break;case"NoiseNode":a.coord=this.getNode(s.coord);break;case"FunctionNode":for(o in a.isMethod=s.isMethod,a.useKeywords=s.useKeywords,a.extensions=s.extensions,a.keywords={},s.keywords)a.keywords[o]=this.getNode(s.keywords[o]);if(s.includes)for(i=0;i<s.includes.length;i++)a.includes.push(this.getNode(s.includes[i]));a.eval(s.src,a.includes,a.extensions,a.keywords),a.isMethod||(a.type=s.out);break;case"FunctionCallNode":for(o in s.inputs)a.inputs[o]=this.getNode(s.inputs[o]);a.value=this.getNode(s.value);break;case"TextureNode":case"CubeTextureNode":case"ScreenNode":s.value&&(a.value=this.getNode(s.value)),a.coord=this.getNode(s.coord),s.bias&&(a.bias=this.getNode(s.bias)),void 0!==a.project&&(a.project=s.project);break;case"RoughnessToBlinnExponentNode":break;case"RawNode":a.value=this.getNode(s.value);break;case"StandardNode":case"PhongNode":case"SpriteNode":a.color=this.getNode(s.color),s.alpha&&(a.alpha=this.getNode(s.alpha)),s.specular&&(a.specular=this.getNode(s.specular)),s.shininess&&(a.shininess=this.getNode(s.shininess)),s.roughness&&(a.roughness=this.getNode(s.roughness)),s.metalness&&(a.metalness=this.getNode(s.metalness)),s.reflectivity&&(a.reflectivity=this.getNode(s.reflectivity)),s.clearCoat&&(a.clearCoat=this.getNode(s.clearCoat)),s.clearCoatRoughness&&(a.clearCoatRoughness=this.getNode(s.clearCoatRoughness)),s.normal&&(a.normal=this.getNode(s.normal)),s.normalScale&&(a.normalScale=this.getNode(s.normalScale)),s.emissive&&(a.emissive=this.getNode(s.emissive)),s.ambient&&(a.ambient=this.getNode(s.ambient)),s.shadow&&(a.shadow=this.getNode(s.shadow)),s.light&&(a.light=this.getNode(s.light)),s.ao&&(a.ao=this.getNode(s.ao)),s.environment&&(a.environment=this.getNode(s.environment)),s.environmentAlpha&&(a.environmentAlpha=this.getNode(s.environmentAlpha)),s.transform&&(a.transform=this.getNode(s.transform)),!1===s.spherical&&(a.spherical=!1);break;default:console.warn(s.type,"not supported.")}for(t in e.materials)s=e.materials[t],a=this.materials[t],void 0!==s.name&&(a.name=s.name),void 0!==s.blending&&(a.blending=s.blending),void 0!==s.flatShading&&(a.flatShading=s.flatShading),void 0!==s.side&&(a.side=s.side),a.depthFunc=s.depthFunc,a.depthTest=s.depthTest,a.depthWrite=s.depthWrite,void 0!==s.wireframe&&(a.wireframe=s.wireframe),void 0!==s.wireframeLinewidth&&(a.wireframeLinewidth=s.wireframeLinewidth),void 0!==s.wireframeLinecap&&(a.wireframeLinecap=s.wireframeLinecap),void 0!==s.wireframeLinejoin&&(a.wireframeLinejoin=s.wireframeLinejoin),void 0!==s.skinning&&(a.skinning=s.skinning),void 0!==s.morphTargets&&(a.morphTargets=s.morphTargets),void 0!==s.visible&&(a.visible=s.visible),void 0!==s.userData&&(a.userData=s.userData),a.vertex=this.getNode(s.vertex),a.fragment=this.getNode(s.fragment),a.vertex===a.fragment&&(a.node=a.vertex),a.build(),void 0!==s.fog&&(a.fog=s.fog),void 0!==s.lights&&(a.lights=s.lights),void 0!==s.transparent&&(a.transparent=s.transparent);for(t in e.passes)s=e.passes[t],(a=this.passes[t]).value=this.getNode(s.value),a.build();return this.material||this.pass||this}});