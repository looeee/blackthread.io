THREE.LegacyGLTFLoader=function(){function e(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager}function r(e,r){var t={},a=e.material.uniforms;for(var n in a){var i=a[n];if(i.semantic){var s=i.node,o=e;s&&(o=r[s]),t[n]={semantic:i.semantic,sourceNode:o,targetNode:e,uniform:i}}}this.boundUniforms=t,this._m4=new THREE.Matrix4}e.prototype={constructor:e,crossOrigin:"Anonymous",load:function(e,r,t,a){var n=this,i=this.path&&"string"==typeof this.path?this.path:THREE.LoaderUtils.extractUrlBase(e),s=new THREE.FileLoader(n.manager);s.setResponseType("arraybuffer"),s.load(e,function(e){n.parse(e,r,i)},t,a)},setCrossOrigin:function(e){this.crossOrigin=e},setPath:function(e){this.path=e},parse:function(e,r,n){var s,o={};THREE.LoaderUtils.decodeText(new Uint8Array(e,0,4))===a.magic?(o[t.KHR_BINARY_GLTF]=new i(e),s=o[t.KHR_BINARY_GLTF].content):s=THREE.LoaderUtils.decodeText(new Uint8Array(e));var c=JSON.parse(s);c.extensionsUsed&&c.extensionsUsed.indexOf(t.KHR_MATERIALS_COMMON)>=0&&(o[t.KHR_MATERIALS_COMMON]=new function(e){this.name=t.KHR_MATERIALS_COMMON,this.lights={};var r=(e.extensions&&e.extensions[t.KHR_MATERIALS_COMMON]||{}).lights||{};for(var a in r){var n,i=r[a],s=i[i.type],o=(new THREE.Color).fromArray(s.color);switch(i.type){case"directional":(n=new THREE.DirectionalLight(o)).position.set(0,0,1);break;case"point":n=new THREE.PointLight(o);break;case"spot":(n=new THREE.SpotLight(o)).position.set(0,0,1);break;case"ambient":n=new THREE.AmbientLight(o)}n&&(this.lights[a]=n)}}(c)),console.time("LegacyGLTFLoader"),new b(c,o,{path:n||this.path,crossOrigin:this.crossOrigin}).parse(function(e,t,a,n){console.timeEnd("LegacyGLTFLoader"),r({scene:e,scenes:t,cameras:a,animations:n})})}},e.Shaders={update:function(){console.warn("THREE.LegacyGLTFLoader.Shaders has been deprecated, and now updates automatically.")}},r.prototype.update=function(e,r){var t=this.boundUniforms;for(var a in t){var n=t[a];switch(n.semantic){case"MODELVIEW":n.uniform.value.multiplyMatrices(r.matrixWorldInverse,n.sourceNode.matrixWorld);break;case"MODELVIEWINVERSETRANSPOSE":var i=n.uniform.value;this._m4.multiplyMatrices(r.matrixWorldInverse,n.sourceNode.matrixWorld),i.getNormalMatrix(this._m4);break;case"PROJECTION":n.uniform.value.copy(r.projectionMatrix);break;case"JOINTMATRIX":for(var s=n.uniform.value,o=0;o<s.length;o++)s[o].getInverse(n.sourceNode.matrixWorld).multiply(n.targetNode.skeleton.bones[o].matrixWorld).multiply(n.targetNode.skeleton.boneInverses[o]).multiply(n.targetNode.bindMatrix);break;default:console.warn("Unhandled shader semantic: "+n.semantic)}}},e.Animations={update:function(){console.warn("THREE.LegacyGLTFLoader.Animation has been deprecated. Use THREE.AnimationMixer instead.")}};var t={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_MATERIALS_COMMON:"KHR_materials_common"};var a={magic:"glTF",version:1,contentFormat:0},n=20;function i(e){this.name=t.KHR_BINARY_GLTF;var r=new DataView(e,0,n),i={magic:THREE.LoaderUtils.decodeText(new Uint8Array(e.slice(0,4))),version:r.getUint32(4,!0),length:r.getUint32(8,!0),contentLength:r.getUint32(12,!0),contentFormat:r.getUint32(16,!0)};for(var s in a){var o=a[s];if(i[s]!==o)throw new Error('Unsupported glTF-Binary header: Expected "%s" to be "%s".',s,o)}var c=new Uint8Array(e,n,i.contentLength);this.header=i,this.content=THREE.LoaderUtils.decodeText(c),this.body=e.slice(n+i.contentLength,i.length)}i.prototype.loadShader=function(e,r){var a=r[e.extensions[t.KHR_BINARY_GLTF].bufferView],n=new Uint8Array(a);return THREE.LoaderUtils.decodeText(n)},i.prototype.loadTextureSourceUri=function(e,r){var a=e.extensions[t.KHR_BINARY_GLTF],n=r[a.bufferView],i=THREE.LoaderUtils.decodeText(new Uint8Array(n));return"data:"+a.mimeType+";base64,"+btoa(i)};var s={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,TRIANGLES:4,LINES:1,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,VERTEX_SHADER:35633,FRAGMENT_SHADER:35632},o={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture},c={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},E={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},u={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},d={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},p={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},l={1028:THREE.BackSide,1029:THREE.FrontSide},f={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth},h={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation},T={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor},m={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},R={scale:"scale",translation:"position",rotation:"quaternion"},v={LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},H={2884:"CULL_FACE",2929:"DEPTH_TEST",3042:"BLEND",3089:"SCISSOR_TEST",32823:"POLYGON_OFFSET_FILL",32926:"SAMPLE_ALPHA_TO_COVERAGE"};function A(e,r,t){if(!e)return Promise.resolve();var a,n=[];if("[object Array]"===Object.prototype.toString.call(e)){a=[];for(var i=e.length,s=0;s<i;s++){(c=r.call(t||this,e[s],s))&&(n.push(c),c instanceof Promise?c.then(function(e,r){a[e]=r}.bind(this,s)):a[s]=c)}}else for(var o in a={},e){var c;if(e.hasOwnProperty(o))(c=r.call(t||this,e[o],o))&&(n.push(c),c instanceof Promise?c.then(function(e,r){a[e]=r}.bind(this,o)):a[o]=c)}return Promise.all(n).then(function(){return a})}function y(e,r){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)?e:/^data:.*,.*$/i.test(e)?e:(r||"")+e}function L(e){this.isDeferredShaderMaterial=!0,this.params=e}function b(e,r,t){this.json=e||{},this.extensions=r||{},this.options=t||{},this.cache=new function(){var e={};return{get:function(r){return e[r]},add:function(r,t){e[r]=t},remove:function(r){delete e[r]},removeAll:function(){e={}},update:function(r,t){for(var a in e){var n=e[a];n.update&&n.update(r,t)}}}}}return L.prototype.create=function(){var e=THREE.UniformsUtils.clone(this.params.uniforms);for(var r in this.params.uniforms){var t=this.params.uniforms[r];t.value instanceof THREE.Texture&&(e[r].value=t.value,e[r].value.needsUpdate=!0),e[r].semantic=t.semantic,e[r].node=t.node}return this.params.uniforms=e,new THREE.RawShaderMaterial(this.params)},b.prototype._withDependencies=function(e){for(var r={},t=0;t<e.length;t++){var a=e[t],n="load"+a.charAt(0).toUpperCase()+a.slice(1),i=this.cache.get(a);if(void 0!==i)r[a]=i;else if(this[n]){var s=this[n]();this.cache.add(a,s),r[a]=s}}return A(r,function(e){return e})},b.prototype.parse=function(e){var r=this.json;this.cache.removeAll(),this._withDependencies(["scenes","cameras","animations"]).then(function(t){var a=[];for(var n in t.scenes)a.push(t.scenes[n]);var i=void 0!==r.scene?t.scenes[r.scene]:a[0],s=[];for(var n in t.cameras){var o=t.cameras[n];s.push(o)}var c=[];for(var n in t.animations)c.push(t.animations[n]);e(i,a,s,c)})},b.prototype.loadShaders=function(){var e=this.json,r=this.extensions,a=this.options;return this._withDependencies(["bufferViews"]).then(function(n){return A(e.shaders,function(e){return e.extensions&&e.extensions[t.KHR_BINARY_GLTF]?r[t.KHR_BINARY_GLTF].loadShader(e,n.bufferViews):new Promise(function(r){var t=new THREE.FileLoader;t.setResponseType("text"),t.load(y(e.uri,a.path),function(e){r(e)})})})})},b.prototype.loadBuffers=function(){var e=this.json,r=this.extensions,a=this.options;return A(e.buffers,function(e,n){return"binary_glTF"===n?r[t.KHR_BINARY_GLTF].body:"arraybuffer"===e.type||void 0===e.type?new Promise(function(r){var t=new THREE.FileLoader;t.setResponseType("arraybuffer"),t.load(y(e.uri,a.path),function(e){r(e)})}):void console.warn("THREE.LegacyGLTFLoader: "+e.type+" buffer type is not supported")})},b.prototype.loadBufferViews=function(){var e=this.json;return this._withDependencies(["buffers"]).then(function(r){return A(e.bufferViews,function(e){var t=r.buffers[e.buffer],a=void 0!==e.byteLength?e.byteLength:0;return t.slice(e.byteOffset,e.byteOffset+a)})})},b.prototype.loadAccessors=function(){var e=this.json;return this._withDependencies(["bufferViews"]).then(function(r){return A(e.accessors,function(e){var t=r.bufferViews[e.bufferView],a=m[e.type],n=c[e.componentType],i=n.BYTES_PER_ELEMENT,s=i*a;if(e.byteStride&&e.byteStride!==s){var o=new n(t),E=new THREE.InterleavedBuffer(o,e.byteStride/i);return new THREE.InterleavedBufferAttribute(E,a,e.byteOffset/i)}return o=new n(t,e.byteOffset,e.count*a),new THREE.BufferAttribute(o,a)})})},b.prototype.loadTextures=function(){var e=this.json,r=this.extensions,a=this.options;return this._withDependencies(["bufferViews"]).then(function(n){return A(e.textures,function(i){if(i.source)return new Promise(function(s){var o=e.images[i.source],c=o.uri;o.extensions&&o.extensions[t.KHR_BINARY_GLTF]&&(c=r[t.KHR_BINARY_GLTF].loadTextureSourceUri(o,n.bufferViews));var l=THREE.Loader.Handlers.get(c);null===l&&(l=new THREE.TextureLoader),l.setCrossOrigin(a.crossOrigin),l.load(y(c,a.path),function(r){if(r.flipY=!1,void 0!==i.name&&(r.name=i.name),r.format=void 0!==i.format?d[i.format]:THREE.RGBAFormat,void 0!==i.internalFormat&&r.format!==d[i.internalFormat]&&console.warn("THREE.LegacyGLTFLoader: Three.js doesn't support texture internalFormat which is different from texture format. internalFormat will be forced to be the same value as format."),r.type=void 0!==i.type?p[i.type]:THREE.UnsignedByteType,i.sampler){var t=e.samplers[i.sampler];r.magFilter=E[t.magFilter]||THREE.LinearFilter,r.minFilter=E[t.minFilter]||THREE.NearestMipMapLinearFilter,r.wrapS=u[t.wrapS]||THREE.RepeatWrapping,r.wrapT=u[t.wrapT]||THREE.RepeatWrapping}s(r)},void 0,function(){s()})})})})},b.prototype.loadMaterials=function(){var e=this.json;return this._withDependencies(["shaders","textures"]).then(function(r){return A(e.materials,function(a){var n,i,c={},E={};if(a.extensions&&a.extensions[t.KHR_MATERIALS_COMMON]&&(i=a.extensions[t.KHR_MATERIALS_COMMON]),i){var u=["ambient","emission","transparent","transparency","doubleSided"];switch(i.technique){case"BLINN":case"PHONG":n=THREE.MeshPhongMaterial,u.push("diffuse","specular","shininess");break;case"LAMBERT":n=THREE.MeshLambertMaterial,u.push("diffuse");break;case"CONSTANT":default:n=THREE.MeshBasicMaterial}u.forEach(function(e){void 0!==i.values[e]&&(c[e]=i.values[e])}),(i.doubleSided||c.doubleSided)&&(E.side=THREE.DoubleSide),(i.transparent||c.transparent)&&(E.transparent=!0,E.opacity=void 0!==c.transparency?c.transparency:1)}else if(void 0===a.technique)n=THREE.MeshPhongMaterial,Object.assign(c,a.values);else{n=L;var d=e.techniques[a.technique];E.uniforms={};var p=e.programs[d.program];if(p){E.fragmentShader=r.shaders[p.fragmentShader],E.fragmentShader||(console.warn("ERROR: Missing fragment shader definition:",p.fragmentShader),n=THREE.MeshPhongMaterial);var m=r.shaders[p.vertexShader];m||(console.warn("ERROR: Missing vertex shader definition:",p.vertexShader),n=THREE.MeshPhongMaterial),E.vertexShader=function(e,r){var t={};for(var a in r.attributes){var n=r.attributes[a],i=(d=r.parameters[n]).type,s=d.semantic;t[a]={type:i,semantic:s}}var o=r.parameters,c=r.attributes,E={};for(var a in t){var u=o[n=c[a]];(s=u.semantic)&&(E[a]=u)}for(var n in E){s=(d=E[n]).semantic;var d,p=new RegExp("\\b"+n+"\\b","g");switch(s){case"POSITION":e=e.replace(p,"position");break;case"NORMAL":e=e.replace(p,"normal");break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":e=e.replace(p,"uv");break;case"TEXCOORD_1":e=e.replace(p,"uv2");break;case"COLOR_0":case"COLOR0":case"COLOR":e=e.replace(p,"color");break;case"WEIGHT":e=e.replace(p,"skinWeight");break;case"JOINT":e=e.replace(p,"skinIndex")}}return e}(m,d);var R=d.uniforms;for(var v in R){var A=R[v],y=d.parameters[A],b=y.type;if(!o[b])throw new Error("Unknown shader uniform param type: "+b);var w,O=y.count;void 0!==a.values&&(w=a.values[A]);var M=new o[b],g=y.semantic,S=y.node;switch(b){case s.FLOAT:M=y.value,"transparency"==A&&(E.transparent=!0),void 0!==w&&(M=w);break;case s.FLOAT_VEC2:case s.FLOAT_VEC3:case s.FLOAT_VEC4:case s.FLOAT_MAT3:y&&y.value&&M.fromArray(y.value),w&&M.fromArray(w);break;case s.FLOAT_MAT2:console.warn("FLOAT_MAT2 is not a supported uniform type");break;case s.FLOAT_MAT4:if(O){M=new Array(O);for(var _=0;_<O;_++)M[_]=new o[b];if(y&&y.value){var x=y.value;M.fromArray(x)}w&&M.fromArray(w)}else{if(y&&y.value){var F=y.value;M.fromArray(F)}w&&M.fromArray(w)}break;case s.SAMPLER_2D:M=void 0!==w?r.textures[w]:void 0!==y.value?r.textures[y.value]:null}E.uniforms[v]={value:M,semantic:g,node:S}}for(var N=d.states||{},D=N.enable||[],C=N.functions||{},I=!1,k=!1,U=!1,B=0,G=D.length;B<G;B++){var P=D[B];switch(H[P]){case"CULL_FACE":I=!0;break;case"DEPTH_TEST":k=!0;break;case"BLEND":U=!0;break;case"SCISSOR_TEST":case"POLYGON_OFFSET_FILL":case"SAMPLE_ALPHA_TO_COVERAGE":break;default:throw new Error("Unknown technique.states.enable: "+P)}}E.side=I?void 0!==C.cullFace?l[C.cullFace]:THREE.FrontSide:THREE.DoubleSide,E.depthTest=k,E.depthFunc=void 0!==C.depthFunc?f[C.depthFunc]:THREE.LessDepth,E.depthWrite=void 0===C.depthMask||C.depthMask[0],E.blending=U?THREE.CustomBlending:THREE.NoBlending,E.transparent=U;var j=C.blendEquationSeparate;void 0!==j?(E.blendEquation=h[j[0]],E.blendEquationAlpha=h[j[1]]):(E.blendEquation=THREE.AddEquation,E.blendEquationAlpha=THREE.AddEquation);var V=C.blendFuncSeparate;void 0!==V?(E.blendSrc=T[V[0]],E.blendDst=T[V[1]],E.blendSrcAlpha=T[V[2]],E.blendDstAlpha=T[V[3]]):(E.blendSrc=THREE.OneFactor,E.blendDst=THREE.ZeroFactor,E.blendSrcAlpha=THREE.OneFactor,E.blendDstAlpha=THREE.ZeroFactor)}}Array.isArray(c.diffuse)?E.color=(new THREE.Color).fromArray(c.diffuse):"string"==typeof c.diffuse&&(E.map=r.textures[c.diffuse]),delete E.diffuse,"string"==typeof c.reflective&&(E.envMap=r.textures[c.reflective]),"string"==typeof c.bump&&(E.bumpMap=r.textures[c.bump]),Array.isArray(c.emission)?n===THREE.MeshBasicMaterial?E.color=(new THREE.Color).fromArray(c.emission):E.emissive=(new THREE.Color).fromArray(c.emission):"string"==typeof c.emission&&(n===THREE.MeshBasicMaterial?E.map=r.textures[c.emission]:E.emissiveMap=r.textures[c.emission]),Array.isArray(c.specular)?E.specular=(new THREE.Color).fromArray(c.specular):"string"==typeof c.specular&&(E.specularMap=r.textures[c.specular]),void 0!==c.shininess&&(E.shininess=c.shininess);var K=new n(E);return void 0!==a.name&&(K.name=a.name),K})})},b.prototype.loadMeshes=function(){var e=this.json;return this._withDependencies(["accessors","materials"]).then(function(r){return A(e.meshes,function(e){var t=new THREE.Group;void 0!==e.name&&(t.name=e.name),e.extras&&(t.userData=e.extras);var a=e.primitives||[];for(var n in a){var i=a[n];if(i.mode===s.TRIANGLES||void 0===i.mode){var o=new THREE.BufferGeometry,c=i.attributes;for(var E in c){if(!(p=c[E]))return;var u=r.accessors[p];switch(E){case"POSITION":o.addAttribute("position",u);break;case"NORMAL":o.addAttribute("normal",u);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":o.addAttribute("uv",u);break;case"TEXCOORD_1":o.addAttribute("uv2",u);break;case"COLOR_0":case"COLOR0":case"COLOR":o.addAttribute("color",u);break;case"WEIGHT":o.addAttribute("skinWeight",u);break;case"JOINT":o.addAttribute("skinIndex",u)}}i.indices&&o.setIndex(r.accessors[i.indices]);var d=void 0!==r.materials?r.materials[i.material]:new THREE.MeshPhongMaterial({color:0,emissive:8947848,specular:0,shininess:0,transparent:!1,depthTest:!0,side:THREE.FrontSide});(l=new THREE.Mesh(o,d)).castShadow=!0,l.name="0"===n?t.name:t.name+n,i.extras&&(l.userData=i.extras),t.add(l)}else if(i.mode===s.LINES){o=new THREE.BufferGeometry,c=i.attributes;for(var E in c){var p;if(!(p=c[E]))return;u=r.accessors[p];switch(E){case"POSITION":o.addAttribute("position",u);break;case"COLOR_0":case"COLOR0":case"COLOR":o.addAttribute("color",u)}}var l;d=r.materials[i.material];i.indices?(o.setIndex(r.accessors[i.indices]),l=new THREE.LineSegments(o,d)):l=new THREE.Line(o,d),l.name="0"===n?t.name:t.name+n,i.extras&&(l.userData=i.extras),t.add(l)}else console.warn("Only triangular and line primitives are supported")}return t})})},b.prototype.loadCameras=function(){return A(this.json.cameras,function(e){if("perspective"==e.type&&e.perspective){var r=e.perspective.yfov,t=void 0!==e.perspective.aspectRatio?e.perspective.aspectRatio:1,a=r*t,n=new THREE.PerspectiveCamera(THREE.Math.radToDeg(a),t,e.perspective.znear||1,e.perspective.zfar||2e6);return void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n}if("orthographic"==e.type&&e.orthographic){n=new THREE.OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,e.orthographic.znear,e.orthographic.zfar);return void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras),n}})},b.prototype.loadSkins=function(){var e=this.json;return this._withDependencies(["accessors"]).then(function(r){return A(e.skins,function(e){var t=new THREE.Matrix4;return void 0!==e.bindShapeMatrix&&t.fromArray(e.bindShapeMatrix),{bindShapeMatrix:t,jointNames:e.jointNames,inverseBindMatrices:r.accessors[e.inverseBindMatrices]}})})},b.prototype.loadAnimations=function(){var e=this.json;return this._withDependencies(["accessors","nodes"]).then(function(r){return A(e.animations,function(e,t){var a=[];for(var n in e.channels){var i=e.channels[n],s=e.samplers[i.sampler];if(s){var o=i.target,c=o.id,E=void 0!==e.parameters?e.parameters[s.input]:s.input,u=void 0!==e.parameters?e.parameters[s.output]:s.output,d=r.accessors[E],p=r.accessors[u],l=r.nodes[c];if(l){l.updateMatrix(),l.matrixAutoUpdate=!0;var f=R[o.path]===R.rotation?THREE.QuaternionKeyframeTrack:THREE.VectorKeyframeTrack,h=l.name?l.name:l.uuid,T=void 0!==s.interpolation?v[s.interpolation]:THREE.InterpolateLinear;a.push(new f(h+"."+R[o.path],THREE.AnimationUtils.arraySlice(d.array,0),THREE.AnimationUtils.arraySlice(p.array,0),T))}}}c=void 0!==e.name?e.name:"animation_"+t;return new THREE.AnimationClip(c,void 0,a)})})},b.prototype.loadNodes=function(){var e=this.json,r=this.extensions,a=this;return A(e.nodes,function(e){var r,t=new THREE.Matrix4;return e.jointName?((r=new THREE.Bone).name=void 0!==e.name?e.name:e.jointName,r.jointName=e.jointName):(r=new THREE.Object3D,void 0!==e.name&&(r.name=e.name)),e.extras&&(r.userData=e.extras),void 0!==e.matrix?(t.fromArray(e.matrix),r.applyMatrix(t)):(void 0!==e.translation&&r.position.fromArray(e.translation),void 0!==e.rotation&&r.quaternion.fromArray(e.rotation),void 0!==e.scale&&r.scale.fromArray(e.scale)),r}).then(function(n){return a._withDependencies(["meshes","skins","cameras"]).then(function(a){return A(n,function(i,s){var o=e.nodes[s];if(void 0!==o.meshes)for(var c in o.meshes){var E=o.meshes[c],u=a.meshes[E];if(void 0!==u)for(var d in u.children){var p,l=u.children[d],f=l.material,h=l.geometry,T=l.userData,m=l.name;switch(f.isDeferredShaderMaterial?f=R=f.create():R=f,l.type){case"LineSegments":l=new THREE.LineSegments(h,R);break;case"LineLoop":l=new THREE.LineLoop(h,R);break;case"Line":l=new THREE.Line(h,R);break;default:l=new THREE.Mesh(h,R)}if(l.castShadow=!0,l.userData=T,l.name=m,o.skin&&(p=a.skins[o.skin]),p){var R,v=function(e){for(var r=Object.keys(n),t=0,a=r.length;t<a;t++){var i=n[r[t]];if(i.jointName===e)return i}return null},H=h;(R=f).skinning=!0,(l=new THREE.SkinnedMesh(H,R)).castShadow=!0,l.userData=T,l.name=m;for(var A=[],y=[],L=0,b=p.jointNames.length;L<b;L++){var w=p.jointNames[L],O=v(w);if(O){A.push(O);var M=p.inverseBindMatrices.array,g=(new THREE.Matrix4).fromArray(M,16*L);y.push(g)}else console.warn("WARNING: joint: '"+w+"' could not be found")}l.bind(new THREE.Skeleton(A,y),p.bindShapeMatrix);var S=function(r,t,a){var i=r[a];if(void 0!==i)for(var s=0,o=i.length;s<o;s++){var c=i[s],E=n[c],u=e.nodes[c];void 0!==E&&!0===E.isBone&&void 0!==u&&(t.add(E),S(u,E,"children"))}};S(o,l,"skeletons")}i.add(l)}else console.warn("LegacyGLTFLoader: Couldn't find node \""+E+'".')}if(void 0!==o.camera){var _=a.cameras[o.camera];i.add(_)}if(o.extensions&&o.extensions[t.KHR_MATERIALS_COMMON]&&o.extensions[t.KHR_MATERIALS_COMMON].light){var x=r[t.KHR_MATERIALS_COMMON].lights[o.extensions[t.KHR_MATERIALS_COMMON].light];i.add(x)}return i})})})},b.prototype.loadScenes=function(){var e=this.json;function t(r,a,n){var i=n[r];a.add(i);var s=e.nodes[r];if(s.children)for(var o=s.children,c=0,E=o.length;c<E;c++){t(o[c],i,n)}}return this._withDependencies(["nodes"]).then(function(a){return A(e.scenes,function(e){var n=new THREE.Scene;void 0!==e.name&&(n.name=e.name),e.extras&&(n.userData=e.extras);for(var i=e.nodes||[],s=0,o=i.length;s<o;s++){t(i[s],n,a.nodes)}return n.traverse(function(e){e.material&&e.material.isRawShaderMaterial&&(e.gltfShader=new r(e,a.nodes),e.onBeforeRender=function(e,r,t){this.gltfShader.update(r,t)})}),n})})},e}();