THREE.EditorControls=function(e,t){t=void 0!==t?t:document,this.enabled=!0,this.center=new THREE.Vector3,this.panSpeed=.001,this.zoomSpeed=.001,this.rotationSpeed=.005;var o=this,n=new THREE.Vector3,r={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},i=r.NONE,s=this.center,a=new THREE.Matrix3,c=new THREE.Vector2,E=new THREE.Vector2,p=new THREE.Spherical,u={type:"change"};function d(e){!1!==o.enabled&&(0===e.button?i=r.ROTATE:1===e.button?i=r.ZOOM:2===e.button&&(i=r.PAN),E.set(e.clientX,e.clientY),t.addEventListener("mousemove",v,!1),t.addEventListener("mouseup",l,!1),t.addEventListener("mouseout",l,!1),t.addEventListener("dblclick",l,!1))}function v(e){if(!1!==o.enabled){c.set(e.clientX,e.clientY);var t=c.x-E.x,n=c.y-E.y;i===r.ROTATE?o.rotate(new THREE.Vector3(-t*o.rotationSpeed,-n*o.rotationSpeed,0)):i===r.ZOOM?o.zoom(new THREE.Vector3(0,0,n)):i===r.PAN&&o.pan(new THREE.Vector3(-t,n,0)),E.set(e.clientX,e.clientY)}}function l(e){t.removeEventListener("mousemove",v,!1),t.removeEventListener("mouseup",l,!1),t.removeEventListener("mouseout",l,!1),t.removeEventListener("dblclick",l,!1),i=r.NONE}function m(e){e.preventDefault(),o.zoom(new THREE.Vector3(0,0,e.deltaY))}function h(e){e.preventDefault()}this.focus=function(t){var n,r=(new THREE.Box3).setFromObject(t);!1===r.isEmpty()?(s.copy(r.getCenter()),n=r.getBoundingSphere().radius):(s.setFromMatrixPosition(t.matrixWorld),n=.1);var i=new THREE.Vector3(0,0,1);i.applyQuaternion(e.quaternion),i.multiplyScalar(4*n),e.position.copy(s).add(i),o.dispatchEvent(u)},this.pan=function(t){var n=e.position.distanceTo(s);t.multiplyScalar(n*o.panSpeed),t.applyMatrix3(a.getNormalMatrix(e.matrix)),e.position.add(t),s.add(t),o.dispatchEvent(u)},this.zoom=function(t){var n=e.position.distanceTo(s);t.multiplyScalar(n*o.zoomSpeed),t.length()>n||(t.applyMatrix3(a.getNormalMatrix(e.matrix)),e.position.add(t),o.dispatchEvent(u))},this.rotate=function(t){n.copy(e.position).sub(s),p.setFromVector3(n),p.theta+=t.x,p.phi+=t.y,p.makeSafe(),n.setFromSpherical(p),e.position.copy(s).add(n),e.lookAt(s),o.dispatchEvent(u)},this.dispose=function(){t.removeEventListener("contextmenu",h,!1),t.removeEventListener("mousedown",d,!1),t.removeEventListener("wheel",m,!1),t.removeEventListener("mousemove",v,!1),t.removeEventListener("mouseup",l,!1),t.removeEventListener("mouseout",l,!1),t.removeEventListener("dblclick",l,!1),t.removeEventListener("touchstart",w,!1),t.removeEventListener("touchmove",y,!1)},t.addEventListener("contextmenu",h,!1),t.addEventListener("mousedown",d,!1),t.addEventListener("wheel",m,!1);var T=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],R=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],g=null;function w(e){if(!1!==o.enabled){switch(e.touches.length){case 1:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[1].pageX,e.touches[1].pageY,0),g=T[0].distanceTo(T[1])}R[0].copy(T[0]),R[1].copy(T[1])}}function y(e){if(!1!==o.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[0].pageX,e.touches[0].pageY,0),o.rotate(T[0].sub(i(T[0],R)).multiplyScalar(-o.rotationSpeed));break;case 2:T[0].set(e.touches[0].pageX,e.touches[0].pageY,0),T[1].set(e.touches[1].pageX,e.touches[1].pageY,0);var t=T[0].distanceTo(T[1]);o.zoom(new THREE.Vector3(0,0,g-t)),g=t;var n=T[0].clone().sub(i(T[0],R)),r=T[1].clone().sub(i(T[1],R));n.x=-n.x,r.x=-r.x,o.pan(n.add(r).multiplyScalar(.5))}R[0].copy(T[0]),R[1].copy(T[1])}function i(e,t){var o=t[0];for(var n in t)o.distanceTo(e)>t[n].distanceTo(e)&&(o=t[n]);return o}}t.addEventListener("touchstart",w,!1),t.addEventListener("touchmove",y,!1)},THREE.EditorControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.EditorControls.prototype.constructor=THREE.EditorControls;