THREE.SVGObject=function(e){THREE.Object3D.call(this),this.node=e},THREE.SVGObject.prototype=Object.create(THREE.Object3D.prototype),THREE.SVGObject.prototype.constructor=THREE.SVGObject,THREE.SVGRenderer=function(){console.log("THREE.SVGRenderer",THREE.REVISION);var e,i,t,o,n,r,s,a,c,l,E,p,f,d=this,h=new THREE.Projector,u=document.createElementNS("http://www.w3.org/2000/svg","svg"),R=new THREE.Box2,S=new THREE.Box2,m=new THREE.Color,y=new THREE.Color,T=new THREE.Color,H=new THREE.Color,b=new THREE.Color,v=new THREE.Color,x=1,g=new THREE.Vector3,w=new THREE.Vector3,M=new THREE.Vector3,C=new THREE.Matrix3,z=new THREE.Matrix4,j=new THREE.Matrix4,L=[],V=0,k=1,P=null;function G(){for(V=0;u.childNodes.length>0;)u.removeChild(u.childNodes[0])}function B(e,i){var t=Math.floor(255*e.r)+","+Math.floor(255*e.g)+","+Math.floor(255*e.b);return void 0===i||1===i?"rgb("+t+")":"rgb("+t+"); fill-opacity: "+i}function O(e){return null!==P?e.toFixed(P):e}function F(e,i,t){var o=i.scale.x*r,n=i.scale.y*s;t.isPointsMaterial&&(o*=t.size,n*=t.size);var a="M"+O(e.x-.5*o)+","+O(e.y-.5*n)+"h"+O(o)+"v"+O(n)+"h"+O(-o)+"z",c="";(t.isSpriteMaterial||t.isPointsMaterial)&&(c="fill:"+B(t.color,t.opacity)),N(c,a)}function A(e,i,t,o){var n="M"+O(e.positionScreen.x)+","+O(e.positionScreen.y)+"L"+O(i.positionScreen.x)+","+O(i.positionScreen.y);if(o.isLineBasicMaterial){var r="fill:none;stroke:"+B(o.color,o.opacity)+";stroke-width:"+o.linewidth+";stroke-linecap:"+o.linecap;o.isLineDashedMaterial&&(r=r+";stroke-dasharray:"+o.dashSize+","+o.gapSize),N(r,n)}}function W(e,i,o,n,r){d.info.render.vertices+=3,d.info.render.faces++;var s="M"+O(e.positionScreen.x)+","+O(e.positionScreen.y)+"L"+O(i.positionScreen.x)+","+O(i.positionScreen.y)+"L"+O(o.positionScreen.x)+","+O(o.positionScreen.y)+"z";r instanceof THREE.MeshBasicMaterial?(m.copy(r.color),r.vertexColors===THREE.FaceColors&&m.multiply(n.color)):r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial?(y.copy(r.color),r.vertexColors===THREE.FaceColors&&y.multiply(n.color),m.copy(T),w.copy(e.positionWorld).add(i.positionWorld).add(o.positionWorld).divideScalar(3),function(e,i,t,o){for(var n=0,r=e.length;n<r;n++){var s=e[n],a=s.color;if(s instanceof THREE.DirectionalLight){var c=g.setFromMatrixPosition(s.matrixWorld).normalize();if((l=t.dot(c))<=0)continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}else if(s instanceof THREE.PointLight){var l;if(c=g.setFromMatrixPosition(s.matrixWorld),(l=t.dot(g.subVectors(c,i).normalize()))<=0)continue;if(0==(l*=0==s.distance?1:1-Math.min(i.distanceTo(c)/s.distance,1)))continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}}}(t,w,n.normalModel,m),m.multiply(y).add(r.emissive)):r instanceof THREE.MeshNormalMaterial&&(M.copy(n.normalModel).applyMatrix3(C),m.setRGB(M.x,M.y,M.z).multiplyScalar(.5).addScalar(.5)),N(r.wireframe?"fill:none;stroke:"+B(m,r.opacity)+";stroke-width:"+r.wireframeLinewidth+";stroke-linecap:"+r.wireframeLinecap+";stroke-linejoin:"+r.wireframeLinejoin:"fill:"+B(m,r.opacity),s)}function N(e,i){f===e?p+=i:(D(),f=e,p=i)}function D(){p&&((E=function(e){if(null==L[e])return L[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==k&&L[e].setAttribute("shape-rendering","crispEdges"),L[e];return L[e]}(V++)).setAttribute("d",p),E.setAttribute("style",f),u.appendChild(E)),p="",f=""}this.domElement=u,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":k=1;break;case"low":k=0}},this.setClearColor=function(e,i){v.set(e),x=void 0!==i?i:1},this.setPixelRatio=function(){},this.setSize=function(e,i){r=(o=e)/2,s=(n=i)/2,u.setAttribute("viewBox",-r+" "+-s+" "+o+" "+n),u.setAttribute("width",o),u.setAttribute("height",n),R.min.set(-r,-s),R.max.set(r,s)},this.setPrecision=function(e){P=e},this.clear=function(){G(),u.style.backgroundColor=B(v,x)},this.render=function(o,n){if(n instanceof THREE.Camera!=!1){var E=o.background;E&&E.isColor?(G(),u.style.backgroundColor=B(E)):!0===this.autoClear&&this.clear(),d.info.render.vertices=0,d.info.render.faces=0,z.copy(n.matrixWorldInverse),j.multiplyMatrices(n.projectionMatrix,z),e=h.projectScene(o,n,this.sortObjects,this.sortElements),i=e.elements,t=e.lights,C.getNormalMatrix(n.matrixWorldInverse),function(e){T.setRGB(0,0,0),H.setRGB(0,0,0),b.setRGB(0,0,0);for(var i=0,t=e.length;i<t;i++){var o=e[i],n=o.color;o instanceof THREE.AmbientLight?(T.r+=n.r,T.g+=n.g,T.b+=n.b):o instanceof THREE.DirectionalLight?(H.r+=n.r,H.g+=n.g,H.b+=n.b):o instanceof THREE.PointLight&&(b.r+=n.r,b.g+=n.g,b.b+=n.b)}}(t),p="",f="";for(var m=0,y=i.length;m<y;m++){var v=i[m],x=v.material;if(void 0!==x&&0!==x.opacity)if(S.makeEmpty(),v instanceof THREE.RenderableSprite)(a=v).x*=r,a.y*=-s,F(a,v,x);else if(v instanceof THREE.RenderableLine)a=v.v1,c=v.v2,a.positionScreen.x*=r,a.positionScreen.y*=-s,c.positionScreen.x*=r,c.positionScreen.y*=-s,S.setFromPoints([a.positionScreen,c.positionScreen]),!0===R.intersectsBox(S)&&A(a,c,v,x);else if(v instanceof THREE.RenderableFace){if(a=v.v1,c=v.v2,l=v.v3,a.positionScreen.z<-1||a.positionScreen.z>1)continue;if(c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;a.positionScreen.x*=r,a.positionScreen.y*=-s,c.positionScreen.x*=r,c.positionScreen.y*=-s,l.positionScreen.x*=r,l.positionScreen.y*=-s,S.setFromPoints([a.positionScreen,c.positionScreen,l.positionScreen]),!0===R.intersectsBox(S)&&W(a,c,l,v,x)}}D(),o.traverseVisible(function(e){if(e instanceof THREE.SVGObject){g.setFromMatrixPosition(e.matrixWorld),g.applyMatrix4(j);var i=g.x*r,t=-g.y*s,o=e.node;o.setAttribute("transform","translate("+i+","+t+")"),u.appendChild(o)}})}else console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera.")}};