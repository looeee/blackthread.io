THREE.SVGObject=function(e){THREE.Object3D.call(this),this.node=e},THREE.SVGObject.prototype=Object.create(THREE.Object3D.prototype),THREE.SVGObject.prototype.constructor=THREE.SVGObject,THREE.SVGRenderer=function(){console.log("THREE.SVGRenderer",THREE.REVISION);var e,t,i,o,n,r,s,a,c,l,E,p,f,d=this,h=new THREE.Projector,u=document.createElementNS("http://www.w3.org/2000/svg","svg"),R=new THREE.Box2,S=new THREE.Box2,m=new THREE.Color,y=new THREE.Color,T=new THREE.Color,x=new THREE.Color,H=new THREE.Color,b=new THREE.Color,v=1,g=new THREE.Vector3,w=new THREE.Vector3,M=new THREE.Vector3,C=new THREE.Matrix3,z=new THREE.Matrix4,j=new THREE.Matrix4,L=[],V=0,k=1,P=null;function G(){for(V=0;u.childNodes.length>0;)u.removeChild(u.childNodes[0])}function B(e,t){var i=Math.floor(255*e.r)+","+Math.floor(255*e.g)+","+Math.floor(255*e.b);return void 0===t||1===t?"rgb("+i+")":"rgb("+i+"); fill-opacity: "+t}function O(e){return null!==P?e.toFixed(P):e}function F(e,t,i){var o=t.scale.x*r,n=t.scale.y*s;i.isPointsMaterial&&(o*=i.size,n*=i.size);var a="M"+O(e.x-.5*o)+","+O(e.y-.5*n)+"h"+O(o)+"v"+O(n)+"h"+O(-o)+"z",c="";(i.isSpriteMaterial||i.isPointsMaterial)&&(c="fill:"+B(i.color,i.opacity)),N(c,a)}function A(e,t,i,o){var n="M"+O(e.positionScreen.x)+","+O(e.positionScreen.y)+"L"+O(t.positionScreen.x)+","+O(t.positionScreen.y);if(o.isLineBasicMaterial){var r="fill:none;stroke:"+B(o.color,o.opacity)+";stroke-width:"+o.linewidth+";stroke-linecap:"+o.linecap;o.isLineDashedMaterial&&(r=r+";stroke-dasharray:"+o.dashSize+","+o.gapSize),N(r,n)}}function W(e,t,o,n,r){d.info.render.vertices+=3,d.info.render.faces++;var s="M"+O(e.positionScreen.x)+","+O(e.positionScreen.y)+"L"+O(t.positionScreen.x)+","+O(t.positionScreen.y)+"L"+O(o.positionScreen.x)+","+O(o.positionScreen.y)+"z";r instanceof THREE.MeshBasicMaterial?(m.copy(r.color),r.vertexColors===THREE.FaceColors&&m.multiply(n.color)):r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial?(y.copy(r.color),r.vertexColors===THREE.FaceColors&&y.multiply(n.color),m.copy(T),w.copy(e.positionWorld).add(t.positionWorld).add(o.positionWorld).divideScalar(3),function(e,t,i,o){for(var n=0,r=e.length;n<r;n++){var s=e[n],a=s.color;if(s instanceof THREE.DirectionalLight){var c=g.setFromMatrixPosition(s.matrixWorld).normalize();if((l=i.dot(c))<=0)continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}else if(s instanceof THREE.PointLight){var l;if(c=g.setFromMatrixPosition(s.matrixWorld),(l=i.dot(g.subVectors(c,t).normalize()))<=0)continue;if(0==(l*=0==s.distance?1:1-Math.min(t.distanceTo(c)/s.distance,1)))continue;l*=s.intensity,o.r+=a.r*l,o.g+=a.g*l,o.b+=a.b*l}}}(i,w,n.normalModel,m),m.multiply(y).add(r.emissive)):r instanceof THREE.MeshNormalMaterial&&(M.copy(n.normalModel).applyMatrix3(C),m.setRGB(M.x,M.y,M.z).multiplyScalar(.5).addScalar(.5)),N(r.wireframe?"fill:none;stroke:"+B(m,r.opacity)+";stroke-width:"+r.wireframeLinewidth+";stroke-linecap:"+r.wireframeLinecap+";stroke-linejoin:"+r.wireframeLinejoin:"fill:"+B(m,r.opacity),s)}function N(e,t){f===e?p+=t:(D(),f=e,p=t)}function D(){p&&((E=function(e){if(null==L[e])return L[e]=document.createElementNS("http://www.w3.org/2000/svg","path"),0==k&&L[e].setAttribute("shape-rendering","crispEdges"),L[e];return L[e]}(V++)).setAttribute("d",p),E.setAttribute("style",f),u.appendChild(E)),p="",f=""}this.domElement=u,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.setQuality=function(e){switch(e){case"high":k=1;break;case"low":k=0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setClearColor=function(e,t){b.set(e),v=void 0!==t?t:1},this.setPixelRatio=function(){},this.setSize=function(e,t){r=(o=e)/2,s=(n=t)/2,u.setAttribute("viewBox",-r+" "+-s+" "+o+" "+n),u.setAttribute("width",o),u.setAttribute("height",n),R.min.set(-r,-s),R.max.set(r,s)},this.setPrecision=function(e){P=e},this.clear=function(){G(),u.style.backgroundColor=B(b,v)},this.render=function(o,n){if(n instanceof THREE.Camera!=!1){var E=o.background;E&&E.isColor?(G(),u.style.backgroundColor=B(E)):!0===this.autoClear&&this.clear(),d.info.render.vertices=0,d.info.render.faces=0,z.copy(n.matrixWorldInverse),j.multiplyMatrices(n.projectionMatrix,z),e=h.projectScene(o,n,this.sortObjects,this.sortElements),t=e.elements,i=e.lights,C.getNormalMatrix(n.matrixWorldInverse),function(e){T.setRGB(0,0,0),x.setRGB(0,0,0),H.setRGB(0,0,0);for(var t=0,i=e.length;t<i;t++){var o=e[t],n=o.color;o instanceof THREE.AmbientLight?(T.r+=n.r,T.g+=n.g,T.b+=n.b):o instanceof THREE.DirectionalLight?(x.r+=n.r,x.g+=n.g,x.b+=n.b):o instanceof THREE.PointLight&&(H.r+=n.r,H.g+=n.g,H.b+=n.b)}}(i),p="",f="";for(var m=0,y=t.length;m<y;m++){var b=t[m],v=b.material;if(void 0!==v&&0!==v.opacity)if(S.makeEmpty(),b instanceof THREE.RenderableSprite)(a=b).x*=r,a.y*=-s,F(a,b,v);else if(b instanceof THREE.RenderableLine)a=b.v1,c=b.v2,a.positionScreen.x*=r,a.positionScreen.y*=-s,c.positionScreen.x*=r,c.positionScreen.y*=-s,S.setFromPoints([a.positionScreen,c.positionScreen]),!0===R.intersectsBox(S)&&A(a,c,b,v);else if(b instanceof THREE.RenderableFace){if(a=b.v1,c=b.v2,l=b.v3,a.positionScreen.z<-1||a.positionScreen.z>1)continue;if(c.positionScreen.z<-1||c.positionScreen.z>1)continue;if(l.positionScreen.z<-1||l.positionScreen.z>1)continue;a.positionScreen.x*=r,a.positionScreen.y*=-s,c.positionScreen.x*=r,c.positionScreen.y*=-s,l.positionScreen.x*=r,l.positionScreen.y*=-s,S.setFromPoints([a.positionScreen,c.positionScreen,l.positionScreen]),!0===R.intersectsBox(S)&&W(a,c,l,b,v)}}D(),o.traverseVisible(function(e){if(e instanceof THREE.SVGObject){g.setFromMatrixPosition(e.matrixWorld),g.applyMatrix4(j);var t=g.x*r,i=-g.y*s,o=e.node;o.setAttribute("transform","translate("+t+","+i+")"),u.appendChild(o)}})}else console.error("THREE.SVGRenderer.render: camera is not an instance of THREE.Camera.")}};