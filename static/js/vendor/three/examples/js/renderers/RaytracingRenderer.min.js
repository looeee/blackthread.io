THREE.RaytracingRenderer=function(e){console.log("THREE.RaytracingRenderer",THREE.REVISION),e=e||{};var t,r,o=this,a=[],i=!1,n=document.createElement("canvas"),s=n.getContext("2d",{alpha:!0===e.alpha}),c=new THREE.Color(0);this.domElement=n,this.autoClear=!0;var l=e.workers,h=e.blockSize||64;this.randomize=e.randomize;var d,f,p,u=[],g=0,m=0;function E(e){e.postMessage({init:[t,r],worker:e.id,blockSize:h})}function v(e){if(!u.length)return i=!1,o.dispatchEvent({type:"complete"});var t=u.pop(),r=t%f*h,a=(t/f|0)*h;e.postMessage({render:!0,x:r,y:a,sceneId:m}),s.fillStyle="#"+e.color,s.fillRect(r,a,h,h)}console.log("%cSpinning off "+l+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(t){for(l=t||navigator.hardwareConcurrency||4;a.length<l;){var r=new Worker(e.workerPath);r.id=g++,r.onmessage=function(e){var t=e.data;if(t&&t.blockSize&&m==t.sceneId){var r=new ImageData(new Uint8ClampedArray(t.data),t.blockSize,t.blockSize);if(s.putImageData(r,t.blockX,t.blockY),console.log("Worker "+this.id,t.time/1e3,(Date.now()-w)/1e3+" s"),a.length>l)return a.splice(a.indexOf(this),1),this.terminate();v(this)}},r.color=(new THREE.Color).setHSL(Math.random(),.8,.8).getHexString(),a.push(r),E(r),i&&(r.postMessage({scene:R,camera:k,annex:S,sceneId:m}),v(r))}if(!i)for(;a.length>l;)a.pop().terminate()},this.setWorkers(l),this.setClearColor=function(e,t){c.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,o){n.width=e,n.height=o,t=n.width,r=n.height,s.fillStyle="white",a.forEach(E)},this.setSize(n.width,n.height),this.clear=function(){};var R,k,w,S={},y={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function z(e){var t=e.material;if(t&&!(t.uuid in S)){var r={};for(var o in y)void 0!==t[o]&&(r[o]=t[o]);S[t.uuid]=r}}this.render=function(e,n){i=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),null===n.parent&&n.updateMatrixWorld(),R=e.toJSON(),k=n.toJSON(),++m,e.traverse(z),a.forEach(function(e){e.postMessage({scene:R,camera:k,annex:S,sceneId:m})}),s.clearRect(0,0,t,r),w=Date.now(),f=Math.ceil(t/h),p=Math.ceil(r/h),d=f*p,u=[];for(var c=0;c<d;c++)u.push(c);if(o.randomize)for(c=0;c<d;c++){var l=Math.random()*d|0,g=u[l];u[l]=u[c],u[c]=g}a.forEach(v)}},Object.assign(THREE.RaytracingRenderer.prototype,THREE.EventDispatcher.prototype);