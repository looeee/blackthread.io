THREE.MD2Character=function(){var e=this;function i(e,i){for(var t=new THREE.TextureLoader,a=[],n=0;n<i.length;n++)a[n]=t.load(e+i[n],s),a[n].mapping=THREE.UVMapping,a[n].name=i[n];return a}function t(e,i){var t=new THREE.MeshLambertMaterial({color:16755200,wireframe:!0,morphTargets:!0,morphNormals:!0}),s=new THREE.MeshLambertMaterial({color:16777215,wireframe:!1,map:i,morphTargets:!0,morphNormals:!0}),a=new THREE.Mesh(e,s);return a.rotation.y=-Math.PI/2,a.castShadow=!0,a.receiveShadow=!0,a.materialTexture=s,a.materialWireframe=t,a}function s(){e.loadCounter-=1,0===e.loadCounter&&e.onLoadComplete()}this.scale=1,this.animationFPS=6,this.root=new THREE.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0,this.loadParts=function(a){this.loadCounter=2*a.weapons.length+a.skins.length+1;for(var n=[],o=0;o<a.weapons.length;o++)n[o]=a.weapons[o][1];this.skinsBody=i(a.baseUrl+"skins/",a.skins),this.skinsWeapon=i(a.baseUrl+"skins/",n);var h=new THREE.MD2Loader;h.load(a.baseUrl+a.body,function(i){i.computeBoundingBox(),e.root.position.y=-e.scale*i.boundingBox.min.y;var a=t(i,e.skinsBody[0]);a.scale.set(e.scale,e.scale,e.scale),e.root.add(a),e.meshBody=a,e.meshBody.clipOffset=0,e.activeAnimationClipName=a.geometry.animations[0].name,e.mixer=new THREE.AnimationMixer(a),s()});var r=function(i,a){return function(n){var o=t(n,e.skinsWeapon[i]);o.scale.set(e.scale,e.scale,e.scale),o.visible=!1,o.name=a,e.root.add(o),e.weapons[i]=o,e.meshWeapon=o,s()}};for(o=0;o<a.weapons.length;o++)h.load(a.baseUrl+a.weapons[o][0],r(o,a.weapons[o][0]))},this.setPlaybackRate=function(e){this.mixer.timeScale=0!==e?1/e:0},this.setWireframe=function(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))},this.setSkin=function(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])},this.setWeapon=function(i){for(var t=0;t<this.weapons.length;t++)this.weapons[t].visible=!1;var s=this.weapons[i];s&&(s.visible=!0,this.meshWeapon=s,e.syncWeaponAnimation())},this.setAnimation=function(i){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);var t=this.mixer.clipAction(i,this.meshBody);t&&(this.meshBody.activeAction=t.play())}e.activeClipName=i,e.syncWeaponAnimation()},this.syncWeaponAnimation=function(){var i=e.activeClipName;if(e.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);this.meshWeapon.geometry.animations;var t=this.mixer.clipAction(i,this.meshWeapon);t&&(this.meshWeapon.activeAction=t.syncWith(this.meshBody.activeAction).play())}},this.update=function(e){this.mixer&&this.mixer.update(e)}};