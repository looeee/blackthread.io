THREE.BokehPass=function(e,r,a){THREE.Pass.call(this),this.scene=e,this.camera=r;var t=void 0!==a.focus?a.focus:1,i=void 0!==a.aspect?a.aspect:r.aspect,s=void 0!==a.aperture?a.aperture:.025,h=void 0!==a.maxblur?a.maxblur:1,l=a.width||window.innerWidth||1,o=a.height||window.innerHeight||1;this.renderTargetColor=new THREE.WebGLRenderTarget(l,o,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat}),this.renderTargetColor.texture.name="BokehPass.color",this.renderTargetDepth=this.renderTargetColor.clone(),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new THREE.MeshDepthMaterial,this.materialDepth.depthPacking=THREE.RGBADepthPacking,this.materialDepth.blending=THREE.NoBlending,void 0===THREE.BokehShader&&console.error("THREE.BokehPass relies on THREE.BokehShader");var n=THREE.BokehShader,d=THREE.UniformsUtils.clone(n.uniforms);d.tDepth.value=this.renderTargetDepth.texture,d.focus.value=t,d.aspect.value=i,d.aperture.value=s,d.maxblur.value=h,d.nearClip.value=r.near,d.farClip.value=r.far,this.materialBokeh=new THREE.ShaderMaterial({defines:n.defines,uniforms:d,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.uniforms=d,this.needsSwap=!1,this.camera2=new THREE.OrthographicCamera(-1,1,1,-1,0,1),this.scene2=new THREE.Scene,this.quad2=new THREE.Mesh(new THREE.PlaneBufferGeometry(2,2),null),this.quad2.frustumCulled=!1,this.scene2.add(this.quad2),this.oldClearColor=new THREE.Color,this.oldClearAlpha=1},THREE.BokehPass.prototype=Object.assign(Object.create(THREE.Pass.prototype),{constructor:THREE.BokehPass,render:function(e,r,a,t,i){this.quad2.material=this.materialBokeh,this.scene.overrideMaterial=this.materialDepth,this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha();e.autoClear;e.autoClear=!1,e.setClearColor(16777215),e.setClearAlpha(1),e.render(this.scene,this.camera,this.renderTargetDepth,!0),this.uniforms.tColor.value=a.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?e.render(this.scene2,this.camera2):e.render(this.scene2,this.camera2,r,this.clear),this.scene.overrideMaterial=null,e.setClearColor(this.oldClearColor),e.setClearAlpha(this.oldClearAlpha),e.autoClear=this.oldAutoClear}});