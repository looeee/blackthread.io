THREE.Lut=function(e,t){this.lut=[],this.map=THREE.ColorMapKeywords[e],this.n=t,this.mapname=e;for(var i=1/this.n,n=0;n<=1;n+=i)for(var s=0;s<this.map.length-1;s++)if(n>=this.map[s][0]&&n<this.map[s+1][0]){var l=this.map[s][0],h=this.map[s+1][0],o=new THREE.Color(16777215).setHex(this.map[s][1]),a=new THREE.Color(16777215).setHex(this.map[s+1][1]),d=o.lerp(a,(n-l)/(h-l));this.lut.push(d)}return this.set(this)},THREE.Lut.prototype={constructor:THREE.Lut,lut:[],map:[],mapname:"rainbow",n:256,minV:0,maxV:1,legend:null,set:function(e){return e instanceof THREE.Lut&&this.copy(e),this},setMin:function(e){return this.minV=e,this},setMax:function(e){return this.maxV=e,this},changeNumberOfColors:function(e){return this.n=e,new THREE.Lut(this.mapname,this.n)},changeColorMap:function(e){return this.mapname=e,new THREE.Lut(this.mapname,this.n)},copy:function(e){return this.lut=e.lut,this.mapname=e.mapname,this.map=e.map,this.n=e.n,this.minV=e.minV,this.maxV=e.maxV,this},getColor:function(e){e<=this.minV?e=this.minV:e>=this.maxV&&(e=this.maxV),e=(e-this.minV)/(this.maxV-this.minV);var t=Math.round(e*this.n);return t==this.n&&(t-=1),this.lut[t]},addColorMap:function(e,t){THREE.ColorMapKeywords[e]=t},setLegendOn:function(e){void 0===e&&(e={}),this.legend={},this.legend.layout=e.hasOwnProperty("layout")?e.layout:"vertical",this.legend.position=e.hasOwnProperty("position")?e.position:{x:21.5,y:8,z:5},this.legend.dimensions=e.hasOwnProperty("dimensions")?e.dimensions:{width:.5,height:3},this.legend.canvas=document.createElement("canvas"),this.legend.canvas.setAttribute("id","legend"),this.legend.canvas.setAttribute("hidden",!0),document.body.appendChild(this.legend.canvas),this.legend.ctx=this.legend.canvas.getContext("2d"),this.legend.canvas.setAttribute("width",1),this.legend.canvas.setAttribute("height",this.n),this.legend.texture=new THREE.Texture(this.legend.canvas);var t=this.legend.ctx.getImageData(0,0,1,this.n),i=t.data;this.map=THREE.ColorMapKeywords[this.mapname];for(var n=0,s=1/this.n,l=1;l>=0;l-=s)for(var h=this.map.length-1;h>=0;h--)if(l<this.map[h][0]&&l>=this.map[h-1][0]){var o=this.map[h-1][0],a=this.map[h][0],d=new THREE.Color(16777215).setHex(this.map[h-1][1]),r=new THREE.Color(16777215).setHex(this.map[h][1]),g=d.lerp(r,(l-o)/(a-o));i[4*n]=Math.round(255*g.r),i[4*n+1]=Math.round(255*g.g),i[4*n+2]=Math.round(255*g.b),i[4*n+3]=255,n+=1}return this.legend.ctx.putImageData(t,0,0),this.legend.texture.needsUpdate=!0,this.legend.legendGeometry=new THREE.PlaneBufferGeometry(this.legend.dimensions.width,this.legend.dimensions.height),this.legend.legendMaterial=new THREE.MeshBasicMaterial({map:this.legend.texture,side:THREE.DoubleSide}),this.legend.mesh=new THREE.Mesh(this.legend.legendGeometry,this.legend.legendMaterial),"horizontal"==this.legend.layout&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh.position.copy(this.legend.position),this.legend.mesh},setLegendOff:function(){return this.legend=null,this.legend},setLegendLayout:function(e){return!!this.legend&&(this.legend.layout!=e&&(("horizontal"==e||"vertical"==e)&&(this.layout=e,"horizontal"==e&&(this.legend.mesh.rotation.z=Math.PI/180*90),"vertical"==e&&(this.legend.mesh.rotation.z=Math.PI/180*-90),this.legend.mesh)))},setLegendPosition:function(e){return this.legend.position=new THREE.Vector3(e.x,e.y,e.z),this.legend},setLegendLabels:function(e,t){if(!this.legend)return!1;"function"==typeof e&&(t=e),void 0===e&&(e={}),this.legend.labels={},this.legend.labels.fontsize=e.hasOwnProperty("fontsize")?e.fontsize:24,this.legend.labels.fontface=e.hasOwnProperty("fontface")?e.fontface:"Arial",this.legend.labels.title=e.hasOwnProperty("title")?e.title:"",this.legend.labels.um=e.hasOwnProperty("um")?" [ "+e.um+" ]":"",this.legend.labels.ticks=e.hasOwnProperty("ticks")?e.ticks:0,this.legend.labels.decimal=e.hasOwnProperty("decimal")?e.decimal:2,this.legend.labels.notation=e.hasOwnProperty("notation")?e.notation:"standard";var i=255,n=100,s=100,l=.8,h=255,o=0,a=0,d=1,r=document.createElement("canvas"),g=r.getContext("2d");g.font="Normal "+1.2*this.legend.labels.fontsize+"px "+this.legend.labels.fontface;g.measureText(this.legend.labels.title.toString()+this.legend.labels.um.toString()).width;g.fillStyle="rgba("+i+","+n+","+s+","+l+")",g.strokeStyle="rgba("+h+","+o+","+a+","+d+")",g.lineWidth=4,g.fillStyle="rgba( 0, 0, 0, 1.0 )",g.fillText(this.legend.labels.title.toString()+this.legend.labels.um.toString(),4,this.legend.labels.fontsize+4);var m=new THREE.CanvasTexture(r);m.minFilter=THREE.LinearFilter;var p=new THREE.SpriteMaterial({map:m}),u=new THREE.Sprite(p);if(u.scale.set(2,1,1),"vertical"==this.legend.layout&&u.position.set(this.legend.position.x+this.legend.dimensions.width,this.legend.position.y+.45*this.legend.dimensions.height,this.legend.position.z),"horizontal"==this.legend.layout&&u.position.set(1.015*this.legend.position.x,this.legend.position.y+.03*this.legend.dimensions.height,this.legend.position.z),this.legend.labels.ticks>0){var c={},E={};if("vertical"==this.legend.layout)var f=this.legend.position.y+.36*this.legend.dimensions.height,x=this.legend.position.y-.61*this.legend.dimensions.height;if("horizontal"==this.legend.layout)var y=this.legend.position.x+.75*this.legend.dimensions.height,w=this.legend.position.x-1.2*this.legend.dimensions.width;for(var v=0;v<this.legend.labels.ticks;v++){var b=(this.maxV-this.minV)/(this.legend.labels.ticks-1)*v+this.minV;b=t?t(b):"scientific"==this.legend.labels.notation?b.toExponential(this.legend.labels.decimal):b.toFixed(this.legend.labels.decimal);var F=document.createElement("canvas"),T=F.getContext("2d");T.font="Normal "+this.legend.labels.fontsize+"px "+this.legend.labels.fontface;T.measureText(b.toString()).width;T.fillStyle="rgba("+i+","+n+","+s+","+l+")",T.strokeStyle="rgba("+h+","+o+","+a+","+d+")",T.lineWidth=4,T.fillStyle="rgba( 0, 0, 0, 1.0 )",T.fillText(b.toString(),4,this.legend.labels.fontsize+4);var H=new THREE.CanvasTexture(F);H.minFilter=THREE.LinearFilter;var R=new THREE.SpriteMaterial({map:H}),V=new THREE.Sprite(R);if(V.scale.set(2,1,1),"vertical"==this.legend.layout){var z=x+(f-x)*((b-this.minV)/(this.maxV-this.minV));V.position.set(this.legend.position.x+2.7*this.legend.dimensions.width,z,this.legend.position.z)}if("horizontal"==this.legend.layout){z=w+(y-w)*((b-this.minV)/(this.maxV-this.minV));if(this.legend.labels.ticks>5)if(v%2==0)var C=1.7;else C=2.1;else C=1.7;V.position.set(z,this.legend.position.y-this.legend.dimensions.width*C,this.legend.position.z)}var M=new THREE.LineBasicMaterial({color:0,linewidth:2}),L=[];if("vertical"==this.legend.layout){var S=this.legend.position.y-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((b-this.minV)/(this.maxV-this.minV)*.99);L.push(new THREE.Vector3(this.legend.position.x+.55*this.legend.dimensions.width,S,this.legend.position.z)),L.push(new THREE.Vector3(this.legend.position.x+.7*this.legend.dimensions.width,S,this.legend.position.z))}if("horizontal"==this.legend.layout){S=this.legend.position.x-.5*this.legend.dimensions.height+.01+this.legend.dimensions.height*((b-this.minV)/(this.maxV-this.minV)*.99);L.push(new THREE.Vector3(S,this.legend.position.y-.55*this.legend.dimensions.width,this.legend.position.z)),L.push(new THREE.Vector3(S,this.legend.position.y-.7*this.legend.dimensions.width,this.legend.position.z))}var P=(new THREE.BufferGeometry).setFromPoints(L),O=new THREE.Line(P,M);E[v]=O,c[v]=V}}return{title:u,ticks:c,lines:E}}},THREE.ColorMapKeywords={rainbow:[[0,"0x0000FF"],[.2,"0x00FFFF"],[.5,"0x00FF00"],[.8,"0xFFFF00"],[1,"0xFF0000"]],cooltowarm:[[0,"0x3C4EC2"],[.2,"0x9BBCFF"],[.5,"0xDCDCDC"],[.8,"0xF6A385"],[1,"0xB40426"]],blackbody:[[0,"0x000000"],[.2,"0x780000"],[.5,"0xE63200"],[.8,"0xFFFF00"],[1,"0xFFFFFF"]],grayscale:[[0,"0x000000"],[.2,"0x404040"],[.5,"0x7F7F80"],[.8,"0xBFBFBF"],[1,"0xFFFFFF"]]};