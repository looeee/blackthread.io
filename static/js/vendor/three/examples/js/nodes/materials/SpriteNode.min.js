THREE.SpriteNode=function(){THREE.GLNode.call(this),this.color=new THREE.ColorNode(15658734),this.spherical=!0},THREE.SpriteNode.prototype=Object.create(THREE.GLNode.prototype),THREE.SpriteNode.prototype.constructor=THREE.SpriteNode,THREE.SpriteNode.prototype.nodeType="Sprite",THREE.SpriteNode.prototype.build=function(e){var t,o=e.material;if(o.define("SPRITE"),o.requires.lights=!1,o.requires.transparent=void 0!=this.alpha,e.isShader("vertex")){var r=this.transform?this.transform.parseAndBuildCode(e,"v3",{cache:"transform"}):void 0;o.mergeUniform(THREE.UniformsUtils.merge([THREE.UniformsLib.fog])),o.addVertexPars(["#include <fog_pars_vertex>"].join("\n")),t=["#include <begin_vertex>"],r&&t.push(r.code,"transformed = "+r.result+";"),t.push("#include <project_vertex>","#include <fog_vertex>","mat4 modelViewMtx = modelViewMatrix;","mat4 modelMtx = modelMatrix;","modelMtx[3][0] = 0.0;","modelMtx[3][1] = 0.0;","modelMtx[3][2] = 0.0;"),this.spherical||t.push("modelMtx[1][1] = 1.0;"),t.push("modelViewMtx[0][0] = 1.0;","modelViewMtx[0][1] = 0.0;","modelViewMtx[0][2] = 0.0;"),this.spherical&&t.push("modelViewMtx[1][0] = 0.0;","modelViewMtx[1][1] = 1.0;","modelViewMtx[1][2] = 0.0;"),t.push("modelViewMtx[2][0] = 0.0;","modelViewMtx[2][1] = 0.0;","modelViewMtx[2][2] = 1.0;","gl_Position = projectionMatrix * modelViewMtx * modelMtx * vec4( transformed, 1.0 );")}else{o.addFragmentPars(["#include <fog_pars_fragment>"].join("\n")),this.color.parse(e,{slot:"color"}),this.alpha&&this.alpha.parse(e);var i=this.color.buildCode(e,"c",{slot:"color"}),s=this.alpha?this.alpha.buildCode(e,"fv1"):void 0;t=[i.code],s?t.push(s.code,"gl_FragColor = vec4( "+i.result+", "+s.result+" );"):t.push("gl_FragColor = vec4( "+i.result+", 1.0 );"),t.push("#include <fog_fragment>")}return t.join("\n")},THREE.SpriteNode.prototype.toJSON=function(e){var t=this.getJSONNode(e);return t||(t=this.createJSONNode(e),this.transform&&(t.transform=this.transform.toJSON(e).uuid),t.color=this.color.toJSON(e).uuid,!1===this.spherical&&(t.spherical=!1),this.alpha&&(t.alpha=this.alpha.toJSON(e).uuid)),t};