THREE.VelocityNode=function(t,e){THREE.Vector3Node.call(this),this.params={},this.velocity=new THREE.Vector3,this.setTarget(t),this.setParams(e)},THREE.VelocityNode.prototype=Object.create(THREE.Vector3Node.prototype),THREE.VelocityNode.prototype.constructor=THREE.VelocityNode,THREE.VelocityNode.prototype.nodeType="Velocity",THREE.VelocityNode.prototype.isReadonly=function(t){return!1},THREE.VelocityNode.prototype.setParams=function(t){switch(this.params.type){case"elastic":delete this.moment,delete this.speed,delete this.springVelocity,delete this.lastVelocity}switch(this.params=t||{},this.params.type){case"elastic":this.moment=new THREE.Vector3,this.speed=new THREE.Vector3,this.springVelocity=new THREE.Vector3,this.lastVelocity=new THREE.Vector3}},THREE.VelocityNode.prototype.setTarget=function(t){this.target&&(delete this.position,delete this.oldPosition),this.target=t,t&&(this.position=t.getWorldPosition(),this.oldPosition=this.position.clone())},THREE.VelocityNode.prototype.updateFrameVelocity=function(t){this.target&&(this.position=this.target.getWorldPosition(),this.velocity.subVectors(this.position,this.oldPosition),this.oldPosition.copy(this.position))},THREE.VelocityNode.prototype.updateFrame=function(t){switch(this.updateFrameVelocity(t),this.params.type){case"elastic":var e=t.delta*(this.params.fps||60),i=Math.pow(this.params.spring,e),o=Math.pow(this.params.damping,e);this.velocity.multiplyScalar(Math.exp(-this.params.damping*e)),this.velocity.add(this.springVelocity),this.velocity.add(this.speed.multiplyScalar(o).multiplyScalar(1-i)),this.speed.subVectors(this.velocity,this.lastVelocity),this.springVelocity.add(this.speed),this.springVelocity.multiplyScalar(i),this.moment.add(this.springVelocity),this.moment.multiplyScalar(o),this.lastVelocity.copy(this.velocity),this.value.copy(this.moment);break;default:this.value.copy(this.velocity)}},THREE.VelocityNode.prototype.toJSON=function(t){var e=this.getJSONNode(t);return e||(e=this.createJSONNode(t),this.target&&(e.target=this.target.uuid),e.params=JSON.parse(JSON.stringify(this.params))),e};