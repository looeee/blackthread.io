THREE.NodeBuilder=function(e){this.material=e,this.caches=[],this.slots=[],this.keywords={},this.parsing=!1,this.optimize=!0,this.update()},THREE.NodeBuilder.type={float:"fv1",vec2:"v2",vec3:"v3",vec4:"v4",mat4:"v4",int:"iv1"},THREE.NodeBuilder.constructors=["float","vec2","vec3","vec4"],THREE.NodeBuilder.elements=["x","y","z","w"],THREE.NodeBuilder.prototype={constructor:THREE.NodeBuilder,addCache:function(e,t){return this.caches.push({name:e||"",requires:t||{}}),this.update()},removeCache:function(){return this.caches.pop(),this.update()},addSlot:function(e){return this.slots.push({name:e||""}),this.update()},removeSlot:function(){return this.slots.pop(),this.update()},isCache:function(e){for(var t=this.caches.length;t--;)if(this.caches[t].name==e)return!0;return!1},isSlot:function(e){for(var t=this.slots.length;t--;)if(this.slots[t].name==e)return!0;return!1},update:function(){var e=this.caches[this.caches.length-1],t=this.slots[this.slots.length-1];return this.slot=t?t.name:"",this.cache=e?e.name:"",this.requires=e?e.requires:{},this},require:function(e,t){return this.requires[e]=t,this},include:function(e,t,r){return this.material.include(this,e,t,r),this},colorToVector:function(e){return e.replace("r","x").replace("g","y").replace("b","z").replace("a","w")},getConstructorFromLength:function(e){return THREE.NodeBuilder.constructors[e-1]},getFormatName:function(e){return e.replace(/c/g,"v3").replace(/fv1/g,"v1").replace(/iv1/g,"i")},isFormatMatrix:function(e){return/^m/.test(e)},getFormatLength:function(e){return parseInt(this.getFormatName(e).substr(1))},getFormatFromLength:function(e){return 1==e?"fv1":"v"+e},format:function(e,t,r){switch(this.getFormatName(r+"="+t)){case"v1=v2":case"v1=v3":case"v1=v4":return e+".x";case"v1=i":return"float("+e+")";case"v2=v1":return"vec2("+e+")";case"v2=v3":case"v2=v4":return e+".xy";case"v2=i":return"vec2(float("+e+"))";case"v3=v1":return"vec3("+e+")";case"v3=v2":return"vec3("+e+",0.0)";case"v3=v4":return e+".xyz";case"v3=i":return"vec2(float("+e+"))";case"v4=v1":return"vec4("+e+")";case"v4=v2":return"vec4("+e+",0.0,1.0)";case"v4=v3":return"vec4("+e+",1.0)";case"v4=i":return"vec4(float("+e+"))";case"i=v1":return"int("+e+")";case"i=v2":case"i=v3":case"i=v4":return"int("+e+".x)"}return e},getTypeByFormat:function(e){return THREE.NodeBuilder.type[e]||e},getUuid:function(e,t){return(t=void 0===t||t)&&this.cache&&(e=this.cache+"-"+e),e},getElementByIndex:function(e){return THREE.NodeBuilder.elements[e]},getIndexByElement:function(e){return THREE.NodeBuilder.elements.indexOf(e)},isShader:function(e){return this.shader==e},setShader:function(e){return this.shader=e,this}};