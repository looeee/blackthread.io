THREE.GLNode=function(e){this.uuid=THREE.Math.generateUUID(),this.name="",this.allows={},this.type=e,this.userData={}},THREE.GLNode.prototype.isNode=!0,THREE.GLNode.prototype.parse=function(e,t){t=t||{},e.parsing=!0;var o=e.material;this.build(e.addCache(t.cache,t.requires).addSlot(t.slot),"v4"),o.clearVertexNode(),o.clearFragmentNode(),e.removeCache().removeSlot(),e.parsing=!1},THREE.GLNode.prototype.parseAndBuildCode=function(e,t,o){return o=o||{},this.parse(e,o),this.buildCode(e,t,o)},THREE.GLNode.prototype.buildCode=function(e,t,o){o=o||{};var i=e.material,r={result:this.build(e.addCache(o.cache,o.requires).addSlot(o.slot),t)};return e.isShader("vertex")?r.code=i.clearVertexNode():r.code=i.clearFragmentNode(),e.removeCache().removeSlot(),r},THREE.GLNode.prototype.build=function(e,t,o){t=t||this.getType(e,t);var i=e.material,r=i.getDataNode(o||this.uuid);if(e.parsing&&this.appendDepsNode(e,r,t),!1===this.allows[e.shader])throw new Error("Shader "+shader+" is not compatible with this node.");return-1===i.nodes.indexOf(this)&&i.nodes.push(this),void 0!==this.updateFrame&&-1===i.updaters.indexOf(this)&&i.updaters.push(this),this.generate(e,t,o)},THREE.GLNode.prototype.appendDepsNode=function(e,t,o){t.deps=(t.deps||0)+1;var i=e.getFormatLength(o);(i>(t.outputMax||0)||this.getType(e,o))&&(t.outputMax=i,t.output=o)},THREE.GLNode.prototype.getType=function(e,t){return"sampler2D"===t||"samplerCube"===t?t:this.type},THREE.GLNode.prototype.getJSONNode=function(e){if(!(void 0===e||"string"==typeof e)&&void 0!==e.nodes[this.uuid])return e.nodes[this.uuid]},THREE.GLNode.prototype.createJSONNode=function(e){var t=void 0===e||"string"==typeof e,o={};if("string"!=typeof this.nodeType)throw new Error("Node does not allow serialization.");return o.uuid=this.uuid,o.type=this.nodeType+"Node",""!==this.name&&(o.name=this.name),"{}"!==JSON.stringify(this.userData)&&(o.userData=this.userData),t||(e.nodes[this.uuid]=o),o},THREE.GLNode.prototype.toJSON=function(e){return this.getJSONNode(e)||this.createJSONNode(e)};